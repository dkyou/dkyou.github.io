[{"title":"è§£å†³vmwareè™šæ‹Ÿæœºå ç”¨ç£ç›˜ç©ºé—´è¿‡å¤§çš„é—®é¢˜","path":"/2025/11/06/è§£å†³vmwareè™šæ‹Ÿæœºå ç”¨ç£ç›˜ç©ºé—´è¿‡å¤§çš„é—®é¢˜/","content":"è§£å†³vmwareè™šæ‹Ÿæœºå ç”¨ç£ç›˜ç©ºé—´è¿‡å¤§çš„é—®é¢˜èµ·å› æ—©éƒ½æƒ³è§£å†³vmwareç£ç›˜å ç”¨è¿‡å¤§çš„é—®é¢˜ï¼Œå°è¯•äº†ç½‘ä¸Šçš„å‡ ç§æ–¹æ³•æ²¡æœ‰ä»»ä½•ä¼˜åŒ–ã€‚æœ€è¿‘è„‘ç£ç›˜åˆå¼€å§‹é£˜çº¢ï¼Œå¿æ— å¯å¿ï¼Œæ— éœ€å†å¿ï¼Œè¿™æ¬¡ä¸‹å®šå†³å¿ƒä¼˜åŒ–ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚ å…ˆæŸ¥çœ‹ä¸€ä¸‹ä¼˜åŒ–å‰Ubuntu 18.04.2 (64bit).vmdkå ç”¨å†…å­˜å¤§å°ï¼Œç«Ÿç„¶å ç”¨220gï¼Œå®åœ¨æ˜¯å¤¸å¼ ï¼Œæ„Ÿè§‰åƒæ˜¯è£…äº†ä¸€ä¸ª3aå¤§ä½œä¸€æ ·ã€‚ ä¸æ­¢äºæ­¤ï¼Œæ­¤å‰ä¸ºäº†é˜²æ­¢ä¸€ä¸ªè™šæ‹Ÿæœºå ç”¨è¿‡å¤§çš„ç©ºé—´ï¼Œæˆ‘åœ¨åšæ¯ä¸ªé¡¹ç›®çš„æ—¶å€™éƒ½ä¼šå•ç‹¬å¤åˆ¶ä¸€ä»½è™šæ‹Ÿæœºï¼Œç”¨å®Œå°±åˆ é™¤ï¼Œåé¢å‘ç°éšä¾¿å¤åˆ¶ä¸€ä¸ªè™šæ‹Ÿæœºï¼Œéƒ½èƒ½ä»10gè½»æ¾æ‰©å……åˆ°60å¤šgã€‚ åŸå› è™šæ‹Ÿæœºçš„ç£ç›˜æ˜¯ â€œç¨€ç–ï¼ˆgrowablesparseï¼‰â€ ç±»å‹ï¼ŒVMware ä¸€å¼€å§‹åªåˆ›å»ºä¸€ä¸ªå°æ–‡ä»¶ï¼Œä½†éšç€ç³»ç»Ÿè¿è¡Œã€æ–‡ä»¶å†™å…¥ï¼Œå®ƒä¼šæŒ‰éœ€è‡ªåŠ¨è†¨èƒ€ï¼Œç›´åˆ°è¾¾åˆ°åˆ›å»ºæ—¶çš„æœ€å¤§å€¼ã€‚ ä¸ºä»€ä¹ˆæˆ‘å·²ç»åœ¨è™šæ‹Ÿæœºä¸­æŠŠä¸‹è½½çš„æ–‡ä»¶åˆ é™¤äº†ï¼Œè€Œvmdkå ç”¨ç©ºé—´å¹¶æ²¡æœ‰å‡å°‘ï¼Ÿ å³ä¾¿ä½ åœ¨ Ubuntu é‡Œåˆ é™¤äº†å¾ˆå¤šæ–‡ä»¶ï¼Œè¿™äº›ç©ºé—²å—æ²¡æœ‰è¢«â€œå½’é›¶â€ï¼Œå¯¹å®¿ä¸»æœºæ¥è¯´ä»ç„¶å ç”¨ç©ºé—´ã€‚ å› æ­¤è§£å†³æ–¹æ³•å°±æ˜¯å°†è¿™äº›ç©ºé—²å—æ¸…é›¶ï¼Œç„¶åé€šè¿‡VMware shrink å·¥å…·å°†è¿™äº›æ¸…é›¶å—å›æ”¶ï¼Œä»è€Œè¾¾åˆ°é‡Šæ”¾ç£ç›˜ç©ºé—´çš„ç›®çš„ è§£å†³æ–¹æ³•1) åœ¨ubuntuè™šæ‹Ÿæœºä¸­å°†ç©ºé—²å—æ¸…é›¶ç¢ç‰‡æ•´ç† #æ‰“å¼€Ubuntuè™šæ‹Ÿæœºsudo apt-get autoremovesudo apt-get cleansudo dd if=/dev/zero of=/zero.fill bs=1M status=progress || truesudo rm /zero.fill#æ¸…é™¤å›æ”¶ç«™æ–‡ä»¶ä¸ç¼“å­˜æ–‡ä»¶sudo rm -rf .local/share/Trash/*sudo rm -rf .cache/*sudo sudo dd if=/dev/zero of=/tmpfile#å°†ç¢ç‰‡ç©ºé—´å¡«å……ä¸Š0ï¼Œç»“æŸçš„æ—¶å€™ä¼šæç¤ºç£ç›˜ç©ºé—´ä¸è¶³ï¼Œå¿½ç•¥å³å¯sudo rm -rf /tmpfile #åˆ é™¤ç¬¬äºŒæ­¥çš„å¡«å……ï¼Œå¦‚æœç”¨df -h ä¼šå‘ç°å¯ç”¨çš„è™šæ‹Ÿç©ºé—´å¢åŠ è®¸å¤šï¼Œä½†æ˜¯å®é™…çš„ç£ç›˜ç©ºé—´æ²¡æœ‰ç¼©å‡ 2) åœ¨windowsä¸‹ä½¿ç”¨shrinkå›æ”¶æ¸…é›¶å—ç¢ç‰‡å›æ”¶ ./vmware-vdiskmanager.exe -k H:\\dky-ubuntu18.04\\ubuntu18.04_vscode_imx6ull_pro\\Ubuntu 18.04.2 (64bit).vmdk ç»“æœ ç»è¿‡æ¼«é•¿çš„ç­‰å¾…ä¹‹åï¼Œå‘ç°ä»åŸæœ¬çš„220gå‡å°‘åˆ°201gã€‚ è¿˜æ˜¯ä¸å¤Ÿç†æƒ³ã€‚ ç»ˆæå¤§æ³•é‡æ–°ç”Ÿæˆç£ç›˜æ–‡ä»¶ç»“æ„ï¼Œè€Œä¸ä»…æ˜¯ shrinkD:\\LinuxLearningInstall\\VMware\\vmware-vdiskmanager.exe ` -r H:\\dky-ubuntu18.04\\ubuntu18.04_vscode_imx6ull_pro\\Ubuntu 18.04.2 (64bit).vmdk ` -t 1 H:\\dky-ubuntu18.04\\ubuntu18.04_vscode_imx6ull_pro\\Ubuntu-compact.vmdk -rï¼šä»æ—§ç›˜è¯»å–ã€‚ -t 1ï¼šåˆ›å»º split growableï¼ˆ2 GB åˆ†ç‰‡ï¼‰ç¨€ç–ç£ç›˜ï¼Œä½“ç§¯ä¼šæ ¹æ®å®é™…æ•°æ®åŠ¨æ€å¢é•¿ã€‚ æ–°ç”Ÿæˆçš„ Ubuntu-compact.vmdk ä¼šè‡ªåŠ¨å‰”é™¤æ‰€æœ‰æ— æ•ˆå— é¢„æœŸæ•ˆæœæœ€ç»ˆä¸ºå‡ ågï¼Œå–å†³äºå®é™…ubuntuä½¿ç”¨äº†å¤šå°‘ç©ºé—´ã€‚ å¦‚æœä¸Šè¿°æ“ä½œæ²¡æœ‰æ˜æ˜¾æ•ˆæœï¼Œå»ºè®®åœ¨æ­¤ä¹‹å‰å†æ¸…é›¶ä¸€æ¬¡ sudo apt-get cleansudo rm -rf /tmp/*sudo journalctl --vacuum-time=1dsudo dd if=/dev/zero of=/zero.fill bs=1M status=progress || truesyncsudo rm /zero.fillsudo poweroff ä¸Šè¿°æ“ä½œåŸç†VMware çš„ .vmdk å°±ç›¸å½“äºä¸€å—â€œè™šæ‹Ÿç¡¬ç›˜â€ã€‚ vmware-vdiskmanager -kï¼šåªåœ¨æ–‡ä»¶å±‚é¢åšå‹ç¼©ï¼Œä¸ä¼šåŠ¨é‡Œé¢çš„æ•°æ®ã€‚ vmware-vdiskmanager -r ... -t ...ï¼šç›¸å½“äºâ€œå…‹éš†ç¡¬ç›˜â€ï¼ŒæŠŠåŸç£ç›˜é‡Œæ‰€æœ‰æœ‰æ•ˆçš„æ•°æ®å—ï¼ˆæ“ä½œç³»ç»Ÿã€é…ç½®æ–‡ä»¶ã€ç”¨æˆ·æ–‡ä»¶ç­‰ï¼‰å®Œæ•´å¤åˆ¶åˆ°ä¸€ä¸ªæ–°ç£ç›˜æ–‡ä»¶ä¸­ã€‚ å®ƒä¸æ”¹åŠ¨ Ubuntu å†…éƒ¨æ–‡ä»¶ç³»ç»Ÿï¼Œåªæ˜¯é‡å»ºç£ç›˜ç»“æ„ã€å»æ‰ç©ºç™½åŒºã€‚ æ‰€ä»¥ï¼š Ubuntu å†…çš„ /home/ä½ çš„ç”¨æˆ·å/ ç›®å½•ä¸‹çš„æ–‡ä»¶ã€æ¡Œé¢ã€é…ç½®ã€ä¸‹è½½ã€VS Code å·¥ä½œåŒºã€ROSã€IMX6ULL å·¥ç¨‹æ–‡ä»¶ç­‰éƒ½ä¼šå®Œå¥½æ— æŸï¼› Ubuntu çš„ç”¨æˆ·è´¦å·ã€å¯†ç ã€åŒ…ç®¡ç†é…ç½®ä¹Ÿéƒ½ä¿ç•™ï¼› å…‹éš†å®Œæˆåè™šæ‹Ÿæœºå¯åŠ¨èµ·æ¥ï¼Œçœ‹èµ·æ¥å’ŒåŸæ¥ä¸€æ¨¡ä¸€æ · æ³¨æ„ éœ€è¦æŠŠå¿«ç…§åˆ é™¤ éœ€è¦é¢„ç•™ä¸¤å€ç£ç›˜ç©ºé—´ ä»¥ä¸Šæ“ä½œè€—æ—¶å¾ˆä¹…","tags":["vmvare"],"categories":["Linux"]},{"title":"æµ‹è¯•ä¸€äº›ç‰¹æ€§","path":"/2025/11/03/hello-world/","content":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post$ hexo new My New Post More info: Writing Run server$ hexo server More info: Server Generate static files$ hexo generate More info: Generating Deploy to remote sites$ hexo deploy More info: Deployment 1æ–‡è¨€æ–‡å‡ºå¸ˆè¡¨å…ˆå¸åˆ›ä¸šæœªåŠè€Œä¸­é“å´©æ®‚ï¼Œä»Šå¤©ä¸‹ä¸‰åˆ†ï¼Œç›Šå·ç–²å¼Šï¼Œæ­¤è¯šå±æ€¥å­˜äº¡ä¹‹ç§‹ä¹Ÿã€‚ç„¶ä¾å«ä¹‹è‡£ä¸æ‡ˆäºå†…ï¼Œå¿ å¿—ä¹‹å£«å¿˜èº«äºå¤–è€…ï¼Œç›–è¿½å…ˆå¸ä¹‹æ®Šé‡ï¼Œæ¬²æŠ¥ä¹‹äºé™›ä¸‹ä¹Ÿã€‚è¯šå®œå¼€å¼ åœ£å¬ï¼Œä»¥å…‰å…ˆå¸é—å¾·ï¼Œæ¢å¼˜å¿—å£«ä¹‹æ°”ï¼Œä¸å®œå¦„è‡ªè²è–„ï¼Œå¼•å–»å¤±ä¹‰ï¼Œä»¥å¡å¿ è°ä¹‹è·¯ä¹Ÿã€‚åå‡ºå¸ˆè¡¨å…ˆå¸æ·±è™‘æ±‰ã€è´¼ä¸ä¸¤ç«‹ï¼Œç‹ä¸šä¸åå®‰ï¼Œæ•…æ‰˜è‡£ä»¥è®¨è´¼ä¹Ÿã€‚ä»¥å…ˆå¸ä¹‹æ˜ï¼Œé‡è‡£ä¹‹æ‰ï¼Œå›ºçŸ¥è‡£ä¼è´¼ï¼Œæ‰å¼±æ•Œå¼ºä¹Ÿã€‚ç„¶ä¸ä¼è´¼ï¼Œç‹ä¸šäº¦äº¡ã€‚æƒŸåè€Œå¾…äº¡ï¼Œå­°ä¸ä¼ä¹‹ï¼Ÿæ˜¯æ•…æ‰˜è‡£è€Œå¼—ç–‘ä¹Ÿã€‚è¯¸è‘›äº®ä¸‰å›½èŠ‚é€‰ 2 æ¨ªå‘é“ºæ»¡çš„å›¾ç‰‡å›¾ç‰‡ç”± xaoxuu æ‹æ‘„äºä¸€ä¸ªæ™®é€šçš„é˜³å…‰æ˜åªšçš„ä¸‹åˆ ç«–å›¾ æ”¯æŒ Fancybox æ’ä»¶ç‚¹å‡»æ”¾å¤§å›¾ç‰‡ç”± xaoxuu æ‹æ‘„äºä¸€ä¸ªæ™®é€šçš„é˜³å…‰æ˜åªšçš„ä¸‹åˆ linkå¡ç‰‡ä¸å¸¦æ‘˜è¦çš„æ ·å¼ï¼š https://xaoxuu.com/blog/20221029/https://xaoxuu.com/blog/20221029/ å¸¦æ‘˜è¦çš„æ ·å¼ï¼š https://xaoxuu.com/blog/20221029/https://xaoxuu.com/blog/20221029/ buttonæŒ‰é’®æ¢ç´¢ ç›®æ ‡ç®¡ç† O1 2077å¹´çš„å°ç›®æ ‡ï¼šå®Œæˆ Volantis 6.0 å¹¶å‘å¸ƒä¸Šçº¿ æ¥è‡ª2077å¹´æœ«çš„å¤ç›˜ï¼šå·²ã€ŠåŸºæœ¬ã€‹å®ç°ç›®æ ‡ æ­£å¸¸ 44% KR1 é‡æ„ tag-plugins å’Œ wiki ç³»ç»Ÿ å½“ KR è¿›åº¦ä¸º 100% æ—¶ï¼Œæ ‡ç­¾é»˜è®¤æ˜¾ç¤ºä¸º å·²å®Œæˆå½“ KR æœªè®¾ç½®è¿›åº¦æ—¶ï¼Œé»˜è®¤ä¸º 0%å½“ O æœªè®¾ç½®è¿›åº¦æ—¶ï¼Œåˆ™æ˜¾ç¤ºæ‰€æœ‰ KR è¿›åº¦å¹³å‡å€¼ å·²å®Œæˆ 100% KR2 å®Œæˆä¸»è¦é¡µé¢è®¾è®¡ç¨¿ å°æç¤º1å°æç¤º2æ‚¨å¯ä»¥åœ¨ _config.yml æ–‡ä»¶ä¸­ä¿®æ”¹æ ‡ç­¾çš„é¢œè‰²å’Œæ–‡æ¡ˆæ‚¨å¯ä»¥åœ¨ _config.yml æ–‡ä»¶ä¸­å¢åŠ ä»»æ„çš„æ ‡ç­¾é…ç½® å»¶æœŸ 90% KR3 å®Œæˆå‰ç½®å‡†å¤‡å·¥ä½œï¼ˆå¦‚æœä½ çŸ¥é“ç­”æ¡ˆï¼Œè¯·åœ¨ç•™è¨€åŒºå¸®å¸®æˆ‘ï¼ğŸ¥¹ï¼‰ åœ¨å’¸æ°´å’Œæµ·æ»©ä¹‹é—´æ‰¾ä¸€äº©åœ°æ±‚å‡ºåœ†å‘¨ç‡å15ä½æ‰¾å‡ºå®‡å®™çš„ç»ˆæé€»è¾‘å»åœ°ç‹±é‡Œèµ°ä¸¤æ­¥ æœªå®Œæˆ -12% KR-4 å¼€å‘ã€æµ‹è¯•å’Œå‘å¸ƒ æ”¯æŒåµŒå¥—æ’å…¥å›¾ç‰‡ç­‰å…¶å®ƒç®€å•ç»„ä»¶ é£é™© 0% copyå¤åˆ¶è¡Œ $ éŸ³é¢‘ Your browser does not support the audio tag. è§†é¢‘ Your browser does not support the video tag. Your browser does not support the video tag. å¯¼èˆªæ æ–‡ç« é¡¹ç›®ç•™è¨€GitHub frame è¿™æ˜¯ é«˜æ–¯æ¨¡ç³Š æ ‡ç­¾ è¿™æ˜¯ å¯†ç  æ ‡ç­¾ è¿™æ˜¯ ä¸‹åˆ’çº¿ æ ‡ç­¾ è¿™æ˜¯ ç€é‡å· æ ‡ç­¾ è¿™æ˜¯ æ³¢æµªçº¿ æ ‡ç­¾ è¿™æ˜¯ åˆ é™¤çº¿ æ ‡ç­¾ è¿™æ˜¯ ä¸Šè§’æ ‡ æ ‡ç­¾ è¿™æ˜¯ ä¸‹è§’æ ‡ æ ‡ç­¾ è¿™æ˜¯ é”®ç›˜æ ·å¼ æ ‡ç­¾ï¼Œè¯•ä¸€è¯•ï¼šâŒ˜ + D é™æ€æ—¶é—´çº¿2021 å¹´ 2 æœˆ 16 æ—¥ä¸»è¦éƒ¨åˆ†åŠŸèƒ½å·²ç»å¼€å‘çš„å·®ä¸å¤šäº†ã€‚2021 å¹´ 2 æœˆ 11 æ—¥ä»Šå¤©é™¤å¤•ï¼Œä¹Ÿæ˜¯ç”Ÿæ—¥ï¼Œä¸€ä¸ªäººåœ¨å¤–åœ°è¿‡å¹´+è¿‡ç”Ÿæ—¥ï¼Œç†¬å¤œå¼€å‘æ–°ä¸»é¢˜ï¼Œå°½é‡åœ¨å‡æœŸç»“æŸå‰æ”¾å‡ºå…¬æµ‹ç‰ˆã€‚ åŠ¨æ€æ—¶é—´çº¿ é™æ€ + åŠ¨æ€è¿™æ¡å†…å®¹ä¸ºé™æ€æ•°æ®è¿™æ¡å†…å®¹ä¸ºé™æ€æ•°æ®ï¼Œé™æ€æ•°æ®åœ¨ deploy æ—¶å°±å·²ç»ç¡®å®šäº†ã€‚ æ•°æ®ç­›é€‰ friends å‹é“¾å€ªé¹é£ md æ¸²æŸ“å¤–éƒ¨ markdown æ–‡ä»¶ ghcard å¡ç‰‡ toc æ–‡æ¡£ç›®å½•æ ‘% toc wiki:xxx [open:true] [display:mobile] title % box ç›’å­å®¹å™¨[title] [color:color] [child:codeblocktabs] â€¦ å½©è‰²ä»£ç å— æ¨èçš„å†™æ³•func test() // ... ä¸æ¨èçš„å†™æ³•func test() - () // ...æŠ˜å ä»£ç  é»˜è®¤æ‰“å¼€çš„ä»£ç æŠ˜å æ¡† ä»£ç å— tabs åˆ†æ å®¹å™¨å›¾ç‰‡ä»£ç å—è¡¨æ ¼let x = 123print(hello world) a b c a1 b1 c1 a2 b2 c2 banner æ¨ªå¹…å®¹å™¨ç”¨äºç‹¬ç«‹é¡µé¢é¡¶éƒ¨ éšè®°æ”¶è—éšè®° ç”¨äºç”¨æˆ·ä¸ªäººèµ„æ–™é¡µ æŸæŸè¿™æ˜¯ä¸ªäººç®€ä»‹ ç”¨ä½œæ–‡ç« æ‘˜è¦å¡ç‰‡åšå®¢è¿›é˜¶ï¼šè‡ªåŠ¨åŒ–éƒ¨ç½²æœ¬æ–‡è®²äº†å¦‚ä½•åˆ©ç”¨è„šæœ¬å’Œ GitHub Actions ç®€åŒ–åšå®¢æ­å»ºå’Œéƒ¨ç½²æµç¨‹ï¼Œæé«˜æ•ˆç‡ã€‚ gallery å›¾åº“ @tianhao_wang@eberhard@eberhard@eberhard@eberhard@vklemen swiper è½®æ’­å®¹å™¨"},{"title":"ä¸€å¹´ä¸€åº¦é“¶æå¤§é“","path":"/2025/11/03/æ‚è®°/ä¸€å¹´ä¸€åº¦é“¶æå¤§é“/","content":"ğŸé“¶ææœè‡­äº†ä¿©æœˆï¼Œç»ˆäºç­‰æ¥é‡‘é»„çš„é“¶æå¤§é“ã€‚ç§‹å¤©çš„æµªæ¼«ï¼šä¸€åŠæ˜¯é“¶æå¶çš„é‡‘é»„ï¼Œå»å¹´çš„ä¸€åŠæ˜¯æˆ‘èµ¶å¼€é¢˜ï¼Œä»Šå¹´çš„ä¸€åŠæ˜¯æŠ•ç®€å†çš„æ…Œå¼ ï¼Œç¾æ™¯ä»…ä¾›è·¯è¿‡ç»ä»°ğŸ˜’ ğŸ˜„æ—©ä¸Šé˜³å…‰æ´’åœ¨12æ–‹æ¥¼ä¸‹çš„è¿™å‡ æ£µé“¶ææ ‘ä¸Šï¼Œä¹Ÿå¾ˆå¥½çœ‹ï¼Œä¹Ÿæœ‰ä¸€ç‚¹æ²»æ„ˆğŸ¶ é¢„è®¡æ¥ä¸‹æ¥çš„ä¸¤å‘¨é“¶æå¤§é“å°†ä¼šæ˜¯äººå±±äººæµ·ğŸ˜ å¥½å›°ğŸ˜ª~","tags":["é“¶æå¤§é“"],"categories":["æ‚è®°"]},{"title":"ç¼–è¯‘Buildroot_2020.02æ—¶é‡åˆ°IndexError:list index out of rangeé—®é¢˜è§£å†³","path":"/2025/11/01/ç¼–è¯‘Buildroot_2020.02æ—¶é‡åˆ°IndexErrorlist index out of rangeé—®é¢˜è§£å†³/","content":"ç¼–è¯‘Buildroot_2020.02æ—¶é‡åˆ°IndexError:list index out of rangeé—®é¢˜è§£å†³å…·ä½“æŠ¥é”™File /home/book/Desktop/workspace_reload_linux_os/100ask_imx6ull-sdk/Buildroot_2020.02.x/output/host/lib/python3.8/site-packages/mesonbuild/dependencies/base.py, line 1204, in _get_cmake_info cmake_root: temp_parser.get_cmake_var(MESON_CMAKE_ROOT)[0], IndexError: list index out of range package/pkg-generic.mk:254: recipe for target /home/book/Desktop/workspace_reload_linux_os/100ask_imx6ull-sdk/Buildroot_2020.02.x/output/build/host-libglib2-2.62.5/.stamp_configured failed make[1]: [/home/book/Desktop/workspace_reload_linux_os/100ask_imx6ull-sdk/Buildroot_2020.02.x/output/build/host-libglib2-2.62.5/.stamp_configured] Error 2 Makefile:84: recipe for target _all failed make: [_all] Error 2 åŸå› Meson ä¸ CMakeç‰ˆæœ¬æ¥æºä¸åŒ¹é…ï¼Œå¯¼è‡´Meson åœ¨é…ç½®host-libglib2æ—¶è¯»å– CMake ä¿¡æ¯å¤±è´¥ã€‚ æŸ¥çœ‹æœ¬åœ°cmakeç‰ˆæœ¬ä¸º3.25è€Œæ„å»ºè¿™ä¸ªbuild rootæ‰€éœ€ç‰ˆæœ¬ä¸º3.15ã€‚ è§£å†³æ–¹æ³•1) å¼ºåˆ¶ä½¿ç”¨ Buildroot è‡ªå¸¦çš„ host å·¥å…·ï¼ˆé¿å…ç³»ç»Ÿ cmakemesonï¼‰åœ¨ Buildroot é¡¶å±‚ç›®å½•æ‰§è¡Œï¼š export PATH=$(pwd)/output/host/bin:$PATHexport LC_ALL=C è®¾ç½®PATHä¼˜å…ˆä½¿ç”¨ Buildroot è‡ªå·±ç¼–è¯‘çš„å·¥å…·ï¼ˆå¦‚ cmakeã€mesonã€ninjaã€pkgconf ç­‰ï¼‰ï¼Œè€Œä¸æ˜¯ç³»ç»Ÿé‡Œ /usr/bin/ çš„ç‰ˆæœ¬ï¼Œé¿å…ç‰ˆæœ¬ä¸å…¼å®¹çš„ç³»ç»Ÿå·¥å…·å¹²æ‰° Buildroot çš„ç¼–è¯‘ LC_ALLæ˜¯ä¸ºäº†é¿å…ä¸­æ–‡ç¼–ç é—®é¢˜ å…ˆç¡®ä¿è¿™äº›å·¥å…·å­˜åœ¨å¯ç”¨ï¼š output/host/bin/cmake --version || trueoutput/host/bin/meson --version || trueoutput/host/bin/ninja --version || true å¦‚æœç¼ºå°‘ï¼Œå°±è®© Buildroot æ„å»ºå®ƒä»¬ï¼š make host-cmake host-ninja host-meson host-pkgconf å¯èƒ½ä¼šç–‘æƒ‘ï¼Œæ˜æ˜åœ¨æˆ‘çš„makefileä¸­å¹¶æ²¡æœ‰host-cmake host-ninja host-meson host-pkgconfè¿™äº›ç›®æ ‡å•Šï¼Œä¸ºä»€ä¹ˆå¯ä»¥makeç”Ÿæˆå‘¢ï¼Ÿ ä¹‹æ‰€ä»¥å¯ä»¥è¿™æ ·åšæ˜¯å› ä¸ºåœ¨å½“å‰makefileä¸­å·²ç»åŒ…å«packageä¸‹çš„å­makefileæ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š include $(sort $(wildcard package/*/*.mk)) è€Œå¯¹åº”çš„å­makefileï¼Œå¦‚Buildroot_2020.02.x/package/cmake/cmake.mkä¸­ä¼šé€šè¿‡$(eval $(cmake-package))ç­‰å‘½ä»¤å»æ„é€ host-cmakeç­‰ç¼–è¯‘ç›®æ ‡ã€‚ 2) æ¸…ç†å¤±è´¥çš„åŒ…åé‡å»ºmake host-libglib2-dircleanmake all -j4 3) æ„å»ºè¿‡ç¨‹ä¸­ä¿æŒ PATH å¹²å‡€æ„å»ºå…¨ç¨‹éƒ½ä¿æŒï¼š export PATH=$(pwd)/output/host/bin:$PATHexport LC_ALL=C é¿å…ç³»ç»Ÿçš„ /usr/bin/cmake æŠ¢åœ¨å‰é¢è¢«è°ƒç”¨ã€‚","tags":["linux","Cmake","uboot"],"categories":["UBOOT"]},{"title":"æ ‘è“æ´¾4Bäº¤å‰ç¼–è¯‘æ›´æ–°Linuxå†…æ ¸","path":"/2025/09/02/æ ‘è“æ´¾4Bäº¤å‰ç¼–è¯‘æ›´æ–°Linuxå†…æ ¸/","content":"æ ‘è“æ´¾4Bäº¤å‰ç¼–è¯‘æ›´æ–°Linuxå†…æ ¸å‚è€ƒï¼šhttps://www.raspberrypi.com/documentation/computers/linux_kernel.html#kernel ä»¥ä¸‹åŸºæœ¬å…¨æ–‡å¤åˆ¶å®˜æ–¹æ•™ç¨‹ã€‚ åŸæœ¬æ ‘è“æ´¾4bè¿è¡Œçš„å°±æ˜¯ubuntu 24.04,é€šè¿‡uname -må¾—åˆ°aarch64æ¶æ„ã€‚å› æ­¤é€‰æ‹©64ä½é€‰é¡¹ ä¸‹è½½å†…æ ¸æºç ä¸‹è½½æœ€æ–°æ ‘è“æ´¾å†…æ ¸çš„æºä»£ç ï¼š git clone --depth=1 https://github.com/raspberrypi/linux è¯´æ˜ï¼š--depth=1 è¡¨ç¤º åªä¸‹è½½æœ€æ–°çš„ä¸€å±‚æäº¤è®°å½•ï¼ˆcommitï¼‰ æœ¬åœ°æ„å»ºå†…æ ¸å®‰è£…ä¾èµ–é¡¹å®‰è£…æ„å»ºä¾èµ–é¡¹ï¼š sudo apt install bc bison flex libssl-dev make libc6-dev libncurses5-dev å·¥å…·è¯´æ˜ bc bison flex libssl-dev make æ˜¯è¦å®‰è£…çš„å…·ä½“è½¯ä»¶åŒ…ï¼Œå„è‡ªåŠŸèƒ½å¦‚ä¸‹ï¼š bcï¼šä¸€æ¬¾æ”¯æŒé«˜ç²¾åº¦è®¡ç®—çš„å‘½ä»¤è¡Œè®¡ç®—å™¨ï¼Œå¸¸ç”¨äºè„šæœ¬ä¸­è¿›è¡Œæ•°å­¦è¿ç®—ã€‚ bisonï¼šè¯­æ³•åˆ†æå™¨ç”Ÿæˆå™¨ï¼Œé…åˆ flex å¯ç”¨äºå¼€å‘ç¼–è¯‘å™¨ã€è§£é‡Šå™¨ç­‰éœ€è¦è¯­æ³•è§£æçš„å·¥å…·ã€‚ flexï¼šè¯æ³•åˆ†æå™¨ç”Ÿæˆå™¨ï¼Œç”¨äºå°†è¾“å…¥çš„å­—ç¬¦æµè½¬æ¢ä¸ºç»“æ„åŒ–çš„ â€œä»¤ç‰Œï¼ˆtokenï¼‰â€ã€‚ libssl-devï¼šOpenSSL åº“çš„å¼€å‘æ–‡ä»¶ã€‚ makeï¼šmakeæ„å»ºè‡ªåŠ¨åŒ–å·¥å…·ã€‚ å®‰è£…äº¤å‰ç¼–è¯‘å·¥å…·é“¾ è¦å®‰è£…ç”¨äºæ„å»º 64 ä½å†…æ ¸çš„ 64 ä½å·¥å…·é“¾ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š sudo apt install crossbuild-essential-arm64 è¦å®‰è£…ç”¨äºæ„å»º 32 ä½å†…æ ¸çš„ 32 ä½å·¥å…·é“¾ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š sudo apt install crossbuild-essential-armhf é…ç½®å†…æ ¸å¯¹äº64ä½çš„æ ‘è“æ´¾4bæ¥è¯´ï¼Œéœ€è¦è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š cd linuxKERNEL=kernel8make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- bcm2711_defconfig ç¼–è¯‘å†…æ ¸ è¿è¡Œä»¥ä¸‹å‘½ä»¤æ„å»º 64 ä½å†…æ ¸ï¼š make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- Image modules dtbs è¿è¡Œä»¥ä¸‹å‘½ä»¤æ„å»º 32 ä½å†…æ ¸ï¼š make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- zImage modules dtbs å®‰è£…å†…æ ¸ç¡®è®¤å¯åŠ¨ä»‹è´¨å°†SDå¡æ’å…¥PCï¼Œæ‰§è¡Œlsblkå‘½ä»¤ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰sdbç­‰ä¿¡æ¯ã€‚åœ¨æˆ‘çš„ç”µè„‘ä¸Šæ˜¯sdd sdd 8:48 1 29.7G 0 disk â”œâ”€sdd1 8:49 1 512M 0 part /media/book/system-boot â””â”€sdd2 8:50 1 29.2G 0 part /media/book/writable /media/book/system-boot å¯¹åº” Raspberry Pi å¯åŠ¨åˆ†åŒºï¼› /media/book/writable å¯¹åº”æ ¹æ–‡ä»¶ç³»ç»Ÿ å¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œæ–¹ä¾¿åç»­æ“ä½œ export ARCH=arm64export CROSS_COMPILE=aarch64-linux-gnu-export BOOT=/media/book/system-bootexport ROOT=/media/book/writable å®‰è£…å†…æ ¸æ¨¡å—åˆ°æ ¹åˆ†åŒºsudo env PATH=$PATH make -j$(nproc) \\ ARCH=$ARCH CROSS_COMPILE=$CROSS_COMPILE \\ INSTALL_MOD_PATH=$ROOT modules_install è¿™ä¸€æ­¥ä¼šåœ¨ /media/book/writable/lib/modules/ ä¸‹é¢ç”Ÿæˆä½ æ–°ç¼–è¯‘çš„æ¨¡å—ç›®å½•ï¼Œä¾‹å¦‚ï¼š /media/book/writable/lib/modules/6.6.32-v8+/ å¤‡ä»½æ—§å†…æ ¸å¹¶å¤åˆ¶æ–°å†…æ ¸å’Œè®¾å¤‡æ ‘åˆ° /system-boot ğŸ’¡ Ubuntu çš„å¯åŠ¨åˆ†åŒºé€šå¸¸åŒ…å« vmlinuz, initrd.img, config.txt, cmdline.txt ç­‰ã€‚ æˆ‘ä»¬å»ºè®®æŠŠè‡ªå·±çš„å†…æ ¸å‘½åä¸º kernel8.imgï¼ˆPi 4 çš„æ ‡å‡†å‘½åï¼‰ï¼Œå¹¶åœ¨ config.txt é‡ŒæŒ‡æ˜ã€‚ 1ï¸âƒ£ å¤‡ä»½ç°æœ‰å¯åŠ¨æ–‡ä»¶ï¼šsudo cp -a $BOOT/kernel8.img $BOOT/kernel8-backup.img 2/dev/null || truesudo cp -a $BOOT/vmlinuz $BOOT/vmlinuz-backup 2/dev/null || true 2ï¸âƒ£ å¤åˆ¶æ–°ç¼–è¯‘çš„å†…æ ¸é•œåƒï¼šsudo cp -a arch/arm64/boot/Image $BOOT/kernel8.img 3ï¸âƒ£ å¤åˆ¶è®¾å¤‡æ ‘æ–‡ä»¶ï¼ˆDTB å’Œ overlaysï¼‰ï¼šsudo cp -a arch/arm64/boot/dts/broadcom/*.dtb $BOOT/sudo mkdir -p $BOOT/overlayssudo cp -a arch/arm64/boot/dts/overlays/*.dtb* $BOOT/overlays/sudo cp -a arch/arm64/boot/dts/overlays/README $BOOT/overlays/ 2/dev/null || true ç¡®ä¿ config.txt æ­£ç¡®æ‰“å¼€ /media/book/system-boot/config.txtï¼Œæ£€æŸ¥æˆ–æ·»åŠ ï¼š kernel=kernel8.imgarm_64bit=1 å¦‚æœä½ ç”¨äº†å‹ç¼©å†…æ ¸æˆ–è‡ªå®šä¹‰æ–‡ä»¶åï¼Œå¿…é¡»åœ¨è¿™é‡Œæ”¹æˆä¸€è‡´çš„åå­—ã€‚ åŒæ­¥å¹¶å¸è½½åˆ†åŒºå¤åˆ¶å®Œæˆåä¸€å®šè¦å¸è½½ï¼Œå¦åˆ™æ•°æ®å¯èƒ½æ²¡å†™å…¥å¡ï¼š syncsudo umount $BOOTsudo umount $ROOT âš¡ å…­ã€å¯åŠ¨éªŒè¯æŠŠè¿™å¼ å¡æ’å›æ ‘è“æ´¾ 4Bï¼Œå¯åŠ¨åç”¨ä¸²å£æˆ– SSH ç™»å½•æ‰§è¡Œï¼š uname -a å¦‚æœæ˜¾ç¤ºä½ çš„æ–°å†…æ ¸ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ä½ è®¾ç½®çš„ -v8 åç¼€ï¼‰ï¼Œè¯´æ˜æ›´æ–°æˆåŠŸ ğŸ‰ éªŒè¯æ¨¡å—æ˜¯å¦åŠ è½½ï¼š ls /lib/modules åº”è¯¥èƒ½çœ‹åˆ°ä¸ä½ æ–°å†…æ ¸ç‰ˆæœ¬å·å¯¹åº”çš„ç›®å½•ã€‚","tags":["æ ‘è“æ´¾","Linux"],"categories":["æ ‘è“æ´¾"]},{"title":"è®°å½•ä½¿ç”¨ZeroTierå®ç°å†…ç½‘ç©¿é€å®ç°è¿œç¨‹è®¿é—®å®éªŒå®¤ä¸»æœº","path":"/2025/09/01/è®°å½•ä½¿ç”¨ZeroTierå®ç°å†…ç½‘ç©¿é€å®ç°è¿œç¨‹è®¿é—®å®éªŒå®¤ä¸»æœº/","content":"è®°å½•ä½¿ç”¨ZeroTierå®ç°å†…ç½‘ç©¿é€å®ç°è¿œç¨‹è®¿é—®å®éªŒå®¤ä¸»æœºå‡†å¤‡å®˜ç½‘æ³¨å†Œzerotierè´¦å·ZeroTier åˆ›å»ºCreate A Networkï¼Œå¹¶è®°ä¸‹Network IDï¼Œåç»­åœ¨ubuntuå’Œwindowsä¸‹éƒ½è¦å¡«å…¥è¿™ä¸ªID. 1.windows ä¸‹è½½å®‰è£…ZeroTier ZeroTier | Download åŠ å…¥æ–°ç½‘ç»œï¼Œå°†Network IDå¤åˆ¶è¿›å»ã€‚ å›åˆ°ç½‘é¡µä¸Šï¼Œä¼šæç¤ºæœ‰ä¸€ä¸ªè®¾å¤‡åŠ å…¥ï¼Œç½‘é¡µä¸Šç‚¹å‡»åŒæ„åŠ å…¥ã€‚ ipconfigæŸ¥çœ‹æ˜¯å¦æœ‰ä»¥ä¸‹ip ä»¥å¤ªç½‘é€‚é…å™¨ ZeroTier One [af415e486f063401]: è¿æ¥ç‰¹å®šçš„ DNS åç¼€ . . . . . . . : æœ¬åœ°é“¾æ¥ IPv6 åœ°å€. . . . . . . . : fe80::c383:dc68:a959:4636%59 IPv4 åœ°å€ . . . . . . . . . . . . : 172.29.51.120 å­ç½‘æ©ç  . . . . . . . . . . . . : 255.255.0.0 é»˜è®¤ç½‘å…³. . . . . . . . . . . . . : 25.255.255.254 2.Ubuntu å¦‚æœæ²¡æœ‰å®‰è£…curlï¼Œå…ˆå®‰è£…curl sudo apt install curl å¦‚æœå·²ç»æœ‰curlç›´æ¥æ‰§è¡Œä¸‹é¢çš„å®‰è£…å‘½ä»¤ curl -s https://install.zerotier.com | sudo bash ç»ˆç«¯å‘½ä»¤è¡Œè¾“å…¥ï¼š sudo zerotier-cli join [è™šæ‹Ÿç½‘ç»œåœ°å€ID] å‘½ä»¤è¿”å›200å°±æ˜¯æˆåŠŸäº† å›åˆ°ç½‘é¡µä¸ŠåŒæ„Authorizeè®¾å¤‡çš„åŠ å…¥ã€‚ é€šè¿‡ifconfigæŸ¥çœ‹æ˜¯å¦æœ‰å¯¹åº”çš„ipã€‚ æ­¤æ—¶å°±å·²ç»å®Œæˆäº†ç»„ç½‘ï¼Œå¯ä»¥å°è¯•äº’ç›¸pingä¸€ä¸‹èƒ½å¦pingé€šã€‚æ¥ä¸‹æ¥å°±æ˜¯sshè¿œç¨‹äº†ï¼Œç•¥","tags":["ZeroTier","å†…ç½‘ç©¿é€"],"categories":["å·¥å…·"]},{"title":"SPIæ—¶åºç†è§£","path":"/2025/08/18/SPIæ—¶åºç†è§£/","content":"SPIæ—¶åºç†è§£ä¼ è¾“æ¨¡å¼æ—¶é’Ÿææ€§CPOLå’Œæ—¶é’Ÿç›¸ä½CPHA CPOL:è¡¨ç¤ºå½“SCLKç©ºé—²idleçš„æ—¶å€™ï¼Œå…¶ç”µå¹³å€¼æ˜¯é«˜ç”µå¹³1è¿˜æ˜¯ä½ç”µå¹³0 CPHAï¼šè¡¨ç¤ºçš„æ˜¯æ•°æ®é‡‡æ ·æ˜¯åœ¨ç¬¬å‡ ä¸ªè¾¹æ²¿(edge)ï¼Œ0å¯¹åº”ç¬¬ä¸€ä¸ªè¾¹æ²¿ï¼Œ1å¯¹åº”ç¬¬äºŒä¸ªè¾¹æ²¿ CPOLå’ŒCPHAä¸¤ä¸¤ç»„åˆä¸€å…±æœ‰4ä¸­æ¨¡å¼ CPHA0 è¡¨ç¤ºç¬¬ä¸€ä¸ªè¾¹æ²¿é‡‡æ · æ¨¡å¼0ï¼šå¯¹äºCPOL0ï¼Œidleæ—¶å€™çš„æ˜¯ä½ç”µå¹³ï¼Œç¬¬ä¸€ä¸ªè¾¹æ²¿å°±æ˜¯ä»ä½å˜åˆ°é«˜ï¼Œæ‰€ä»¥æ˜¯ä¸Šå‡æ²¿ï¼› æ¨¡å¼2ï¼šå¯¹äºCPOL1ï¼Œidleæ—¶å€™çš„æ˜¯é«˜ç”µå¹³ï¼Œç¬¬ä¸€ä¸ªè¾¹æ²¿å°±æ˜¯ä»é«˜å˜åˆ°ä½ï¼Œæ‰€ä»¥æ˜¯ä¸‹é™æ²¿ï¼› CPHA1è¡¨ç¤ºç¬¬äºŒä¸ªè¾¹æ²¿é‡‡æ · æ¨¡å¼1ï¼šå¯¹äºCPOL0ï¼Œidleæ—¶å€™çš„æ˜¯ä½ç”µå¹³ï¼Œç¬¬äºŒä¸ªè¾¹æ²¿å°±æ˜¯ä»é«˜å˜åˆ°ä½ï¼Œæ‰€ä»¥æ˜¯ä¸‹é™æ²¿ï¼› æ¨¡å¼3ï¼šå¯¹äºCPOL1ï¼Œidleæ—¶å€™çš„æ˜¯é«˜ç”µå¹³ï¼Œç¬¬ä¸€ä¸ªè¾¹æ²¿å°±æ˜¯ä»ä½å˜åˆ°é«˜ï¼Œæ‰€ä»¥æ˜¯ä¸Šå‡æ²¿ï¼› å¸¸ç”¨æ¨¡å¼0å’Œæ¨¡å¼3 ä¼ è¾“æ—¶åºæ—¶åºå›¾ æ¨¡å¼0æ—¶åºå›¾ éœ€è¦é‡ç‚¹ç†è§£ä¸¤ä¸ªæ¦‚å¿µï¼š ä¸Šå‡æ²¿é‡‡æ ·ï¼šæŒ‡çš„æ˜¯ä»è®¾å¤‡åœ¨CLKçš„ä¸Šå‡æ²¿ï¼ˆä½ç”µå¹³-é«˜ç”µå¹³è·³å˜ï¼‰è¯»å–MOSIçº¿ä¸Šçš„æ•°æ®ï¼Œè¿™æ˜¯ä»è®¾å¤‡çš„æ¥å—åŠ¨ä½œã€‚æ­¤æ—¶è¦æ±‚MOSIçº¿ä¸Šçš„æ•°æ®å¿…é¡»å·²ç»ç¨³å®šï¼Œä¸èƒ½å¤„äºè·³å˜çŠ¶æ€ï¼Œå¦åˆ™ä»è®¾å¤‡ä¼šé‡‡æ ·åˆ°é”™è¯¯å€¼ã€‚ ä¸Šå‡æ²¿å‰è¾“å‡ºæ•°æ®ï¼šæŒ‡çš„æ˜¯ä¸»è®¾å¤‡åœ¨CLKä¸Šå‡æ²¿æ¥ä¹‹å‰ï¼Œå°±è¦æŠŠä¼ è¾“çš„å½“å‰æ•°æ®ï¼ˆå¦‚bit1ï¼‰è¾“å‡ºåˆ°MOSIçº¿ä¸Šï¼Œç›®çš„æ˜¯ç»™æ•°æ®ç•™å‡ºç¨³å®šæ—¶é—´ï¼Œç¡®ä¿ä¸Šå‡æ²¿é‡‡æ ·æ—¶æ•°æ®å·²ç»å¤„äºå›ºå®šç”µå¹³ ä»¥ä¼ è¾“bit1ä¸ºä¾‹åˆ†æMOSIé‡‡æ ·å’Œè¾“å‡ºçš„è¿‡ç¨‹ æ­¥éª¤ 1ï¼šä¸»è®¾å¤‡ â€œæå‰è¾“å‡ºâ€ å½“å‰ä½æ•°æ®ï¼ˆCLK ä¸Šå‡æ²¿å‰ï¼‰å½“ä¸»è®¾å¤‡é€‰ä¸­ä»è®¾å¤‡ï¼ˆSS ä¿¡å·æœ‰æ•ˆï¼‰åï¼Œä¼šåœ¨ CLK ä¸Šå‡æ²¿åˆ°æ¥å‰çš„ â€œç©ºé—²é˜¶æ®µâ€ï¼ˆCPOL0 æ—¶ CLK ä¸ºä½ç”µå¹³ï¼‰ï¼Œå°±æŠŠ bit1 çš„ç”µå¹³ï¼ˆå¦‚é«˜ç”µå¹³ 1ï¼‰è¾“å‡ºåˆ° MOSI çº¿ä¸Šï¼Œå¹¶ä¿æŒä¸å˜ï¼ˆï¼‰ã€‚æ–‡æ¡£å›¾ 3 éªŒè¯äº†è¿™ä¸€ç‚¹ï¼šbit1 çš„è¾“å‡ºæ—¶åˆ»æ¯” CLK ä¸Šå‡æ²¿æ—©åŠä¸ªæ—¶é’Ÿå‘¨æœŸï¼Œæ­¤æ—¶ CLK ä»å¤„äºä½ç”µå¹³ï¼Œå°šæœªè¿›å…¥ä¸Šå‡æ²¿é˜¶æ®µã€‚ æ­¥éª¤ 2ï¼šä»è®¾å¤‡ â€œä¸Šå‡æ²¿é‡‡æ ·â€ å½“å‰ä½æ•°æ®å½“ CLK ä»ä½ç”µå¹³è·³å˜ä¸ºé«˜ç”µå¹³ï¼ˆä¸Šå‡æ²¿ï¼‰æ—¶ï¼Œä»è®¾å¤‡æ£€æµ‹åˆ°è¿™ä¸ªè·³å˜ï¼Œç«‹å³è¯»å–æ­¤æ—¶ MOSI çº¿ä¸Šçš„ç¨³å®šæ•°æ®ï¼ˆå³ä¸»è®¾å¤‡æå‰è¾“å‡ºçš„ bit1ï¼‰ï¼Œå®Œæˆé‡‡æ ·åŠ¨ä½œï¼ˆã€ï¼‰ã€‚æ­¤æ—¶é‡‡æ ·çš„ â€œåŸææ–™â€ï¼Œæ­£æ˜¯ä¸»è®¾å¤‡åœ¨ä¸Šå‡æ²¿å‰å°±å‡†å¤‡å¥½çš„ã€‚ æ­¥éª¤ 3ï¼šä¸»è®¾å¤‡ â€œä¸‹é™æ²¿æ›´æ–°â€ ä¸‹ä¸€ä½æ•°æ®é‡‡æ ·å®Œæˆåï¼ŒCLK ä»é«˜ç”µå¹³è·³å˜ä¸ºä½ç”µå¹³ï¼ˆä¸‹é™æ²¿ï¼‰ï¼Œä¸»è®¾å¤‡ä¼šç«‹å³å°† MOSI çº¿ä¸Šçš„ç”µå¹³æ›´æ–°ä¸ºä¸‹ä¸€ä½æ•°æ®ï¼ˆå¦‚ bit2 çš„ç”µå¹³ï¼‰ï¼Œä¸ºä¸‹ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸçš„é‡‡æ ·åšå‡†å¤‡ï¼ˆï¼‰ã€‚æ³¨æ„ï¼šè¿™ä¸€æ­¥æ›´æ–°çš„æ˜¯ â€œä¸‹ä¸€ä½â€ï¼Œè€Œéå½“å‰å·²é‡‡æ ·çš„ bit1â€”â€” å½“å‰ä½æ•°æ®çš„é‡‡æ ·å·²åœ¨ä¸Šå‡æ²¿å®Œæˆï¼Œä¸‹é™æ²¿çš„æ“ä½œä¸å½±å“å·²ä¼ è¾“çš„ä½ã€‚ ä¸»è®¾å¤‡éœ€è¦æå‰åœ¨CLKä¸Šå‡æ²¿ä¹‹å‰å°†æ•°æ®ï¼ˆå³bit1ç”µå¹³ï¼‰è¾“å‡ºåˆ°MOSIçº¿ä¸Šï¼ˆå³å‡†å¤‡å¥½æ•°æ®ï¼Œä¸ºé‡‡æ ·æä¾›ç¨³å®šæ•°æ®ï¼‰ï¼Œä¸ç„¶åœ¨ä¸Šå‡æ²¿ä»è®¾å¤‡å°±è¦é‡‡æ ·äº†ã€‚è‡³äºé‡‡æ ·æ˜¯å¦å¿…é¡»åœ¨ä¸Šå‡æ²¿æœŸé—´å®Œæˆè¿˜æ˜¯è¯´åœ¨CLKé«˜ç”µå¹³æœŸé—´ä»å¯ä»¥ç»§ç»­é‡‡æ ·è¿™ä¸ªæš‚æ—¶ä¸åšæ·±å…¥ç ”ç©¶(å³é‡‡æ ·æ—¶é—´æ˜¯å¦ä¸ºï¼šCLKä¸Šå‡æ²¿+CLKé«˜ç”µå¹³ä¿æŒæœŸé—´)ã€‚ åœ¨CLKé«˜ç”µå¹³ç»“æŸä¹‹åï¼Œå°±æ¥åˆ°äº†CLKçš„ä¸‹é™æ²¿ï¼Œè¿™ä¸ªæ—¶å€™ä¸»è®¾å¤‡åˆè¦å°†æ•°æ®ï¼ˆå³BIT2ï¼‰è¾“å‡ºåˆ°MOSIçº¿ä¸Šï¼Œè‡³äºä¸»è®¾å¤‡åœ¨CLKä¸‹é™æ²¿å¼€å§‹çš„æ—¶å€™å°†æ•°æ®è¾“å‡ºåˆ°MOSIçº¿ä¸Šçš„æ—¶é—´æ˜¯å¦åŒ…æ‹¬CLKä½ç”µå¹³çš„æ—¶é—´ï¼ˆå³è¾“å‡ºæ•°æ®çš„æ—¶é—´æ˜¯å¦ä¸ºï¼šCLKä¸‹é™æ²¿+CLKä½ç”µå¹³ä¿æŒæœŸé—´ï¼‰è¿™ä¸ªæš‚æ—¶ä¸åšç ”ç©¶ã€‚ ä»¥ä¼ è¾“bit1ä¸ºä¾‹åˆ†æMISOé‡‡æ ·å’Œè¾“å‡ºçš„è¿‡ç¨‹ æ­¥éª¤ 1ï¼šä»è®¾å¤‡ â€œSS æœ‰æ•ˆåç«‹å³è¾“å‡ºâ€ å½“å‰ä½æ•°æ®ï¼ˆSCLK ä¸Šå‡æ²¿å‰ï¼‰ ä¸ä¸»è®¾å¤‡åœ¨ MOSI çº¿ä¸Š â€œæå‰åŠä¸ªæ—¶é’Ÿå‘¨æœŸè¾“å‡ºâ€ ä¸åŒï¼Œä»è®¾å¤‡åœ¨ MISO çº¿ä¸Šçš„è¾“å‡ºè§¦å‘æ¡ä»¶æ˜¯ **SS ä¿¡å·æœ‰æ•ˆ **ï¼ˆä¸»è®¾å¤‡æ‹‰ä½ SS é€‰ä¸­ä»è®¾å¤‡ï¼‰ï¼šä¸€æ—¦ SS æœ‰æ•ˆï¼Œä»è®¾å¤‡ä¼šç«‹å³å°†å½“å‰è¦ä¼ è¾“çš„ bit1 ç”µå¹³ï¼ˆå¦‚é«˜ç”µå¹³ 1ï¼‰è¾“å‡ºåˆ° MISO çº¿ä¸Šï¼Œå¹¶ä¿æŒç¨³å®šï¼Œæ— éœ€ç­‰å¾… SCLK çš„ä¸Šå‡æ²¿ï¼ˆã€ï¼‰ã€‚æ–‡æ¡£å›¾ 4 å¯¹æ­¤æœ‰æ˜ç¡®éªŒè¯ï¼šå›¾ä¸­ SS ä¿¡å·å˜ä¸ºä½ç”µå¹³ï¼ˆæœ‰æ•ˆï¼‰åï¼ŒMISO çº¿ç«‹å³è¾“å‡º bit1ï¼ˆå€¼ä¸º 1ï¼‰ï¼Œæ­¤æ—¶ SCLK ä»å¤„äºç©ºé—²ä½ç”µå¹³çŠ¶æ€ï¼Œä¸ºåç»­ä¸»è®¾å¤‡é‡‡æ ·ç•™å‡ºäº†å……è¶³çš„ç¨³å®šæ—¶é—´ï¼ˆã€ï¼‰ã€‚ æ­¥éª¤ 2ï¼šä¸»è®¾å¤‡ â€œSCLK ä¸Šå‡æ²¿é‡‡æ ·â€ MISO çº¿ä¸Šçš„æ•°æ® å½“ä¸»è®¾å¤‡ç”Ÿæˆçš„ SCLK ä»ä½ç”µå¹³è·³å˜ä¸ºé«˜ç”µå¹³ï¼ˆä¸Šå‡æ²¿ï¼‰æ—¶ï¼Œä¸»è®¾å¤‡ä¼šæ£€æµ‹è¿™ä¸ªè·³å˜ï¼Œå¹¶ç«‹å³è¯»å–æ­¤æ—¶ MISO çº¿ä¸Šçš„ç¨³å®šæ•°æ® â€”â€” å³ä»è®¾å¤‡åœ¨ SS æœ‰æ•ˆåè¾“å‡ºçš„ bit1ï¼Œå®Œæˆ â€œä¸»è®¾å¤‡é‡‡æ · MISO æ•°æ®â€ çš„åŠ¨ä½œï¼ˆã€ï¼‰ã€‚è¿™ä¸€æ­¥ä¸ MOSI çº¿çš„ â€œä»è®¾å¤‡ä¸Šå‡æ²¿é‡‡æ ·â€ é€»è¾‘å®Œå…¨åŒæ­¥ï¼Œå‡ä¾èµ– SCLK çš„ç¬¬ä¸€ä¸ªè·³å˜æ²¿ï¼Œç¡®ä¿ä¸»ä»è®¾å¤‡çš„æ”¶å‘åŠ¨ä½œåœ¨åŒä¸€æ—¶é’ŸåŸºå‡†ä¸‹è¿›è¡Œï¼ˆï¼‰ã€‚ æ­¥éª¤ 3ï¼šä»è®¾å¤‡ â€œSCLK ä¸‹é™æ²¿æ›´æ–°â€ MISO çº¿ä¸Šçš„ä¸‹ä¸€ä½æ•°æ® SCLK ä¸Šå‡æ²¿çš„é‡‡æ ·åŠ¨ä½œå®Œæˆåï¼Œå½“ SCLK ä»é«˜ç”µå¹³è·³å˜ä¸ºä½ç”µå¹³ï¼ˆä¸‹é™æ²¿ï¼‰æ—¶ï¼Œä»è®¾å¤‡ä¼šç«‹å³å°† MISO çº¿ä¸Šçš„ç”µå¹³æ›´æ–°ä¸ºä¸‹ä¸€ä½è¦ä¼ è¾“çš„æ•°æ®ï¼ˆå¦‚ bit2 çš„ç”µå¹³ï¼‰ï¼Œä¸ºä¸‹ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸçš„ä¸»è®¾å¤‡é‡‡æ ·åšå‡†å¤‡ï¼ˆã€ï¼‰ã€‚ä¸ MOSI çº¿ç±»ä¼¼ï¼ŒMISO çº¿çš„ â€œæ›´æ–°â€ åŠ¨ä½œä»…é’ˆå¯¹ â€œä¸‹ä¸€ä½æ•°æ®â€ï¼Œä¸ä¼šå½±å“å·²åœ¨ä¸Šå‡æ²¿è¢«ä¸»è®¾å¤‡é‡‡æ ·çš„å½“å‰ä½ï¼ˆbit1ï¼‰ï¼Œä¿è¯æ•°æ®ä¼ è¾“çš„è¿ç»­æ€§å’Œæ­£ç¡®æ€§ã€‚ åŒºåˆ«ï¼š MOSI çº¿ï¼ˆä¸»â†’ä»ï¼‰ï¼šä¸»è®¾å¤‡è¾“å‡ºæ•°æ®çš„è§¦å‘ä¸ SS æ— å…³ï¼Œä»…åœ¨ SCLK ä¸Šå‡æ²¿å‰çš„ç©ºé—²é˜¶æ®µè¾“å‡ºï¼ˆï¼‰ï¼› MISO çº¿ï¼ˆä»â†’ä¸»ï¼‰ï¼šä»è®¾å¤‡è¾“å‡ºæ•°æ®çš„è§¦å‘æ˜¯ SS æœ‰æ•ˆï¼Œæœ‰æ•ˆåç«‹å³è¾“å‡ºç¬¬ä¸€ä½æ•°æ®ï¼ˆï¼‰ã€‚ å‚è€ƒï¼šSPIæ€»çº¿åè®®ä»‹ç».pdf","tags":["linux","SPI","platform"],"categories":["é©±åŠ¨"]},{"title":"æœ¬åœ°ä»“åº“è¦†ç›–è¿œç¨‹éç©ºä»“åº“","path":"/2025/08/18/git sshå¤±è´¥ copy/","content":"æœ¬åœ°ä»“åº“è¦†ç›–è¿œç¨‹éç©ºä»“åº“ è¿œç¨‹ä»“åº“å·²æœ‰ä¸€ä¸ªåˆå§‹æäº¤ï¼ˆREADME.mdï¼‰ æœ¬åœ°æ–‡ä»¶å¤¹ç»“æ„å’Œè¿œç¨‹ä¸ä¸€è‡´ âœ… ç›®æ ‡è®©æœ¬åœ°ä»“åº“è¦†ç›–å¹¶ä¸Šä¼ åˆ° GitHub ä»“åº“ ğŸš€ç›´æ¥è¦†ç›–è¿œç¨‹ä»“åº“å¦‚æœè¿œç¨‹ä»“åº“é‡Œåªæœ‰ä¸€ä¸ª README.mdï¼Œå¯ä»¥ç›´æ¥è®©æœ¬åœ°ç‰ˆæœ¬è¦†ç›–æ‰è¿œç¨‹å†…å®¹ åœ¨æœ¬åœ°é¡¹ç›®ç›®å½•æ‰§è¡Œï¼š git init # å¦‚æœè¿˜æ²¡åˆå§‹åŒ–git branch -M main # ç»Ÿä¸€åˆ†æ”¯ågit remote add origin https://github.com/xxx/yyy.gitgit fetch origin # è·å–è¿œç¨‹åˆ†æ”¯git pull origin main --allow-unrelated-histories ä¸Šé¢çš„å‘½ä»¤ä¼šæŠŠè¿œç¨‹çš„ README.md æ‹‰åˆ°æœ¬åœ°ï¼Œå¹¶å…è®¸åˆå¹¶ä¸åŒæ¥æºçš„é¡¹ç›®ã€‚ ç„¶åæ‰§è¡Œï¼š # å¦‚æœäº§ç”Ÿå†²çªï¼Œæ¯”å¦‚ README.md åŒåï¼Œå¯ä»¥æ‰‹åŠ¨é€‰æ‹©ä¿ç•™å“ªä¸€ä¸ªgit add .git commit -m xxxgit push -u origin main --force âš ï¸ è¯´æ˜ï¼š --allow-unrelated-histories ç”¨äºåˆå¹¶ä¸¤ä¸ªç‹¬ç«‹é¡¹ç›®çš„å†å²ã€‚ --force æ˜¯ä¸ºäº†è¦†ç›–è¿œç¨‹æ—§å†…å®¹ï¼ˆè¯·ç¡®è®¤æ— é‡è¦æ–‡ä»¶åä½¿ç”¨ï¼‰ã€‚ ğŸ˜„å®Œ","tags":["git","ssh"],"categories":["GIT"]},{"title":"git sshå¤±è´¥","path":"/2025/08/18/git sshå¤±è´¥/","content":"git sshå¤±è´¥git æŠ¥é”™ï¼š fatal: Could not read from remote repository.Please make sure you have the correct access rightsand the repository exists. PS D:\\822lib git remote -vorigin git@github.com:dkyou/822lib.git (fetch)origin git@github.com:dkyou/822lib.git (push)PS D:\\822lib ssh -T git@github.comgit@github.com: Permission denied (publickey). åŸå› ï¼šæ²¡æœ‰æ­£ç¡®é…ç½®sshå¯†é’¥ è§£å†³æ­¥éª¤1. ç”Ÿæˆ SSH å¯†é’¥å¯¹ssh-keygen -t ed25519 -C ä½ çš„é‚®ç®±@example.com æŒ‰æç¤ºæ“ä½œï¼Œå¯ä»¥ç›´æ¥æŒ‰å›è½¦ä½¿ç”¨é»˜è®¤è·¯å¾„å’Œç©ºå¯†ç ã€‚ PS C:\\Users\\dky\\.ssh ls ç›®å½•: C:\\Users\\dky\\.sshMode LastWriteTime Length Name---- ------------- ------ -----a---- 2025/8/22 11:30 278 config-a---- 2025/8/22 11:11 411 id_ed25519 # æ–°ç”Ÿæˆ-a---- 2025/8/22 11:11 100 id_ed25519.pub # æ–°ç”Ÿæˆ-a---- 2024/6/25 17:47 2602 id_rsa-a---- 2024/6/25 17:47 571 id_rsa.pub-a---- 2025/4/23 22:13 1205 known_hosts-a---- 2025/3/27 23:01 926 known_hosts.old 2. å¯åŠ¨ ssh-agent å¹¶æ·»åŠ å¯†é’¥basheval $(ssh-agent -s)ssh-add ~/.ssh/id_ed25519 éœ€è¦ç”¨git bashç»ˆç«¯æ‰§è¡Œ 2.1 é…ç½®SSH configæ–‡ä»¶ï¼Œåœ¨~.sshconfigæ–‡ä»¶ä¸­æ·»åŠ ï¼š Host github.com AddKeysToAgent yes UseKeychain yes # macOS ä¸“ç”¨ IdentityFile ~/.ssh/id_ed25519 3. è·å–å¹¶æ·»åŠ å…¬é’¥åˆ° GitHub æŸ¥çœ‹å…¬é’¥å†…å®¹ï¼š cat ~/.ssh/id_ed25519.pub å¤åˆ¶è¾“å‡ºçš„å†…å®¹ ç™»å½• GitHub â†’ ç‚¹å‡»å³ä¸Šè§’å¤´åƒ â†’ Settings â†’ SSH and GPG keys â†’ New SSH key Title å¡«å†™æ ‡è¯†åç§°ï¼ˆå¦‚ â€œMy PCâ€ï¼‰ï¼ŒKey type é€‰æ‹© â€œAuthenticationâ€ï¼ŒKey ä¸­ç²˜è´´åˆšæ‰å¤åˆ¶çš„å†…å®¹ ç‚¹å‡» â€œAdd SSH keyâ€ 4. éªŒè¯è¿æ¥ssh -T git@github.com å¦‚æœæ˜¾ç¤º â€œHi xxx! Youâ€™ve successfully authenticatedâ€¦â€ è¡¨ç¤ºé…ç½®æˆåŠŸã€‚ 5. é‡æ–°æ¨é€git push -u origin master","tags":["git","ssh"],"categories":["GIT"]},{"title":"imx6ullå¯åŠ¨æ—¥å¿—åˆ†æ","path":"/2025/08/18/imx6ullå¯åŠ¨æ—¥å¿—/","content":"U-Boot 2017.03 (Oct 03 2024 - 08:18:41 -0400) CPU: Freescale i.MX6ULL rev1.1 696 MHz (running at 396 MHz)CPU: Industrial temperature grade (-40C to 105C) at 40CReset cause: PORModel: Freescale i.MX6 ULL 14x14 EVK BoardBoard: MX6ULL 14x14 EVKDRAM: 512 MiBMMC: FSL_SDHC: 0, FSL_SDHC: 1Display: TFT7016 (1024x600)Video: 1024x600x24In: serialOut: serialErr: serialNet: No ethernet found.Normal BootHit any key to stop autoboot: 0 Error: â€œfindteeâ€ not definedswitch to partitions #0, OKmmc1(part 0) is current deviceswitch to partitions #0, OKmmc1(part 0) is current device** Unrecognized filesystem type **8846320 bytes read in 440 ms (19.2 MiBs)Booting from mmc â€¦39690 bytes read in 49 ms (791 KiBs)Kernel image @ 0x80800000 [ 0x000000 - 0x86fbf0 ] Flattened Device Tree blob at 83000000 Booting using the fdt blob at 0x83000000 Using Device Tree in place at 83000000, end 8300cb09Modify socaips-bus@02200000epdc@0228c000:status disabledft_system_setup for mx6 Starting kernel â€¦ [ 0.000000] Booting Linux on physical CPU 0x0[ 0.000000] Linux version 4.9.88 (book@100ask) (gcc version 7.5.0 (Buildroot 2020.02-gee85cab) ) #4 SMP PREEMPT Thu Mar 13 04:25:09 EDT 2025[ 0.000000] CPU: ARMv7 Processor [410fc075] revision 5 (ARMv7), cr10c53c7d[ 0.000000] CPU: div instructions available: patching division code[ 0.000000] CPU: PIPT VIPT nonaliasing data cache, VIPT aliasing instruction cache[ 0.000000] OF: fdt:Machine model: Freescale i.MX6 ULL 14x14 EVK Board[ 0.000000] Reserved memory: created CMA memory pool at 0x8c000000, size 320 MiB[ 0.000000] OF: reserved mem: initialized node linux,cma, compatible id shared-dma-pool[ 0.000000] Memory policy: Data cache writealloc[ 0.000000] percpu: Embedded 15 pagescpu @8bb2e000 s30156 r8192 d23092 u61440[ 0.000000] Built 1 zonelists in Zone order, mobility grouping on. Total pages: 130048[ 0.000000] Kernel command line: consolettymxc0,115200 rootdevmmcblk1p2 rootwait rw[ 0.000000] PID hash table entries: 2048 (order: 1, 8192 bytes)[ 0.000000] Dentry cache hash table entries: 65536 (order: 6, 262144 bytes)[ 0.000000] Inode-cache hash table entries: 32768 (order: 5, 131072 bytes)[ 0.000000] Memory: 172236K524288K available (11264K kernel code, 1103K rwdata, 4040K rodata, 1024K init, 477K bss, 24372K reserved, 327680K cma-reserved, 0K highmem)[ 0.000000] Virtual kernel memory layout:[ 0.000000] vector : 0xffff0000 - 0xffff1000 ( 4 kB)[ 0.000000] fixmap : 0xffc00000 - 0xfff00000 (3072 kB)[ 0.000000] vmalloc : 0xa0800000 - 0xff800000 (1520 MB)[ 0.000000] lowmem : 0x80000000 - 0xa0000000 ( 512 MB)[ 0.000000] pkmap : 0x7fe00000 - 0x80000000 ( 2 MB)[ 0.000000] modules : 0x7f000000 - 0x7fe00000 ( 14 MB)[ 0.000000] .text : 0x80008000 - 0x80c00000 (12256 kB)[ 0.000000] .init : 0x81100000 - 0x81200000 (1024 kB)[ 0.000000] .data : 0x81200000 - 0x81313c70 (1104 kB)[ 0.000000] .bss : 0x81315000 - 0x8138c6d8 ( 478 kB)[ 0.000000] SLUB: HWalign64, Order0-3, MinObjects0, CPUs1, Nodes1[ 0.000000] Preemptible hierarchical RCU implementation.[ 0.000000] Build-time adjustment of leaf fanout to 32.[ 0.000000] RCU restricting CPUs from NR_CPUS4 to nr_cpu_ids1.[ 0.000000] RCU: Adjusting geometry for rcu_fanout_leaf32, nr_cpu_ids1[ 0.000000] NR_IRQS:16 nr_irqs:16 16[ 0.000000] Switching to timer-based delay loop, resolution 333ns[ 0.000018] sched_clock: 32 bits at 3000kHz, resolution 333ns, wraps every 715827882841ns[ 0.000068] clocksource: mxc_timer1: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 637086815595 ns[ 0.004510] Console: colour dummy device 80x30[ 0.004564] Calibrating delay loop (skipped), value calculated using timer frequency.. 6.00 BogoMIPS (lpj30000)[ 0.004607] pid_max: default: 32768 minimum: 301[ 0.004861] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)[ 0.004894] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)[ 0.006578] CPU: Testing write buffer coherency: ok[ 0.006680] ftrace: allocating 35227 entries in 104 pages[ 0.140629] cpuscpu@0 missing clock-frequency property[ 0.140684] CPU0: thread -1, cpu 0, socket 0, mpidr 80000000[ 0.140757] Setting up static identity map for 0x80100000 - 0x80100058[ 0.229449] Brought up 1 CPUs[ 0.229490] SMP: Total of 1 processors activated (6.00 BogoMIPS).[ 0.229511] CPU: All CPU(s) started in SVC mode.[ 0.231097] devtmpfs: initialized[ 0.249164] OF: Duplicate name in lcdif@021c8000, renamed to â€œdisplay#1â€[ 0.256508] VFP support v0.3: implementor 41 architecture 2 part 30 variant 7 rev 5[ 0.257365] clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 19112604462750000 ns[ 0.257424] futex hash table entries: 256 (order: 2, 16384 bytes)[ 0.283866] pinctrl core: initialized pinctrl subsystem[ 0.286526] NET: Registered protocol family 16[ 0.306281] DMA: preallocated 256 KiB pool for atomic coherent allocations[ 0.331551] cpuidle: using governor menu[ 0.393319] hw-breakpoint: found 5 (+1 reserved) breakpoint and 4 watchpoint registers.[ 0.393356] hw-breakpoint: maximum watchpoint size is 8 bytes.[ 0.397863] imx6ul-pinctrl 20e0000.iomuxc: Invalid fsl,pins property in node socaips-bus@02000000iomuxc@020e0000imx6ul-evkenet1grp[ 0.398711] imx6ul-pinctrl 20e0000.iomuxc: initialized IMX pinctrl driver[ 0.399599] imx6ul-pinctrl 2290000.iomuxc-snvs: initialized IMX pinctrl driver[ 0.546074] mxs-dma 1804000.dma-apbh: initialized[ 0.554548] SCSI subsystem initialized[ 0.564527] usbcore: registered new interface driver usbfs[ 0.564748] usbcore: registered new interface driver hub[ 0.565014] usbcore: registered new device driver usb[ 0.567951] i2c i2c-0: IMX I2C adapter registered[ 0.568006] i2c i2c-0: canâ€™t use DMA, using PIO instead.[ 0.570280] i2c i2c-1: IMX I2C adapter registered[ 0.570332] i2c i2c-1: canâ€™t use DMA, using PIO instead.[ 0.571663] Linux video capture interface: v2.00[ 0.571874] pps_core: LinuxPPS API ver. 1 registered[ 0.571899] pps_core: Software ver. 5.3.6 - Copyright 2005-2007 Rodolfo Giometti giometti@linux.it[ 0.571964] PTP clock support registered[ 0.575207] MIPI CSI2 driver module loaded[ 0.576501] imx rpmsg driver is registered.[ 0.577036] Advanced Linux Sound Architecture Driver Initialized.[ 0.579348] Bluetooth: Core ver 2.22[ 0.579487] NET: Registered protocol family 31[ 0.579512] Bluetooth: HCI device and connection manager initialized[ 0.579557] Bluetooth: HCI socket layer initialized[ 0.579594] Bluetooth: L2CAP socket layer initialized[ 0.579693] Bluetooth: SCO socket layer initialized[ 0.594415] clocksource: Switched to clocksource mxc_timer1[ 0.783452] VFS: Disk quotas dquot_6.6.0[ 0.783643] VFS: Dquot-cache hash table entries: 1024 (order 0, 4096 bytes)[ 0.813312] NET: Registered protocol family 2[ 0.815091] TCP established hash table entries: 4096 (order: 2, 16384 bytes)[ 0.815227] TCP bind hash table entries: 4096 (order: 3, 32768 bytes)[ 0.815389] TCP: Hash tables configured (established 4096 bind 4096)[ 0.815535] UDP hash table entries: 256 (order: 1, 8192 bytes)[ 0.815597] UDP-Lite hash table entries: 256 (order: 1, 8192 bytes)[ 0.816001] NET: Registered protocol family 1[ 0.837352] RPC: Registered named UNIX socket transport module.[ 0.837388] RPC: Registered udp transport module.[ 0.837410] RPC: Registered tcp transport module.[ 0.837431] RPC: Registered tcp NFSv4.1 backchannel transport module.[ 0.844073] Bus freq driver module loaded[ 0.859324] workingset: timestamp_bits30 max_order17 bucket_order0[ 0.890506] NFS: Registering the id_resolver key type[ 0.890580] Key type id_resolver registered[ 0.890604] Key type id_legacy registered[ 0.890746] jffs2: version 2.2. (NAND) Â© 2001-2006 Red Hat, Inc.[ 0.892706] fuse init (API version 7.26)[ 0.912006] io scheduler noop registered[ 0.912044] io scheduler deadline registered[ 0.912546] io scheduler cfq registered (default)[ 0.913889] imx-weim 21b8000.weim: Driver registered.[ 0.923122] backlight supply power not found, using dummy regulator[ 0.932749] sii902x 1-0039: No reset pin found[ 0.936749] 21c8000.lcdif supply lcd not found, using dummy regulator[ 1.073728] Console: switching to colour frame buffer device 128x37[ 1.204549] mxsfb 21c8000.lcdif: Success seset LCDIF[ 1.204591] mxsfb 21c8000.lcdif: initialized[ 1.208320] imx-sdma 20ec000.sdma: loaded firmware 3.3[ 1.220207] 2020000.serial: ttymxc0 at MMIO 0x2020000 (irq 20, base_baud 5000000) is a IMX[ 1.922972] console [ttymxc0] enabled[ 1.929129] 21ec000.serial: ttymxc2 at MMIO 0x21ec000 (irq 73, base_baud 5000000) is a IMX[ 1.939733] 21fc000.serial: ttymxc5 at MMIO 0x21fc000 (irq 74, base_baud 5000000) is a IMX[ 1.987307] imx-rng 2284000.rngb: iMX RNG Registered.[ 1.993285] imx sema4 driver is registered.[ 1.997811] [drm] Initialized[ 2.002231] [drm] Initialized vivante 1.0.0 20120216 on minor 0[ 2.205473] brd: module loaded[ 2.277921] loop: module loaded[ 2.292077] spi_gpio spi4: gpio-miso property not found, switching to no-rx mode[ 2.305678] spi_imx 2008000.ecspi: probed[ 2.312397] spi_imx 2010000.ecspi: probed[ 2.319892] libphy: Fixed MDIO Bus: probed[ 2.325383] CAN device driver interface[ 2.332235] flexcan 2090000.can: device registered (reg_basea0a00000, irq29)[ 2.343587] 20b4000.ethernet supply phy not found, using dummy regulator[ 2.395768] pps pps0: new PPS source ptp0[ 2.402541] libphy: fec_enet_mii_bus: probed[ 2.421512] fec 20b4000.ethernet eth0: registered PHC device 0[ 2.429035] 2188000.ethernet supply phy not found, using dummy regulator[ 2.485616] pps pps1: new PPS source ptp1[ 2.493693] fec 2188000.ethernet eth1: registered PHC device 1[ 2.502086] PPP generic driver version 2.4.2[ 2.507201] PPP BSD Compression module registered[ 2.511977] PPP Deflate Compression module registered[ 2.517309] PPP MPPE Compression module registered[ 2.522155] NET: Registered protocol family 24[ 2.526787] SLIP: version 0.8.4-NET3.019-NEWTTY (dynamic channels, max256) (6 bit encapsulation enabled).[ 2.536647] CSLIP: code copyright 1989 Regents of the University of California.[ 2.543996] SLIP linefillkeepalive option.[ 2.548537] usbcore: registered new interface driver asix[ 2.554148] usbcore: registered new interface driver ax88179_178a[ 2.560529] usbcore: registered new interface driver cdc_ether[ 2.566632] usbcore: registered new interface driver cdc_eem[ 2.572472] usbcore: registered new interface driver net1080[ 2.578387] usbcore: registered new interface driver cdc_subset[ 2.584582] usbcore: registered new interface driver zaurus[ 2.590410] usbcore: registered new interface driver cdc_ncm[ 2.596188] ehci_hcd: USB 2.0 â€˜Enhancedâ€™ Host Controller (EHCI) Driver[ 2.602798] ehci-platform: EHCI generic platform driver[ 2.609198] ehci-mxc: Freescale On-Chip EHCI Host driver[ 2.614656] random: fast init done[ 2.618462] ohci_hcd: USB 1.1 â€˜Openâ€™ Host Controller (OHCI) Driver[ 2.624851] ohci-platform: OHCI generic platform driver[ 2.631009] usbcore: registered new interface driver cdc_acm[ 2.636834] cdc_acm: USB Abstract Control Model driver for USB modems and ISDN adapters[ 2.645159] usbcore: registered new interface driver usblp[ 2.650839] usbcore: registered new interface driver cdc_wdm[ 2.656847] usbcore: registered new interface driver usb-storage[ 2.663186] usbcore: registered new interface driver usbserial[ 2.669286] usbcore: registered new interface driver usbserial_generic[ 2.676057] usbserial: USB Serial support registered for generic[ 2.682230] usbcore: registered new interface driver option[ 2.688044] usbserial: USB Serial support registered for GSM modem (1-port)[ 2.695270] usbcore: registered new interface driver usb_ehset_test[ 2.705076] 2184800.usbmisc supply vbus-wakeup not found, using dummy regulator[ 2.715116] 2184000.usb supply vbus not found, using dummy regulator[ 3.335574] 2184200.usb supply vbus not found, using dummy regulator[ 3.346129] ci_hdrc ci_hdrc.1: EHCI Host Controller[ 3.351139] ci_hdrc ci_hdrc.1: new USB bus registered, assigned bus number 1[ 3.384530] ci_hdrc ci_hdrc.1: USB 2.0 started, EHCI 1.00[ 3.392705] hub 1-0:1.0: USB hub found[ 3.396864] hub 1-0:1.0: 1 port detected[ 3.404246] mousedev: PS2 mouse device common for all mice[ 3.412597] input: 20cc000.snvs:snvs-powerkey as devicessoc0soc2000000.aips-bus20cc000.snvs20cc000.snvs:snvs-powerkeyinputinput0[ 3.427703] imx6ul-pinctrl 20e0000.iomuxc: pin MX6UL_PAD_GPIO1_IO01 already requested by 2010000.ecspi; cannot claim for 2040000.tsc[ 3.439944] imx6ul-pinctrl 20e0000.iomuxc: pin-24 (2040000.tsc) status -22[ 3.446954] imx6ul-pinctrl 20e0000.iomuxc: could not request pin 24 (MX6UL_PAD_GPIO1_IO01) from group tscgrp on device 20e0000.iomuxc[ 3.459133] imx6ul-tsc 2040000.tsc: Error applying setting, reverse things back[ 3.466574] imx6ul-tsc: probe of 2040000.tsc failed with error -22[ 3.474085] usbcore: registered new interface driver usbtouchscreen[ 3.481110] Gt9xx driver installing..[ 3.485402] goodix-ts 1-005d: GTP Driver Version: V2.8.0.220171214[ 3.491987] goodix-ts 1-005d: GTP I2C Address: 0x5d[ 3.497189] goodix-ts 1-005d: touch input parameters is [id x y w p]5 800 480 1024 1024[ 3.505928] 1-005d supply vdd_ana not found, using dummy regulator[ 3.512329] 1-005d supply vcc_i2c not found, using dummy regulator[ 3.518793] goodix-ts 1-005d: Failed get pinctrl state:output_high[ 3.525123] goodix-ts 1-005d: Success request irq-gpio[ 3.530316] goodix-ts 1-005d: Success request rst-gpio[ 3.535549] goodix-ts 1-005d: try to reset and read Guitar 0[ 3.541246] goodix-ts 1-005d: Guitar reset[ 3.576738] goodix-ts 1-005d: I2C Addr is 5d[ 3.582693] goodix-ts 1-005d: IC Version: 911_1060[ 3.589475] goodix-ts 1-005d: Driver set not send config[ 3.626001] goodix-ts 1-005d: Use slot report protocol[ 3.631797] input: goodix-ts as devicesvirtualinputinput1[ 3.638223] goodix-ts 1-005d: INT num 84, trigger type:2[ 3.644192] goodix-ts 1-005d: create proc entry gt9xx_config success[ 3.650796] goodix-ts 1-005d: Alloc memory size:1534.[ 3.655958] goodix-ts 1-005d: I2C function: without pre and end cmd![ 3.662375] goodix-ts 1-005d: Create proc entry success![ 3.672119] snvs_rtc 20cc000.snvs:snvs-rtc-lp: rtc core: registered 20cc000.snvs:snvs-r as rtc0[ 3.682311] i2c dev entries driver[ 3.687748] IR NEC protocol handler initialized[ 3.692334] IR RC5(xsz) protocol handler initialized[ 3.697552] IR RC6 protocol handler initialized[ 3.702120] IR JVC protocol handler initialized[ 3.706737] IR Sony protocol handler initialized[ 3.711386] IR SANYO protocol handler initialized[ 3.716165] IR Sharp protocol handler initialized[ 3.720899] IR MCE Keyboardmouse protocol handler initialized[ 3.726809] IR XMP protocol handler initialized[ 3.735093] pxp-v4l2 pxp_v4l2: initialized[ 3.745145] imx2-wdt 20bc000.wdog: timeout 60 sec (nowayout0)[ 3.752109] Bluetooth: HCI UART driver ver 2.3[ 3.756968] usb 1-1: new high-speed USB device number 2 using ci_hdrc[ 3.764002] Bluetooth: HCI UART protocol H4 registered[ 3.769395] Bluetooth: HCI UART protocol BCSP registered[ 3.774985] Bluetooth: HCI UART protocol ATH3K registered[ 3.781019] usbcore: registered new interface driver bcm203x[ 3.787384] usbcore: registered new interface driver btusb[ 3.797004] sdhci: Secure Digital Host Controller Interface driver[ 3.803239] sdhci: Copyright(c) Pierre Ossman[ 3.807960] sdhci-pltfm: SDHCI platform and OF driver helper[ 3.817762] sdhci-esdhc-imx 2190000.usdhc: could not get ultra high speed state, work on normal mode[ 3.827886] sdhci-esdhc-imx 2190000.usdhc: Got CD GPIO[ 3.896389] mmc0: SDHCI controller on 2190000.usdhc [2190000.usdhc] using ADMA[ 3.905211] sdhci-esdhc-imx 2194000.usdhc: could not get ultra high speed state, work on normal mode[ 3.947203] hub 1-1:1.0: USB hub found[ 3.951294] hub 1-1:1.0: 4 ports detected[ 3.974522] mmc1: SDHCI controller on 2194000.usdhc [2194000.usdhc] using ADMA[ 3.994283] ledtrig-cpu: registered to indicate activity on CPUs[ 4.018682] usbcore: registered new interface driver usbhid[ 4.024315] usbhid: USB HID core driver[ 4.064275] wm8960 1-001a: No platform data supplied[ 4.110264] mmc1: new DDR MMC card at address 0001[ 4.126957] mmcblk1: mmc1:0001 S40004 3.64 GiB[ 4.142458] mmcblk1boot0: mmc1:0001 S40004 partition 1 4.00 MiB[ 4.159586] mmcblk1boot1: mmc1:0001 S40004 partition 2 4.00 MiB[ 4.176714] mmcblk1rpmb: mmc1:0001 S40004 partition 3 4.00 MiB[ 4.195215] mmcblk1: p1 p2 p3[ 4.209289] imx-wm8960 sound: wm8960-hifi - 202c000.sai mapping ok[ 4.221843] imx-wm8960 sound: snd-soc-dummy-dai - 2034000.asrc mapping ok[ 4.229628] imx-wm8960 sound: wm8960-hifi - 202c000.sai mapping ok[ 4.274518] usb 1-1.1: new high-speed USB device number 3 using ci_hdrc[ 4.369229] NET: Registered protocol family 26[ 4.376114] NET: Registered protocol family 10[ 4.393809] sit: IPv6, IPv4 and MPLS over IPv4 tunneling driver[ 4.401977] NET: Registered protocol family 17[ 4.406784] can: controller area network core (rev 20120528 abi 9)[ 4.413229] NET: Registered protocol family 29[ 4.417857] can: raw protocol (rev 20120528)[ 4.422170] can: broadcast manager protocol (rev 20161123 t)[ 4.428109] can: netlink gateway (rev 20130117) max_hops1[ 4.435702] Bluetooth: RFCOMM TTY layer initialized[ 4.442912] Bluetooth: RFCOMM socket layer initialized[ 4.449620] Bluetooth: RFCOMM ver 1.11[ 4.453440] Bluetooth: BNEP (Ethernet Emulation) ver 1.3[ 4.459014] Bluetooth: BNEP filters: protocol multicast[ 4.464705] Bluetooth: BNEP socket layer initialized[ 4.469719] Bluetooth: HIDP (Human Interface Emulation) ver 1.2[ 4.475897] Bluetooth: HIDP socket layer initialized[ 4.481080] 8021q: 802.1Q VLAN Support v1.8[ 4.485444] lib80211: common routines for IEEE802.11 drivers[ 4.491607] Key type dns_resolver registered[ 4.500306] cpu cpu0: Registered imx6q-cpufreq[ 4.529808] Bluetooth: hci0: rtl: examining hci_ver06 hci_rev000b lmp_ver06 lmp_subver8723[ 4.538599] Bluetooth: hci0: rtl: loading rtl_btrtl8723b_config.bin[ 4.545167] bluetooth hci0: Falling back to user helper[ 4.611108] imx_thermal 2000000.aips-bus:tempmon: Industrial CPU temperature grade - max:105C critical:100C passive:95C[ 4.624000] input: gpio-keys as devicessoc0gpio-keysinputinput2[ 4.631298] snvs_rtc 20cc000.snvs:snvs-rtc-lp: setting system clock to 1970-01-01 00:00:00 UTC (0)[ 4.641003] ltemodule-pwr: disabling[ 4.644705] wifi-pwr: disabling[ 4.647866] ALSA device list:[ 4.650846] #0: wm8960-audio[ 4.666249] EXT4-fs (mmcblk1p2): couldnâ€™t mount as ext3 due to feature incompatibilities[ 4.937373] EXT4-fs (mmcblk1p2): recovery complete[ 4.944210] EXT4-fs (mmcblk1p2): mounted filesystem with ordered data mode. Opts: (null)[ 4.952552] VFS: Mounted root (ext4 filesystem) on device 179:2.[ 4.959806] devtmpfs: mounted[ 4.966107] Freeing unused kernel memory: 1024K[ 5.218400] EXT4-fs (mmcblk1p2): re-mounted. Opts: dataorderedStarting syslogd: OKStarting klogd: OKRunning sysctl: OK[ 5.709022] ds18b20_drv_init OK.[ 5.726532] dht11_drv_init OK.[ 5.756803] irda_drv_init OK.Populating dev using udev: [ 5.843441] udevd[176]: starting version 3.2.9[ 5.961356] udevd[177]: starting eudev-3.2.9[ 7.014107] inv-mpu6000-spi spi2.0: mounting matrix not found: using identityâ€¦[ 7.415114] 8723bu: loading out-of-tree module taints kernel.[ 7.951951] usbcore: registered new interface driver rtl8723budoneInitializing random number generator: OKSaving random seed: OKStarting system message bus: doneStarting network: [ 9.049861] Generic PHY 20b4000.ethernet-1:01: attached PHY driver [Generic PHY] (mii_bus:phy_addr20b4000.ethernet-1:01, irq-1)[ 9.062312] IPv6: ADDRCONF(NETDEV_UP): eth0: link is not readyOKStarting ModemManager: OKStarting NetworkManager â€¦ done.Starting ntpd: OKStarting mosquitto: OKStarting pulseaudio: W: [pulseaudio] main.c: This program is not intended to be run as root (unless â€“system is specified).[ 10.677544] IPv6: ADDRCONF(NETDEV_UP): eth1: link is not ready[ 10.686604] Generic PHY 20b4000.ethernet-1:00: attached PHY driver [Generic PHY] (mii_bus:phy_addr20b4000.ethernet-1:00, irq-1)[ 10.699008] IPv6: ADDRCONF(NETDEV_UP): eth1: link is not ready[ 10.808344] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready[ 12.475638] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready[ 12.632380] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready[ 12.759970] IPv6: ADDRCONF(NETDEV_UP): wlan1: link is not ready[ 12.767253] IPv6: ADDRCONF(NETDEV_UP): wlan1: link is not ready[ 12.880121] IPv6: ADDRCONF(NETDEV_UP): wlan1: link is not ready[ 13.710783] IPv6: ADDRCONF(NETDEV_UP): wlan1: link is not ready[ 13.766578] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not readyOKStarting sshd: OKStarting telnetd: OKStarting swupdate: Trying to connect to SWUpdateâ€¦OKConnected to SWUpdate via tmpswupdateprog Welcome to imx6ull buildroot system ! SourceCode: https://gitee.com/weidongshan Support: https://support@100ask.net Shopï¼š https://100ask.taobao.com/ Login: name: root Passwd:100ask login: rootCOLUMNS88;LINES18;export COLUMNS LINES;[root@100ask:~]# [ 69.655147] Bluetooth: hci0: Failed to load rtl_btrtl8723b_config.bin[ 69.661764] Bluetooth: hci0: rtl: loading rtl_btrtl8723b_fw.bin[ 69.692145] Bluetooth: hci0: rom_version status0 version1[ 69.698229] Bluetooth: cfg_sz 0, total size 22768","tags":["linux","å¯åŠ¨"],"categories":["åµŒå…¥å¼"]},{"title":"Linuxå¯åŠ¨åˆ†æ","path":"/2025/08/18/linuxmain/","content":"è¿™å‡ å¤©ä¸€ç›´åœ¨çº ç»“ï¼š mainå‡½æ•°æ˜¯ç¨‹åºçš„å…¥å£ï¼Œä¸€ä¸ªç¨‹åºå¯åŠ¨åï¼Œç»è¿‡bootloaderçš„åˆå§‹åŒ–å°±è¯¥ç»mainå‡½æ•°è¿›å…¥Cè¯­è¨€çš„ä¸–ç•Œï¼Œä½†æ˜¯linuxä¸­æ¯ä¸ªåº”ç”¨ç¨‹åºçš„å¼€å§‹éƒ½æ˜¯ä»mainå‡½æ•°å¼€å§‹çš„ã€‚linuxä¸‹æœ‰å¤šä¸ªåº”ç”¨ç¨‹åºï¼Œå²‚ä¸æ˜¯æœ‰å¾ˆå¤šä¸ªmainã€‚é‚£bootloaderä¼šçŸ¥é“è·³åˆ°å“ªä¸ªmainï¼Ÿå¤šä¸ªmainç¼–è¯‘æ€ä¹ˆä¸å†²çªï¼Ÿ åœ¨ç½‘ä¸Šæœç´¢äº†å¾ˆä¹…ï¼Œæ¸æ¸çš„æœ‰äº›æ˜ç™½äº†ï¼š 1ã€mainå‡½æ•°æ˜¯Cè¯­è¨€çš„å…¥å£ï¼Œè¿™å¥è¯æ²¡é”™ï¼›ä½†æ˜¯è¿™å¥è¯ä»…ä»…æ˜¯ä¸€ä¸ªçº¦å®šï¼Œè€Œéä¸€ä¸ªäº˜å¤ä¸å˜çš„é“å¾‹ï¼ä»ç¨‹åºçš„æ›´ä¸ºæœ¬è´¨çš„æ±‡ç¼–ä»£ç æ¥çœ‹ï¼Œåªæ˜¯å¤§å®¶çº¦å®šæ±‡ç¼–åˆå§‹åŒ–å®Œäº†åï¼Œè·³åˆ°ä¸€ä¸ªåå­—å«â€mainâ€çš„æ ‡å·å¤„ï¼›è¨€å¤–ä¹‹æ„å°±æ˜¯è¿™ä¸ªæ ‡å·ä¹Ÿæ˜¯å¯ä»¥æ”¹åçš„ï¼Œæ¯”å¦‚linuxçš„Cè¯­è¨€å…¥å£å°±æ˜¯start_kernelï¼ˆï¼‰ï¼›ä»è¿™ä¸ªæ ‡å·åœ°å€åå°±æ˜¯Cè¯­è¨€çš„å¤©ä¸‹äº†ã€‚ç”¨mainè¿™ä¸ªåå­—ä»…ä»…æ˜¯å› ä¸ºå¤§å®¶çš„çº¦å®šè€Œå·²ï¼Œä¸éµå®ˆçº¦å®šèƒ½ç©çš„è½¬ä¹Ÿè¡Œå•Šï¼Œå°±åƒè‹¹æœå……ç”µçº¿å•¥çš„éƒ½å’Œåˆ«äººä¸ä¸€æ ·ã€‚ 2ã€åœ¨ç¼–è¯‘æ—¶æ˜¯ä¸å­˜å¤šä¸ªmainå‡½æ•°çš„ï¼æ¯ä¸ªåº”ç”¨ç¨‹åºè™½è¯´éƒ½æœ‰ä¸€ä¸ªmainå‡½æ•°ï¼ˆä»åº”ç”¨ç¨‹åºæ¥çœ‹åº”ç”¨ç¨‹åºçš„å…¥å£æ˜¯mainå‡½æ•°å“¦ï¼‰ï¼›ä½†æ˜¯åº”ç”¨ç¨‹åºéƒ½æ˜¯ç‹¬ç«‹ç¼–è¯‘çš„ï¼Œä¸ä¼šä¸€èµ·ç¼–è¯‘ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸å°±æ›´ä¸å¯èƒ½å’Œåº”ç”¨ç¨‹åºä¸€èµ·ç¼–è¯‘äº†ï¼æ‰€ä»¥æ ¹æœ¬ä¸å­˜åœ¨å¤šä¸ªmainå†²çªçš„ï¼ï¼å¯èƒ½æ˜¯ç»Ÿä¸€æ“ä½œç³»ç»Ÿä¸åº”ç”¨ç¨‹åºä¹‹é—´çš„æ¥å£ï¼ŒæŠ‘æˆ–æ˜¯ä¾§é¢å½±å“ä¸‹mainæ˜¯ç¨‹åºå…¥å£çš„è¯´æ³•ï¼Œmainæ˜¯åº”ç”¨ç¨‹åºå’Œæ“ä½œç³»ç»Ÿä¹‹é—´çº¦å®šå¥½çš„ä¸€ä¸ªæ¥å£åï¼æ‰€ä»¥linuxä¸­æ¯ä¸ªåº”ç”¨ç¨‹åºçš„ç¬¬ä¸€ä¸ªå‡½æ•°å¿…é¡»æ˜¯mainã€‚é™¤éä½ æ”¹æ‰äº†å†…æ ¸è°ƒåº¦çš„æ¥å£åœ°æ–¹ã€‚ 3ã€linuxçš„åº”ç”¨ç¨‹åºçš„å®‰è£…å¯åŠ¨ä¹Ÿå¯ä»¥ç±»æ¯”ä¸‹æˆ‘ä»¬æ¯å¤©éƒ½åœ¨ç”¨çš„Windowsã€‚Windowsåº”ç”¨ç¨‹åºçš„å®‰è£…å…¶å®ä¹Ÿæ˜¯æŠŠä¸€äº›æ‰§è¡Œæ–‡ä»¶æ‹·è´åˆ°æŒ‡å®šçš„æ–‡ä»¶å¤¹é‡Œï¼ˆä»ç»¿è‰²è½¯ä»¶çœ‹ï¼‰ï¼Œç‚¹å‡»å°±å¯ä»¥è¿è¡Œã€‚linuxä¸‹ä¹Ÿæ˜¯è¿™æ ·ã€‚ç¼–è¯‘å¥½çš„binæ–‡ä»¶æ”¾åˆ°æŒ‡å®šçš„æ–‡ä»¶å¤¹ç›®å½•ä¸‹ï¼Œç„¶åç”¨å‘½ä»¤å¯åŠ¨æ‰§è¡Œã€‚ * linuxinitmain.c Copyright (C) 1991, 1992 Linus Torvalds GK 2595 - Changed to support mounting root fs via NFS Added initrd change_root: Werner Almesberger Hans Lermen, Feb â€˜96 Moan early if gcc is old, avoiding bogus kernels - Paul Gortmaker, May â€˜96 Simplified starting of init: Michael A. Griffith grif@acm.org start_kernel-rest_init-kernel_initåˆ›å»ºç”¨æˆ·init pid1 -kthreaddç®¡ç†å†…æ ¸çº¿ç¨‹ pidx -pid0ï¼Œæ˜¯idleçº¿ç¨‹ åœ¨rest_initä¸­ï¼Œä¼šåˆ›å»ºkernel_initçº¿ç¨‹ï¼Œå®ƒè´Ÿè´£åˆ›å»ºç”¨æˆ·initè¿›ç¨‹,å®Œæˆå·¥ä½œåï¼Œè‡ªå·± åŒ–èº«ä¸ºidleçº¿ç¨‹ * #include linuxtypes.h#include linuxmodule.h#include linuxproc_fs.h#include linuxkernel.h#include linuxsyscalls.h#include linuxstackprotector.h#include linuxstring.h#include linuxctype.h#include linuxdelay.h#include linuxioport.h#include linuxinit.h#include linuxinitrd.h#include linuxbootmem.h#include linuxacpi.h#include linuxtty.h#include linuxpercpu.h#include linuxkmod.h#include linuxvmalloc.h#include linuxkernel_stat.h#include linuxstart_kernel.h#include linuxsecurity.h#include linuxsmp.h#include linuxprofile.h#include linuxrcupdate.h#include linuxmoduleparam.h#include linuxkallsyms.h#include linuxwriteback.h#include linuxcpu.h#include linuxcpuset.h#include linuxcgroup.h#include linuxefi.h#include linuxtick.h#include linuxinterrupt.h#include linuxtaskstats_kern.h#include linuxdelayacct.h#include linuxunistd.h#include linuxrmap.h#include linuxmempolicy.h#include linuxkey.h#include linuxbuffer_head.h#include linuxpage_cgroup.h#include linuxdebug_locks.h#include linuxdebugobjects.h#include linuxlockdep.h#include linuxkmemleak.h#include linuxpid_namespace.h#include linuxdevice.h#include linuxkthread.h#include linuxsched.h#include linuxsignal.h#include linuxidr.h#include linuxkgdb.h#include linuxftrace.h#include linuxasync.h#include linuxkmemcheck.h#include linuxsfi.h#include linuxshmem_fs.h#include linuxslab.h#include linuxperf_event.h #include asmio.h#include asmbugs.h#include asmsetup.h#include asmsections.h#include asmcacheflush.h #ifdef CONFIG_X86_LOCAL_APIC#include asmsmp.h#endif static int kernel_init(void *); extern void init_IRQ(void);extern void fork_init(unsigned long);extern void mca_init(void);extern void sbus_init(void);extern void prio_tree_init(void);extern void radix_tree_init(void);#ifndef CONFIG_DEBUG_RODATAstatic inline void mark_rodata_ro(void) { }#endif #ifdef CONFIG_TCextern void tc_init(void);#endif * Debug helper: via this flag we know that we are in â€˜early bootup codeâ€™ where only the boot processor is running with IRQ disabled. This means two things - IRQ must not be enabled before the flag is cleared and some operations which are not allowed with IRQ disabled are allowed while the flag is set. *bool early_boot_irqs_disabled __read_mostly; enum system_states system_state __read_mostly;EXPORT_SYMBOL(system_state); * Boot command-line arguments * #define MAX_INIT_ARGS CONFIG_INIT_ENV_ARG_LIMIT#define MAX_INIT_ENVS CONFIG_INIT_ENV_ARG_LIMIT extern void time_init(void);* Default late time init is NULL. archs can override this later. void (__initdata late_time_init)(void);extern void softirq_init(void); * Untouched command line saved by arch-specific code. char __initdata boot_command_line[COMMAND_LINE_SIZE]; Untouched saved command line (eg. for proc) *char saved_command_line; Command line for parameter parsing *static char *static_command_line; static char *execute_command;static char *ramdisk_execute_command; * If set, this is an indication to the drivers that reset the underlying device before going ahead with the initialization otherwise driver might rely on the BIOS and skip the reset operation. This is useful if kernel is booting in an unreliable environment. For ex. kdump situaiton where previous kernel has crashed, BIOS has been skipped and devices will be in unknown state. *unsigned int reset_devices;EXPORT_SYMBOL(reset_devices); static int __init set_reset_devices(char *str){ reset_devices 1; return 1;} __setup(â€œreset_devicesâ€, set_reset_devices); static const char * argv_init[MAX_INIT_ARGS+2] { â€œinitâ€, NULL, };const char * envp_init[MAX_INIT_ENVS+2] { â€œHOMEâ€œ, â€œTERMlinuxâ€, NULL, };static const char *panic_later, *panic_param; extern const struct obs_kernel_param __setup_start[], __setup_end[]; static int __init obsolete_checksetup(char *line){ const struct obs_kernel_param *p; int had_early_param 0; p = __setup_start; do { int n = strlen(p-str); if (parameqn(line, p-str, n)) { if (p-early) { /* Already done in parse_early_param? * (Needs exact match on param part). * Keep iterating, as we can have early * params and __setups of same names 8( */ if (line[n] == \\0 || line[n] == =) had_early_param = 1; } else if (!p-setup_func) { printk(KERN_WARNING Parameter %s is obsolete, ignored , p-str); return 1; } else if (p-setup_func(line + n)) return 1; } p++; } while (p __setup_end); return had_early_param; } * This should be approx 2 Bo*oMips to start (note initial shift), and will still work even if initially too large, it will just take slightly longer *unsigned long loops_per_jiffy (112);EXPORT_SYMBOL(loops_per_jiffy);static int __init debug_kernel(char *str){ console_loglevel 10; return 0;}static int __init quiet_kernel(char *str){ console_loglevel 4; return 0;}early_param(â€œdebugâ€, debug_kernel);early_param(â€œquietâ€, quiet_kernel);static int __init loglevel(char str){ int newlevel; Only update loglevel value when a correct setting was passed, to prevent blind crashes (when loglevel being set to 0) that are quite hard to debug if (get_option(str, newlevel)) { console_loglevel newlevel; return 0; } return -EINVAL;}early_param(â€œloglevelâ€, loglevel); Change NUL term back to â€œâ€, to make â€œparamâ€ the whole string. *static int __init repair_env_string(char *param, char val){ if (val) { paramval or paramâ€valâ€? * if (val param+strlen(param)+1) val[-1] â€˜â€™; else if (val param+strlen(param)+2) { val[-2] â€˜â€™; memmove(val-1, val, strlen(val)+1); valâ€“; } else BUG(); } return 0;}* Unknown boot options get handed to init, unless they look like unused parameters (modprobe will find them in proccmdline). *static int __init unknown_bootoption(char *param, char val){ repair_env_string(param, val); Handle obsolete-style parameters if (obsolete_checksetup(param)) return 0; Unused module parameter. if (strchr(param, â€˜.â€™) (!val || strchr(param, â€˜.â€™) val)) return 0; if (panic_later) return 0; if (val) { Environment option * unsigned int i; for (i 0; envp_init[i]; i++) { if (i MAX_INIT_ENVS) { panic_later â€œToo many boot env vars at %s; panic_param = param; } if (!strncmp(param, envp_init[i], val - param)) break; } envp_init[i] = param; } else { /* Command line option */ unsigned int i; for (i = 0; argv_init[i]; i++) { if (i == MAX_INIT_ARGS) { panic_later = Too many boot init vars at %sâ€™â€; panic_param param; } } argv_init[i] param; } return 0;}static int __init init_setup(char str){ unsigned int i; execute_command str; In case LILO is going to boot us with default command line, it prepends â€œautoâ€ before the whole cmdline which makes the shell think it should execute a script with such name. So we ignore all arguments entered before initâ€¦ [MJ] * for (i 1; i MAX_INIT_ARGS; i++) argv_init[i] NULL; return 1;}__setup(â€œinitâ€, init_setup);static int __init rdinit_setup(char str){ unsigned int i; ramdisk_execute_command str; See â€œautoâ€ comment in init_setup * for (i 1; i MAX_INIT_ARGS; i++) argv_init[i] NULL; return 1;}__setup(â€œrdinitâ€, rdinit_setup); #ifndef CONFIG_SMPstatic const unsigned int setup_max_cpus NR_CPUS;#ifdef CONFIG_X86_LOCAL_APICstatic void __init smp_init(void){ APIC_init_uniprocessor();}#else#define smp_init() do { } while (0)#endifstatic inline void setup_nr_cpu_ids(void) { }static inline void smp_prepare_cpus(unsigned int maxcpus) { }#endif* We need to store the untouched command line for future reference. We also need to store the touched command line since the parameter parsing is performed in place, and we should allow a component to store reference of namevalue for future reference. *static void __init setup_command_line(char command_line){ saved_command_line alloc_bootmem(strlen (boot_command_line)+1); static_command_line alloc_bootmem(strlen (command_line)+1); strcpy (saved_command_line, boot_command_line); strcpy (static_command_line, command_line);} We need to finalize in a non-__init function or else race conditions between the root thread and the init thread may cause start_kernel to be reaped by free_initmem before the root thread has proceeded to cpu_idle. gcc-3.4 accidentally inlines this function, so use noinline. static __initdata DECLARE_COMPLETION(kthreadd_done);static noinline void __init_refok rest_init(void){ int pid; rcu_scheduler_starting();READ-COPY UPDATEå¯åŠ¨ We need to spawn init first so that it obtains pid 1, however the init task will end up wanting to create kthreads, which, if we schedule it before we create kthreadd, will OOPS. åˆ›å»ºä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œå®ƒçš„çº¿ç¨‹å‡½æ•°æ˜¯kernel_init,pid1,å†…æ ¸è¿›ç¨‹ kernel_thread(kernel_init, NULL, CLONE_FS | CLONE_SIGHAND); numaç­–ç•¥è®¾ç½® numa_default_policy(); å…¨å±€é“¾è¡¨kthread_create_listä¸­çš„kthreadå†…æ ¸çº¿ç¨‹éƒ½è¢«è¿è¡Œ kthreaddçº¿ç¨‹ç®¡ç†å’Œè°ƒåº¦å…¶å®ƒå†…æ ¸çº¿ç¨‹ pid kernel_thread(kthreadd, NULL, CLONE_FS | CLONE_FILES); rcu_read_lock(); é€šè¿‡pid,ini_pid_nså–å¾—kthreaddåœ°å€ kthreadd_task find_task_by_pid_ns(pid, init_pid_ns); rcu_read_unlock(); é€šçŸ¥åœ¨kthreadd_doneæ¡ä»¶çš„kernel_initçº¿ç¨‹ complete(kthreadd_done); The boot idle thread must execute schedule() at least once to get things moving: idle çº¿ç¨‹åˆå§‹åŒ– init_idle_bootup_task(current); æŠ¢å ç¦ç”¨ schedule_preempt_disabled(); Call into cpu_idle with preempt disabled cpu_idle();} Check for early params. *static int __init do_early_param(char *param, char *val){ const struct obs_kernel_param p; for (p __setup_start; p __setup_end; p++) { if ((p-early parameq(param, p-str)) || (strcmp(param, â€œconsoleâ€) 0 strcmp(p-str, â€œearlyconâ€) 0) ) { if (p-setup_func(val) ! 0) printk(KERN_WARNING â€œMalformed early option â€˜%sâ€™ â€, param); } } We accept everything at this stage. * return 0;}void __init parse_early_options(char cmdline){ parse_args(â€œearly optionsâ€, cmdline, NULL, 0, 0, 0, do_early_param);} Arch code calls this early on, or if not, just before other parsing. void __init parse_early_param(void){ static __initdata int done 0; static __initdata char tmp_cmdline[COMMAND_LINE_SIZE]; if (done) return; All fall through to do_early_param. strlcpy(tmp_cmdline, boot_command_line, COMMAND_LINE_SIZE); parse_early_options(tmp_cmdline); done 1;} Activate the first processor. static void __init boot_cpu_init(void){int cpu smp_processor_id(); Mark the boot cpu â€œpresentâ€, â€œonlineâ€ etc for SMP and UP case set_cpu_online(cpu, true);set_cpu_active(cpu, true);set_cpu_present(cpu, true);set_cpu_possible(cpu, true);}void __init __weak smp_setup_processor_id(void){}void __init __weak thread_info_cache_init(void){} Set up kernel memory allocators static void __init mm_init(void){ page_cgroup requires contiguous pages, bigger than MAX_ORDER unless SPARSEMEM. page_cgroup_init_flatmem(); mem_init(); kmem_cache_init(); percpu_init_late(); pgtable_cache_init(); vmalloc_init();}asmlinkage void __init start_kernel(void){ char * command_line; extern const struct kernel_param __start___param[], __stop___param[]; Need to run as early as possible, to initialize the lockdep hash: åˆå§‹åŒ–2ä¸ªhashè¡¨-Lock Dependency Validator(å†…æ ¸ä¾èµ–çš„å…³ç³»è¡¨) lockdep_init(); smp_setup_processor_id(); ç©ºå‡½æ•° debug_objects_early_init();åˆå§‹åŒ–å†…æ ¸è°ƒè¯•ç›¸å…³ Set up the the initial canary ASAP: boot_init_stack_canary();æ ˆæº¢å‡ºä¿æŠ¤åˆå§‹åŒ– æ§åˆ¶ç»„åˆå§‹åŒ–-cgroup-èµ„æºä»»åŠ¡åˆ†ç»„ç®¡ç† cgroup_init_early(); local_irq_disable();å…³ä¸­æ–­ early_boot_irqs_disabled true; Interrupts are still disabled. Do necessary setups, then enable them tick_init();æ—¶é’Ÿåˆå§‹åŒ– boot_cpu_init();å¯åŠ¨cpuåˆå§‹åŒ– page_address_init();é¡µé¢åˆå§‹åŒ– printk(KERN_NOTICE â€œ%sâ€, linux_banner); setup_arch(command_line);æ¶æ„ç›¸å…³åˆå§‹åŒ– mm_init_owner(init_mm, init_task);å†…å­˜ç®¡ç†åˆå§‹åŒ– mm_init_cpumask(init_mm);å†…å­˜ç®¡ç†åˆå§‹åŒ– setup_command_line(command_line);å¤„ç†å‘½ä»¤è¡Œ(ä¿å­˜2ä»½) setup_nr_cpu_ids();cpuidç›¸å…³ setup_per_cpu_areas();æ¯cpuå˜é‡ç”³è¯·ç©ºé—´(åŒ…æ‹¬gdt) smpä¸­ç”¨æ¥å¯åŠ¨çš„cpu smp_prepare_boot_cpu(); arch-specific boot-cpu hooks å»ºç«‹ç³»ç»Ÿå†…å­˜é¡µåŒºé“¾è¡¨ build_all_zonelists(NULL); å†…å­˜é¡µç›¸å…³åˆå§‹åŒ– page_alloc_init(); printk(KERN_NOTICE â€œKernel command line: %s â€, boot_command_line); å‘½ä»¤è¡Œboot_command_line parse_early_param(); è§£æå‚æ•° parse_args(â€œBooting kernelâ€, static_command_line, __start___param, __stop___param - __start___param, -1, -1, unknown_bootoption); jump_label_init(); These use large bootmem allocations and must precede kmem_cache_init() å†…å­˜åˆå§‹åŒ–ç›¸å…³ setup_log_buf(0); pidhash_init(); vfs_caches_init_early(); sort_main_extable(); trap_init(); mm_init(); Set up the scheduler prior starting any interrupts (such as the timer interrupt). Full topology setup happens at smp_init() time - but meanwhile we still have a functioning scheduler. è°ƒåº¦åˆå§‹åŒ– sched_init(); Disable preemption - early bootup scheduling is extremely fragile until we cpu_idle() for the first time. æŠ¢å ç¦ç”¨ preempt_disable(); if (!irqs_disabled()) { printk(KERN_WARNING â€œstart_kernel(): bug: interrupts were â€œ â€œenabled very early, fixing it â€); local_irq_disable(); } idr_init_cache();idr perf_event_init();performance event rcu_init();read-copy-update æœºåˆ¶ radix_tree_init();radixæ ‘æœºåˆ¶ init some links before init_ISA_irqs() * early_irq_init();ä¸­æ–­è¯·æ±‚ init_IRQ();ä¸­æ–­è¯·æ±‚ prio_tree_init();ä¼˜å…ˆæŸ¥æ‰¾æ ‘ init_timers();æ—¶é’Ÿ hrtimers_init();High-resolution kernel timersé«˜ç²¾åº¦å†…æ ¸æ—¶é’Ÿ softirq_init();è½¯ä¸­æ–­ timekeeping_init();æ—¶é—´ç›¸å…³ time_init();æ—¶é—´ profile_init();åˆ†é…å†…æ ¸æ€§èƒ½ç»Ÿè®¡ä¿å­˜çš„å†…å­˜ call_function_init();smpä¸­æ¯cpuçš„call_single_queueåˆå§‹åŒ– if (!irqs_disabled()) printk(KERN_CRIT â€œstart_kernel(): bug: interrupts were â€œ â€œenabled early â€); early_boot_irqs_disabled false;ä¸­æ–­è¯·æ±‚å¼€ local_irq_enable();æœ¬åœ°ä¸­æ–­å¼€ kmem_cache_init_late();kmemåæœŸåˆå§‹åŒ– * HACK ALERT! This is early. Weâ€™re enabling the console before weâ€™ve done PCI setups etc, and console_init() must be aware of this. But we do want output early, in case something goes wrong. console_init();åˆå§‹åŒ–ç³»ç»Ÿæ§åˆ¶å°ç»“æ„ if (panic_later) panic(panic_later, panic_param); é”ä¾èµ–ä¿¡æ¯ lockdep_info(); Need to run this when irqs are enabled, because it wants to self-test [hardsoft]-irqs onoff lock inversion bugs too: * locking_selftest(); #ifdef CONFIG_BLK_DEV_INITRD if (initrd_start !initrd_below_start_ok page_to_pfn(virt_to_page((void *)initrd_start)) min_low_pfn) { printk(KERN_CRIT â€œinitrd overwritten (0x%08lx 0x%08lx) - â€œ â€œdisabling it. â€, page_to_pfn(virt_to_page((void )initrd_start)), min_low_pfn); initrd_start 0; }#endif page_cgroup_init();control groupsåˆå§‹åŒ– debug_objects_mem_init();å¯¹è±¡è°ƒè¯• kmemleak_init();æ£€æµ‹å†…æ ¸å†…å­˜æ³„æ¼çš„åŠŸèƒ½ setup_per_cpu_pageset();ç”³è¯·å¹¶åˆå§‹åŒ–æ¯cpué¡µset numa_policy_init();numaç›¸å…³ if (late_time_init) late_time_init(); åˆå§‹åŒ–æ¯cpusched_clock_dataktime_now sched_clock_init(); calibrate_delay();è®¡ç®—cpuMIPSç™¾ä¸‡æ¡æŒ‡ä»¤s pidmap_init();pidè¿›ç¨‹idè¡¨åˆå§‹åŒ– anon_vma_init();è™šæ‹Ÿåœ°å€#ifdef CONFIG_X86 if (efi_enabled)efi bois efi_enter_virtual_mode();#endif thread_info_cache_init();ç”³è¯·thread_infoçš„å†…å­˜ cred_init();credentialå¥åœ¨åˆ†é… æ ¹æ®ç‰©ç†å†…å­˜å¤§å°ï¼Œè®¡ç®—å¯åˆ›å»ºè¿›çº¿ç¨‹æ•°é‡ fork_init(totalram_pages); proc_caches_init();è¿›ç¨‹å†…å­˜åˆå§‹åŒ– buffer_init();é¡µé«˜é€Ÿç¼“å­˜ key_init();çº¢é»‘æ ‘å†…å­˜ï¼Œå­˜keys security_init();å®‰å…¨ç›¸å…³ dbg_late_init();è°ƒè¯•ç›¸å…³ vfs_caches_init(totalram_pages);è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿåˆå§‹åŒ– signals_init();sigqueueç”³è¯·å†…å­˜ï¼Œä¿¡å·ç³»ç»Ÿ rootfs populating might need page-writeback page_writeback_init();é¡µå›å†™#ifdef CONFIG_PROC_FS proc_root_init();procæ–‡ä»¶ç³»ç»Ÿåˆå§‹åŒ–#endif cgroup_init();cgroupç›¸å…³ cpuset_init();cpusetç›¸å…³ taskstats_init_early();è¿›ç¨‹è®¡æ•°å™¨ delayacct_init();è¿›ç¨‹å»¶æ—¶å®¡è®¡ check_bugs();ç³»ç»Ÿbugç›¸å…³æµ‹è¯• acpiæ€»çº¿ acpi_early_init(); before LAPIC and SMP init sfi_init_late();Simple Firmware Interface åŠŸèƒ½è¿½è¸ªåˆå§‹åŒ–,ä¸€ç§è°ƒè¯•å·¥å…· ftrace_init(); Do the rest non-__initâ€™ed, weâ€™re now alive rest_init();} Call all constructor functions linked into the kernel. *static void __init do_ctors(void){#ifdef CONFIG_CONSTRUCTORS ctor_fn_t *fn (ctor_fn_t *) __ctors_start; for (; fn (ctor_fn_t *) __ctors_end; fn++) (*fn)();#endif}bool initcall_debug;core_param(initcall_debug, initcall_debug, bool, 0644);static char msgbuf[64];static int __init_or_module do_one_initcall_debug(initcall_t fn){ ktime_t calltime, delta, rettime; unsigned long long duration; int ret; printk(KERN_DEBUG â€œcalling %pF @ %i â€, fn, task_pid_nr(current)); calltime ktime_get(); ret fn(); rettime ktime_get(); delta ktime_sub(rettime, calltime); duration (unsigned long long) ktime_to_ns(delta) 10; printk(KERN_DEBUG â€œinitcall %pF returned %d after %lld usecs â€, fn, ret, duration); return ret;}int __init_or_module do_one_initcall(initcall_t fn){ int count preempt_count(); int ret; if (initcall_debug) ret do_one_initcall_debug(fn); else ret fn(); msgbuf[0] 0; if (ret ret ! -ENODEV initcall_debug) sprintf(msgbuf, â€œerror code %d â€œ, ret); if (preempt_count() ! count) { strlcat(msgbuf, â€œpreemption imbalance â€œ, sizeof(msgbuf)); preempt_count() count; } if (irqs_disabled()) { strlcat(msgbuf, â€œdisabled interrupts â€œ, sizeof(msgbuf)); local_irq_enable(); } if (msgbuf[0]) { printk(â€œinitcall %pF returned with %s â€, fn, msgbuf); } return ret;}extern initcall_t __initcall_start[];extern initcall_t __initcall0_start[];extern initcall_t __initcall1_start[];extern initcall_t __initcall2_start[];extern initcall_t __initcall3_start[];extern initcall_t __initcall4_start[];extern initcall_t __initcall5_start[];extern initcall_t __initcall6_start[];extern initcall_t __initcall7_start[];extern initcall_t __initcall_end[];static initcall_t *initcall_levels[] __initdata { __initcall0_start, __initcall1_start, __initcall2_start, __initcall3_start, __initcall4_start, __initcall5_start, __initcall6_start, __initcall7_start, __initcall_end,};static char *initcall_level_names[] __initdata { â€œearly parametersâ€, â€œcore parametersâ€, â€œpostcore parametersâ€, â€œarch parametersâ€, â€œsubsys parametersâ€, â€œfs parametersâ€, â€œdevice parametersâ€, â€œlate parametersâ€,};static void __init do_initcall_level(int level){ extern const struct kernel_param __start___param[], __stop___param[]; initcall_t *fn; strcpy(static_command_line, saved_command_line); parse_args(initcall_level_names[level], static_command_line, __start___param, __stop___param - __start___param, level, level, repair_env_string); for (fn initcall_levels[level]; fn initcall_levels[level+1]; fn++) do_one_initcall(fn);}static void __init do_initcalls(void){ int level; for (level 0; level ARRAY_SIZE(initcall_levels) - 1; level++) do_initcall_level(level);} Ok, the machine is now initialized. None of the devices have been touched yet, but the CPU subsystem is up and running, and memory and process management works. Now we can finally start doing some real work.. *static void __init do_basic_setup(void){ cpuset_init_smp();smp cpusetç›¸å…³ usermodehelper_init();khelperå•çº¿ç¨‹å·¥ä½œé˜Ÿåˆ— shmem_init();shemeæœºåˆ¶ driver_init();é©±åŠ¨å„å­ç³»ç»Ÿ init_irq_proc();procä¸­åˆ›å»ºirqç›®å½• do_ctors();å†…æ ¸ä¸­æ‰€æœ‰æ„é€ å‡½æ•°,ä»‹äº.ctorsæ®µä¸­çš„å‡½æ•° usermodehelper_enable(); æ‰€æœ‰ç¼–è¯‘è¿›å†…æ ¸çš„é©±åŠ¨æ¨¡å—åˆå§‹åŒ–å‡½æ•° do_initcalls();}static void __init do_pre_smp_initcalls(void){ initcall_t *fn; for (fn __initcall_start; fn __initcall0_start; fn++) do_one_initcall(*fn); }static void run_init_process(const char init_filename){ argv_init[0] init_filename; kernel_execve(init_filename, argv_init, envp_init);} This is a non __init function. Force it to be noinline otherwise gcc makes it inline to init() and it becomes part of init.text section è¿™æ˜¯ä¸ªéInitå‡½æ•°ï¼Œé˜²æ­¢gccè®©å®ƒå†…è”åˆ°init()ï¼Œå¹¶æˆä¸ºInit.textæ®µçš„ä¸€éƒ¨åˆ† static noinline int init_post(void){ need to finish all async __init code before freeing the memory åœ¨é‡Šæ”¾initå†…å­˜å‰ï¼Œå¿…é¡»å®Œæˆæ‰€æœ‰__initä»£ç æ‰§è¡Œ * async_synchronize_full(); free_initmem();é‡Šæ”¾init.*æ®µä¸­çš„å†…å­˜ ä¿®æ”¹é¡µè¡¨ï¼Œä¿è¯åªè¯»æ•°æ®æ®µä¸ºåªè¯»å±æ€§read only mark_rodata_ro(); ç³»ç»Ÿè¿è¡ŒçŠ¶æ€æ ‡å¿— system_state SYSTEM_RUNNING; numaé»˜è®¤ç­–ç•¥ numa_default_policy(); å½“å‰è¿›ç¨‹ä¸èƒ½è¢«æ€æ‰ï¼Œåªä¸ºå®ƒæ˜¯init current-signal-flags | SIGNAL_UNKILLABLE; å¦‚æœramdisk_execute_commandå˜é‡æŒ‡å®šäº†initç¨‹åºï¼Œæ‰§è¡Œå®ƒ if (ramdisk_execute_command) { run_init_process(ramdisk_execute_command); printk(KERN_WARNING â€œFailed to execute %s â€, ramdisk_execute_command); } * We try each of these until one succeeds. The Bourne shell can be used instead of init if we are trying to recover a really broken machine. åˆä¸€ä¸ªç¨‹åºï¼Œçœ‹èƒ½ä¸èƒ½æ‰§è¡Œï¼Œå¦‚æœä¸èƒ½ï¼Œåˆ™æ‰§è¡Œä¸‹é¢4ä¸ªä¹‹ä¸€ * if (execute_command) { run_init_process(execute_command); printk(KERN_WARNING â€œFailed to execute %s. Attempting â€œ â€œdefaultsâ€¦ â€, execute_command); } run_init_process(â€œsbininitâ€); run_init_process(â€œetcinitâ€); run_init_process(â€œbininitâ€); run_init_process(â€œbinshâ€); ä¸¤ä¸ªå˜é‡å’Œ4ä¸ªinitéƒ½ä¸èƒ½æˆåŠŸæ‰§è¡Œï¼ŒæŠ¥é”™ panic(â€œNo init found. Try passing init option to kernel. â€œ â€œSee Linux Documentationinit.txt for guidance.â€); }static int __init kernel_init(void * unused){ * * Wait until kthreadd is all set-up.ç­‰å¾…kthreaddçš„å¯åŠ¨å®Œæˆ wait_for_completion(kthreadd_done); Now the scheduler is fully set up and can do blocking allocations * gfp_allowed_mask __GFP_BITS_MASK; * init can allocate pages on any node set_mems_allowed(node_states[N_HIGH_MEMORY]); * init can run on any cpu. set_cpus_allowed_ptr(current, cpu_all_mask); cad_pidä¸ºæ¥æ”¶Ctrl-alt-delæ“ä½œçš„INTä¿¡å·çš„è¿›ç¨‹ID,è®¾ç½®æˆäº†initçš„pid è¯´æ˜initå¯æ¥å—è¿™3ä¸ªé”® cad_pid task_pid(current); smpç³»ç»Ÿå‡†å¤‡ã€æ¿€æ´»æ‰€æœ‰cpu smp_prepare_cpus(setup_max_cpus); do_pre_smp_initcalls(); lockup_detector_init(); smp_init(); sched_init_smp(); åˆå§‹åŒ–è®¾å¤‡é©±åŠ¨ã€å†…æ ¸æ¨¡å— do_basic_setup(); Open the devconsole on the rootfs, this should never fail * æ‰“å¼€devconsoleè®¾å¤‡ * if (sys_open((const char __user ) â€œdevconsoleâ€, O_RDWR, 0) 0) printk(KERN_WARNING â€œWarning: unable to open an initial console. â€); * å¤åˆ¶ä¸¤æ¬¡æ ‡å‡†è¾“å…¥0ï¼Œä¸€ä¸ªæ˜¯æ ‡å‡†è¾“å…¥1ï¼Œä¸€ä¸ªæ˜¯æ ‡å‡†é”™è¯¯2 (void) sys_dup(0); (void) sys_dup(0); * check if there is an early userspace init. If yes, let it do all * the work * æ˜¯å¦æœ‰æ—©æœŸç”¨æˆ·ç©ºé—´initè¿›ç¨‹ï¼Œæœ‰çš„è¯ï¼Œè®©å…¶æ‰§è¡Œ * if (!ramdisk_execute_command) ramdisk_execute_command â€œinitâ€; if (sys_access((const char __user ) ramdisk_execute_command, 0) ! 0) { ramdisk_execute_command NULL; prepare_namespace(); } * Ok, we have completed the initial bootup, and * weâ€™re essentially up and running. Get rid of the * initmem segments and start the user-mode stuff.. * å¯åŠ¨ç”¨æˆ·ç©ºé—´çš„initè¿›ç¨‹ init_post(); return 0;}","tags":["linux","å¯åŠ¨"],"categories":["LINUX"]},{"title":"platformbusåŠå…¶åˆå§‹åŒ–è¿‡ç¨‹åˆ†æ","path":"/2025/08/18/platformbusåŠå…¶åˆå§‹åŒ–è¿‡ç¨‹åˆ†æ/","content":"platformbusåŠå…¶åˆå§‹åŒ–è¿‡ç¨‹åˆ†æ platformåŸºæœ¬æ¦‚å¿µå¯¹äºusbè®¾å¤‡ã€i2cè®¾å¤‡ã€pciè®¾å¤‡ã€spiè®¾å¤‡ç­‰ç­‰ï¼Œä»–ä»¬ä¸cpuçš„é€šä¿¡éƒ½æ˜¯ç›´æ¥æŒ‚åœ¨ç›¸åº”çš„æ€»çº¿ä¸‹é¢ä¸cpuè¿›è¡Œæ•°æ®äº¤äº’çš„ï¼Œä½†æ˜¯åœ¨åµŒå…¥å¼ç³»ç»Ÿä¸­ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„è®¾å¤‡éƒ½å¯ä»¥å½’å±åˆ°è¿™äº›å¸¸è§çš„æ€»çº¿ä¸­ã€‚æ‰€æœ‰linuxé©±åŠ¨æ¨¡å‹ä¸ºäº†ä¿æŒå®Œæ•´æ€§ï¼Œå°†è¿™äº›è®¾å¤‡æŒ‚è½½åœ¨ä¸€æ¡è™šæ‹Ÿçš„æ€»çº¿ä¸Šï¼Œå³platformæ€»çº¿ï¼Œä»è€Œé¿å…äº†æœ‰äº›è®¾å¤‡æŒ‚è½½åœ¨æ€»çº¿ä¸Šï¼Œè€Œæœ‰äº›è®¾å¤‡æ²¡æœ‰æŒ‚è½½åœ¨æ€»çº¿ä¸Šã€‚ linux_platform_driver æœºåˆ¶å’Œä¼ ç»Ÿçš„device_driveræœºåˆ¶ï¼ˆå³ï¼šé€šè¿‡ driver_register å‡½æ•°è¿›è¡Œæ³¨å†Œï¼‰ç›¸æ¯”ï¼Œä¸€ä¸ªååˆ†æ˜æ˜¾çš„ä¼˜åŠ¿åœ¨äºplatformæœºåˆ¶å°†è®¾å¤‡æœ¬èº«çš„èµ„æºæ³¨å†Œè¿›å†…æ ¸ï¼Œç”±å†…æ ¸ç»Ÿä¸€ç®¡ç†ï¼Œåœ¨é©±åŠ¨ç¨‹åºä¸­ä½¿ç”¨è¿™äº›èµ„æºæ—¶ï¼Œé€šè¿‡ platform deviceæä¾›çš„æ ‡å‡†æ¥å£è¿›è¡Œç”³è¯·å¹¶ä½¿ç”¨ã€‚ 1.1paltformé©±åŠ¨ç®¡ç†å’Œæ³¨å†Œæœºåˆ¶è®¾å¤‡ç”¨struct platform_deviceè¡¨ç¤ºï¼Œé©±åŠ¨ç”¨struct platform_driverè¡¨ç¤º platform æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„åœ°å€æ€»çº¿ï¼Œç›¸æ¯” PCIã€USBï¼Œå®ƒä¸»è¦ç”¨äºæè¿°SOCä¸Šçš„ç‰‡ä¸Šèµ„æºã€‚platform æ‰€æè¿°çš„èµ„æºæœ‰ä¸€ä¸ªå…±åŒç‚¹ï¼šåœ¨CPU çš„æ€»çº¿ä¸Šç›´æ¥å–å€ã€‚å¹³å°è®¾å¤‡ä¼šåˆ†åˆ°ä¸€ä¸ªåç§°ï¼ˆç”¨åœ¨é©±åŠ¨ç»‘å®šä¸­ï¼‰ä»¥åŠä¸€ç³»åˆ—è¯¸å¦‚åœ°å€å’Œä¸­æ–­è¯·æ±‚å·ï¼ˆIRQï¼‰ä¹‹ç±»çš„èµ„æºã€‚ Linux platformæ€»çº¿ã€platformè®¾å¤‡ã€platformé©±åŠ¨ä¹‹é—´çš„å…³ç³»åŠæ¡†æ¶ï¼ˆ1ï¼‰ å½“ç³»ç»Ÿå‘å†…æ ¸æ³¨å†Œæ¯ä¸€ä¸ªé©±åŠ¨ç¨‹åºæ—¶ï¼Œéƒ½è¦é€šè¿‡è°ƒç”¨platform_driver_registerå‡½æ•°å°†é©±åŠ¨ç¨‹åºæ³¨å†Œåˆ°æ€»çº¿ï¼ˆbusï¼‰ï¼Œå¹¶å°†å…¶æ”¾å…¥æ‰€å±æ€»çº¿çš„drvé“¾è¡¨ä¸­ï¼Œæ³¨å†Œé©±åŠ¨çš„æ—¶å€™ä¼šè°ƒç”¨æ‰€å±æ€»çº¿çš„matchå‡½æ•°å¯»æ‰¾è¯¥æ€»çº¿ä¸Šä¸ä¹‹åŒ¹é…çš„æ¯ä¸€ä¸ªè®¾å¤‡ï¼Œå¦‚æœæ‰¾åˆ°ä¸ä¹‹åŒ¹é…çš„è®¾å¤‡åˆ™ä¼šè°ƒç”¨ç›¸åº”çš„probeå‡½æ•°å°†ç›¸åº”çš„è®¾å¤‡å’Œé©±åŠ¨è¿›è¡Œç»‘å®šï¼› ï¼ˆ2ï¼‰ å½“ç³»ç»Ÿå‘å†…æ ¸æ³¨å†Œæ¯ä¸€ä¸ªè®¾å¤‡æ—¶ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨platform_device_registerå‡½æ•°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è§£æDTBç”±å†…æ ¸å®Œæˆplatform deviceçš„åˆ›å»ºï¼Œå¹¶å°†è®¾å¤‡platform deviceæ³¨å†Œåˆ°æ€»çº¿platform busï¼Œå¹¶å°†å…¶æ”¾å…¥æ‰€å±æ€»çº¿çš„devé“¾è¡¨ä¸­ï¼Œæ³¨å†Œè®¾å¤‡çš„æ—¶å€™åŒæ ·ä¹Ÿä¼šè°ƒç”¨æ‰€å±æ€»çº¿çš„matchå‡½æ•°å¯»æ‰¾è¯¥æ€»çº¿ä¸Šä¸ä¹‹åŒ¹é…çš„æ¯ä¸€ä¸ªé©±åŠ¨ç¨‹åºï¼Œå¦‚æœæ‰¾åˆ°ä¸ä¹‹åŒ¹é…çš„é©±åŠ¨ç¨‹åºæ—¶ä¼šè°ƒç”¨ç›¸åº”çš„probeå‡½æ•°å°†ç›¸åº”çš„è®¾å¤‡å’Œé©±åŠ¨è¿›è¡Œç»‘å®šï¼›è€Œè¿™ä¸€åŒ¹é…çš„è¿‡ç¨‹æ˜¯ç”±æ€»çº¿è‡ªåŠ¨å®Œæˆçš„ã€‚ platform buså…³é”®ç»“æ„ä½“ struct bus_type const char *name; // æ€»çº¿åå­— struct bus_attribute *bus_attrs; // è¯¥æ€»çº¿çš„å±æ€§ struct device_attribute *dev_attrs; // è¯¥æ€»çº¿ä¸‹è®¾å¤‡çš„å±æ€§ struct driver_attribute *drv_attrs; // è¯¥æ€»çº¿ä¸‹è®¾å¤‡é©±åŠ¨çš„å±æ€§ int (*match)(struct device *dev, struct device_driver *drv); // è¯¥æ€»çº¿ä¸‹è®¾å¤‡ä¸è®¾å¤‡é©±åŠ¨çš„åŒ¹é…å‡½æ•° int (*uevent)(struct device *dev, struct kobj_uevent_env *env); // äº‹ä»¶å‡½æ•° çƒ­æ‹¨æ’ int (*probe)(struct device *dev); // æ€»çº¿ä¸‹çš„ æ¢é’ˆå‡½æ•° int (*remove)(struct device *dev); // æ€»çº¿ä¸‹çš„ å¸è½½å‡½æ•° void (*shutdown)(struct device *dev); int (*suspend)(struct device *dev, pm_message_t state); int (*resume)(struct device *dev); const struct dev_pm_ops *pm; // ç”µæºç®¡ç†ç›¸å…³çš„ struct bus_type_private *p; // æ€»çº¿çš„ç§æœ‰æ•°æ® p-subsys.kobj è¡¨ç¤ºè¯¥æ€»çº¿åœ¨é©±åŠ¨æ¨¡å‹ä¸­å¯¹åº”çš„å¯¹è±¡;struct bus_type_private struct kset subsys; // è¿™ä¸ªæ˜¯busä¸»è¦çš„kset struct kset *drivers_kset; // è¿™ä¸ªksetæŒ‡é’ˆç”¨æ¥æŒ‡å‘è¯¥æ€»çº¿çš„ driversç›®å½•çš„ struct kset *devices_kset; // è¿™ä¸ªkseæŒ‡é’ˆç”¨æ¥æŒ‡å‘è¯¥æ€»çº¿çš„devicesç›®å½•çš„ struct klist klist_devices; // ç”¨æ¥æŒ‚æ¥è¯¥æ€»çº¿ä¸‹çš„è®¾å¤‡çš„ä¸€ä¸ªé“¾è¡¨å¤´ struct klist klist_drivers; // ç”¨æ¥æŒ‚æ¥è¯¥æ€»çº¿ä¸‹çš„è®¾å¤‡é©±åŠ¨çš„ä¸€ä¸ªé“¾è¡¨å¤´ struct blocking_notifier_head bus_notifier; unsigned int drivers_autoprobe:1; // æ˜¯å¦éœ€è¦åœ¨è®¾å¤‡é©±åŠ¨æ³¨å†Œæ—¶å€™å­è‡ªåŠ¨åŒ¹é…è®¾å¤‡ struct bus_type *bus; // æŒ‡å‘æœ¬busç»“æ„ä½“; platform busåˆå§‹åŒ–æµç¨‹platform busçš„åˆå§‹åŒ–ç”±å‡½æ•°platfrom_bus_init()å‡½æ•°æ¥å®Œæˆã€‚ç”±äºplatform busæœ¬èº«ä¹Ÿæ˜¯ä¸€ç§è®¾å¤‡ï¼Œå› æ­¤è°ƒç”¨äº†åŸå§‹çš„ç³»ç»Ÿæ¥å£device_register()å’Œbus_register()åˆ†åˆ«å®Œæˆplatform_busè®¾å¤‡å’Œplatform_bus_typeæœ¬èº«çš„åˆå§‹åŒ–ï¼› start_kernel() // init/main.c rest_init(); pid = kernel_thread(kernel_init, NULL, CLONE_FS); kernel_init(void *unused) kernel_init_freeable(); do_basic_setup(); driver_init(); // kernel/drivers/base/init.c devices_init(); #deviceåˆå§‹åŒ– buses_init(); #busåˆå§‹åŒ– classes_init(); #classåˆå§‹åŒ– platform_bus_init(); #platform busåˆå§‹åŒ– kernel/drivers/base/platform.c early_platform_cleanup();// è¿›è¡Œä¸€äº›æ—©æœŸçš„å¹³å°æ¸…ç† error = device_register(platform_bus);//æ³¨å†Œè®¾å¤‡ (åœ¨/sys/devices/ç›®å½•ä¸‹å»ºç«‹ platformç›®å½•å¯¹åº”çš„è®¾å¤‡å¯¹è±¡ /sys/devices/platform/) error = bus_register(platform_bus_type); // å°†Platform busæ€»çº¿æ³¨å†Œè¿›ç³»ç»Ÿ of_platform_register_reconfig_notifier(); do_initcalls();// init/main.c for (level = 0; level ARRAY_SIZE(initcall_levels) - 1; level++) do_initcall_level(level); for (fn = initcall_levels[level]; fn initcall_levels[level+1]; fn++) do_one_initcall(*fn);//æ­¤å¤„è°ƒç”¨ç›¸å…³æ¨¡å—çš„åˆå§‹åŒ–å…¶ä¸­ï¼Œstruct device platform_bus = .init_name = platform,; static const struct dev_pm_ops platform_dev_pm_ops = .runtime_suspend = pm_generic_runtime_suspend, .runtime_resume = pm_generic_runtime_resume, USE_PLATFORM_PM_SLEEP_OPS; struct bus_type platform_bus_type = .name = platform, .dev_groups = platform_dev_groups, .match = platform_match, .uevent = platform_uevent, .pm = platform_dev_pm_ops,;c //å‘ç³»ç»Ÿæ³¨å†Œä¸€ä¸ªè®¾å¤‡int device_register(struct device *dev) device_initialize(dev)//åˆå§‹åŒ–è®¾å¤‡ç»“æ„ä½“æˆå‘˜ device_add(dev);//é€šè¿‡è°ƒç”¨kobject_add()å°†è®¾å¤‡å¯¹è±¡æ·»åŠ åˆ°ç³»ç»Ÿä¸­ï¼ŒåŠ å…¥åˆ°è®¾å¤‡é“¾è¡¨//åˆå§‹åŒ–è®¾å¤‡ç»“æ„ä½“æˆå‘˜void device_initialize(struct device *dev) dev-kobj.kset = devices_kset; kobject_init(dev-kobj, device_ktype); INIT_LIST_HEAD(dev-dma_pools); mutex_init(dev-mutex); lockdep_set_novalidate_class(dev-mutex); spin_lock_init(dev-devres_lock); INIT_LIST_HEAD(dev-devres_head); device_pm_init(dev); set_dev_node(dev, -1);#ifdef CONFIG_GENERIC_MSI_IRQ INIT_LIST_HEAD(dev-msi_list);#endif INIT_LIST_HEAD(dev-links.consumers); INIT_LIST_HEAD(dev-links.suppliers); dev-links.status = DL_DEV_NO_DRIVER;int device_add(struct device *dev) dev = get_device(dev); error = device_private_init(dev); dev_set_name(dev, %s, dev-init_name); parent = get_device(dev-parent); kobj = get_device_parent(dev, parent); set_dev_node(dev, dev_to_node(parent)); error = kobject_add(dev-kobj, dev-kobj.parent, NULL); ..... int bus_register(struct bus_type *bus) int retval; struct bus_type_private *priv; // å®šä¹‰ä¸€ä¸ªbus_type_private ç»“æ„ä½“æŒ‡é’ˆ priv = kzalloc(sizeof(struct bus_type_private), GFP_KERNEL); // ç”³è¯·åˆ†é…å†…å­˜ if (!priv) return -ENOMEM; priv-bus = bus; // ä½¿ç”¨ priv-bus æŒ‡å‘æˆ‘ä»¬ä¼ è¿›æ¥çš„bus bus-p = priv; // é€šè¿‡ bus-p æŒ‡å‘priv è¿™é‡Œå…¶å®å°±æ˜¯å°†busä¸privå»ºç«‹å…³ç³»ï¼Œè¿™ä¸ªè·Ÿä¹‹å‰çš„eviceã€classçš„è®¾è®¡æ˜¯ä¸€æ ·çš„ BLOCKING_INIT_NOTIFIER_HEAD(priv-bus_notifier); retval = kobject_set_name(priv-subsys.kobj, %s, bus-name); // ç»™æˆ‘ä»¬çš„busåœ¨è®¾å¤‡é©±æ¨¡å‹ä¸­çš„å¯¹è±¡è®¾ç½®åå­— bus-p-subsys.kobj if (retval) goto out; // è¿™é‡Œå°±æ˜¯å¯¹busçš„ç§æœ‰æ•°æ®è¿›è¡Œä¸€äº›å¡«å…… priv-subsys.kobj.kset = bus_kset; // è®¾ç½®buså¯¹è±¡çš„çˆ¶å¯¹è±¡ ä¹Ÿå°±æ˜¯ /sys/bus è¿™ç›®å½• ä½œä¸ºä»–çš„ä¸Šå±‚ç›®å½• æ‰€æœ‰çš„å…·ä½“çš„æ€»çº¿ç±»å‹å¯¹è±¡éƒ½æ˜¯åœ¨è¿™ä¸ªç›®å½•ä¸‹ priv-subsys.kobj.ktype = bus_ktype; // è®¾ç½®buså¯¹è±¡çš„ å¯¹è±¡ç±»å‹ä¸º bus_ktype priv-drivers_autoprobe = 1; // é…ç½®ä¸ºåœ¨æ³¨å†Œè®¾å¤‡æˆ–è€…æ˜¯æ³¨å†Œè®¾å¤‡é©±åŠ¨æ—¶è‡ªåŠ¨è¿›è¡Œé…ç½® è¿™ä¸ªå°±å†³å®šä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨æ³¨å†Œè®¾å¤‡æˆ–è€…æ˜¯è®¾å¤‡é©±åŠ¨èƒ½å¤Ÿè¿›è¡Œè‡ªåŠ¨åŒ¹é… retval = kset_register(priv-subsys); // æ³¨å†Œksetç»“æ„ä½“(å†…éƒ¨ä¼šè°ƒç”¨kobject_add_internalå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å°†buså¯¹è±¡æ·»åŠ åˆ° /sys/bus/ç›®å½•ä¸‹ï¼Œ /sys/bus/xxx_busType å¯¹åº”å…·ä½“çš„æ€»çº¿) if (retval) goto out; retval = bus_create_file(bus, bus_attr_uevent); // åœ¨è¯¥busä¸‹å»ºç«‹å±æ€§æ–‡ä»¶ (å¯¹åº”çš„å°±æ˜¯ busä¸‹çš„ ueventå±æ€§) if (retval) goto bus_uevent_fail; priv-devices_kset = kset_create_and_add(devices, NULL, // åœ¨å…·ä½“æ€»çº¿çš„ç›®å½•ä¸‹åˆ›å»º kset å®¹å™¨å¯¹è±¡ /sys/bus/xxx_busType/devices priv-subsys.kobj); // é€šè¿‡priv-devices_ksetæŒ‡é’ˆå»æŒ‡å‘ è¿™ä¸ªç›®å½•å¯¹åº”çš„å¯¹è±¡ if (!priv-devices_kset) retval = -ENOMEM; goto bus_devices_fail; priv-drivers_kset = kset_create_and_add(drivers, NULL, // /sys/bus/xxx_busType /drivers priv-subsys.kobj); // é€šè¿‡ priv-drivers_kset æŒ‡é’ˆå»æŒ‡å‘ è¿™ä¸ªç›®å½•å¯¹åº”çš„å¯¹è±¡ if (!priv-drivers_kset) retval = -ENOMEM; goto bus_drivers_fail; klist_init(priv-klist_devices, klist_devices_get, klist_devices_put); // åˆå§‹åŒ–é“¾è¡¨ klist klist_init(priv-klist_drivers, NULL, NULL); // åˆå§‹åŒ–é“¾è¡¨ klist retval = add_probe_files(bus); // æ·»åŠ æ¢é’ˆæ–‡ä»¶ å…¶å®å†…éƒ¨åšçš„è¿˜æ˜¯æ·»åŠ å±æ€§æ–‡ä»¶ /sys/bus/xxx_busType/drivers_probe /sys/bus/xxx_busType/drivers_autoprobe if (retval) goto bus_probe_files_fail; retval = bus_add_attrs(bus); // æ ¹æ® bus-bus_attrs ä¸­çš„å±æ€§è®¾ç½®æ¥æ·»åŠ å±æ€§æ–‡ä»¶ if (retval) goto bus_attrs_fail; pr_debug(bus: %s: registered , bus-name); return 0; bus_attrs_fail: remove_probe_files(bus); bus_probe_files_fail: kset_unregister(bus-p-drivers_kset); bus_drivers_fail: kset_unregister(bus-p-devices_kset); bus_devices_fail: bus_remove_file(bus, bus_attr_uevent); bus_uevent_fail: kset_unregister(bus-p-subsys); kfree(bus-p); out: bus-p = NULL; return retval; å‚è€ƒï¼šâ€‹ è®¾å¤‡æ ‘å’ŒPlatformæ¶æ„â€“4â€“platform busæ¦‚è¿°åŠå…¶åˆå§‹åŒ–-CSDNåšå®¢","tags":["linux","platform"],"categories":["é©±åŠ¨"]},{"title":"platform_deviceçš„ä¸€ç¯‡çŸ¥ä¹è§£æ","path":"/2025/08/18/platform_deviceçš„ä¸€ç¯‡çŸ¥ä¹è§£æ/","content":"platform_deviceçš„ä¸€ç¯‡çŸ¥ä¹è§£æ (4 å°ç§ä¿¡ 21 æ¡æ¶ˆæ¯) é©±åŠ¨å…¥å£ç‚¹â€”â€”platform_deviceè§£æ - çŸ¥ä¹","tags":["linux","platform"],"categories":["é©±åŠ¨"]},{"title":"platformæ€»çº¿åŒ¹é…æ–¹å¼","path":"/2025/08/18/platformæ€»çº¿åŒ¹é…æ–¹å¼/","content":"platformæ€»çº¿åŒ¹é…æ–¹å¼é‡è¦ç»“æ„ä½“struct platform_devicestruct platform_device const char\t*name;\tint id;\tbool id_auto;\tstruct device\tdev;\tu32 num_resources;\tstruct resource\t*resource;\tconst struct platform_device_id\t*id_entry;\tchar *driver_override; /* Driver name to force a match ç¬¬ä¸€ç§åŒ¹é…æ–¹å¼ï¼šåŒ¹é…ä¼˜å…ˆçº§æœ€é«˜*/\t/* MFD cell pointer */\tstruct mfd_cell *mfd_cell;\t/* arch specific additions */\tstruct pdev_archdata\tarchdata;; struct platform_driverstruct platform_driver int (*probe)(struct platform_device *);\tint (*remove)(struct platform_device *);\tvoid (*shutdown)(struct platform_device *);\tint (*suspend)(struct platform_device *, pm_message_t state);\tint (*resume)(struct platform_device *);\tstruct device_driver driver;//ç¬¬äºŒç§åŒ¹é…æ–¹å¼ï¼š.of_match_tableæˆå‘˜ç”¨äºcompatibleå±æ€§åŒ¹é…,ç±»å‹ä¸ºconst struct of_device_id *of_match_table;æ¨èæ–¹å¼ //ç¬¬ä¸‰ç§åŒ¹é…æ–¹å¼.acpi_match_tableæˆå‘˜ç”¨äºacpiæ–¹å¼åŒ¹é…\tconst struct platform_device_id *id_table;//ç¬¬å››ç§åŒ¹é…æ–¹å¼ï¼šç”¨äºIDè¡¨åŒ¹é…ï¼Œä¼ ç»Ÿæ–¹å¼\tbool prevent_deferred_probe;; å…ˆè®¨è®ºplatform_matchè¿™ä¸ªå‡½æ•° /** * platform_match - bind platform device to platform driver. * @dev: device. * @drv: driver. * * Platform device IDs are assumed to be encoded like this: * nameinstance, where name is a short description of the type of * device, like pci or floppy, and instance is the enumerated * instance of the device, like 0 or 42. Driver IDs are simply * name. So, extract the name from the platform_device structure, * and compare it against the name of the driver. Return whether they match * or not. */static int platform_match(struct device *dev, struct device_driver *drv)\tstruct platform_device *pdev = to_platform_device(dev);\tstruct platform_driver *pdrv = to_platform_driver(drv);\t/* When driver_override is set, only bind to the matching driver */\tif (pdev-driver_override) return !strcmp(pdev-driver_override, drv-name);\t/* Attempt an OF style match first */\tif (of_driver_match_device(dev, drv)) return 1;\t/* Then try ACPI style match */\tif (acpi_driver_match_device(dev, drv)) return 1;\t/* Then try to match against the id table */\tif (pdrv-id_table) return platform_match_id(pdrv-id_table, pdev) != NULL;\t/* fall-back to driver name match */\treturn (strcmp(pdev-name, drv-name) == 0); å‡½æ•°æŒ‰ç…§ä»¥ä¸‹é¡ºåºè¿›è¡ŒåŒ¹é…ï¼Œä¸€æ—¦æŸä¸ªåŒ¹é…æˆåŠŸå°±è¿”å›ï¼š driver_overrideï¼ˆå¼ºåˆ¶ç»‘å®šï¼‰ è®¾å¤‡æ ‘åŒ¹é… ACPIåŒ¹é… IDè¡¨åŒ¹é… åç§°åŒ¹é…ï¼ˆå…œåº•æ–¹æ¡ˆ) è¯¦ç»†åˆ†ææ•°æ®ç±»å‹è½¬åŒ–ï¼šstruct platform_device *pdev = to_platform_device(dev);struct platform_driver *pdrv = to_platform_driver(drv); å°†é€šç”¨çš„deviceå’Œdevice_driverç»“æ„è½¬æ¢ä¸ºplatformç‰¹å®šçš„ç»“æ„ä½“ï¼Œæ–¹ä¾¿è®¿é—®platformç‰¹æœ‰çš„å­—æ®µã€‚ to_platform_deviceç”¨äºé€šè¿‡struct deviceç±»å‹çš„devæŒ‡é’ˆï¼Œå¾—åˆ°åŒ…å«å®ƒçš„struct platform_deviceç±»å‹çš„æŒ‡é’ˆã€‚ to_platform_driverç”¨äºé€šè¿‡struct device_driverç±»å‹çš„drvæŒ‡é’ˆï¼Œå¾—åˆ°åŒ…å«å®ƒçš„struct platform_driverç±»å‹çš„æŒ‡é’ˆã€‚ è¿™ä¸¤ä¸ªå®å®šä¹‰ç”±contain_ofå®å®šä¹‰å®ç° #define to_platform_device(x) container_of((x), struct platform_device, dev)#define to_platform_driver(drv)\t(container_of((drv), struct platform_driver, driver)) driver_overrideåŒ¹é…if (pdev-driver_override) return !strcmp(pdev-driver_override, drv-name); æ£€æŸ¥è®¾å¤‡æ˜¯å¦æŒ‡å®šäº†å¼ºåˆ¶ç»‘å®šçš„é©±åŠ¨åç§° å¦‚æœæŒ‡å®šï¼Œåˆ™åªä¸è¯¥åç§°å®Œå…¨åŒ¹é…çš„é©±åŠ¨ç»‘å®š è¿™é€šå¸¸ç”¨äºè°ƒè¯•æˆ–å¼ºåˆ¶ç‰¹å®šè®¾å¤‡ä½¿ç”¨ç‰¹å®šé©±åŠ¨ è®¾å¤‡æ ‘åŒ¹é…if (of_driver_match_device(dev,drv))\treturn 1; è°ƒç”¨è®¾å¤‡æ ‘åŒ¹é…å‡½æ•° é€šè¿‡è®¾å¤‡èŠ‚ç‚¹çš„â€compatibleâ€å±æ€§ä¸é©±åŠ¨çš„of_match_tableè¿›è¡ŒåŒ¹é… è¿™æ˜¯ç°ä»£åµŒå…¥å¼ç³»ç»Ÿä¸­æœ€å¸¸ç”¨çš„åŒ¹é…æ–¹å¼ ACPIåŒ¹é…if (acpi_driver_match_device(dev, drv)) return 1; åœ¨ACPIç³»ç»Ÿä¸­ï¼Œé€šè¿‡ACPI_hidå’Œé©±åŠ¨è¿›è¡ŒåŒ¹é… ä¸»è¦ç”¨äºx86ç³»ç»Ÿ IDè¡¨åŒ¹é…if (pdrv-id_table)\treturn platform_match_id(pdrv-id_table,pdev) != NULL; ä½¿ç”¨é©±åŠ¨ä¸­å®šä¹‰çš„id_tableä¸è®¾å¤‡åç§°è¿›è¡ŒåŒ¹é… éå†é©±åŠ¨çš„IDè¡¨ï¼ŒæŸ¥æ‰¾ä¸è®¾å¤‡åç§°åŒ¹é…çš„é¡¹ åç§°åŒ¹é…return (strcmp(pdev-name,drv-name) == 0) ç®€å•åœ°æ¯”è¾ƒè®¾å¤‡åç§°å’Œé©±åŠ¨åç§°æ˜¯å¦ç›¸åŒ è¿™æ˜¯æœ€åŸºæœ¬çš„åŒ¹é…æ–¹å¼ åŒºåˆ†è®¾å¤‡æ ‘åŒ¹é…å’ŒIDè¡¨åŒ¹é…1. of_driver_match_device ç”¨äº**è®¾å¤‡æ ‘(Device Tree)**åŒ¹é…æœºåˆ¶ é€šè¿‡è®¾å¤‡æ ‘ä¸­çš„compatibleå±æ€§è¿›è¡ŒåŒ¹é… å·¥ä½œåŸç†// åœ¨è®¾å¤‡æ ‘ä¸­my_device: my-device@10000000 compatible = vendor,device-name, generic-name; reg = 0x10000000 0x1000;;// åœ¨é©±åŠ¨ä¸­static const struct of_device_id my_of_match[] = .compatible = vendor,device-name, .data = my_data , .compatible = generic-name, .data = generic_data , ;static struct platform_driver my_driver = .driver = .name = my-driver, .of_match_table = my_of_match, , .probe = my_probe,; åŒ¹é…è¿‡ç¨‹ éå†é©±åŠ¨çš„of_match_tableæ•°ç»„ å°†è®¾å¤‡æ ‘èŠ‚ç‚¹çš„compatibleå±æ€§ä¸è¡¨ä¸­æ¡ç›®é€ä¸€æ¯”è¾ƒ æ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹å³æˆåŠŸ 2. platform_match_id ç”¨äºä¼ ç»Ÿplatformè®¾å¤‡IDè¡¨åŒ¹é…æœºåˆ¶ é€šè¿‡è®¾å¤‡å’Œé©±åŠ¨çš„åç§°è¿›è¡ŒåŒ¹é… å·¥ä½œåŸç†c// åœ¨é©±åŠ¨ä¸­å®šä¹‰IDè¡¨static const struct platform_device_id my_id_table[] = my-device-name, .driver_data = MY_DATA_1 , my-old-device, .driver_data = MY_DATA_2 , ;static struct platform_driver my_driver = .driver = .name = my-driver, , .id_table = my_id_table, // ä½¿ç”¨IDè¡¨åŒ¹é… .probe = my_probe,;// åœ¨æ¿çº§æ–‡ä»¶æˆ–è®¾å¤‡æ³¨å†Œæ—¶static struct platform_device my_device = .name = my-device-name, // ä¸IDè¡¨ä¸­çš„åç§°åŒ¹é… .id = -1, // ...; åŒ¹é…è¿‡ç¨‹ éå†é©±åŠ¨çš„id_tableæ•°ç»„ å°†è®¾å¤‡çš„nameå­—æ®µä¸è¡¨ä¸­æ¡ç›®çš„nameå­—æ®µæ¯”è¾ƒ æ‰¾åˆ°åŒ¹é…é¡¹å³æˆåŠŸï¼Œå¹¶å°†åŒ¹é…çš„è¡¨é¡¹ä¿å­˜åˆ°è®¾å¤‡çš„id_entryå­—æ®µ è®¾å¤‡æ ‘åŒ¹é…å’ŒIDè¡¨åŒ¹é…ä¸åŒç‚¹ ç»´åº¦ of_driver_match_deviceï¼ˆè®¾å¤‡æ ‘åŒ¹é…ï¼‰ platform_match_idï¼ˆID è¡¨åŒ¹é…ï¼‰ åŒ¹é…ä¾æ® åŸºäºè®¾å¤‡æ ‘ï¼ˆDevice Treeï¼‰ä¸­çš„ compatible å±æ€§ã€‚ åŸºäºé©±åŠ¨ä¸­å®šä¹‰çš„ id_tableï¼ˆstruct platform_device_id æ•°ç»„ï¼‰ã€‚ é€‚ç”¨åœºæ™¯ ä¸»è¦ç”¨äºä½¿ç”¨è®¾å¤‡æ ‘çš„ç³»ç»Ÿï¼ˆç°ä»£åµŒå…¥å¼ç³»ç»Ÿä¸»æµï¼Œå¦‚ ARMã€RISC-V å¹³å°ï¼‰ã€‚ ä¸»è¦ç”¨äºä¸ä½¿ç”¨è®¾å¤‡æ ‘çš„ç³»ç»Ÿï¼ˆå¦‚éƒ¨åˆ† x86 å¹³å°ã€è€çš„åµŒå…¥å¼ç³»ç»Ÿï¼‰ï¼Œæˆ–ä½œä¸ºè®¾å¤‡æ ‘åŒ¹é…çš„è¡¥å……ã€‚ å®ç°é€»è¾‘ 1. è®¾å¤‡åœ¨è®¾å¤‡æ ‘ä¸­é€šè¿‡ compatible å±æ€§å£°æ˜è‡ªå·±çš„ã€Œå…¼å®¹æ ‡è¯†ã€ï¼ˆå¦‚ vendor,chip-nameï¼‰ï¼› 2. é©±åŠ¨é€šè¿‡ of_match_table æˆå‘˜å£°æ˜è‡ªå·±æ”¯æŒçš„ compatible åˆ—è¡¨ï¼› 3. å‡½æ•°æ¯”è¾ƒè®¾å¤‡çš„ compatible ä¸é©±åŠ¨çš„ of_match_tableï¼Œè‹¥æœ‰ä¸€è‡´åˆ™åŒ¹é…æˆåŠŸã€‚ 1. é©±åŠ¨é€šè¿‡ id_table å®šä¹‰æ”¯æŒçš„è®¾å¤‡åç§°åˆ—è¡¨ï¼ˆname å­—æ®µï¼‰å’Œè®¾å¤‡ IDï¼ˆid å­—æ®µï¼‰ï¼› 2. è®¾å¤‡é€šè¿‡ name å’Œ id æˆå‘˜æ ‡è¯†è‡ªå·±ï¼› 3. å‡½æ•°éå† id_tableï¼Œè‹¥è®¾å¤‡çš„ name å’Œ id ä¸è¡¨ä¸­æŸæ¡ç›®ä¸€è‡´ï¼Œåˆ™åŒ¹é…æˆåŠŸã€‚ çµæ´»æ€§ æ›´é«˜ã€‚compatible å±æ€§å¯åŒ…å«å¤šä¸ªå€¼ï¼ˆå¦‚ vendor,chip-v2ã€vendor,chip-v1ï¼‰ï¼Œæ”¯æŒã€Œå‘ä¸‹å…¼å®¹ã€ï¼ˆé©±åŠ¨å¯åŒ¹é…å¤šä¸ªç‰ˆæœ¬çš„è®¾å¤‡ï¼‰ã€‚ è¾ƒä½ã€‚ä¾èµ–ç²¾ç¡®çš„åç§°å’Œ ID åŒ¹é…ï¼Œé€šå¸¸åªèƒ½åŒ¹é…å›ºå®šåç§°æˆ– ID çš„è®¾å¤‡ã€‚ åœ¨åŒ¹é…é“¾ä¸­çš„ä¼˜å…ˆçº§ è¾ƒé«˜ï¼ˆåœ¨ platform_match ä¸­å…ˆäº platform_match_id æ‰§è¡Œï¼‰ã€‚ è¾ƒä½ï¼ˆåœ¨è®¾å¤‡æ ‘ã€ACPI åŒ¹é…å¤±è´¥åæ‰æ‰§è¡Œï¼‰ã€‚ 3. å®ä¾‹æ–‡ä»¶åœ°å€ï¼šdrivers\\gpio\\gpio-mxc.c static const struct of_device_id mxc_gpio_dt_ids[] = .compatible = fsl,imx1-gpio, .data = mxc_gpio_devtype[IMX1_GPIO], , .compatible = fsl,imx21-gpio, .data = mxc_gpio_devtype[IMX21_GPIO], , .compatible = fsl,imx31-gpio, .data = mxc_gpio_devtype[IMX31_GPIO], , .compatible = fsl,imx35-gpio, .data = mxc_gpio_devtype[IMX35_GPIO], , /* sentinel */ ; static const struct platform_device_id mxc_gpio_devtype[] = .name = imx1-gpio, .driver_data = IMX1_GPIO,\t, .name = imx21-gpio, .driver_data = IMX21_GPIO,\t, .name = imx31-gpio, .driver_data = IMX31_GPIO,\t, .name = imx35-gpio, .driver_data = IMX35_GPIO,\t, /* sentinel */\t; static struct platform_driver mxc_gpio_driver = .driver = .name\t= gpio-mxc, .pm = mxc_gpio_dev_pm_ops, .of_match_table = mxc_gpio_dt_ids,//æ”¯æŒè®¾å¤‡æ ‘åŒ¹é…æ¨¡å¼\t,\t.probe = mxc_gpio_probe,\t.id_table\t= mxc_gpio_devtype,//æ”¯æŒIDè¡¨åŒ¹é…æ¨¡å¼;","tags":["linux","platform"],"categories":["é©±åŠ¨"]},{"title":"é€šè¿‡platformå®ç°LEDè®¾å¤‡é©±åŠ¨ä¸€äº›åŸºç¡€çŸ¥è¯†","path":"/2025/08/18/platformçš„LEDè®¾å¤‡é©±åŠ¨ä¸€äº›åŸºç¡€çŸ¥è¯†(æœªå®Œæˆ)/","content":"é€šè¿‡platformå®ç°LEDè®¾å¤‡é©±åŠ¨ä¸€äº›åŸºç¡€çŸ¥è¯†é¦–å…ˆè¦çŸ¥é“ä¸€ä¸ªå­—ç¬¦è®¾å¤‡é©±åŠ¨çš„æµç¨‹ä¸ºï¼šåˆ†é…file_operationsç»“æ„ä½“ï¼Œè®¾ç½®file_operationsç»“æ„ä½“ï¼Œæ³¨å†Œfile_operationsç»“æ„ä½“ã€‚å…·ä½“æ¥è¯´å°±æ˜¯ï¼š1.ç¡®å®šä¸€ä¸ªä¸»è®¾å¤‡å·ï¼Œ2.å®šä¹‰è‡ªå·±çš„file_operationsç»“æ„ä½“ï¼Œ3.å®ç°file_operationsç»“æ„ä½“ä¸­çš„openwirtereadå‡½æ•°ï¼Œ4.æŠŠfile_operationsç»“æ„ä½“å‘Šè¯‰å†…æ ¸ï¼Œå³æ³¨å†Œfile_operationsç»“æ„ä½“ï¼Œ5.å®ç°å…¥å£å‡½æ•°ï¼Œåœ¨è¿™ä¸ªå…¥å£å‡½æ•°ä¸­æ³¨å†Œfile_operationsç»“æ„ä½“ã€‚ é¦–å…ˆè¦åŒºåˆ†ï¼šè®¾å¤‡å·(devid)ï¼Œä¸»è®¾å¤‡å·(major)ï¼Œæ¬¡è®¾å¤‡å·(minor)ä¸»è®¾å¤‡å·ï¼šç”¨äºæ ‡è¯†ä¸åŒçš„é©±åŠ¨ç¨‹åº æ¬¡è®¾å¤‡å·ï¼šç”¨äºåŒºåˆ†åŒä¸€ä¸»è®¾å¤‡å·ä¸‹çš„ä¸åŒè®¾å¤‡å®ä¾‹ã€‚ è®¾å¤‡å·ï¼šå†…æ ¸è®¾å¤‡çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚æ˜¯ä¸»è®¾å¤‡å·å’Œæ¬¡è®¾å¤‡å·çš„ç»„åˆï¼Œé€šè¿‡MKDEV(major,minor)å®ç”Ÿæˆã€‚ ä¸‰è€…ä¹‹é—´çš„å…³ç³»ï¼š è®¾å¤‡å·devidé€šè¿‡devid=MKDEV(marjor,minor)è·å¾— ä¸»è®¾å¤‡å·majoré€šè¿‡marjor=MAJOR(devid)è·å¾— æ¬¡è®¾å¤‡å·minoré€šè¿‡minor=MINOR(devid)è·å¾— ä¸¾ä¾‹1ï¼šåŠ¨æ€åˆ†é…è®¾å¤‡å· é€šè¿‡alloc_chrdev_regionè·å¾—è®¾å¤‡å·ï¼Œä½¿ç”¨MAJORå’ŒMINORå¾—åˆ°ä¸»è®¾å¤‡å·majorå’Œæ¬¡è®¾å¤‡å·MINOR class_createä¼šåœ¨sysclassä¸‹åˆ›å»ºä¸€ä¸ªåä¸ºâ€œGPIO_NAMEâ€çš„ç±» æ ¹æ®è®¾å¤‡å·devidï¼Œé€šè¿‡device_create()åˆ›å»ºGPIOLED_NAMEè®¾å¤‡ ã€‚ä¼šåœ¨sysclassGPIO_NAMEçš„ç±»ä¸‹é¢å†åˆ›å»ºä¸€ä¸ªåä¸ºGPIO_NAMEçš„è®¾å¤‡èŠ‚ç‚¹ã€‚åŒæ ·è¯¥èŠ‚ç‚¹åœ¨devGPIO_NAMEä¸­ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥openæ‰“å¼€è¿™ä¸ªè®¾å¤‡ alloc_chrdev_region(gpioled.devid, 0, GPIOLED_CNT, GPIOLED_NAME);gpioled.major = MAJOR(gpioled.devid);gpioled.minor = MINOR(gpioled.devid);.../* 4ã€åˆ›å»ºç±» */gpioled.class = class_create(THIS_MODULE, GPIOLED_NAME);/* 5,åˆ›å»ºè®¾å¤‡ */gpioled.device = device_create(gpioled.class, NULL, gpioled.devid, NULL, GPIOLED_NAME); ä¸¾ä¾‹2ï¼šåˆ†é…è®¾å¤‡å· é€šè¿‡register_chrdevæ³¨å†Œlfile_operationç»“æ„ä½“ï¼Œå¾—åˆ°ä¸»è®¾å¤‡å· å†ä½¿ç”¨MKDEV(major,i)å¾—åˆ°è®¾å¤‡å·devidï¼Œæ ¹æ®devidåˆ›å»º100ask_led0ç­‰è®¾å¤‡ major = register_chrdev(0, 100ask_led, led_drv); /* /dev/100ask_led */led_class = class_create(THIS_MODULE, 100ask_led_class);for (i = 0; i LED_NUM; i++)device_create(led_class, NULL, MKDEV(major, i), NULL, 100ask_led%d, i); /* /dev/100ask_led0,1,... */ å†æ¥çœ‹ä¸‹å¦‚ä½•åˆ†é…è®¾å¤‡å·ï¼šè®¾å¤‡å·çš„åˆ†é…å¯ä»¥åˆ†ä¸ºåŠ¨æ€åˆ†é…å’Œé™æ€åˆ†é…ã€‚ é™æ€åˆ†é…å‡½æ•°åŸå‹ï¼šstatic inline int regiser_chrdev(unsigned int major,const char *name,const struct file_operations* fops) ä½¿ç”¨ç¤ºä¾‹ï¼šmajor = register_chrdev(0, 100ask_led, led_drv); å‚æ•°ï¼š major:ä¸»è®¾å¤‡å·ï¼Œä¸€èˆ¬ä¸º0ï¼Œè®©ç³»ç»Ÿè‡ªåŠ¨åˆ†é…ä¸€ä¸ªæœªä½¿ç”¨çš„ä¸»è®¾å¤‡å· name:åå­—ï¼Œå¯ä»¥é€šè¿‡cat procdevicesæŸ¥çœ‹ fops:éœ€è¦æ³¨å†Œçš„file_operationsç»“æ„ä½“ è¿”å›å€¼ï¼šæˆåŠŸåˆ™è¿”å›ä¸»è®¾å¤‡å· åŠ¨æ€åˆ†é…å‡½æ•°åŸå‹ï¼šint alloc_chrdev_region(dev_t *dev, unsigned baseminor, unsigned count, const char *name) ä½¿ç”¨ç¤ºä¾‹ï¼šalloc_chrdev_region(gpioled.devid, 0, GPIOLED_CNT, GPIOLED_NAME); å‚æ•°ï¼š dev:ç”¨äºä¿å­˜ç”³è¯·åˆ°çš„è®¾å¤‡å·ï¼Œdev_tä¸ºunsigned int ç±»å‹æ•°æ® baseminor:æ¬¡è®¾å¤‡å·çš„èµ·å§‹åœ°å€ï¼Œä¸€èˆ¬ä¸º0è¡¨ç¤ºæ¬¡è®¾å¤‡å·ä»0å¼€å§‹ count:éœ€è¦ç”³è¯·çš„è®¾å¤‡å·æ•°é‡ï¼Œä¸€èˆ¬ä¸º1 name:è®¾å¤‡åå­—ï¼ŒåŒregister_chrdevä¸€æ ·ï¼Œå¯ä»¥åœ¨procdevicesæŸ¥çœ‹ è¿”å›å€¼ï¼š æˆåŠŸè¿”å› å¦‚æœç»™å®šäº†è®¾å¤‡çš„ä¸»è®¾å¤‡å·å’Œæ¬¡è®¾å¤‡å·ï¼Œä½¿ç”¨register_chrdev_regionå‡½æ•°åŸå‹ï¼šint register_chrdev_region(dev_t from, unsigned count, const char *name) åŠ¨æ€åˆ†é…è®¾å¤‡å·ä¸‹æ³¨å†Œå­—ç¬¦è®¾å¤‡é©±åŠ¨é™æ€åˆ†é…ä¸ä»…åˆ†é…äº†è®¾å¤‡å·ï¼Œè¿˜ç›´æ¥å®Œæˆäº†å­—ç¬¦è®¾å¤‡file_operationsçš„æ³¨å†Œï¼Œä½†æ˜¯ä¼šå æ®ä¸»è®¾å¤‡å·ä¸‹é¢çš„æ‰€æœ‰æ¬¡è®¾å¤‡å·ã€‚ åŠ¨æ€åˆ†é…ä»…ä»…åˆ†é…äº†å­—ç¬¦è®¾å¤‡çš„è®¾å¤‡å·(devid)ï¼Œéœ€è¦é…åˆcdev_initå’Œcdev_addå°†è®¾å¤‡å’Œæ–‡ä»¶æ“ä½œç»‘å®šã€‚åœ¨åˆ†æcdev_initå’Œcdev_addä¹‹å‰ï¼Œå…ˆæ¥çœ‹çœ‹cdevç»“æ„ä½“æœ‰å“ªäº›æˆå‘˜ cdevç»“æ„ä½“ï¼šstruct cdev struct kobject kobj;\tstruct module *owner;\tconst struct file_operations *ops;\tstruct list_head list;\tdev_t dev; //è®¾å¤‡å·\tunsigned int count;; å…¶ä¸­dev_t devå°±æ˜¯è®¾å¤‡å·ï¼Œfile_operations *opså°±æ˜¯æœ€é‡è¦çš„é‚£ä¸ªè®¾å¤‡æ–‡ä»¶æ“ä½œç»“æ„ä½“æŒ‡é’ˆï¼Œä¸€èˆ¬åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼Œè¿™é‡Œä»…ä½œä¸ºç¤ºä¾‹ï¼š static const struct file_operations led_fops = .owner =\tTHIS_MODULE,\t.write =\tled_write,\t.open =\tled_open,\t.release\t=\tled_release,; cdev_initå®šä¹‰å¥½cdevå˜é‡ä¹‹åï¼Œcdev_addç”¨äºå‘Linuxç³»ç»Ÿæ·»åŠ å­—ç¬¦è®¾å¤‡(cdevç»“æ„ä½“)ï¼Œä½†åœ¨ä½¿ç”¨cdev_addä¹‹å‰éœ€è¦å…ˆå¯¹cdevç»“æ„ä½“å˜é‡è¿›è¡Œåˆå§‹åŒ–ï¼Œcdev_initå‡½æ•°åŸå‹å¦‚ä¸‹ï¼š void cdev_init(struct cdev* cdev,const struct file_operations *fops) å‚è€ƒç¤ºä¾‹ï¼š cdev_init(gpioled.cdev, led_fops); å‚æ•°ï¼š cdev:cdevå°±æ˜¯è¦è¿›è¡Œåˆå§‹åŒ–çš„cdevç»“æ„ä½“å˜é‡ fops:å°±æ˜¯æˆ‘ä»¬ä¸€ç›´æåˆ°çš„file_operationsç»“æ„ä½“ï¼Œé€šè¿‡cdev_initå°†cdevå’Œfile_operationsç»‘å®š cdev_addå¯¹cdevåˆå§‹åŒ–ä¹‹åå°±å¯ä»¥é€šè¿‡cdev_addå‘linuxç³»ç»Ÿä¸­æ·»åŠ è¿™ä¸ªå­—ç¬¦è®¾å¤‡ã€‚cdev_addåŸå‹ä¸ºï¼š int cdev_add(struct cdev *p,dev_t dev,unsigned count) å‚è€ƒç¤ºä¾‹ï¼š cdev_add(gpioled.cdev, gpioled.devid, GPIOLED_CNT); å‚æ•°ï¼š p:æŒ‡å‘cdevæŒ‡é’ˆ dev:æ˜¾ç¤ºä¼ å…¥çš„è®¾å¤‡å·ï¼Œåº”è¯¥ä¼šå°†devid(é€šè¿‡alloc_chrdev_region)ä¿å­˜åˆ°cdev-dev(è®¾å¤‡å·)ä¸­ count:è¦æ·»åŠ çš„è®¾å¤‡çš„æ•°é‡ ä»¥ä¸Šä¾¿å®ç°äº†ä¸€ä¸ªå­—ç¬¦è®¾å¤‡é©±åŠ¨çš„å¤§éƒ¨åˆ†å†…å®¹äº†ï¼šåŒ…æ‹¬ç¡®å®šä¸»è®¾å¤‡å·(åŠ¨æ€åˆ†é…å’Œé™æ€åˆ†é…)ï¼Œå®šä¹‰è‡ªå·±çš„file_operationsç»“æ„ä½“ï¼Œ3.å®ç°file_operationsç»“æ„ä½“ä¸­çš„openwirtereadå‡½æ•°(æ²¡å†™å‡ºç»†èŠ‚)ï¼Œ4.æŠŠfile_operationsç»“æ„ä½“å‘Šè¯‰å†…æ ¸ï¼Œå³æ³¨å†Œfile_operationsç»“æ„ä½“(é™æ€æ³¨å†Œregister_chrdevï¼Œcdev_add)ï¼Œ5.å®ç°å…¥å£å‡½æ•°(å®é™…ä¸Šä¸Šè¿°æ‰€æœ‰æ¡ˆä¾‹ä»£ç éƒ½ä½äºinitå‡½æ•°æˆ–è€…probeå‡½æ•°ä¸­) è®¾å¤‡æ ‘ åœ¨æ ¹èŠ‚ç‚¹ä¸‹åˆ›å»ºgpioled gpioled 18 #address-cells = 1; 19 #size-cells = 1; 20 compatible = atkalpha-gpioled; 21 pinctrl-names = default; 22 pinctrl-0 = pinctrl_leds; 23 led-gpio = gpio5 3 GPIO_ACTIVE_LOW; 24 status = okay; 25 ; åœ¨imx6ul-evkä¸‹åˆ›å»ºpinctrl_ledsèŠ‚ç‚¹ pinctrl_leds: ledgrp 738 fsl,pins = 739 MX6ULL_PAD_SNVS_TAMPER3__GPIO5_IO03 0x000110A0740 ;741 ; çœ‹å‡ ä¸ªé‡è¦çš„ç»“æ„ä½“ cdevå†çœ‹ä¸€éï¼Œå®é™…ä¸Šåªç”¨åˆ°äº†ownerï¼Œå…¶ä»–æš‚æ—¶æœªç”¨åˆ° struct cdev struct kobject kobj;\tstruct module *owner;\tconst struct file_operations *ops;\tstruct list_head list;\tdev_t dev;\tunsigned int count;; å†çœ‹classè¿™ä¸ªåºå¤§çš„ç»“æ„ä½“,åæ­£å°±æ˜¯é€šè¿‡gpioled.class class_create(THIS_MODULE, GPIOLED_NAME);åˆ›å»ºäº†ä¸€ä¸ªç±»ï¼Œå•¥ä¹Ÿæ²¡è®¾ç½®ï¼Œç±»ä¸‹è¾¹æœ‰å¾ˆå¤šçš„æˆå‘˜ï¼ŒåŒæ ·ä¹Ÿæœ‰owner nameå•¥çš„ã€‚åœ¨classç»“æ„ä½“å‰ï¼Œå¯ä»¥çœ‹åˆ°è¿™æ ·çš„ä¸€å¥è¯ï¼š * A class is a higher-level view of a device that abstracts out low-level* implementation details. Drivers may see a SCSI disk or an ATA disk, but,* at the class level, they are all simply disks. Classes allow user space* to work with devices based on what they do, rather than how they are* connected or how they work. ç¿»è¯‘è¿‡æ¥å¤§æ¦‚å°±æ˜¯ï¼šç±»æ˜¯è®¾å¤‡çš„æ›´é«˜çš„è§†è§’ï¼Œç±»æŠ½è±¡å‡ºäº†ä½å±‚æ¬¡çš„å®ç°ç»†èŠ‚ã€‚æ¯”å¦‚ï¼Œé©±åŠ¨ç¨‹åºä¼šåŒºåˆ†SCSIç£ç›˜å’ŒATAç£ç›˜ï¼Œä½†æ˜¯åœ¨ç±»çœ‹æ¥ï¼Œä»–ä»¬éƒ½æ˜¯ç®€å•çš„ç£ç›˜ã€‚ç±»å…è®¸ç”¨æˆ·ç©ºé—´æ ¹æ®ä»–ä»¬çš„åŠŸèƒ½è¿›è¡Œä½¿ç”¨ï¼Œè€Œä¸æ˜¯è®¾å¤‡çš„è¿æ¥æ–¹å¼å’Œå·¥ä½œæ–¹å¼ã€‚ struct class const char *name;\tstruct module *owner;\tstruct class_attribute *class_attrs;\tconst struct attribute_group\t**dev_groups;\tstruct kobject *dev_kobj;...çœç•¥ä¸€äº›å‡½æ•°\tconst struct dev_pm_ops *pm;\tstruct subsys_private *p;; deviceç»“æ„ä½“ä¹Ÿæ˜¯ä¸€ä¸ªåºå¤§çš„ç»“æ„ä½“ï¼Œgpioled.device device_create(gpioled.class, NULL, gpioled.devid, NULL, GPIOLED_NAME); platform_deviceç»“æ„ä½“ struct platform_device const char\t*name;//ä¼šåœ¨/sys/devices/platform/nameä¸­è¡¨ç°å‡ºæ¥\tint id;\tbool id_auto;\tstruct device\tdev;\tu32 num_resources;\tstruct resource\t*resource;\tconst struct platform_device_id\t*id_entry;\tchar *driver_override; /* Driver name to force a match */\t/* MFD cell pointer */\tstruct mfd_cell *mfd_cell;\t/* arch specific additions */\tstruct pdev_archdata\tarchdata;; platform_driver - device_driver- ä»£ç æºç åœ¨nfs_rootfsmyled_driverç›®å½•ä¸‹","tags":["linux","platform","LED"],"categories":["é©±åŠ¨"]},{"title":"dw-spi-mmioæ§åˆ¶å™¨é©±åŠ¨","path":"/2025/08/18/spiå­ç³»ç»Ÿdwæ§åˆ¶å™¨probeè¿‡ç¨‹/","content":"dw-spi-mmioæ§åˆ¶å™¨é©±åŠ¨éœ€è¦çŸ¥é“ï¼šSPIå¤§è‡´åˆ†ä¸ºäº†ä»¥ä¸‹ä¸‰ä¸ªå±‚æ¬¡ï¼Œåˆ†åˆ«æ˜¯SPIæ ¸å¿ƒï¼ŒSPIæ§åˆ¶å™¨é©±åŠ¨ï¼ŒSPIè®¾å¤‡é©±åŠ¨ã€‚ SPIæ ¸å¿ƒå±‚ä»£ç ä½äºkernel/include/linux/spi/spi.hå’Œkernel/drivers/spi/spi.cï¼Œæ ¸å¿ƒå±‚æä¾›äº†SPIæ€»çº¿é©±åŠ¨å’Œè®¾å¤‡é©±åŠ¨çš„æ³¨å†Œï¼Œæ³¨å†Œæ–¹æ³•ï¼Œå¹¶æä¾›ä¸€äº›æ§åˆ¶å™¨é©±åŠ¨å®ç°çš„å›è°ƒå‡½æ•°ã€‚æ ¸å¿ƒå±‚åŒ…å«ä¸€äº›é‡è¦çš„ç»“æ„ä½“ï¼Œstruct spi_controller,struct spi_transfer,struct spi_messageç­‰ã€‚ æ§åˆ¶å™¨é©±åŠ¨å°±æ˜¯æœ¬æ–‡æ ¸å¿ƒã€‚ä¸»è¦å®ç°SPIç¡¬ä»¶æ•°æ®æ”¶å‘åŠŸèƒ½ï¼Œåªæœ‰è¿™æ ·ï¼ŒæŒ‚æ¥åœ¨SPIæ€»çº¿ä¸Šçš„SPIè®¾å¤‡æ‰èƒ½é€šè¿‡SPIæ§åˆ¶å™¨è¯»å†™æ•°æ®å¹¶ä¸CPUè¿›è¡Œæ•°æ®äº¤äº’ã€‚ SPIè®¾å¤‡é©±åŠ¨ä¸€èˆ¬æŒ‚æ¥åœ¨å—CPUæ§åˆ¶çš„SPIæ§åˆ¶å™¨ä¸Šï¼Œé€šè¿‡SPIæ§åˆ¶å™¨ä¸CPUè¿›è¡Œæ•°æ®äº¤äº’ã€‚ graph TD subgraph ç”¨æˆ·ç©ºé—´å±‚ U3[åº”ç”¨ç¨‹åº] end subgraph å†…æ ¸ç©ºé—´å±‚ K4[SPIè®¾å¤‡é©±åŠ¨] K3[SPIè®¾å¤‡é©±åŠ¨] K2[SPIæ ¸å¿ƒ] K1[SPIæ§åˆ¶å™¨é©±åŠ¨] end subgraph ç¡¬ä»¶å±‚ H1[SPIæ§åˆ¶å™¨] H2[SPIè®¾å¤‡1] H3[SPIè®¾å¤‡2] end U3 -- K4 U3 -- K3 K4 -- K2 K3 -- K2 K2 -- K1 K1 -- H1 H1 -- H2 H1 -- H3 è®¾å¤‡æ ‘é…ç½®spi0: spi@f0383000 compatible = snps,dw-apb-ssi; status = disabled; interrupt-parent = gic; interrupts = GIC_SPI 29 IRQ_TYPE_LEVEL_HIGH; reg = 0x0 0xf0383000 0x0 0x1000; reg-io-width = 4; num-cs = 1; dmas = dw_axi_dmac 0x1 0 0 dw_axi_dmac 0x0 0 0; dma-names = tx, rx;;spi0 status = disabled;\t#address-cells = 1;\t#size-cells = 0;\t// pinctrl-names = default;\t// pinctrl-0 = spi0_pinctrl gpiob1_pinctrl;\tcs-gpios = portb 1 GPIO_ACTIVE_LOW;\tspi0_flash0: wnbnd0@0 compatible = jedec,spi-nor; spi-max-frequency = 400000; reg = 0; #address-cells = 1; #size-cells = 1; partition@spi-test0 label = test0; reg = 0x0 0x800000; /* 8MB */ ;\t;; spi0æ§åˆ¶å™¨ä¸‹æŒ‚è½½äº†spi0_flashçš„flashã€‚ spi0æ§åˆ¶å™¨å¯¹åº”çš„æ–‡ä»¶ä¸ºï¼škernel/drivers/spi/spi-dw-mmio.c ä¸dwç›¸å…³çš„é©±åŠ¨æ–‡ä»¶è¿˜æœ‰kerneldriversspispi-dw-core.c kerneldriversspispi-dw-dma.c spi0_flash0å¯¹åº”çš„é©±åŠ¨æ–‡ä»¶ä¸ºï¼škernel/drivers/mtd/devices/m25p80.c ä¸flashç›¸å…³çš„é‡è¦é©±åŠ¨æ–‡ä»¶æœ‰kerneldriversmtdspi-norspi-nor.cï¼Œå®ç°äº†spi_nor_scanï¼Œspi_nor_setupã€‚åœ¨spi-nor.hä¸­åªæœ‰spi_nor_scanå¼€æ”¾å‡ºæ¥äº†ï¼Œå› æ­¤è¿™ä¸ªå‡½æ•°éœ€è¦é‡ç‚¹åˆ†æ å…³äºç‰‡é€‰å¼•è„šï¼š åœ¨spi_deviceä¸­æœ‰æˆå‘˜ï¼šchip_selectï¼Œè¡¨ç¤ºspi_masterä¸‹çš„ç¬¬å‡ ä¸ªè®¾å¤‡ åœ¨spi_controllerä¸­æœ‰ä¸€ä¸ªcs_gpiosæ•°ç»„ï¼Œé‡Œé¢å­˜æ”¾æœ‰ä¸‹é¢å„ä¸ªspiè®¾å¤‡çš„ç‰‡é€‰å¼•è„š spi_deviceçš„ç‰‡é€‰å¼•è„šå°±æ˜¯ï¼šcs_gpios[spi_device.chip_select] åœ¨spi_deviceä¸­cs_gpioæ˜¯å¯é€‰é¡¹ï¼Œä¹Ÿå¯ä»¥æŠŠspi_deviceçš„ç‰‡é€‰å¼•è„šè®°å½•åœ¨è¿™é‡Œ åœ¨spi_controllerä¸­çš„æ˜¯cs_gpiosæ•°ç»„ SPIæ§åˆ¶å™¨é©±åŠ¨spi-dw-mimo.cæ³¨å†Œçš„æ˜¯å¹³å°é©±åŠ¨ SPI æ§åˆ¶å™¨é©±åŠ¨ï¼ˆplatform é©±åŠ¨ç±»å‹ï¼‰ï¼Œè´Ÿè´£åŒ¹é…è®¾å¤‡æ ‘ä¸­çš„ SPI æ§åˆ¶å™¨èŠ‚ç‚¹ï¼ˆspi@f0383000ï¼‰ static const struct of_device_id dw_spi_mmio_of_match[] = .compatible = snps,dw-apb-ssi, .data = dw_spi_dw_apb_init, /* end of table */; compatibleå­—æ®µï¼šè¿™æ˜¯åŒ¹é…çš„ â€œå…³é”®å­—â€ï¼Œä¸è®¾å¤‡æ ‘ä¸­æ§åˆ¶å™¨èŠ‚ç‚¹çš„compatibleå±æ€§å®Œå…¨å¯¹åº”ã€‚è®¾å¤‡æ ‘ä¸­spi@f0383000çš„compatible = snps,dw-apb-ssiï¼Œä¸ç¬¬ä¸€ä¸ªæ¡ç›®åŒ¹é…ã€‚ .dataå­—æ®µï¼šå¯é€‰çš„é™„åŠ æ•°æ®ï¼Œè¿™é‡ŒæŒ‡å‘dw_spi_dw_apb_initå‡½æ•°ï¼Œç”¨äºåˆå§‹åŒ–è¯¥ç±»å‹æ§åˆ¶å™¨çš„ç‰¹å®šå‚æ•°ï¼ˆè¿™é‡Œå®ç°çš„æ˜¯DMAé…ç½®å®ç°) static struct platform_driver dw_spi_mmio_driver = .probe = dw_spi_mmio_probe, // è®¾å¤‡åŒ¹é…æˆåŠŸåæ‰§è¡Œçš„åˆå§‹åŒ–å‡½æ•°\t.remove = dw_spi_mmio_remove, // è®¾å¤‡ç§»é™¤æ—¶æ‰§è¡Œçš„æ¸…ç†å‡½æ•°\t.driver = .name\t= DRIVER_NAME, // é©±åŠ¨åç§°ï¼ˆè¾…åŠ©åŒ¹é…ï¼Œä¼˜å…ˆçº§ä½äºcompatibleï¼‰ .of_match_table = dw_spi_mmio_of_match, // å…³è”è®¾å¤‡æ ‘åŒ¹é…è¡¨ .acpi_match_table = ACPI_PTR(dw_spi_mmio_acpi_match), // å…³è”ACPIåŒ¹é…è¡¨ï¼ˆç”¨äºéè®¾å¤‡æ ‘ç³»ç»Ÿï¼‰ .pm = SPI_DEV_PM_OPS, // ç”µæºç®¡ç†æ“ä½œé›†\t,; SPI æ§åˆ¶å™¨æ˜¯ç›´æ¥æŒ‚åœ¨ CPU æ€»çº¿ä¸Šçš„è®¾å¤‡ï¼ˆå¦‚ APB æ€»çº¿ï¼‰ï¼Œå±äºplatformè®¾å¤‡ç±»å‹ï¼ˆå†…æ ¸å¯¹ â€œæŒ‚åœ¨æ€»çº¿ä¸Šçš„è®¾å¤‡â€ çš„æŠ½è±¡ï¼‰ï¼Œå› æ­¤å…¶é©±åŠ¨éœ€ç”¨platform_driverç»“æ„ä½“è¿›è¡Œæ³¨å†Œ SPIä»è®¾å¤‡é©±åŠ¨SPI ä»è®¾å¤‡é©±åŠ¨ï¼ˆspi_driver ç±»å‹ï¼‰ï¼Œè´Ÿè´£åŒ¹é… SPI æ€»çº¿ä¸Šçš„ä»è®¾å¤‡ï¼ˆå³wnbnd0@0 flashï¼‰ è¿™é‡Œåªåˆ—å‡ºé€šè¿‡spiæ€»çº¿è®¿é—®nor flashçš„æƒ…å†µï¼Œå¯¹äºé€šè¿‡qspiæ§åˆ¶å™¨è®¿é—®nor flashæš‚æ—¶è¿˜æ²¡ç»†çœ‹ static struct spi_driver m25p80_driver = .driver = .name\t= m25p80, // é©±åŠ¨åç§° .of_match_table = m25p_of_table, // å…³è”è®¾å¤‡æ ‘åŒ¹é…è¡¨\t,\t.id_table\t= m25p_ids, // åŸºäºSPIè®¾å¤‡åç§°çš„åŒ¹é…è¡¨ï¼ˆæ—§æ–¹å¼ï¼Œä¼˜å…ˆçº§ä½äºof_match_tableï¼‰\t.probe\t= m25p_probe, // è®¾å¤‡åŒ¹é…æˆåŠŸåæ‰§è¡Œçš„åˆå§‹åŒ–å‡½æ•°\t.remove\t= m25p_remove, // è®¾å¤‡ç§»é™¤æ—¶çš„æ¸…ç†å‡½æ•°; SPI é—ªå­˜æ˜¯æŒ‚åœ¨ SPI æ€»çº¿ä¸Šçš„ä»è®¾å¤‡ï¼Œå±äºspiè®¾å¤‡ç±»å‹ï¼ˆå†…æ ¸å¯¹ â€œSPI æ€»çº¿ä¸Šçš„è®¾å¤‡â€ çš„æŠ½è±¡ï¼‰ï¼Œå› æ­¤å…¶é©±åŠ¨éœ€ç”¨spi_driverç»“æ„ä½“ id_tableçš„ä½œç”¨ï¼šæ—©æœŸæ²¡æœ‰è®¾å¤‡æ ‘æ—¶ï¼Œé€šè¿‡ SPI è®¾å¤‡çš„nameå­—æ®µåŒ¹é…ï¼ˆå¦‚name = m25p80ï¼‰ï¼Œç°åœ¨ä¸»è¦ç”¨äºå…¼å®¹æ—§è®¾å¤‡ï¼Œä¼˜å…ˆçº§ä½äºof_match_table è®¾å¤‡ä¸é©±åŠ¨çš„åŒ¹é…æµç¨‹ï¼ˆç»“åˆè®¾å¤‡æ ‘ï¼‰ å†…æ ¸å¯åŠ¨æ—¶æ‰«æè®¾å¤‡æ ‘ï¼šè§£æspi@f0383000ï¼ˆæ§åˆ¶å™¨ï¼‰å’Œwnbnd0@0ï¼ˆé—ªå­˜ï¼‰èŠ‚ç‚¹ï¼Œåˆ†åˆ«åˆ›å»ºplatform_deviceï¼ˆæ§åˆ¶å™¨è®¾å¤‡ï¼‰å’Œspi_deviceï¼ˆé—ªå­˜è®¾å¤‡ï¼‰ç»“æ„ä½“ï¼Œå…¶ä¸­åŒ…å«èŠ‚ç‚¹çš„compatibleå±æ€§ã€‚ é©±åŠ¨åŠ è½½æ—¶æ³¨å†ŒåŒ¹é…ä¿¡æ¯ï¼š spi-dw-mmio.koåŠ è½½åï¼Œé€šè¿‡platform_driver_register()æ³¨å†Œdw_spi_mmio_driverï¼Œå†…æ ¸å°†å…¶of_match_tableåŠ å…¥å…¨å±€è®¾å¤‡æ ‘åŒ¹é…è¡¨ã€‚ m25p80.koåŠ è½½åï¼Œé€šè¿‡spi_register_driver()æ³¨å†Œm25p80_driverï¼Œå†…æ ¸å°†å…¶of_match_tableåŠ å…¥å…¨å±€è®¾å¤‡æ ‘åŒ¹é…è¡¨ã€‚ åŒ¹é…è¿‡ç¨‹ï¼š å¯¹äºspi@f0383000ï¼ˆplatform è®¾å¤‡ï¼‰ï¼šå†…æ ¸éå†æ‰€æœ‰platform_driverï¼Œå‘ç°dw_spi_mmio_driverçš„of_match_tableä¸­compatible = snps,dw-apb-ssiä¸è®¾å¤‡ä¸€è‡´ï¼Œè§¦å‘dw_spi_mmio_probe()åˆå§‹åŒ–æ§åˆ¶å™¨ã€‚ å¯¹äºwnbnd0@0ï¼ˆspi è®¾å¤‡ï¼‰ï¼šå†…æ ¸éå†æ‰€æœ‰spi_driverï¼Œå‘ç°m25p80_driverçš„of_match_tableä¸­compatible = jedec,spi-norä¸è®¾å¤‡ä¸€è‡´ï¼Œè§¦å‘m25p_probe()åˆå§‹åŒ–é—ªå­˜ã€‚ åŒ¹é…æˆåŠŸåï¼šæ§åˆ¶å™¨é©±åŠ¨åˆå§‹åŒ– SPI ç¡¬ä»¶ï¼Œè®¾å¤‡é©±åŠ¨é€šè¿‡ SPI æ ¸å¿ƒå±‚æ¥å£ï¼ˆå¦‚spi_sync()ï¼‰ä¸æ§åˆ¶å™¨äº¤äº’ï¼Œå®Œæˆæ•°æ®ä¼ è¾“ã€‚ SPI DWæ§åˆ¶å™¨é©±åŠ¨probeè§£æå½“è®¾å¤‡æ ‘ä¸­çš„spièŠ‚ç‚¹è¢«è§£æä¸ºpaltform_deviceä¹‹åï¼Œä¼šä¸platform_driver.driver-of_device_idä¸­çš„compatibleå±æ€§è¿›è¡Œmatchï¼ŒåŒ¹é…æˆåŠŸååˆ™ä¼šè°ƒç”¨probeå‡½æ•° static const struct of_device_id dw_spi_mmio_of_match[] = .compatible = snps,dw-apb-ssi, .data = dw_spi_dw_apb_init, /* end of table */;MODULE_DEVICE_TABLE(of, dw_spi_mmio_of_match); probeå‡½æ•°è°ƒç”¨å…³ç³»dw_spi_mmio_probe\t//åˆ†é…dw_spi_mmioç»“æ„ä½“\tstruct dw_spi_mmio *dwsmmio = devm_kzalloc(pdev-dev, sizeof(struct dw_spi_mmio),GFP_KERNEL);\t//è·å–å¯„å­˜å™¨èµ„æº å¹¶èµ‹å€¼ç»™paddr\tstruct resource *mem = platform_get_resource(pdev, IORESOURCE_MEM, 0);\tdwsmmio-dws.paddr = mem-start;\t//è¿›è¡Œåœ°å€ioremapï¼Œå¹¶ä¸spi deviceè¿›è¡Œç»‘å®š\tdwsmmio-dws.regs = devm_ioremap_resource(pdev-dev, mem);\t//è®¾ç½®ä¸­æ–­\tdwsmmio-dws.irq = platform_get_irq(pdev, 0);\t//è·å–æ—¶é’Ÿ\tdwsmmio-clk = devm_clk_get(pdev-dev, NULL);\tdwsmmio-pclk = devm_clk_get(pdev-dev, pclk);//optional\tdwsmmio-dws.max_freq = clk_get_rate(dwsmmio-clk);\t//è·å–å¤ä½æ§åˆ¶å™¨\tdwsmmio-rstc = devm_reset_control_get_optional_exclusive(pdev-dev,spi);\treset_control_deassert(dwsmmio-rstc); //è·å–è®¾å¤‡æ ‘å±æ€§\tdevice_property_read_u32(pdev-dev, reg-io-width, dwsmmio-dws.reg_io_width);\tdevice_property_read_u32(pdev-dev, num-cs, dwsmmio-dws.num-cs); //è·å–æ€»çº¿num,idä»£è¡¨ä¸åŒspiå®ä¾‹\tdwsmmio-dws.bus_num = pdev-id; //ç§æœ‰æ•°æ® è·å–struct of_device_id dw_spi_mmio_of_match[0] = // .compatible = snps,dw-apb-ssi, .data = dw_spi_dw_apb_init,\t//;ä¸­çš„dataæŒ‡é’ˆæ•°æ®ï¼Œè¿™é‡Œæ˜¯å‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘dw_spi_dw_apb_initã€‚è¯¥å‡½æ•°å®ŒæˆDMAçš„dma_opsæ“ä½œé›†çš„å®ç°é…ç½®\tinit_func = of_device_get_match_data(pdev-dev);\tret = init_func(pdev, dwsmmio); /*å°†dw_spiæ·»åŠ åˆ° * åç»­é‡ç‚¹åˆ†ædw_spi_add_host*/\tret = dw_spi_add_host(pdev-dev, dwsmmio-dws); //å°†dwsmmioæ·»åŠ åˆ°deviceè®¾å¤‡çš„driver_dataä¸­ï¼Œä»¥å…±ä¾›åç»­ä½¿ç”¨\tplatform_set_drvdata(pdev, dwsmmio); dma_opsæ“ä½œé›†åˆå§‹åŒ–å®ŒæˆDMAçš„dma_opsæ“ä½œé›†çš„å®ç°é…ç½®ï¼Œæ–‡ä»¶ä½ç½®åœ¨kernel/drivers/spi/spi-dw-dma.cå¯ä»¥é€šè¿‡æ ‡å¿—ä½é…ç½®æ˜¯å¦ä½¿ç”¨dmaä¼ è¾“ã€‚ init_func = of_device_get_match_data(pdev-dev);\tret = init_func(pdev, dwsmmio);\t==static int dw_spi_dw_apb_init(pdev,dwsmmio) static int dw_spi_dw_apb_init(struct platform_device *pdev, struct dw_spi_mmio *dwsmmio)\tdw_spi_dma_setup_generic(dwsmmio-dws);\treturn 0;static const struct dw_spi_dma_ops dw_spi_dma_generic_ops = .dma_init\t= dw_spi_dma_init_generic,\t.dma_exit\t= dw_spi_dma_exit,\t.dma_setup\t= dw_spi_dma_setup,\t.can_dma\t= dw_spi_can_dma,\t.dma_transfer\t= dw_spi_dma_transfer,\t.dma_stop\t= dw_spi_dma_stop,;void dw_spi_dma_setup_generic(struct dw_spi *dws)\tdws-dma_ops = dw_spi_dma_generic_ops;EXPORT_SYMBOL_GPL(dw_spi_dma_setup_generic); SPI DWæ§åˆ¶å™¨é©±åŠ¨add_hostè§£æret = dw_spi_add_host(pdev-dev, dwsmmio-dws);dw_spi_add_host\t//åˆ†é…spi_masterç»“æ„ä½“\tdws-master = spi_alloc_master(dev, 0); //è®¾ç½®DMAå¯„å­˜å™¨åç§»åœ°å€\tdws-dma_addr = (dma_addr_t)(dws-paddr + DW_SPI_DR);\t/* Restart the controller, disable all interrupts, clean rx fifo */\tspi_hw_init(dev, dws);\t//è¯·æ±‚ä¸­æ–­\tret = request_irq(dws-irq, dw_spi_irq, IRQF_SHARED, dev_name(dev),master); //åˆå§‹åŒ–memory operationsæˆå‘˜\tdw_spi_init_mem_ops(dws); //åˆå§‹åŒ–å…¶ä»–æˆå‘˜\tdws-master-mode_bits = SPI_CPOL | SPI_CPHA | SPI_LOOP;\tdws-master-bits_per_word_mask = SPI_BPW_RANGE_MASK(4, 16);\tdws-master-bus_num = dws-bus_num;\tdws-master-num_chipselect = dws-num_cs;\tdws-master-setup = dw_spi_setup;\tdws-master-cleanup = dw_spi_cleanup;\t//æ§åˆ¶ç‰‡é€‰ä¿¡å·ï¼ˆç¡¬ä»¶ç‰‡é€‰æˆ– GPIO æ¨¡æ‹Ÿï¼‰\tif (dws-set_cs) dws-master-set_cs = dws-set_cs;//GPIOæ¨¡æ‹Ÿ èµ°è¿™ä¸ªåˆ†æ”¯ï¼Ÿ!\telse dws-master-set_cs = dw_spi_set_cs;//ç¡¬ä»¶ç‰‡é€‰ dws-master-transfer_one = dw_spi_transfer_one;\tdws-master-handle_err = dw_spi_handle_err;\tif (dws-mem_ops.exec_op)//1 dws-master-mem_ops = dws-mem_ops;\tdws-master-max_speed_hz = dws-max_freq;\tdws-master-dev.of_node = dev-of_node;\tdws-master-dev.fwnode = dev-fwnode;\tdws-master-flags = SPI_MASTER_GPIO_SS;//ä½¿ç”¨GPIOç‰‡é€‰æ ‡å¿—ï¼Ÿ\tdws-master-auto_runtime_pm = true;\tdevice_property_read_u32(dev, rx-sample-delay-ns,dws-def_rx_sample_dly_ns);\t// DMAæ”¯æŒï¼šè‹¥é©±åŠ¨å®ç°äº†DMAæ“ä½œå‡½æ•°ï¼ˆdma_opsï¼‰,åˆ™è°ƒç”¨dma_initåˆå§‹åŒ–DMAé€šé“\t// dma_opsæ˜¯åœ¨probeçš„init_funcè¿›è¡Œå®ç°çš„\tif (dws-dma_ops dws-dma_ops-dma_init) ret = dws-dma_ops-dma_init(dev, dws); if (ret) dev_warn(dev, DMA init failed ); else master-can_dma = dws-dma_ops-can_dma; master-flags |= SPI_CONTROLLER_MUST_TX; //æ³¨å†Œå°†dws-masteræ³¨å†Œè¿›spi controllerä¸­\tret = spi_register_controller(dws-master); //æ–‡ä»¶ç³»ç»Ÿè°ƒè¯• dw_spi_debugfs_init(dws); //å°†dwsä¸masterç»‘å®šï¼Œåç»­é©±åŠ¨é€»è¾‘å¯é€šè¿‡dev_set/get_drvdata(master-dev) å’Œ spi_controller_get_devdata(master)è®¿é—®ç¡¬ä»¶ç›¸å…³çš„ç§æœ‰é…ç½®ï¼ˆå¦‚å¯„å­˜å™¨åŸºåœ°å€ã€ä¸­æ–­å·ç­‰ç­‰ï¼‰\tspi_controller_set_devdata(master, dws); SPI DWæ§åˆ¶å™¨é©±åŠ¨dw_spi_transfer_oneè§£æstatic int dw_spi_transfer_one(struct spi_controller *master, struct spi_device *spi, struct spi_transfer *transfer)\tstruct dw_spi *dws = spi_controller_get_devdata(master);\tstruct dw_spi_cfg cfg = .tmode = SPI_TMOD_TR, .dfs = transfer-bits_per_word, .freq = transfer-speed_hz,\t;\tint ret;\tdws-dma_mapped = 0;\tdws-n_bytes = DIV_ROUND_UP(transfer-bits_per_word, BITS_PER_BYTE);\tdws-tx = (void *)transfer-tx_buf;\tdws-tx_len = transfer-len / dws-n_bytes;\tdws-rx = transfer-rx_buf;\tdws-rx_len = dws-tx_len;\t/* Ensure the data above is visible for all CPUs */\tsmp_mb();\tspi_enable_chip(dws, 0);\tdw_spi_update_config(dws, spi, cfg);\t/* Check if current transfer is a DMA transaction */\tif (master-can_dma master-can_dma(master, spi, transfer)) dws-dma_mapped = master-cur_msg_mapped;\t/* For poll mode just disable all interrupts */\tspi_mask_intr(dws, 0xff);\t// DMAæ¨¡å¼ å¯¹åº”è®¾å¤‡æ ‘ä¸­ dmas å±æ€§ if (dws-dma_mapped) // DMA ä¼ è¾“åˆå§‹åŒ– ret = dws-dma_ops-dma_setup(dws, transfer); if (ret) return ret; spi_enable_chip(dws, 1);\tif (dws-dma_mapped) // ä¼˜å…ˆ DMA ä¼ è¾“æ¨¡å¼ return dws-dma_ops-dma_transfer(dws, transfer); // è½®è¯¢æ¨¡å¼\telse if (dws-irq == IRQ_NOTCONNECTED) return dw_spi_poll_transfer(dws, transfer);\t// é»˜è®¤ä¸­æ–­ä¼ è¾“æ¨¡å¼\tdw_spi_irq_setup(dws);\treturn 1; dw_spi_transfer_oneå®ç°äº†SPIä¼ è¾“ï¼Œæœ‰3ç§æ¨¡å¼ï¼ŒDMAæ¨¡å¼ pollè½®è¯¢æ¨¡å¼ ä¸­æ–­ä¼ è¾“æ¨¡å¼ã€‚åœ¨tsèŠ¯ç‰‡ä¸­ä¼˜å…ˆä½¿ç”¨DMAæ¨¡å¼è¿›è¡Œä¼ è¾“ SPI DWæ§åˆ¶å™¨é©±åŠ¨spi_register_controllerè§£æint spi_register_controller(struct spi_controller *ctlr) //å®Œæˆè§£æcs-gpioså±æ€§ status = of_spi_register_master(ctlr); for (i = 0; i nb; i++) cs[i] = of_get_named_gpio(ctlr-dev.of_node, cs-gpios, i);\t// if (ctlr-bus_num = 0) /* ç”¨æŒ‡å®šçš„æ€»çº¿å·åˆ†é… id */ mutex_lock(board_lock); id = idr_alloc(spi_master_idr, ctlr, ctlr-bus_num, ctlr-bus_num + 1, GFP_KERNEL); mutex_unlock(board_lock); if (WARN(id 0, couldnt get idr)) return id == -ENOSPC ? -EBUSY : id; ctlr-bus_num = id; //æ ¸å¿ƒæ•°æ®åˆå§‹åŒ– INIT_LIST_HEAD(ctlr-queue); // åˆå§‹åŒ–ä¼ è¾“è¯·æ±‚é˜Ÿåˆ— spin_lock_init(ctlr-queue_lock); // ä¿æŠ¤ä¼ è¾“é˜Ÿåˆ—çš„è‡ªæ—‹é” spin_lock_init(ctlr-bus_lock_spinlock); // æ€»çº¿é”å®šçš„è‡ªæ—‹é” mutex_init(ctlr-bus_lock_mutex); // æ€»çº¿é”å®šçš„äº’æ–¥é” mutex_init(ctlr-io_mutex); // I/O æ“ä½œäº’æ–¥é” ctlr-bus_lock_flag = 0; // æ€»çº¿é”å®šçŠ¶æ€æ ‡è®° init_completion(ctlr-xfer_completion); // ä¼ è¾“å®Œæˆé‡ if (!ctlr-max_dma_len) ctlr-max_dma_len = INT_MAX; // DMA æœ€å¤§ä¼ è¾“é•¿åº¦é»˜è®¤å€¼\t//æ³¨å†Œæ§åˆ¶å™¨ä¸ºå†…æ ¸è®¾å¤‡ dev_set_name(ctlr-dev, spi%u, ctlr-bus_num); // è®¾ç½®è®¾å¤‡åï¼ˆå¦‚ spi0ï¼‰ status = device_add(ctlr-dev); // æ³¨å†Œåˆ°å†…æ ¸è®¾å¤‡æ¨¡å‹ if (status 0) /* æ³¨å†Œå¤±è´¥ï¼Œé‡Šæ”¾æ€»çº¿å· */ mutex_lock(board_lock); idr_remove(spi_master_idr, ctlr-bus_num); mutex_unlock(board_lock); goto done; //ä¼ è¾“é˜Ÿåˆ—åˆå§‹åŒ–ï¼ˆé©±åŠ¨æ¨¡å¼é€‚é…ï¼‰ if (ctlr-transfer) dev_info(dev, controller is unqueued, this is deprecated ); else status = spi_controller_initialize_queue(ctlr); if (status) device_del(ctlr-dev); /* é‡Šæ”¾æ€»çº¿å· */ mutex_lock(board_lock); idr_remove(spi_master_idr, ctlr-bus_num); mutex_unlock(board_lock); goto done; /* åˆå§‹åŒ–ç»Ÿè®¡ä¿¡æ¯é” */ spin_lock_init(ctlr-statistics.lock); /* å°†æ§åˆ¶å™¨æ·»åŠ åˆ°å…¨å±€é“¾è¡¨ï¼Œå¹¶åŒ¹é…æ¿çº§è®¾å¤‡ */ mutex_lock(board_lock); list_add_tail(ctlr-list, spi_controller_list); // åŠ å…¥å…¨å±€æ§åˆ¶å™¨é“¾è¡¨ list_for_each_entry(bi, board_list, list) // éå†æ¿çº§è®¾å¤‡ä¿¡æ¯ spi_match_controller_to_boardinfo(ctlr, bi-board_info); // åŒ¹é…è®¾å¤‡ mutex_unlock(board_lock); of_register_spi_devices(ctlr); // ä»è®¾å¤‡æ ‘æ³¨å†Œ SPI ä»è®¾å¤‡ å³M25P80é©±åŠ¨ acpi_register_spi_devices(ctlr); // ä» ACPI æ³¨å†Œ SPI ä»è®¾å¤‡ SPI DWæ§åˆ¶å™¨æ³¨å†Œä»è®¾å¤‡of_register_spi_devices éå†æ§åˆ¶å™¨è®¾å¤‡æ ‘èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼ˆæ¯ä¸ªå­èŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ª SPI ä»è®¾å¤‡ï¼‰ï¼Œè§£æ compatibleã€regï¼ˆregè¡¨ç¤ºç‰‡é€‰å·ï¼Œä»£è¡¨ç¬¬å‡ ä¸ªspiè®¾å¤‡ï¼Œä¸æ˜¯å¯„å­˜å™¨ï¼‰ã€spi-max-frequency ç­‰å±æ€§ï¼Œè‡ªåŠ¨åˆ›å»º struct spi_device å¹¶æ³¨å†Œã€‚ spi_register_controller\tof_register_spi_devices of_register_spi_device /* Alloc an spi_device */ spi = spi_alloc_device(ctlr); /* Select device driver */ rc = of_modalias_node(nc, spi-modalias,sizeof(spi-modalias)); rc = of_spi_parse_dt(ctlr, spi, nc); /* Register the new device */ rc = spi_add_device(spi); spi0 spi0_flash0: wnbnd0@0 compatible = jedec,spi-nor; spi-max-frequency = 1000000; reg = 0; #address-cells = 1; #size-cells = 1; partition@spi-test0 label = test0; reg = 0x0 0x800000; /* 8MB */ ;\t;; SPIä»è®¾å¤‡é©±åŠ¨(è¡¥å……)é’ˆå¯¹ä¸Šä¸€èŠ‚ä¸­SPIä»è®¾å¤‡é©±åŠ¨çš„å…·ä½“è¡¥å……ã€‚ç”±äºè¿™ä¸ªä»è®¾å¤‡æ—¢å’Œspiæ€»çº¿æœ‰å…³ï¼Œåˆå’Œmtdå­ç³»ç»Ÿæœ‰å…³ï¼ŒåŒæ—¶åˆä»å±äºspi-norç³»ç»Ÿæ¡†æ¶ä¹‹ä¸‹ï¼Œå› æ­¤è¦æƒ³ææ˜ç™½éœ€è¦èŠ±å¾ˆå¤§çš„æ—¶é—´ã€‚è¿™é‡Œåªæ˜¯ç®€å•ä»‹ç»ä¸€äº›æŸ¥åˆ°çš„ä»‹ç»ã€‚ å‰ç½®çŸ¥è¯†mtdå­ç³»ç»ŸMTDè®¾å¤‡é€šå¸¸å¯åˆ†ä¸ºå››å±‚ ï¼Œè®¾å¤‡èŠ‚ç‚¹ã€MTDè®¾å¤‡å±‚ã€MTDåŸå§‹è®¾å¤‡å±‚å’Œç¡¬ä»¶é©±åŠ¨å±‚ã€‚ ç¡¬ä»¶é©±åŠ¨å±‚ä¸»è¦æ–‡ä»¶ä½äº drivers/mtd/chips : CFI/jedecæ¥å£é€šç”¨é©±åŠ¨ drivers/mtd/nand : nandé€šç”¨é©±åŠ¨å’Œéƒ¨åˆ†åº•å±‚é©±åŠ¨ç¨‹åº drivers/mtd/maps : nor flashæ˜ å°„å…³ç³»ç›¸å…³å‡½æ•° drivers/mtd/spi-nor: nor flashåº•å±‚é©±åŠ¨ MTDè®¾å¤‡å±‚ä¸»è¦æ–‡ä»¶ä½äº mtdchar.c : MTDå­—ç¬¦è®¾å¤‡æ¥å£ç›¸å…³å®ç° mtdblock.c : MTDå—è®¾å¤‡æ¥å£ç›¸å…³å®ç° è®¾å¤‡èŠ‚ç‚¹ä½äº/dev/mtdxå’Œ/dev/mtdblockXï¼Œåˆ†åˆ«æ˜¯å­—ç¬¦è®¾å¤‡èŠ‚ç‚¹å’Œå—è®¾å¤‡èŠ‚ç‚¹ã€‚ä¸¤è€…ä¸€èˆ¬æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œåœ¨ç‰©ç†ä¸Šä¸¤è€…å…¶å®æ˜¯åŒä¸€ä¸ªä¸œè¥¿ï¼Œä½†æ˜¯åœ¨è½¯ä»¶ä¸Šæ˜¯è¿›è¡ŒåŒºåˆ†çš„ï¼Œå¯ä»¥ç†è§£ä¸ºä»–ä»¬æ˜¯å¯¹åŒä¸€åˆ†åŒºçš„ä¸åŒæè¿°æ–¹æ³•ã€‚ devmtdx:æ˜¯mtdchar.cæ³¨å†Œç”Ÿæˆçš„ï¼Œæ”¯æŒopen,read,write,ioctlç­‰ã€‚flash_erase, nanddumpç­‰éƒ½æ˜¯å¯¹å­—ç¬¦èŠ‚ç‚¹ï¼Œé€šè¿‡read,write,ioctlç­‰æ‰§è¡Œ å¯¹åº”mtdblock.cå’Œmtd_blkdevs.cï¼Œæ˜¯Flashé©±åŠ¨ä¸­ç”¨add_mtd_partitions()æ·»åŠ MTDè®¾å¤‡åˆ†åŒºï¼Œè€Œç”Ÿæˆçš„å¯¹åº”çš„å—è®¾å¤‡ MTDå—è®¾å¤‡é©±åŠ¨ç¨‹åºå¯ä»¥è®©flashå™¨ä»¶ä¼ªè£…æˆå—è®¾å¤‡ï¼Œå®é™…ä¸Šå®ƒé€šè¿‡æŠŠæ•´å—çš„erase blockæ”¾åˆ°ramé‡Œé¢è¿›è¡Œè®¿é—®ï¼Œç„¶åå†æ›´æ–°åˆ°flashï¼Œç”¨æˆ·å¯ä»¥åœ¨è¿™ä¸ªå—è®¾å¤‡ä¸Šåˆ›å»ºé€šå¸¸çš„æ–‡ä»¶ç³»ç»Ÿ å¯¹äºMTDå—è®¾å¤‡ï¼ŒMTDè®¾å¤‡å±‚æ˜¯ä¸æä¾›ioctlçš„å®ç°æ–¹æ³•çš„ï¼Œä¸èƒ½ä½¿ç”¨nandwrite,flash_eraseall,flash_eraseç­‰å·¥å…·å»å¯¹devmtdblockNå»è¿›è¡Œæ“ä½œ mtd-utilså·¥å…·åªèƒ½ç”¨ä¸devmtdNçš„MTDå­—ç¬¦è®¾å¤‡ mountã€umountå‘½ä»¤åªå¯¹devmtdblockNçš„MTDå—è®¾å¤‡æœ‰æ•ˆ éœ€è¦æ³¨æ„çš„æ˜¯ï¼šMTDè®¾å¤‡æ—¢éå—è®¾å¤‡ä¹Ÿä¸æ˜¯å­—ç¬¦è®¾å¤‡ï¼Œä½†å¯ä»¥åŒæ—¶æä¾›å­—ç¬¦è®¾å¤‡å’Œå—è®¾å¤‡æ¥å£æ¥æ“ä½œå®ƒ spi-nor ç³»ç»Ÿæ¡†æ¶SPIæ€»çº¿åªèƒ½å¤„ç†å­—èŠ‚æµï¼Œæ€»çº¿æ§åˆ¶å™¨çš„æ“ä½œä¸æ‰€è¿æ¥çš„ç‰¹å®šè®¾å¤‡æ— å…³ã€‚SPIæ§åˆ¶å™¨åªçŸ¥é“å‘é€æˆ–æ¥æ”¶å­—èŠ‚ï¼ˆTxå’ŒRxï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ–°çš„åˆ†å±‚æ–¹æ¡ˆï¼Œåœ¨è¯¥æ–¹æ¡ˆä¸‹ï¼Œæ§åˆ¶å™¨é©±åŠ¨ç¨‹åºçŸ¥é“SPI NORåè®®çš„æ“ä½œç ã€å¯»å€å’Œå…¶ä»–ç»†èŠ‚ã€‚ å†…å®¹è¶Šçœ‹è¶Šå¤šï¼Œæš‚æ—¶å°±æ•´ç†è¿™ä¹ˆå¤šå§ã€‚å…ˆæŠŠä»è®¾å¤‡é©±åŠ¨åˆ†æä¸€ä¸‹ï¼Œmtdå­ç³»ç»Ÿå’Œspi norç³»ç»Ÿæ¡†æ¶å•ç‹¬æ•´ç†åˆ°ä¸€ä¸ªæ–°æ–‡ä»¶ä¸­ã€‚ é‡è¦ç»“æ„ä½“struct spi_norstruct spi_nor struct mtd_info mtd;//æŒ‡å‘mtd_infoç»“æ„ä½“ï¼Œæ‰€æœ‰çš„å­˜å‚¨è®¾å¤‡ï¼Œéƒ½å¯ä»¥æŒ‚è½½åˆ°mtdå­ç³»ç»Ÿä¸­\tstruct mutex lock;\tstruct device *dev;\tu32 page_size;//SPI NORçš„é¡µé¢å¤§å°\tu8 addr_width;// åœ°å€å­—èŠ‚æ•°\tu8 erase_opcode;//ç”¨äºæ“¦é™¤æ‰‡åŒºçš„æ“ä½œç \tu8 read_opcode;\tu8 read_dummy;\tu8 program_opcode;//programæ“ä½œç  //spi_nor_protocol 1çº¿ 4çº¿ 8çº¿\tenum spi_nor_protocol\tread_proto;//ç”¨äºè¯»å–æ“ä½œçš„SPIåè®®\tenum spi_nor_protocol\twrite_proto;//ç”¨äºå†™æ“ä½œçš„SPIåè®®\tenum spi_nor_protocol\treg_proto;//ç”¨äºè¯»\\å†™\\æ“¦é™¤æ“ä½œçš„SPIåè®®\tbool sst_write_second;\tu32 flags;\tu8 cmd_buf[SPI_NOR_MAX_CMD_SIZE];\tint (*prepare)(struct spi_nor *nor, enum spi_nor_ops ops);\tvoid (*unprepare)(struct spi_nor *nor, enum spi_nor_ops ops);\tint (*read_reg)(struct spi_nor *nor, u8 opcode, u8 *buf, int len);\tint (*write_reg)(struct spi_nor *nor, u8 opcode, u8 *buf, int len);\tssize_t (*read)(struct spi_nor *nor, loff_t from, size_t len, u_char *read_buf);\tssize_t (*write)(struct spi_nor *nor, loff_t to, size_t len, const u_char *write_buf);\tint (*erase)(struct spi_nor *nor, loff_t offs);\tint (*flash_lock)(struct spi_nor *nor, loff_t ofs, uint64_t len);\tint (*flash_unlock)(struct spi_nor *nor, loff_t ofs, uint64_t len);\tint (*flash_is_locked)(struct spi_nor *nor, loff_t ofs, uint64_t len);\tvoid *priv;; è®¾å¤‡æ ‘åŒ¹é…spi0 spi0_flash0: wnbnd0@0 compatible = jedec,spi-nor; spi-max-frequency = 1000000; reg = 0; #address-cells = 1; #size-cells = 1; partition@spi-test0 label = test0; reg = 0x0 0x800000; /* 8MB */ ;\t;; static const struct of_device_id m25p_of_table[] = /* * Generic compatibility for SPI NOR that can be identified by the * JEDEC READ ID opcode (0x9F). Use this, if possible. */ .compatible = jedec,spi-nor ,\t;static struct spi_driver m25p80_driver = .driver = .name\t= m25p80, // é©±åŠ¨åç§° .of_match_table = m25p_of_table, // å…³è”è®¾å¤‡æ ‘åŒ¹é…è¡¨\t,\t.id_table\t= m25p_ids, // åŸºäºSPIè®¾å¤‡åç§°çš„åŒ¹é…è¡¨ï¼ˆæ—§æ–¹å¼ï¼Œä¼˜å…ˆçº§ä½äºof_match_tableï¼‰\t.probe\t= m25p_probe, // è®¾å¤‡åŒ¹é…æˆåŠŸåæ‰§è¡Œçš„åˆå§‹åŒ–å‡½æ•°\t.remove\t= m25p_remove, // è®¾å¤‡ç§»é™¤æ—¶çš„æ¸…ç†å‡½æ•°; probeå‡½æ•°static int m25p_probe(struct spi_device *spi)\tstruct flash_platform_data\t*data;\tstruct m25p *flash;\tstruct spi_nor *nor;\tstruct spi_nor_hwcaps hwcaps = .mask = SNOR_HWCAPS_READ | SNOR_HWCAPS_READ_FAST | SNOR_HWCAPS_PP,\t;\tchar *flash_name;\tint ret;\tprintk(m25p80: %s , __func__);\tdata = dev_get_platdata(spi-dev);\tflash = devm_kzalloc(spi-dev, sizeof(*flash), GFP_KERNEL);\tif (!flash) return -ENOMEM;\tnor = flash-spi_nor;\t/* install the hooks */\tnor-read = m25p80_read;\tnor-write = m25p80_write;\tnor-write_reg = m25p80_write_reg;\tnor-read_reg = m25p80_read_reg;\tnor-dev = spi-dev;\tspi_nor_set_flash_node(nor, spi-dev.of_node);\tnor-priv = flash;\tspi_set_drvdata(spi, flash);\tflash-spi = spi;\tif (spi-mode SPI_RX_QUAD) hwcaps.mask |= SNOR_HWCAPS_READ_1_1_4; if (spi-mode SPI_TX_QUAD) hwcaps.mask |= (SNOR_HWCAPS_READ_1_4_4 | SNOR_HWCAPS_PP_1_1_4 | SNOR_HWCAPS_PP_1_4_4); else if (spi-mode SPI_RX_DUAL) hwcaps.mask |= SNOR_HWCAPS_READ_1_1_2; if (spi-mode SPI_TX_DUAL) hwcaps.mask |= SNOR_HWCAPS_READ_1_2_2; if (data data-name) nor-mtd.name = data-name;\t/* For some (historical?) reason many platforms provide two different * names in flash_platform_data: name and type. Quite often name is * set to m25p80 and then type provides a real chip name. * If thats the case, respect type and ignore a name. */\tif (data data-type) flash_name = data-type;\telse if (!strcmp(spi-modalias, spi-nor)) flash_name = NULL; /* auto-detect */\telse flash_name = spi-modalias;\tret = spi_nor_scan(nor, flash_name, hwcaps);\tif (ret) printk(%s %d ret:%d,__func__,__LINE__,ret); return ret; return mtd_device_register(nor-mtd, data ? data-parts : NULL, data ? data-nr_parts : 0); å¯ä»¥æŒ‰ç…§é¡ºåºåˆ’åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ† è®¾ç½®struct spi_norç»“æ„ä½“ è®¾ç½®struct spi_nor_hwcapsç»“æ„ä½“ spi_nor_scanæ³¨å†Œstruct spi_norç»“æ„ä½“ åé¢éœ€è¦é‡ç‚¹åˆ†æspi_nor_scanç»“æ„ä½“ mtd deviceæ³¨å†Œ spi_nor_scan**(é‡ç‚¹åˆ†æ)**int spi_nor_scan(struct spi_nor *nor, const char *name, const struct spi_nor_hwcaps *hwcaps)\tstruct spi_nor_flash_parameter params;\tconst struct flash_info *info = NULL;\tstruct device *dev = nor-dev;\tstruct mtd_info *mtd = nor-mtd;\tstruct device_node *np = spi_nor_get_flash_node(nor);\tint ret;\tint i;\tprintk(spi_nor_scan start );\tret = spi_nor_check(nor);\tif (ret) return ret;\t/* Reset SPI protocol for all commands. */\tnor-reg_proto = SNOR_PROTO_1_1_1;\tnor-read_proto = SNOR_PROTO_1_1_1;\tnor-write_proto = SNOR_PROTO_1_1_1;\tif (name) info = spi_nor_match_id(name);\t/* Try to auto-detect if chip name wasnt specified or not found */\tif (!info) info = spi_nor_read_id(nor);\tif (IS_ERR_OR_NULL(info)) return -ENOENT;\t/* * If caller has specified name of flash model that can normally be * detected using JEDEC, lets verify it. */\tif (name info-id_len) const struct flash_info *jinfo; jinfo = spi_nor_read_id(nor); if (IS_ERR(jinfo)) return PTR_ERR(jinfo); else if (jinfo != info) /* * JEDEC knows better, so overwrite platform ID. We * cant trust partitions any longer, but well let * mtd apply them anyway, since some partitions may be * marked read-only, and we dont want to lose that * information, even if its not 100% accurate. */ dev_warn(dev, found %s, expected %s , jinfo-name, info-name); info = jinfo; mutex_init(nor-lock);\t/* * Make sure the XSR_RDY flag is set before calling * spi_nor_wait_till_ready(). Xilinx S3AN share MFR * with Atmel spi-nor */\tif (info-flags SPI_S3AN) nor-flags |= SNOR_F_READY_XSR_RDY;\t/* Parse the Serial Flash Discoverable Parameters table. */\tret = spi_nor_init_params(nor, info, params);\tif (ret) return ret;\t/* * Atmel, SST, Intel/Numonyx, and others serial NOR tend to power up * with the software protection bits set */\tif (JEDEC_MFR(info) == SNOR_MFR_ATMEL || JEDEC_MFR(info) == SNOR_MFR_INTEL || JEDEC_MFR(info) == SNOR_MFR_SST || info-flags SPI_NOR_HAS_LOCK) write_enable(nor); write_sr(nor, 0); spi_nor_wait_till_ready(nor); if (!mtd-name) mtd-name = dev_name(dev);\tmtd-priv = nor;\tmtd-type = MTD_NORFLASH;\tmtd-writesize = 1;\tmtd-flags = MTD_CAP_NORFLASH;\tmtd-size = params.size;\tmtd-_erase = spi_nor_erase;\tmtd-_read = spi_nor_read;\t/* NOR protection support for STmicro/Micron chips and similar */\tif (JEDEC_MFR(info) == SNOR_MFR_MICRON || info-flags SPI_NOR_HAS_LOCK) nor-flash_lock = stm_lock; nor-flash_unlock = stm_unlock; nor-flash_is_locked = stm_is_locked; if (nor-flash_lock nor-flash_unlock nor-flash_is_locked) mtd-_lock = spi_nor_lock; mtd-_unlock = spi_nor_unlock; mtd-_is_locked = spi_nor_is_locked; /* sst nor chips use AAI word program */\tif (info-flags SST_WRITE) mtd-_write = sst_write;\telse mtd-_write = spi_nor_write;\tif (info-flags USE_FSR) nor-flags |= SNOR_F_USE_FSR;\tif (info-flags SPI_NOR_HAS_TB) nor-flags |= SNOR_F_HAS_SR_TB;\tif (info-flags NO_CHIP_ERASE) nor-flags |= SNOR_F_NO_OP_CHIP_ERASE;\tif (info-flags USE_CLSR) nor-flags |= SNOR_F_USE_CLSR;\tif (info-flags SPI_NOR_NO_ERASE) mtd-flags |= MTD_NO_ERASE;\tmtd-dev.parent = dev;\tnor-page_size = params.page_size;\tmtd-writebufsize = nor-page_size;\tif (np) /* If we were instantiated by DT, use it */ if (of_property_read_bool(np, m25p,fast-read)) params.hwcaps.mask |= SNOR_HWCAPS_READ_FAST; else params.hwcaps.mask = ~SNOR_HWCAPS_READ_FAST; else /* If we werent instantiated by DT, default to fast-read */ params.hwcaps.mask |= SNOR_HWCAPS_READ_FAST; /* Some devices cannot do fast-read, no matter what DT tells us */\tif (info-flags SPI_NOR_NO_FR) params.hwcaps.mask = ~SNOR_HWCAPS_READ_FAST;\t/* * Configure the SPI memory: * - select op codes for (Fast) Read, Page Program and Sector Erase. * - set the number of dummy cycles (mode cycles + wait states). * - set the SPI protocols for register and memory accesses. * - set the Quad Enable bit if needed (required by SPI x-y-4 protos). */\tret = spi_nor_setup(nor, info, params, hwcaps);\tif (ret) return ret;\tif (nor-addr_width) /* already configured from SFDP */ else if (info-addr_width) nor-addr_width = info-addr_width; else if (mtd-size 0x1000000) /* enable 4-byte addressing if the device exceeds 16MiB */ nor-addr_width = 4; if (JEDEC_MFR(info) == SNOR_MFR_SPANSION || info-flags SPI_NOR_4B_OPCODES) spi_nor_set_4byte_opcodes(nor, info); else set_4byte(nor, info, 1); else nor-addr_width = 3; if (nor-addr_width SPI_NOR_MAX_ADDR_WIDTH) dev_err(dev, address width is too large: %u , nor-addr_width); return -EINVAL; if (info-flags SPI_S3AN) ret = s3an_nor_scan(info, nor); if (ret) return ret; dev_info(dev, %s (%lld Kbytes) , info-name, (long long)mtd-size 10);\tdev_dbg(dev, mtd .name = %s, .size = 0x%llx (%lldMiB), .erasesize = 0x%.8x (%uKiB) .numeraseregions = %d , mtd-name, (long long)mtd-size, (long long)(mtd-size 20), mtd-erasesize, mtd-erasesize / 1024, mtd-numeraseregions);\tprintk(spi_nor_scan end );\tif (mtd-numeraseregions) for (i = 0; i mtd-numeraseregions; i++) dev_dbg(dev, mtd.eraseregions[%d] = .offset = 0x%llx, .erasesize = 0x%.8x (%uKiB), .numblocks = %d , i, (long long)mtd-eraseregions[i].offset, mtd-eraseregions[i].erasesize, mtd-eraseregions[i].erasesize / 1024, mtd-eraseregions[i].numblocks);\treturn 0;EXPORT_SYMBOL_GPL(spi_nor_scan); éœ€è¦é‡ç‚¹åˆ†æ å‡ ä¸ªé‡è¦çš„å‡½æ•°m25p80_read_regstatic int m25p80_read_reg(struct spi_nor *nor, u8 code, u8 *val, int len)\tstruct m25p *flash = nor-priv;\tstruct spi_device *spi = flash-spi;\tint ret;\tret = spi_write_then_read(spi, code, 1, val, len);\tif (ret 0) dev_err(spi-dev, error %d reading %x , ret, code);\treturn ret; m25p80_write_regstatic int m25p80_write_reg(struct spi_nor *nor, u8 opcode, u8 *buf, int len)\tstruct m25p *flash = nor-priv;\tstruct spi_device *spi = flash-spi;\tflash-command[0] = opcode;\tif (buf) memcpy(flash-command[1], buf, len);\treturn spi_write(spi, flash-command, len + 1); m25p80_writestatic ssize_t m25p80_write(struct spi_nor *nor, loff_t to, size_t len, const u_char *buf)\tstruct m25p *flash = nor-priv;\tstruct spi_device *spi = flash-spi;\tunsigned int inst_nbits, addr_nbits, data_nbits, data_idx;\tstruct spi_transfer t[3] = ;\tstruct spi_message m;\tint cmd_sz = m25p_cmdsz(nor);\tssize_t ret;\t/* get transfer protocols. */\tinst_nbits = spi_nor_get_protocol_inst_nbits(nor-write_proto);\taddr_nbits = spi_nor_get_protocol_addr_nbits(nor-write_proto);\tdata_nbits = spi_nor_get_protocol_data_nbits(nor-write_proto);\tspi_message_init(m);\tif (nor-program_opcode == SPINOR_OP_AAI_WP nor-sst_write_second) cmd_sz = 1;\tflash-command[0] = nor-program_opcode;\tm25p_addr2cmd(nor, to, flash-command);\tt[0].tx_buf = flash-command;\tt[0].tx_nbits = inst_nbits;\tt[0].len = cmd_sz;\tspi_message_add_tail(t[0], m);\t/* split the op code and address bytes into two transfers if needed. */\tdata_idx = 1;\tif (addr_nbits != inst_nbits) t[0].len = 1; t[1].tx_buf = flash-command[1]; t[1].tx_nbits = addr_nbits; t[1].len = cmd_sz - 1; spi_message_add_tail(t[1], m); data_idx = 2; t[data_idx].tx_buf = buf;\tt[data_idx].tx_nbits = data_nbits;\tt[data_idx].len = len;\tspi_message_add_tail(t[data_idx], m);\tret = spi_sync(spi, m);\tif (ret) return ret;\tret = m.actual_length - cmd_sz;\tif (ret 0) return -EIO;\treturn ret; m25p80_readstatic ssize_t m25p80_read(struct spi_nor *nor, loff_t from, size_t len, u_char *buf)\tstruct m25p *flash = nor-priv;\tstruct spi_device *spi = flash-spi;\tunsigned int inst_nbits, addr_nbits, data_nbits, data_idx;\tstruct spi_transfer t[3];\tstruct spi_message m;\tunsigned int dummy = nor-read_dummy;\tssize_t ret;\tint cmd_sz;\t/* get transfer protocols. */\tinst_nbits = spi_nor_get_protocol_inst_nbits(nor-read_proto);\taddr_nbits = spi_nor_get_protocol_addr_nbits(nor-read_proto);\tdata_nbits = spi_nor_get_protocol_data_nbits(nor-read_proto);\t/* convert the dummy cycles to the number of bytes */\tdummy = (dummy * addr_nbits) / 8;\tif (spi_flash_read_supported(spi)) struct spi_flash_read_message msg; memset(msg, 0, sizeof(msg)); msg.buf = buf; msg.from = from; msg.len = len; msg.read_opcode = nor-read_opcode; msg.addr_width = nor-addr_width; msg.dummy_bytes = dummy; msg.opcode_nbits = inst_nbits; msg.addr_nbits = addr_nbits; msg.data_nbits = data_nbits; ret = spi_flash_read(spi, msg); if (ret 0) return ret; return msg.retlen; spi_message_init(m);\tmemset(t, 0, sizeof(t));\tflash-command[0] = nor-read_opcode;\tm25p_addr2cmd(nor, from, flash-command);\tt[0].tx_buf = flash-command;\tt[0].tx_nbits = inst_nbits;\tt[0].len = m25p_cmdsz(nor) + dummy;\tspi_message_add_tail(t[0], m);\t/* * Set all dummy/mode cycle bits to avoid sending some manufacturer * specific pattern, which might make the memory enter its Continuous * Read mode by mistake. * Based on the different mode cycle bit patterns listed and described * in the JESD216B specification, the 0xff value works for all memories * and all manufacturers. */\tcmd_sz = t[0].len;\tmemset(flash-command + cmd_sz - dummy, 0xff, dummy);\t/* split the op code and address bytes into two transfers if needed. */\tdata_idx = 1;\tif (addr_nbits != inst_nbits) t[0].len = 1; t[1].tx_buf = flash-command[1]; t[1].tx_nbits = addr_nbits; t[1].len = cmd_sz - 1; spi_message_add_tail(t[1], m); data_idx = 2; t[data_idx].rx_buf = buf;\tt[data_idx].rx_nbits = data_nbits;\tt[data_idx].len = min3(len, spi_max_transfer_size(spi), spi_max_message_size(spi) - cmd_sz);\tspi_message_add_tail(t[data_idx], m);\tret = spi_sync(spi, m);\tif (ret) return ret;\tret = m.actual_length - cmd_sz;\tif (ret 0) return -EIO;\treturn ret;","tags":["linux","SPI","platform"],"categories":["é©±åŠ¨"]},{"title":"Linux sys è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿåˆ†æ","path":"/2025/08/18/sys class/","content":"Linux sys è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿåˆ†æç³»ç»Ÿä¸­æ‰€æœ‰çš„è®¾å¤‡ï¼ˆå¯¹è±¡ï¼‰éƒ½ä¼šåœ¨sysdevices ä½“ç°å‡ºæ¥ï¼Œæ˜¯ sysfs æ–‡ä»¶ç³»ç»Ÿä¸­æœ€é‡è¦çš„ç›®å½•ç»“æ„ï¼›è€Œ sysbusã€sysclassã€sysdev åˆ†åˆ«å°†è®¾å¤‡æŒ‰ç…§æŒ‚è½½çš„æ€»çº¿ç±»å‹ã€åŠŸèƒ½åˆ†ç±»ä»¥åŠè®¾å¤‡å·çš„å½¢å¼å°†è®¾å¤‡ç»„ç»‡å­˜æ”¾ åœ¨è¿™äº›ç›®å½•ä¸­ï¼Œè¿™äº›ç›®å½•ä¸‹çš„æ–‡ä»¶éƒ½æ˜¯é“¾æ¥åˆ°äº†sysdevices ä¸­ã€‚ åº”ç”¨å±‚æƒ³è¦å¯¹åº•å±‚ç¡¬ä»¶è¿›è¡Œæ“æ§ï¼Œé€šå¸¸å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼ï¼š âš« devç›®å½•ä¸‹çš„è®¾å¤‡æ–‡ä»¶ï¼ˆè®¾å¤‡èŠ‚ç‚¹ï¼‰ï¼› âš« sysç›®å½•ä¸‹è®¾å¤‡çš„å±æ€§æ–‡ä»¶ã€‚ ç³»ç»Ÿä¸­çš„æ‰€æœ‰è®¾å¤‡æ ¹æ®å…¶åŠŸèƒ½åˆ†ç±»ç»„ç»‡åˆ°äº†sysclass ç›®å½•ä¸‹ï¼Œæ‰€ä»¥sysclassleds ç›®å½•ä¸‹ä¾¿å­˜æ”¾äº†æ‰€æœ‰çš„ LED ç±»è®¾å¤‡ æœªå®Œâ€¦","tags":["linux","platform","sys"],"categories":["é©±åŠ¨"]},{"title":"ä»¥spi_deviceç»§æ‰¿spi_controlleråˆ†æç»§æ‰¿å’Œå…³è”çš„ä½¿ç”¨åŒºåˆ«","path":"/2025/08/18/ä»¥spi_deviceç»§æ‰¿spi_controlleråˆ†æç»§æ‰¿å’Œå…³è”çš„ä½¿ç”¨åŒºåˆ«/","content":"ä»¥spi_deviceç»§æ‰¿spi_controlleråˆ†æç»§æ‰¿å’Œå…³è”çš„ä½¿ç”¨åŒºåˆ«åŒºåˆ† â€œç»§æ‰¿â€ å’Œ â€œä»å±å…³è”â€è¦æ¸…æ™°åŒºåˆ† â€œç»§æ‰¿â€ å’Œ â€œä»å±å…³è”â€ï¼Œéœ€ä» æ ¸å¿ƒå®šä¹‰ã€å†…å­˜ç»“æ„ã€é€»è¾‘å…³ç³»ã€ä»£ç è¡¨ç° å››ä¸ªç»´åº¦åˆ‡å…¥ â€”â€” è¿™ä¸¤ä¸ªæ¦‚å¿µçš„æœ¬è´¨å·®å¼‚ï¼Œæ˜¯ â€œæ˜¯å¦å­˜åœ¨å±‚çº§å½’å±ä¸å±æ€§å¤ç”¨â€ï¼Œè€Œéç®€å•çš„ â€œå¼•ç”¨å…³ç³»â€ã€‚ ä¸€ã€æ ¸å¿ƒå®šä¹‰ï¼šæœ¬è´¨å·®å¼‚ æ¦‚å¿µ æ ¸å¿ƒé€»è¾‘ é€šä¿—ç±»æ¯” ç»§æ‰¿ï¼ˆInheritanceï¼‰ å­ç±»ï¼ˆæ´¾ç”Ÿç±»ï¼‰â€œis aâ€ï¼ˆæ˜¯ä¸€ç§ï¼‰çˆ¶ç±»ï¼ˆåŸºç±»ï¼‰ï¼Œç»§æ‰¿çˆ¶ç±»çš„æ‰€æœ‰å±æ€§å’Œè¡Œä¸ºï¼ŒåŒæ—¶å¯æ‰©å±•è‡ªèº«ç‰¹æ€§ã€‚ æ ¸å¿ƒæ˜¯ â€œå±‚çº§å½’å± + å±æ€§å¤ç”¨â€ã€‚ çŒ«ï¼ˆå­ç±»ï¼‰æ˜¯ä¸€ç§åŠ¨ç‰©ï¼ˆçˆ¶ç±»ï¼‰ï¼Œç»§æ‰¿ â€œå‘¼å¸ã€è¿›é£Ÿâ€ ç­‰åŠ¨ç‰©çš„é€šç”¨è¡Œä¸ºï¼ŒåŒæ—¶æœ‰ â€œæŠ“è€é¼ â€ çš„ç‰¹æœ‰è¡Œä¸ºã€‚ ä»å±å…³è”ï¼ˆDependencyAssociationï¼‰ A å¯¹è±¡ â€œdepends onâ€ï¼ˆä¾èµ– ä»å±ï¼‰B å¯¹è±¡ï¼ŒA éœ€å€ŸåŠ© B çš„èƒ½åŠ›å®Œæˆå·¥ä½œï¼Œä½† A ä¸ç»§æ‰¿ B çš„å±æ€§æˆ–è¡Œä¸ºï¼Œä¸¤è€…æ˜¯ç‹¬ç«‹çš„ä¸ªä½“ã€‚ æ ¸å¿ƒæ˜¯ â€œåŠŸèƒ½ä¾èµ– + ç‹¬ç«‹å­˜åœ¨â€ã€‚ å­¦ç”Ÿï¼ˆAï¼‰ä»å±ç­çº§ï¼ˆBï¼‰ï¼šå­¦ç”Ÿéœ€è¦ç­çº§æä¾›çš„ â€œä¸Šè¯¾ã€è€ƒå‹¤â€ åŠŸèƒ½ï¼Œä½†å­¦ç”Ÿä¸ç»§æ‰¿ç­çº§çš„ â€œç­çº§ç¼–å·ã€ç­ä¸»ä»»â€ ç­‰å±æ€§ï¼Œå­¦ç”Ÿå’Œç­çº§æ˜¯ç‹¬ç«‹çš„å®ä½“ã€‚ äºŒã€å››ä¸ªå…³é”®åŒºåˆ†ç»´åº¦1. å†…å­˜ç»“æ„ï¼šâ€œåŒ…å«â€ vs â€œå¼•ç”¨â€ç»§æ‰¿å’Œä»å±å…³è”åœ¨ä»£ç çš„å†…å­˜å¸ƒå±€ä¸Šæœ‰æœ¬è´¨ä¸åŒï¼Œè¿™æ˜¯æœ€ç¡¬æ ¸çš„åŒºåˆ†ä¾æ®ï¼š ï¼ˆ1ï¼‰ç»§æ‰¿ï¼šå­ç±»å†…å­˜åŒ…å«çˆ¶ç±»æˆå‘˜åœ¨ C è¯­è¨€ï¼ˆå†…æ ¸å¸¸ç”¨ï¼‰ä¸­ï¼Œç»§æ‰¿é€šè¿‡ â€œç»“æ„ä½“åµŒå¥—â€ å®ç° â€”â€”çˆ¶ç±»ç»“æ„ä½“ä½œä¸ºå­ç±»ç»“æ„ä½“çš„ç¬¬ä¸€ä¸ªæˆå‘˜ï¼Œå­ç±»å†…å­˜ä¸­ä¼šå®Œæ•´åŒ…å«çˆ¶ç±»çš„æ‰€æœ‰æˆå‘˜ï¼Œå¯ç›´æ¥è®¿é—®çˆ¶ç±»å±æ€§ã€‚ç¤ºä¾‹ï¼ˆå†…æ ¸è®¾å¤‡æ¨¡å‹çš„ç»§æ‰¿ï¼‰ï¼š // çˆ¶ç±»ï¼šé€šç”¨è®¾å¤‡åŸºç±»struct device const char *name; // é€šç”¨å±æ€§ï¼šè®¾å¤‡å struct device *parent; // é€šç”¨å±æ€§ï¼šçˆ¶è®¾å¤‡ // å…¶ä»–é€šç”¨æˆå‘˜...;// å­ç±»ï¼šSPIä»è®¾å¤‡ï¼ˆç»§æ‰¿ struct deviceï¼‰struct spi_device struct device dev; // ç¬¬ä¸€ä¸ªæˆå‘˜ = çˆ¶ç±»ï¼Œå†…å­˜ä¸ŠåŒ…å«çˆ¶ç±»æ‰€æœ‰æˆå‘˜ u32 max_speed_hz; // å­ç±»ç‰¹æœ‰å±æ€§ï¼šæœ€å¤§é€Ÿç‡ struct spi_controller *controller; // å…³è”æ§åˆ¶å™¨ï¼ˆéç»§æ‰¿ï¼‰ // å…¶ä»–å­ç±»ç‰¹æœ‰æˆå‘˜...; å†…å­˜å¸ƒå±€ï¼šspi_device çš„å†…å­˜èµ·å§‹åœ°å€ å…¶å†…éƒ¨ dev çš„åœ°å€ï¼Œå¯é€šè¿‡ spi_device æŒ‡é’ˆç›´æ¥è®¿é—® dev çš„æˆå‘˜ï¼ˆå¦‚ spi_dev-dev.nameï¼‰ã€‚ å†…æ ¸å® to_spi_device(dev) æœ¬è´¨ï¼šå°† struct device * æŒ‡é’ˆå¼ºåˆ¶è½¬æ¢ä¸º struct spi_device *ï¼Œä¾èµ– â€œçˆ¶ç±»æ˜¯å­ç±»ç¬¬ä¸€ä¸ªæˆå‘˜â€ çš„å†…å­˜å¸ƒå±€ â€”â€” è¿™æ˜¯ç»§æ‰¿çš„å…¸å‹ç‰¹å¾ã€‚ ï¼ˆ2ï¼‰ä»å±å…³è”ï¼šä»…é€šè¿‡æŒ‡é’ˆ â€œå¼•ç”¨â€ï¼Œä¸åŒ…å«å¯¹æ–¹æˆå‘˜ä»å±å…³è”ä¸­ï¼ŒA å¯¹è±¡ä»…æŒæœ‰ B å¯¹è±¡çš„æŒ‡é’ˆ å¥æŸ„ï¼Œå†…å­˜ä¸Šä¸åŒ…å« B çš„ä»»ä½•æˆå‘˜ï¼Œæ— æ³•ç›´æ¥è®¿é—® B çš„å±æ€§ï¼ˆéœ€é€šè¿‡æŒ‡é’ˆé—´æ¥è®¿é—®ï¼‰ã€‚ç¤ºä¾‹ï¼ˆspi_device ä¸ spi_controller çš„å…³è”ï¼‰ï¼š struct spi_device struct device dev; // ç»§æ‰¿çš„çˆ¶ç±» // ä»…æŒæœ‰æ§åˆ¶å™¨çš„æŒ‡é’ˆï¼Œä¸åŒ…å« spi_controller çš„ä»»ä½•æˆå‘˜ struct spi_controller *controller; ;struct spi_controller struct device dev; // è‡ªèº«ç»§æ‰¿çš„çˆ¶ç±» u16 num_chipselect; // æ§åˆ¶å™¨ç‰¹æœ‰å±æ€§ï¼šç‰‡é€‰æ•°é‡; å†…å­˜å¸ƒå±€ï¼šspi_device çš„ controller æŒ‡é’ˆä»…å­˜å‚¨ spi_controller çš„å†…å­˜åœ°å€ï¼Œspi_device å†…å­˜ä¸­æ²¡æœ‰ num_chipselect ç­‰æ§åˆ¶å™¨æˆå‘˜ã€‚ è®¿é—®æ§åˆ¶å™¨å±æ€§ï¼šå¿…é¡»é€šè¿‡æŒ‡é’ˆé—´æ¥è®¿é—®ï¼ˆå¦‚ spi_dev-controller-num_chipselectï¼‰ï¼Œè€Œéç›´æ¥è®¿é—® â€”â€” è¿™æ˜¯å…³è”çš„å…¸å‹ç‰¹å¾ã€‚ 2. é€»è¾‘å…³ç³»ï¼šâ€œæ˜¯ä¸€ç§â€ vs â€œä¾èµ–ä¸€ç§â€ï¼ˆ1ï¼‰ç»§æ‰¿ï¼šâ€œæ˜¯ä¸€ç§â€ï¼ˆis aï¼‰å­ç±»æ˜¯çˆ¶ç±»çš„ â€œç‰¹æ®ŠåŒ–â€ï¼Œå…·å¤‡çˆ¶ç±»çš„æ‰€æœ‰æœ¬è´¨ç‰¹å¾ï¼ŒåŒæ—¶å¢åŠ ç‰¹æœ‰ç‰¹å¾ã€‚ ä¾‹ 1ï¼šspi_device æ˜¯ä¸€ç§ struct deviceï¼ˆç¬¦åˆè®¾å¤‡æ¨¡å‹çš„é€šç”¨è®¾å¤‡ï¼‰ï¼Œspi_controller ä¹Ÿæ˜¯ä¸€ç§ struct deviceã€‚ ä¾‹ 2ï¼šâ€œå“ˆå£«å¥‡â€ æ˜¯ä¸€ç§ â€œç‹—â€ï¼Œâ€œç‹—â€ æ˜¯ä¸€ç§ â€œåŠ¨ç‰©â€â€”â€” å±‚çº§å½’å±æ˜ç¡®ã€‚ ï¼ˆ2ï¼‰ä»å±å…³è”ï¼šâ€œä¾èµ–ä¸€ç§â€ï¼ˆdepends onï¼‰A å¯¹è±¡éœ€è¦ B å¯¹è±¡çš„èƒ½åŠ›æ‰èƒ½å·¥ä½œï¼Œä½† A ä¸æ˜¯ B çš„ â€œç‰¹æ®ŠåŒ–â€ï¼Œä¸¤è€…æ˜¯ç‹¬ç«‹çš„é€»è¾‘å®ä½“ã€‚ ä¾‹ 1ï¼šspi_device ä¾èµ– spi_controller çš„ â€œä¼ è¾“æ•°æ®â€ èƒ½åŠ›ï¼Œä½† spi_device ä¸æ˜¯ â€œä¸€ç§â€spi_controllerï¼ˆä»è®¾å¤‡æ˜¯è¢«ç®¡ç†è€…ï¼Œæ§åˆ¶å™¨æ˜¯ç®¡ç†è€…ï¼Œè§’è‰²å®Œå…¨ä¸åŒï¼‰ã€‚ ä¾‹ 2ï¼šâ€œæ‰‹æœºâ€ ä¾èµ– â€œåŸºç«™â€ çš„ â€œä¿¡å·ä¼ è¾“â€ èƒ½åŠ›ï¼Œä½†æ‰‹æœºä¸æ˜¯ â€œä¸€ç§â€ åŸºç«™ã€‚ 3. å±æ€§ä¸è¡Œä¸ºï¼šâ€œå¤ç”¨â€ vs â€œéš”ç¦»â€ï¼ˆ1ï¼‰ç»§æ‰¿ï¼šå­ç±»å¤ç”¨çˆ¶ç±»çš„å±æ€§å’Œè¡Œä¸ºçˆ¶ç±»çš„å±æ€§ï¼ˆå¦‚ struct device çš„ nameï¼‰å’Œè¡Œä¸ºï¼ˆå¦‚å†…æ ¸æä¾›çš„ device_add æ³¨å†Œå‡½æ•°ï¼‰ï¼Œå­ç±»å¯ç›´æ¥å¤ç”¨ï¼Œæ— éœ€é‡å¤å®šä¹‰ã€‚ ä¾‹ï¼šspi_device å’Œ spi_controller éƒ½æ— éœ€è‡ªå·±å®ç° â€œè®¾å¤‡æ³¨å†Œâ€ é€»è¾‘ï¼Œç›´æ¥å¤ç”¨ device_add å‡½æ•°ï¼ˆé€šè¿‡ dev æˆå‘˜ï¼‰ã€‚ ï¼ˆ2ï¼‰ä»å±å…³è”ï¼šå±æ€§å’Œè¡Œä¸ºå®Œå…¨éš”ç¦»A å¯¹è±¡å’Œ B å¯¹è±¡çš„å±æ€§ã€è¡Œä¸ºäº’ä¸å¤ç”¨ï¼Œå„è‡ªæœ‰ç‹¬ç«‹çš„å®šä¹‰ã€‚ ä¾‹ï¼šspi_device çš„ max_speed_hzï¼ˆä»è®¾å¤‡é€Ÿç‡ï¼‰ä¸ spi_controller çš„ max_speed_hzï¼ˆæ§åˆ¶å™¨æœ€å¤§é€Ÿç‡ï¼‰æ˜¯å®Œå…¨ç‹¬ç«‹çš„å±æ€§ï¼Œå‰è€…å—åè€…çº¦æŸï¼Œä½†ä¸å¤ç”¨åè€…çš„å€¼ã€‚ ä¾‹ï¼šspi_controller çš„ transfer_oneï¼ˆä¼ è¾“å‡½æ•°ï¼‰æ˜¯æ§åˆ¶å™¨çš„è¡Œä¸ºï¼Œspi_device æ— æ³•å¤ç”¨ï¼Œåªèƒ½é€šè¿‡ controller-transfer_one è°ƒç”¨è¯¥è¡Œä¸ºã€‚ 4. ç”Ÿå‘½å‘¨æœŸï¼šâ€œç»‘å®šâ€ vs â€œç‹¬ç«‹â€ï¼ˆ1ï¼‰ç»§æ‰¿ï¼šå­ç±»ä¸çˆ¶ç±»ç”Ÿå‘½å‘¨æœŸç»‘å®šå­ç±»çš„ç”Ÿå‘½å‘¨æœŸä¸çˆ¶ç±»å®Œå…¨ä¸€è‡´ â€”â€” åˆ›å»ºå­ç±»æ—¶ï¼Œçˆ¶ç±»æˆå‘˜ä¼šåŒæ—¶åˆå§‹åŒ–ï¼›é”€æ¯å­ç±»æ—¶ï¼Œçˆ¶ç±»æˆå‘˜ä¹Ÿä¼šåŒæ—¶é‡Šæ”¾ã€‚ ä¾‹ï¼šåˆ›å»º spi_device æ—¶ï¼Œå…¶å†…éƒ¨çš„ struct device dev ä¼šè¢«ä¸€èµ·åˆå§‹åŒ–ï¼›é”€æ¯ spi_device æ—¶ï¼Œdev ä¹Ÿä¼šè¢« device_del æ¸…ç†ã€‚ ï¼ˆ2ï¼‰ä»å±å…³è”ï¼šç”Ÿå‘½å‘¨æœŸç‹¬ç«‹A å¯¹è±¡å’Œ B å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå¯ç‹¬ç«‹å­˜åœ¨ï¼Œäº’ä¸å½±å“ã€‚ ä¾‹ 1ï¼šspi_controller å…ˆæ³¨å†Œï¼ˆç”Ÿå‘½å‘¨æœŸå¼€å§‹ï¼‰ï¼Œä¹‹å spi_device å†æ³¨å†Œï¼ˆä¾èµ–å·²å­˜åœ¨çš„æ§åˆ¶å™¨ï¼‰ï¼›spi_device å¯å…ˆæ³¨é”€ï¼ˆç”Ÿå‘½å‘¨æœŸç»“æŸï¼‰ï¼Œæ§åˆ¶å™¨ä»å¯ç»§ç»­ç®¡ç†å…¶ä»–ä»è®¾å¤‡ã€‚ ä¾‹ 2ï¼šâ€œå­¦ç”Ÿâ€ æ¯•ä¸šï¼ˆç”Ÿå‘½å‘¨æœŸç»“æŸï¼‰ï¼Œâ€œç­çº§â€ ä»å¯å­˜åœ¨ï¼ˆç»§ç»­æ‹›æ”¶æ–°å­¦ç”Ÿï¼‰ã€‚ ä¸‰ã€æ€»ç»“ï¼šä¸€å¥è¯åŒºåˆ† ç»§æ‰¿ï¼šå­ç±»æ˜¯çˆ¶ç±»çš„ â€œä¸€ç§â€ï¼Œå†…å­˜åŒ…å«çˆ¶ç±»æˆå‘˜ï¼Œå¤ç”¨çˆ¶ç±»å±æ€§å’Œè¡Œä¸ºï¼Œç”Ÿå‘½å‘¨æœŸç»‘å®šï¼ˆå¦‚ spi_device â† struct deviceï¼‰ã€‚ ä»å±å…³è”ï¼šA ä¾èµ– B çš„èƒ½åŠ›ï¼Œå†…å­˜ä»…æŒæœ‰ B çš„æŒ‡é’ˆï¼Œå±æ€§è¡Œä¸ºå®Œå…¨éš”ç¦»ï¼Œç”Ÿå‘½å‘¨æœŸç‹¬ç«‹ï¼ˆå¦‚ spi_device â†’ spi_controllerï¼‰ã€‚ å›åˆ°ä½ æœ€åˆçš„ç–‘é—®ï¼šspi_device æ²¡æœ‰ç»§æ‰¿ spi_controllerï¼Œè€Œæ˜¯é€šè¿‡æŒ‡é’ˆ â€œä»å±å…³è”â€ åˆ° spi_controllerï¼›ä¸¤è€…çœŸæ­£çš„ç»§æ‰¿å…³ç³»ï¼Œæ˜¯éƒ½ç»§æ‰¿è‡ªå†…æ ¸çš„ struct deviceï¼ˆé€šç”¨è®¾å¤‡åŸºç±»ï¼‰ã€‚ åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œå¦‚ä½•åˆ¤æ–­åº”è¯¥ä½¿ç”¨ç»§æ‰¿è¿˜æ˜¯ä»å±å…³è”ï¼Ÿåœ¨å®é™…ç¼–ç¨‹ï¼ˆå°¤å…¶æ˜¯é©±åŠ¨å¼€å‘ã€æ¡†æ¶è®¾è®¡ç­‰åœºæ™¯ï¼‰ä¸­ï¼Œåˆ¤æ–­ä½¿ç”¨ç»§æ‰¿è¿˜æ˜¯ä»å±å…³è”ï¼Œæ ¸å¿ƒæ˜¯å›´ç»• â€œé€»è¾‘å…³ç³»â€â€œå¤ç”¨éœ€æ±‚â€â€œç”Ÿå‘½å‘¨æœŸâ€â€œè€¦åˆåº¦â€ å››ä¸ªç»´åº¦åšå†³ç­–ï¼Œå¯æŒ‰ä»¥ä¸‹æ­¥éª¤é€æ­¥åˆ¤æ–­ï¼Œç»“åˆå…·ä½“åœºæ™¯è½åœ°ã€‚ ä¸€ã€ç¬¬ä¸€æ­¥ï¼šå…ˆåˆ¤æ–­æ ¸å¿ƒé€»è¾‘å…³ç³» â€”â€”â€œis aâ€ è¿˜æ˜¯ â€œhas adepends onâ€è¿™æ˜¯æœ€æ ¹æœ¬çš„åˆ¤æ–­æ ‡å‡†ï¼Œç›´æ¥å†³å®šä¸¤ç§è®¾è®¡çš„é€‚ç”¨åœºæ™¯ï¼š 1. è‹¥æ»¡è¶³ â€œis aâ€ï¼ˆA æ˜¯ B çš„ä¸€ç§ï¼‰â†’ ä¼˜å…ˆç”¨ç»§æ‰¿å½“ A å®ä½“æœ¬è´¨ä¸Šæ˜¯ B å®ä½“çš„ç‰¹æ®ŠåŒ–ç‰ˆæœ¬ï¼Œå…·å¤‡ B çš„æ‰€æœ‰æ ¸å¿ƒç‰¹å¾ï¼Œä¸”éœ€è¦åœ¨æ­¤åŸºç¡€ä¸Šæ‰©å±•ç‰¹æœ‰å±æ€§ è¡Œä¸ºæ—¶ï¼Œç”¨ç»§æ‰¿ã€‚åˆ¤æ–­é—®é¢˜ï¼šèƒ½å¦ç”¨ â€œXX æ˜¯ä¸€ç§ XXâ€ æè¿°ä¸¤è€…å…³ç³»ï¼Ÿèƒ½åˆ™é€‰ç»§æ‰¿ã€‚ å…¸å‹åœºæ™¯ç¤ºä¾‹ï¼š å†…æ ¸è®¾å¤‡æ¨¡å‹ï¼šspi_device æ˜¯ä¸€ç§ struct deviceï¼ˆç¬¦åˆé€šç”¨è®¾å¤‡çš„æ‰€æœ‰ç‰¹å¾ï¼šæœ‰åç§°ã€èƒ½åŒ¹é…é©±åŠ¨ã€æ”¯æŒç”µæºç®¡ç†ï¼‰ï¼Œå› æ­¤ spi_device ç»§æ‰¿ struct deviceã€‚ é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼šDog æ˜¯ä¸€ç§ Animalï¼ˆæœ‰å‘¼å¸ã€è¿›é£Ÿç­‰é€šç”¨è¡Œä¸ºï¼Œæ‰©å±• â€œæ±ªæ±ªå«â€ ç‰¹æœ‰è¡Œä¸ºï¼‰ï¼Œå› æ­¤ Dog ç»§æ‰¿ Animalã€‚ é©±åŠ¨å¼€å‘ï¼ši2c_clientï¼ˆI2C ä»è®¾å¤‡ï¼‰æ˜¯ä¸€ç§ struct deviceï¼Œå› æ­¤ç»§æ‰¿ struct deviceã€‚ 2. è‹¥æ»¡è¶³ â€œhas aâ€ï¼ˆA åŒ…å« ä¾èµ– B çš„èƒ½åŠ›ï¼‰â†’ ä¼˜å…ˆç”¨ä»å±å…³è”å½“ A å®ä½“éœ€è¦ å€ŸåŠ© B å®ä½“çš„èƒ½åŠ›å®Œæˆå·¥ä½œï¼Œä½† A ä¸æ˜¯ B çš„ â€œç‰¹æ®ŠåŒ–ç‰ˆæœ¬â€ï¼Œä¸¤è€…æ˜¯ç‹¬ç«‹ä¸ªä½“æ—¶ï¼Œç”¨ä»å±å…³è”ã€‚åˆ¤æ–­é—®é¢˜ï¼šèƒ½å¦ç”¨ â€œXX éœ€è¦ XX çš„å¸®åŠ©æ‰èƒ½å·¥ä½œâ€ æˆ– â€œXX åŒ…å« XX çš„å¼•ç”¨â€ æè¿°ï¼Ÿèƒ½åˆ™é€‰å…³è”ã€‚ å…¸å‹åœºæ™¯ç¤ºä¾‹ï¼š SPI å­ç³»ç»Ÿï¼šspi_device éœ€è¦ spi_controller çš„ â€œæ•°æ®ä¼ è¾“èƒ½åŠ›â€ æ‰èƒ½æ”¶å‘æ•°æ®ï¼Œä½† spi_device ä¸æ˜¯ â€œä¸€ç§â€spi_controllerï¼ˆè§’è‰²æ˜¯ â€œè¢«ç®¡ç†è€…â€ vs â€œç®¡ç†è€…â€ï¼‰ï¼Œå› æ­¤ç”¨æŒ‡é’ˆå…³è”ï¼ˆspi_controller *controllerï¼‰ã€‚ ç¡¬ä»¶é©±åŠ¨ï¼šâ€œLED è®¾å¤‡â€ éœ€è¦ â€œGPIO æ§åˆ¶å™¨â€ çš„ â€œå¼•è„šæ§åˆ¶èƒ½åŠ›â€ æ‰èƒ½äº®ç­ï¼Œä½† LED ä¸æ˜¯ â€œä¸€ç§â€ GPIO æ§åˆ¶å™¨ï¼Œå› æ­¤ç”¨ struct gpio_desc *gpio å…³è” GPIO å¼•è„šã€‚ åº”ç”¨å¼€å‘ï¼šâ€œæ’­æ”¾å™¨â€ éœ€è¦ â€œéŸ³é¢‘è§£ç å™¨â€ çš„ â€œè§£ç èƒ½åŠ›â€ æ‰èƒ½æ’­æ”¾éŸ³ä¹ï¼Œä½†æ’­æ”¾å™¨ä¸æ˜¯ â€œä¸€ç§â€ è§£ç å™¨ï¼Œå› æ­¤ç”¨æŒ‡é’ˆå…³è”è§£ç å™¨å®ä¾‹ã€‚ äºŒã€ç¬¬äºŒæ­¥ï¼šåˆ¤æ–­å±æ€§ è¡Œä¸ºçš„å¤ç”¨éœ€æ±‚è‹¥ç¬¬ä¸€æ­¥çš„é€»è¾‘å…³ç³»ä¸æ˜ç¡®ï¼Œå¯é€šè¿‡ â€œæ˜¯å¦éœ€è¦å¤ç”¨å±æ€§ è¡Œä¸ºâ€ è¿›ä¸€æ­¥åˆ¤æ–­ï¼š 1. éœ€è¦å¤ç”¨å±æ€§ è¡Œä¸º â†’ ç”¨ç»§æ‰¿ç»§æ‰¿çš„æ ¸å¿ƒä»·å€¼æ˜¯é¿å…é‡å¤ä»£ç ï¼šçˆ¶ç±»çš„å±æ€§ï¼ˆå¦‚ struct device çš„ nameã€parentï¼‰å’Œè¡Œä¸ºï¼ˆå¦‚å†…æ ¸æä¾›çš„ device_add æ³¨å†Œå‡½æ•°ï¼‰ï¼Œå­ç±»å¯ç›´æ¥å¤ç”¨ï¼Œæ— éœ€é‡æ–°å®šä¹‰ã€‚åä¾‹ï¼šè‹¥ spi_device ä¸ç»§æ‰¿ struct deviceï¼Œåˆ™éœ€è¦è‡ªå·±å®ç°è®¾å¤‡å‘½åã€é©±åŠ¨åŒ¹é…ã€ç”µæºç®¡ç†ç­‰é€»è¾‘ï¼Œå¯¼è‡´ä»£ç å†—ä½™ï¼ˆI2Cã€USB ç­‰å…¶ä»–æ€»çº¿è®¾å¤‡ä¹Ÿéœ€é‡å¤å®ç°ï¼‰ã€‚ 2. ä»…éœ€è°ƒç”¨åŠŸèƒ½ï¼Œæ— éœ€å¤ç”¨å±æ€§ â†’ ç”¨ä»å±å…³è”ä»å±å…³è”ä¸­ï¼ŒA ä»…éœ€è°ƒç”¨ B çš„ç‰¹å®šæ¥å£ï¼ˆå¦‚ spi_controller-transfer_oneï¼‰ï¼Œæ— éœ€å¤ç”¨ B çš„å±æ€§ï¼ˆå¦‚ num_chipselectï¼‰ï¼Œæ­¤æ—¶ç”¨æŒ‡é’ˆå…³è”å³å¯ï¼Œé¿å…ä¸å¿…è¦çš„å±æ€§æš´éœ²ã€‚åä¾‹ï¼šè‹¥ spi_device ç»§æ‰¿ spi_controllerï¼Œåˆ™ä¼šè¢«è¿«åŒ…å« num_chipselectã€dma_tx ç­‰ä¸ä»è®¾å¤‡æ— å…³çš„å±æ€§ï¼Œé€ æˆå†…å­˜æµªè´¹å’Œé€»è¾‘æ··ä¹±ã€‚ ä¸‰ã€ç¬¬ä¸‰æ­¥ï¼šåˆ¤æ–­ç”Ÿå‘½å‘¨æœŸæ˜¯å¦ç»‘å®šä¸¤ç§è®¾è®¡çš„ç”Ÿå‘½å‘¨æœŸå…³ç³»ä¸åŒï¼Œç›´æ¥å½±å“èµ„æºç®¡ç†çš„å®‰å…¨æ€§ï¼š 1. ç”Ÿå‘½å‘¨æœŸå¿…é¡»ç»‘å®šï¼ˆåŒç”Ÿå…±æ­»ï¼‰â†’ ç”¨ç»§æ‰¿ç»§æ‰¿ä¸­ï¼Œå­ç±»çš„ç”Ÿå‘½å‘¨æœŸä¸çˆ¶ç±»å®Œå…¨ç»‘å®šï¼šåˆ›å»ºå­ç±»æ—¶ï¼Œçˆ¶ç±»æˆå‘˜ä¼šåŒæ­¥åˆå§‹åŒ–ï¼›é”€æ¯å­ç±»æ—¶ï¼Œçˆ¶ç±»æˆå‘˜ä¹Ÿä¼šåŒæ­¥é‡Šæ”¾ï¼Œæ— éœ€å•ç‹¬ç®¡ç†çˆ¶ç±»èµ„æºã€‚ç¤ºä¾‹ï¼šåˆ›å»º spi_device æ—¶ï¼Œå…¶å†…éƒ¨çš„ struct device dev ä¼šé€šè¿‡ device_initialize åˆå§‹åŒ–ï¼›é”€æ¯ spi_device æ—¶ï¼Œdev ä¼šé€šè¿‡ device_del è‡ªåŠ¨æ¸…ç†ï¼Œæ— éœ€å•ç‹¬å¤„ç† dev çš„ç”Ÿå‘½å‘¨æœŸã€‚ 2. ç”Ÿå‘½å‘¨æœŸç‹¬ç«‹ï¼ˆå¯åˆ†åˆ«åˆ›å»º é”€æ¯ï¼‰â†’ ç”¨ä»å±å…³è”ä»å±å…³è”ä¸­ï¼ŒA å’Œ B çš„ç”Ÿå‘½å‘¨æœŸç›¸äº’ç‹¬ç«‹ï¼šB å¯å…ˆäº A åˆ›å»ºï¼ˆå¦‚ spi_controller å…ˆæ³¨å†Œï¼Œspi_device åæ³¨å†Œï¼‰ï¼ŒA å¯å…ˆäº B é”€æ¯ï¼ˆå¦‚ spi_device æ³¨é”€åï¼Œspi_controller ä»ç®¡ç†å…¶ä»–è®¾å¤‡ï¼‰ã€‚ç¤ºä¾‹ï¼šspi_controller æ³¨å†Œåï¼Œå¯åŠ¨æ€æ·»åŠ  åˆ é™¤å¤šä¸ª spi_deviceï¼›å³ä½¿æ‰€æœ‰ spi_device éƒ½æ³¨é”€ï¼Œspi_controller ä»å¯ä¿ç•™ï¼ˆé™¤éä¸»åŠ¨å¸è½½æ§åˆ¶å™¨é©±åŠ¨ï¼‰ã€‚ å››ã€ç¬¬å››æ­¥ï¼šè€ƒè™‘è€¦åˆåº¦éœ€æ±‚ï¼ˆæ¾è€¦åˆä¼˜å…ˆï¼‰ç»§æ‰¿ä¼šå¯¼è‡´å¼ºè€¦åˆï¼ˆå­ç±»ä¾èµ–çˆ¶ç±»çš„å®ç°ç»†èŠ‚ï¼‰ï¼Œå…³è”åˆ™æ˜¯æ¾è€¦åˆï¼ˆä»…ä¾èµ–æ¥å£ï¼Œä¸ä¾èµ–å®ç°ï¼‰ï¼Œå®é™…ç¼–ç¨‹ä¸­åº”ä¼˜å…ˆé€‰æ‹©æ¾è€¦åˆè®¾è®¡ï¼Œé™¤éç»§æ‰¿çš„æ”¶ç›Šï¼ˆå¤ç”¨ã€é€»è¾‘æ¸…æ™°ï¼‰è¿œå¤§äºè€¦åˆæˆæœ¬ã€‚ 1. éœ€é™ä½è€¦åˆï¼ˆä¾¿äºæ‰©å±• ç»´æŠ¤ï¼‰â†’ ä¼˜å…ˆå…³è”è‹¥ B çš„å®ç°å¯èƒ½å˜åŒ–ï¼ˆå¦‚æ›´æ¢ä¸åŒå‚å•†çš„ SPI æ§åˆ¶å™¨ï¼‰ï¼ŒA åªéœ€é€‚é… B çš„æ¥å£ï¼ˆå¦‚ transfer_one å‡½æ•°ï¼‰ï¼Œæ— éœ€ä¿®æ”¹ A çš„ä»£ç ï¼Œæ­¤æ—¶å…³è”æ›´åˆé€‚ã€‚ç¤ºä¾‹ï¼šæ›´æ¢ SPI æ§åˆ¶å™¨é©±åŠ¨æ—¶ï¼Œspi_device æ— éœ€ä¿®æ”¹ï¼ˆåªéœ€ç¡®ä¿æ–°æ§åˆ¶å™¨å®ç° transfer_one æ¥å£ï¼‰ï¼Œå› ä¸º spi_device ä»…é€šè¿‡æŒ‡é’ˆè°ƒç”¨æ¥å£ï¼Œä¸ä¾èµ–æ§åˆ¶å™¨çš„å†…éƒ¨å®ç°ã€‚ 2. éœ€ç»Ÿä¸€è§„èŒƒï¼ˆä¸å…è®¸çµæ´»ä¿®æ”¹ï¼‰â†’ ç”¨ç»§æ‰¿è‹¥éœ€è¦å¼ºåˆ¶æ‰€æœ‰å­ç±»éµå¾ªç»Ÿä¸€çš„æ¥å£æˆ–å±æ€§ï¼ˆå¦‚å†…æ ¸è®¾å¤‡æ¨¡å‹è¦æ±‚æ‰€æœ‰è®¾å¤‡å¿…é¡»æœ‰ struct device æˆå‘˜ï¼‰ï¼Œåˆ™ç”¨ç»§æ‰¿ï¼Œç¡®ä¿è§„èŒƒä¸è¢«æ‰“ç ´ã€‚ç¤ºä¾‹ï¼šå†…æ ¸æ‰€æœ‰ç¡¬ä»¶è®¾å¤‡ï¼ˆSPIã€I2Cã€PCI ç­‰ï¼‰éƒ½å¿…é¡»ç»§æ‰¿ struct deviceï¼Œä»¥ä¿è¯ç”µæºç®¡ç†ã€sysfs æ¥å£ç­‰åŠŸèƒ½çš„ç»Ÿä¸€æ€§ï¼Œä¸å…è®¸é€šè¿‡å…³è”ç»•è¿‡è¿™ä¸€è§„èŒƒã€‚ äº”ã€æ€»ç»“ï¼šå†³ç­–æµç¨‹å›¾ï¼ˆå®é™…ç¼–ç¨‹å¯æŒ‰æ­¤æ­¥éª¤ï¼‰â€‹ A[â€œåˆ¤æ–­ä¸¤ä¸ªå®ä½“å…³ç³»â€] â€“ B{æ˜¯å¦æ»¡è¶³â€œis aâ€ï¼Ÿ} graph TD A[åˆ¤æ–­ä¸¤ä¸ªå®ä½“å…³ç³»] -- Bæ˜¯å¦æ»¡è¶³is aå…³ç³» B --|æ˜¯| C[ç”¨ç»§æ‰¿,å¤ç”¨å±æ€§/è¡Œä¸º,ç”Ÿå‘½å‘¨æœŸç»‘å®š] B --|å¦| Dæ˜¯å¦ä»…éœ€è°ƒç”¨å¯¹æ–¹åŠŸèƒ½,æ— éœ€å¤ç”¨å±æ€§? D --|æ˜¯| E[ç”¨ä»å±å…³è”,æŒ‡é’ˆå¼•ç”¨,æ¾è€¦åˆ,ç”Ÿå‘½å‘¨æœŸç‹¬ç«‹] D --|å¦| F[é‡æ–°å®¡è§†é€»è¾‘å…³ç³»æ˜¯å¦è¯¯åˆ¤is a?] F --|ç¡®è®¤ä¸æ˜¯is a| E F --|ç¡®è®¤æ˜¯is a| C å…³é”®ç»“è®º ç»§æ‰¿ï¼šé€‚ç”¨äº â€œXX æ˜¯ä¸€ç§ XXâ€ã€éœ€å¤ç”¨å±æ€§ è¡Œä¸ºã€ç”Ÿå‘½å‘¨æœŸç»‘å®šã€éœ€ç»Ÿä¸€è§„èŒƒçš„åœºæ™¯ï¼ˆå¦‚å†…æ ¸è®¾å¤‡æ¨¡å‹ã€ç±»çš„ç‰¹æ®ŠåŒ–ï¼‰ã€‚ ä»å±å…³è”ï¼šé€‚ç”¨äº â€œXX ä¾èµ– XX çš„èƒ½åŠ›â€ã€ä»…éœ€è°ƒç”¨æ¥å£ã€ç”Ÿå‘½å‘¨æœŸç‹¬ç«‹ã€éœ€é™ä½è€¦åˆçš„åœºæ™¯ï¼ˆå¦‚è®¾å¤‡ä¸æ§åˆ¶å™¨çš„å…³ç³»ã€æ¨¡å—é—´çš„åŠŸèƒ½è°ƒç”¨ï¼‰ã€‚ å›åˆ°ä¹‹å‰çš„ SPI ä¾‹å­ï¼š spi_device ç»§æ‰¿ struct deviceï¼šå› ä¸º â€œspi_device æ˜¯ä¸€ç§è®¾å¤‡â€ï¼Œéœ€å¤ç”¨è®¾å¤‡å‘½åã€ç”µæºç®¡ç†ç­‰åŠŸèƒ½ï¼Œç”Ÿå‘½å‘¨æœŸç»‘å®šã€‚ spi_device å…³è” spi_controllerï¼šå› ä¸º â€œspi_device ä¾èµ–æ§åˆ¶å™¨çš„ä¼ è¾“èƒ½åŠ›â€ï¼Œä»…éœ€è°ƒç”¨æ¥å£ï¼Œç”Ÿå‘½å‘¨æœŸç‹¬ç«‹ï¼Œéœ€é™ä½è€¦åˆã€‚ ä¼˜ç‚¹ æ¸…æ™°çš„é€»è¾‘å±‚çº§ï¼Œé™ä½ç†è§£æˆæœ¬ç»§æ‰¿ç›´æ¥ä½“ç° â€œis aâ€ çš„è¯­ä¹‰å…³ç³»ï¼Œå­ç±»ä¸åŸºç±»çš„å±‚çº§æ˜ç¡®ï¼Œä»£ç é˜…è¯»è€…å¯å¿«é€Ÿç†è§£å®ä½“é—´çš„é€»è¾‘å½’å±ï¼Œæ— éœ€é¢å¤–æ–‡æ¡£è¯´æ˜ã€‚ ç¤ºä¾‹ï¼šçœ‹åˆ° struct spi_device åµŒå¥— struct deviceï¼Œå¯ç«‹åˆ»åˆ¤æ–­ â€œSPI ä»è®¾å¤‡æ˜¯ä¸€ç§å†…æ ¸é€šç”¨è®¾å¤‡â€ï¼›çœ‹åˆ° struct spi_controller ä¹ŸåµŒå¥— struct deviceï¼Œå¯åˆ¤æ–­ â€œSPI æ§åˆ¶å™¨ä¹Ÿæ˜¯ä¸€ç§é€šç”¨è®¾å¤‡â€â€”â€” è¿™ç§å±‚çº§å…³ç³»æ¯”é€šè¿‡æŒ‡é’ˆå…³è”æ›´ç›´è§‚ã€‚ æ”¶ç›Šï¼šæå‡ä»£ç å¯è¯»æ€§ï¼Œé™ä½å›¢é˜Ÿåä½œä¸­çš„è®¤çŸ¥æˆæœ¬ã€‚ ä¼˜ç‚¹ ç»Ÿä¸€æ¥å£ä¸æ¡†æ¶åŒ–ç®¡ç†åŸºç±»å¯å®šä¹‰ é€šç”¨æ“ä½œè§„èŒƒï¼Œæ‰€æœ‰å­ç±»éµå¾ªåŒä¸€æ¥å£ï¼Œä¾¿äºæ¡†æ¶ç»Ÿä¸€ç®¡ç†ä¸åŒç±»å‹çš„å­ç±»ï¼Œå®ç° â€œå¤šæ€â€ æ•ˆæœï¼ˆC ä¸­é€šè¿‡å‡½æ•°æŒ‡é’ˆå’ŒåŸºç±»æ¥å£é—´æ¥å®ç°ï¼‰ã€‚ ç¤ºä¾‹ï¼šå†…æ ¸è®¾å¤‡æ¨¡å‹é€šè¿‡ struct device å®šä¹‰äº†ç»Ÿä¸€çš„è®¾å¤‡ç”Ÿå‘½å‘¨æœŸæ¥å£ï¼ˆprobeã€removeã€suspendã€resumeï¼‰ã€‚æ— è®ºå­ç±»æ˜¯ spi_device è¿˜æ˜¯ i2c_clientï¼Œæ¡†æ¶éƒ½èƒ½é€šè¿‡ struct device * æŒ‡é’ˆè°ƒç”¨é€šç”¨æ¥å£ï¼ˆå¦‚ dev_pm_domain_attach(dev)ï¼‰ï¼Œæ— éœ€åŒºåˆ†è®¾å¤‡ç±»å‹ â€”â€” è¿™æ˜¯å†…æ ¸èƒ½ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ç¡¬ä»¶è®¾å¤‡çš„å…³é”®ã€‚ æ”¶ç›Šï¼šç®€åŒ–æ¡†æ¶è®¾è®¡ï¼Œæ”¯æŒ â€œæ–°å¢å­ç±»æ— éœ€ä¿®æ”¹æ¡†æ¶â€ï¼ˆå¦‚æ–°å¢ä¸€ç§æ€»çº¿è®¾å¤‡ï¼Œåªéœ€åµŒå¥— struct device å³å¯èå…¥ç°æœ‰æ¨¡å‹ï¼‰ã€‚","tags":["linux","SPI","platform"],"categories":["é©±åŠ¨"]},{"title":"LVGLç§»æ¤åˆ°IMX6ULLç¬”è®°","path":"/2024/12/20/LVGLç§»æ¤åˆ°IMX6ULL/","content":"LVGLç§»æ¤åˆ°IMX6ULLç¬”è®°æ‰€éœ€åº“æ–‡ä»¶åŠç‰ˆæœ¬é—®é¢˜æ‰€éœ€åº“æ–‡ä»¶åŠç‰ˆæœ¬å¦‚ä¸‹ï¼š åº“æ–‡ä»¶ ç‰ˆæœ¬ ä»“åº“åœ°å€ æè¿° lv_port_linux_frame_buffer releasev8.2 https://github.com/lvgl/lv_port_linux.git é€‚é…æœ‰frame bufferçš„linuxç³»ç»Ÿçš„æ¥å£ lv_drivers releasev8.2(49c4b17) https://github.com/lvgl/lv_drivers.git åŒ…å«äº†é©±åŠ¨LVGLå›¾å½¢ç•Œé¢çš„é©±åŠ¨æ¥å£æºä»£ç  lvgl releasev8.2.0(0b5a1d4) https://github.com/lvgl/lvgl.git LVGLå›¾å½¢åº“æºä»£ç ,åŒ…å«æ‰€éœ€demo æ³¨æ„ä¸€å®šè¦ç‰ˆæœ¬å¯¹åº”ï¼Œä¸ç„¶ä¼šå‡ºç°å„ç§ç¨€å¥‡å¤æ€ªçš„é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•ä¸‹è½½ç‰¹å®šç‰ˆæœ¬ï¼š é€‰æ‹©å¯¹åº”ç‰ˆæœ¬åï¼Œé€‰æ‹©Download ZIP ä½¿ç”¨gitå‘½ä»¤å…‹éš†ç‰¹å®šç‰ˆæœ¬ å…ˆgitæ•´ä¸ªä»“åº“ git clone https://github.com/lvgl/lvgl.git ç„¶ååˆ‡æ¢åˆ°å¯¹åº”ç‰ˆæœ¬ git checkout v8.2.0 ç§»æ¤æ–‡ä»¶å°†ä¸Šè¿°ä¸‹è½½åˆ°çš„lv_drivers lvgl å’Œ lv_port_linux_frame_bufferä¸­ main.cå’Œ Makefileæ–‡ä»¶çš„ æ”¾åœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œæ¯”å¦‚æˆ‘æ”¾åœ¨äº†æ–°å»ºçš„lvgl_demoç›®å½•ä¸‹ã€‚å°†lvgl_demolvgllv_conf_template.hå¤åˆ¶åˆ°lvgl_demoä¸‹å¹¶ä¸”æ”¹åä½lvgl_demolv_conf.hå°†lvgl_demolv_driverslv_drv_conf_template.hå¤åˆ¶åˆ°lvgl_demoä¸‹å¹¶ä¸”æ”¹åä½lvgl_demolv_drv_conf.hæ­¤æ—¶æŸ¥çœ‹ book@100ask:~/Desktop/lvgl_demo2$ lslv_conf.h lv_drivers lv_drv_conf.h lvgl main.c Makefile æ­¤æ—¶ç›®å½•ç»“æ„ä¸ºï¼š lvgl_demoâ”œâ”€â”€ lvglâ”œâ”€â”€ lv_driversâ”œâ”€â”€ lv_conf.hâ”œâ”€â”€ lv_drv_conf.hâ”œâ”€â”€ main.câ””â”€â”€ Makefile äºŒçº§ç›®å½•ä½¿ç”¨tree -L 2æŸ¥çœ‹æˆ‘çš„lvgl_demoç›®å½•ç»“æ„å¦‚ä¸‹ï¼š lvgl_demoâ”œâ”€â”€ lv_conf.hâ”œâ”€â”€ lv_driversâ”‚ â”œâ”€â”€ CMakeLists.txtâ”‚ â”œâ”€â”€ displayâ”‚ â”œâ”€â”€ docsâ”‚ â”œâ”€â”€ gtkdrvâ”‚ â”œâ”€â”€ indevâ”‚ â”œâ”€â”€ library.jsonâ”‚ â”œâ”€â”€ LICENSEâ”‚ â”œâ”€â”€ lv_drivers.mkâ”‚ â”œâ”€â”€ lv_drv_conf_template.hâ”‚ â”œâ”€â”€ README.mdâ”‚ â”œâ”€â”€ sdlâ”‚ â”œâ”€â”€ waylandâ”‚ â”œâ”€â”€ win32drvâ”‚ â”œâ”€â”€ win_drv.câ”‚ â”œâ”€â”€ win_drv.hâ”‚ â””â”€â”€ win_drv.oâ”œâ”€â”€ lv_drv_conf.hâ”œâ”€â”€ lvglâ”‚ â”œâ”€â”€ CMakeLists.txtâ”‚ â”œâ”€â”€ component.mkâ”‚ â”œâ”€â”€ demosâ”‚ â”œâ”€â”€ docsâ”‚ â”œâ”€â”€ env_supportâ”‚ â”œâ”€â”€ examplesâ”‚ â”œâ”€â”€ idf_component.ymlâ”‚ â”œâ”€â”€ Kconfigâ”‚ â”œâ”€â”€ library.jsonâ”‚ â”œâ”€â”€ library.propertiesâ”‚ â”œâ”€â”€ LICENCE.txtâ”‚ â”œâ”€â”€ lv_conf_template.hâ”‚ â”œâ”€â”€ lvgl.hâ”‚ â”œâ”€â”€ lvgl.mkâ”‚ â”œâ”€â”€ README.mdâ”‚ â”œâ”€â”€ README_zh.mdâ”‚ â”œâ”€â”€ SConscriptâ”‚ â”œâ”€â”€ scriptsâ”‚ â”œâ”€â”€ srcâ”‚ â””â”€â”€ testsâ”œâ”€â”€ main.câ””â”€â”€ Makefile ä¿®æ”¹é…ç½®æ–‡ä»¶ä¿®æ”¹lv_drv_conf.h ä½¿èƒ½é©±åŠ¨å°†#if 1 /*Set it to 1 to enable the content*/æ”¹ä¸º#if 1 /*Set it to 1 to enable the content*/ ä½¿èƒ½frame bufferè®¾å¤‡ï¼Œå°†USE_FBDEVçš„å€¼æ”¹ä¸º1/*----------------------------------------- * Linux frame buffer device (/dev/fbx) *-----------------------------------------*/#ifndef USE_FBDEV# define USE_FBDEV 1#endif#if USE_FBDEV# define FBDEV_PATH /dev/fb0#endif ä½¿èƒ½USE_EVDEVï¼Œå°†devinputevent0æ”¹ä¸ºdevinputevent1,è¿™é‡Œæ˜¯ä½¿è§¦æ‘¸è®¾å¤‡ç”Ÿæ•ˆ /*-------------------------------------------------* Mouse or touchpad as evdev interface (for Linux based systems)*------------------------------------------------*/#ifndef USE_EVDEV# define USE_EVDEV 1#endif#ifndef USE_BSD_EVDEV# define USE_BSD_EVDEV 0#endif#if USE_EVDEV || USE_BSD_EVDEV# define EVDEV_NAME /dev/input/event1 /*You can use the evtest Linux tool to get the list of devices and test them*/# define EVDEV_SWAP_AXES 0 /*Swap the x and y axes of the touchscreen*/# define EVDEV_CALIBRATE 0 /*Scale and offset the touchscreen coordinates by using maximum and minimum values for each axis*/ ä¿®æ”¹lv_conf.h ä½¿èƒ½ï¼Œè¿™é‡Œå’Œä¸Šè¿°æ­¥éª¤ç›¸åŒå°†#if 1 /*Set it to 1 to enable the content*/æ”¹ä¸º#if 1 /*Set it to 1 to enable the content*/ ä¿®æ”¹æ˜¾å­˜å¤§å°å¯ä»¥ä½¿èƒ½LV_MEM_CUSTOMè‡ªå·±åˆ†é…ä¹Ÿå¯ä»¥è‡ªåŠ¨åˆ†é…ï¼Œæˆ‘é€‰æ‹©çš„æ˜¯è‡ªå·±åˆ†é…æ˜¾å­˜ï¼š/*1: use custom malloc/free, 0: use the built-in `lv_mem_alloc()` and `lv_mem_free()`*/#define LV_MEM_CUSTOM 1#if LV_MEM_CUSTOM == 0 /*Size of the memory available for `lv_mem_alloc()` in bytes (= 2kB)*/ #define LV_MEM_SIZE (48U * 1024U) /*[bytes]*/ /*Set an address for the memory pool instead of allocating it as a normal array. Can be in external SRAM too.*/ #define LV_MEM_ADR 0 /*0: unused*/ /*Instead of an address give a memory allocator that will be called to get a memory pool for LVGL. E.g. my_malloc*/ #if LV_MEM_ADR == 0 //#define LV_MEM_POOL_INCLUDE your_alloc_library /* Uncomment if using an external allocator*/ //#define LV_MEM_POOL_ALLOC your_alloc /* Uncomment if using an external allocator*/ #endif #else /*LV_MEM_CUSTOM*/ #define LV_MEM_CUSTOM_INCLUDE stdlib.h /*Header for the dynamic memory function*/ #define LV_MEM_CUSTOM_ALLOC malloc #define LV_MEM_CUSTOM_FREE free #define LV_MEM_CUSTOM_REALLOC realloc#endif /*LV_MEM_CUSTOM*/ åˆ·æ–°æ—¶é—´å¯ä¿®æ”¹å¯ä»¥ä¸ä¿®æ”¹ï¼Œè®°å½•è¯´æ˜è¿™é‡Œå¯ä»¥æŒ‰éœ€ä¿®æ”¹/*====================HAL SETTINGS*====================*/ /*Default display refresh period. LVG will redraw changed areas with this period time*/#define LV_DISP_DEF_REFR_PERIOD 10 /*[ms]*/ /*Input device read period in milliseconds*/#define LV_INDEV_DEF_READ_PERIOD 10 /*[ms]*/ TICKçš„é…ç½®è¿™é‡Œé€‰æ‹©è‡ªå·±å®šä¹‰ä¸€ä¸ªTickå®šæ—¶å™¨é…ç½®å‡½æ•°,æ›´æ”¹åçš„é…ç½®å¦‚ä¸‹ï¼š/*Use a custom tick source that tells the elapsed time in milliseconds.*It removes the need to manually update the tick with `lv_tick_inc()`)*/uint32_t custom_tick_get(void);#define LV_TICK_CUSTOM 1#if LV_TICK_CUSTOM#define LV_TICK_CUSTOM_INCLUDE stdint.h /*Header for the system time function*/#define LV_TICK_CUSTOM_SYS_TIME_EXPR (custom_tick_get()) /*Expression evaluating to current system time in ms*/#endif /*LV_TICK_CUSTOM*/ LV_COLOR_DEPTHè®¾ç½®/*====================COLOR SETTINGS*====================*/ /*Color depth: 1 (1 byte per pixel), 8 (RGB332), 16 (RGB565), 32 (ARGB8888)*/#define LV_COLOR_DEPTH 32 /*Swap the 2 bytes of RGB565 color. Useful if the display has an 8-bit interface (e.g. SPI)*/#define LV_COLOR_16_SWAP 0 é¢œè‰²æ·±åº¦è®¾ç½®ä¸º32ä½ï¼Œå®¹æ˜“é—å¿˜çš„è®¾ç½®ï¼Œå¦åˆ™lvglé¢œè‰²æ˜¾ç¤ºä¸æ­£å¸¸ ä½¿èƒ½ç›¸åº”çš„demoæ¨¡æ¿è¿™é‡Œä½¿ç”¨çš„æ˜¯LV_USE_DEMO_WIDGETS /*=================== * DEMO USAGE ====================*//*Show some widget. It might be required to increase `LV_MEM_SIZE` */#define LV_USE_DEMO_WIDGETS 1#if LV_USE_DEMO_WIDGETS#define LV_DEMO_WIDGETS_SLIDESHOW 0#endif ä¿®æ”¹main.c ä¿®æ”¹æ˜¾ç¤ºå™¨åˆ†è¾¨ç‡disp_drv.hor_res = 1024;disp_drv.ver_res = 600; æ³¨é‡Šé¼ æ ‡è¾“å…¥/*Set a cursor for the mouse*/ // LV_IMG_DECLARE(mouse_cursor_icon) // lv_obj_t * cursor_obj = lv_img_create(lv_scr_act()); /*Create an image object for the cursor */ // lv_img_set_src(cursor_obj, mouse_cursor_icon); /*Set the image source*/ // lv_indev_set_cursor(mouse_indev, cursor_obj); /*Connect the image object to the driver*/ æ³¨é‡Šå…¶ä»–ä¸éœ€è¦çš„åœ°æ–¹ï¼Œé˜²æ­¢ç¼–è¯‘ä¸é€šè¿‡ï¼Œæ¯”å¦‚ï¼š// #include lvgl/demos/lv_demos.h åˆ°è¿™é‡Œmainå‡½æ•°å°±ä¿®æ”¹å®Œäº†ï¼Œæ³¨æ„åˆ°main.cä¸­å°±æœ‰custom_tick_getå®ç°ï¼Œå…¶ä»–å¯ä»¥æŒ‰éœ€ä¿®æ”¹å®Œæ•´çš„main.cä»£ç å¦‚ä¸‹ï¼š #include lvgl/lvgl.h// #include lvgl/demos/lv_demos.h#include lv_drivers/display/fbdev.h#include lv_drivers/indev/evdev.h#include unistd.h#include pthread.h#include time.h#include sys/time.h// #define DISP_BUF_SIZE (128 * 1024)#define DISP_BUF_SIZE (1024 * 600)int main(void) /*LittlevGL init*/ lv_init(); /*Linux frame buffer device init*/ fbdev_init(); /*A small buffer for LittlevGL to draw the screens content*/ static lv_color_t buf[DISP_BUF_SIZE]; /*Initialize a descriptor for the buffer*/ static lv_disp_draw_buf_t disp_buf; lv_disp_draw_buf_init(disp_buf, buf, NULL, DISP_BUF_SIZE); /*Initialize and register a display driver*/ static lv_disp_drv_t disp_drv; lv_disp_drv_init(disp_drv); disp_drv.draw_buf = disp_buf; disp_drv.flush_cb = fbdev_flush; disp_drv.hor_res = 1024; disp_drv.ver_res = 600; lv_disp_drv_register(disp_drv); evdev_init(); // static lv_indev_drv_t indev_drv_1; // lv_indev_drv_init(indev_drv_1); /*Basic initialization*/ // indev_drv_1.type = LV_INDEV_TYPE_POINTER; // /*This function will be called periodically (by the library) to get the mouse position and state*/ // indev_drv_1.read_cb = evdev_read; // lv_indev_t *mouse_indev = lv_indev_drv_register(indev_drv_1); /* Initialize and register a display input driver */ lv_indev_drv_t indev_drv; lv_indev_drv_init(indev_drv); /*Basic initialization*/ indev_drv.type = LV_INDEV_TYPE_POINTER; indev_drv.read_cb = evdev_read; lv_indev_t * my_indev = lv_indev_drv_register(indev_drv); /*Set a cursor for the mouse*/ // LV_IMG_DECLARE(mouse_cursor_icon) // lv_obj_t * cursor_obj = lv_img_create(lv_scr_act()); /*Create an image object for the cursor */ // lv_img_set_src(cursor_obj, mouse_cursor_icon); /*Set the image source*/ // lv_indev_set_cursor(mouse_indev, cursor_obj); /*Connect the image object to the driver*/ /*Create a Demo*/ // lv_demo_widgets(); lv_demo_music(); /*Handle LitlevGL tasks (tickless mode)*/ while(1) lv_timer_handler(); usleep(5000); return 0;/*Set in lv_conf.h as `LV_TICK_CUSTOM_SYS_TIME_EXPR`*/uint32_t custom_tick_get(void) static uint64_t start_ms = 0; if(start_ms == 0) struct timeval tv_start; gettimeofday(tv_start, NULL); start_ms = (tv_start.tv_sec * 1000000 + tv_start.tv_usec) / 1000; struct timeval tv_now; gettimeofday(tv_now, NULL); uint64_t now_ms; now_ms = (tv_now.tv_sec * 1000000 + tv_now.tv_usec) / 1000; uint32_t time_ms = now_ms - start_ms; return time_ms; Makefileé…ç½® ä¿®æ”¹äº†äº¤å‰ç¼–è¯‘å·¥å…·é“¾ä¸ºï¼šCC := arm-buildroot-linux-gnueabihf-gcc. ä½¿ç”¨echo $CROSS_COMPILEå¯ä»¥æŸ¥çœ‹äº¤å‰ç¼–è¯‘é“¾æ˜¯ä»€ä¹ˆ å°†é¼ æ ‡æ ·å¼çš„è¿æ¥æºæ–‡ä»¶æ³¨é‡Šæ‰# CSRCS +=$(LVGL_DIR)/mouse_cursor_icon.c å®Œæ•´çš„Makefileå¦‚ä¸‹ï¼š ## Makefile## CC ?= gccCC := arm-buildroot-linux-gnueabihf-gccLVGL_DIR_NAME ?= lvglLVGL_DIR ?= $shell pwdCFLAGS ?= -O3 -g0 -I$(LVGL_DIR)/ -Wall -Wshadow -Wundef -Wmissing-prototypes -Wno-discarded-qualifiers -Wall -Wextra -Wno-unused-function -Wno-error=strict-prototypes -Wpointer-arith -fno-strict-aliasing -Wno-error=cpp -Wuninitialized -Wmaybe-uninitialized -Wno-unused-parameter -Wno-missing-field-initializers -Wtype-limits -Wsizeof-pointer-memaccess -Wno-format-nonliteral -Wno-cast-qual -Wunreachable-code -Wno-switch-default -Wreturn-type -Wmultichar -Wformat-security -Wno-ignored-qualifiers -Wno-error=pedantic -Wno-sign-compare -Wno-error=missing-prototypes -Wdouble-promotion -Wclobbered -Wdeprecated -Wempty-body -Wtype-limits -Wshift-negative-value -Wstack-usage=2048 -Wno-unused-value -Wno-unused-parameter -Wno-missing-field-initializers -Wuninitialized -Wmaybe-uninitialized -Wall -Wextra -Wno-unused-parameter -Wno-missing-field-initializers -Wtype-limits -Wsizeof-pointer-memaccess -Wno-format-nonliteral -Wpointer-arith -Wno-cast-qual -Wmissing-prototypes -Wunreachable-code -Wno-switch-default -Wreturn-type -Wmultichar -Wno-discarded-qualifiers -Wformat-security -Wno-ignored-qualifiers -Wno-sign-compareLDFLAGS ?= -lmBIN = demo#Collect the files to compileMAINSRC = ./main.cinclude $(LVGL_DIR)/lvgl/lvgl.mkinclude $(LVGL_DIR)/lv_drivers/lv_drivers.mk# include $(LVGL_DIR)/lv_demos/lv_demos.mk# CSRCS +=$(LVGL_DIR)/mouse_cursor_icon.c OBJEXT ?= .oAOBJS = $(ASRCS:.S=$(OBJEXT))COBJS = $(CSRCS:.c=$(OBJEXT))MAINOBJ = $(MAINSRC:.c=$(OBJEXT))SRCS = $(ASRCS) $(CSRCS) $(MAINSRC)OBJS = $(AOBJS) $(COBJS)## MAINOBJ - OBJFILESall: default%.o: %.c\t@$(CC) $(CFLAGS) -c $ -o $@\t@echo CC $ default: $(AOBJS) $(COBJS) $(MAINOBJ)\t$(CC) -o $(BIN) $(MAINOBJ) $(AOBJS) $(COBJS) $(LDFLAGS)\tmkdir -p $(LVGL_DIR)/obj $(LVGL_DIR)/bin\tmv *.o $(LVGL_DIR)/obj/\tmv $(BIN) $(LVGL_DIR)/bin/clean: rm -f $(BIN) $(AOBJS) $(COBJS) $(MAINOBJ) ./bin/* ./obj/* è¿è¡Œå’Œç»“æœ ä½¿ç”¨makeç¼–è¯‘åï¼Œå°†ç”Ÿæˆdemoå¯æ‰§è¡Œæ–‡ä»¶ã€‚ç„¶åé€šè¿‡mountæŒ‚è½½ï¼Œå°†ç¼–è¯‘å¥½çš„demoæ”¾åˆ°å¼€å‘æ¿çš„mntç›®å½•ä¸‹ å¼€å‘æ¿ä¸Šåˆ‡æ¢åˆ°mntç›®å½•ï¼Œæ‰§è¡Œ.demoè¿è¡Œ ç»“æœ æ³¨æ„äº‹é¡¹1.æ³¨æ„ç‰ˆæœ¬ä¸€è‡´ï¼Œä¸ç„¶å®¹æ˜“å‡ºç°å„ç§å„æ ·ç¨€å¥‡å¤æ€ªçš„é—®é¢˜ï¼Œæœ‰å¯èƒ½æ— æ³•ç¼–è¯‘ã€‚æˆ‘ç”šè‡³é‡åˆ°è¿‡ç¼–è¯‘æˆåŠŸä¹‹åå‡ºæ¥çš„å¯æ‰§è¡Œæ–‡ä»¶æ˜¯64ä½çš„ï¼Œè€Œå¼€å‘æ¿æ˜¯32ä½çš„ï¼Œå¯¼è‡´æ— æ³•è¿è¡Œã€‚2.ä¿®æ”¹é…ç½®æˆ–è€…æºç ä¹‹åï¼Œå¦‚æœä¸æ˜¯é¢„æœŸçš„æ•ˆæœï¼Œå¯ä»¥è¯•è¯•å…ˆmake cleanï¼Œç„¶åå†makeã€‚ å‚è€ƒé“¾æ¥ã€åµŒå…¥å¼Linuxåº”ç”¨å¼€å‘ã€‘1. ç§»æ¤LVGLåˆ°Linuxå¼€å‘æ¿","tags":["åµŒå…¥å¼","LVGL"],"categories":["LVGL"]},{"title":"IMX6ULLç§»é™¤åŠæ¢å¤åŸæœ‰UI","path":"/2024/12/15/ç§»é™¤åŠæ¢å¤åŸæœ‰UI/","content":"IMX6ULLç§»é™¤åŠæ¢å¤åŸæœ‰UIæœ‰æ—¶å€™éœ€è¦ç§»é™¤æ‰IMX6ULLåŸæœ¬çš„UIï¼Œæ¢å¤æˆé»˜è®¤çš„ç•Œé¢ï¼Œæ–¹ä¾¿æˆ‘ä»¬åšä¸€äº›LVGLçš„æµ‹è¯•æˆ–è€…è¿è¡Œå…¶ä»–çš„å›¾å½¢ç•Œé¢ã€‚ è¿›å…¥/etc/init.d/ç›®å½• è¿›å…¥/etc/init.d/ç›®å½•ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä»¥ä¸‹æ–‡ä»¶ï¼šå…¶ä¸­S99myirhmi2å°±æ˜¯æˆ‘ä»¬çš„ç›®æ ‡æ–‡ä»¶ ç§»é™¤S99myirhmi2ç§»åŠ¨S99myirhmi2çš„å¯åŠ¨è„šæœ¬åˆ°/rootç›®å½•ä¸‹ï¼Œé˜²æ­¢å¼€æœºæ—¶è‡ªåŠ¨å¯åŠ¨ï¼Œä½¿ç”¨å‘½ä»¤ï¼š mv /etc/init.d/S99myirhmi2 /root/sync ç§»é™¤æˆåŠŸåï¼Œé‡å¯è®¾å¤‡ã€‚ reboot è¿™æ ·å°±ä¸ä¼šè¿›å…¥myirhmi2äº†,å¦‚ä¸‹ï¼Œä¼šå¡åœ¨è¿™ä¸ªç•Œé¢ï¼š æ¢å¤åŸæœ‰ UI å¦‚æœæƒ³æ¢å¤åŸæœ‰ UIï¼Œåˆ™æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ï¼š mv /root/S99myirhmi2 /etc/init.d/sync å†rebooté‡å¯å³å¯æ¢å¤ å…³é—­è‡ªåŠ¨é»‘å±æ³¨æ„ï¼šä»¥ä¸‹å‘½ä»¤é‡å¯åå‡å¤±æ•ˆæ‰§è¡Œï¼š echo -e \\033[9;0] /dev/tty0 é‡æ–°å¯ç”¨è‡ªåŠ¨é»‘å±ï¼š echo -e \\033[9;1] /dev/tty0 æ‰“å¼€å…‰æ ‡ echo -e \\033[?25h /dev/tty1 å…³é—­å…‰æ ‡ echo -e â€œ\\033[?25lâ€ /dev/tty1","tags":["ubuntu","UI"],"categories":["UBUNTU"]},{"title":"catkin_make ç¼–è¯‘å‡ºé”™","path":"/2024/10/31/catkin_makeç¼–è¯‘å‡ºé”™/","content":"catkin_make ç¼–è¯‘å‡ºé”™æŠ¥é”™ï¼šusrbinld: æ‰¾ä¸åˆ° -lncursesåŸå› ï¼šæ‰¾ä¸åˆ°ç›¸åº”çš„libncurses.soåŠ¨æ€åº“ï¼Œåº“æ–‡ä»¶æ²¡æœ‰å¯¼å…¥åˆ°ldæ£€ç´¢ç›®å½• è§£å†³æ–¹æ³•ï¼š1.ä½¿ç”¨locateå®šä½libncurses.so locate libncurses.so è¾“å‡ºï¼š /snap/core/17200/lib/x86_64-linux-gnu/libncurses.so.5/snap/core/17200/lib/x86_64-linux-gnu/libncurses.so.5.9/snap/core20/2379/usr/lib/x86_64-linux-gnu/libncurses.so.6/snap/core20/2379/usr/lib/x86_64-linux-gnu/libncurses.so.6.2/snap/core20/2434/usr/lib/x86_64-linux-gnu/libncurses.so.6/snap/core20/2434/usr/lib/x86_64-linux-gnu/libncurses.so.6.2/snap/core22/1621/usr/lib/x86_64-linux-gnu/libncurses.so.6/snap/core22/1621/usr/lib/x86_64-linux-gnu/libncurses.so.6.3/snap/core22/1663/usr/lib/x86_64-linux-gnu/libncurses.so.6/snap/core22/1663/usr/lib/x86_64-linux-gnu/libncurses.so.6.3/usr/lib/x86_64-linux-gnu/libncurses.so.6/usr/lib/x86_64-linux-gnu/libncurses.so.6.2 éšä¾¿æ‰¾ä¸€ä¸ªè¿›è¡Œè½¯é“¾æ¥ sudo ln -s /usr/lib/x86_64-linux-gnu/libncurses.so.6 /usr/lib/libncurses.so æ›´æ–°åº“ç¼“å­˜ sudo ldconfig é‡æ–°catkin_makeç¼–è¯‘å‚è€ƒé“¾æ¥ï¼šhttps://blog.csdn.net/qq_34761779/article/details/126665354","tags":["ros","ç¬”è®°"],"categories":["ROS"]},{"title":"roslaunch å‡ºé”™","path":"/2024/10/31/roslaunchå‡ºé”™/","content":"roslaunch å‡ºé”™æŠ¥é”™ï¼šhomedkutouch_wsdevellibomni_commonomni_state: error while loading shared libraries: libncurses.so.5: cannot open shared object file: No such file or directory åŸå› ï¼šç¼ºå°‘libncurses.so.5å…±äº«åº“ è§£å†³æ–¹æ³•ï¼š1.å®‰è£…libncurses.so.5å…±äº«åº“ sudo apt-get updatesudo apt-get install libncurses5 é‡æ–°è¿è¡Œroslaunch omni_common omni.launchå‚è€ƒé“¾æ¥ï¼šhttps://blog.csdn.net/qq_38236680/article/details/142253345 æ¥ç€é‡åˆ°ï¼šFailed to initialize haptic deviceæŠ¥é”™å…·ä½“æŠ¥é”™ä¿¡æ¯ï¼š[ERROR] [1730784892.557095854]: Failed to initialize haptic device[omni_state-1] process has died [pid 13774, exit code 255, cmd homedkutouch_wsdevellibomni_commonomni_state __name:omni_state __log:homedku.roslog6a3020f8-9b2e-11ef-82db-71f799b1505aomni_state-1.log].log file: homedku.roslog6a3020f8-9b2e-11ef-82db-71f799b1505aomni_state-1*.logè§£å†³æ–¹æ³•ï¼šæŠŠtouché©±åŠ¨ç¨‹åºå…³äº†â€¦.è¿™ç‚¹å¾ˆå‘","tags":["ros","ç¬”è®°"],"categories":["ROS"]},{"title":"vscodeä¸­æ‰¾ä¸åˆ°rosä¸­çš„ä¸€äº›å¤´æ–‡ä»¶","path":"/2024/10/31/vscodeä¸­æ‰¾ä¸åˆ°rosä¸­çš„ä¸€äº›å¤´æ–‡ä»¶/","content":"vscodeä¸­æ‰¾ä¸åˆ°rosä¸­çš„ä¸€äº›å¤´æ–‡ä»¶ä¸€ä¸ªå°é—®é¢˜åœ¨VSCodeä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ROSçš„C++å¼€å‘ï¼Œä½†æ˜¯ROSçš„C++å¼€å‘éœ€è¦ä½¿ç”¨ROSçš„APIï¼Œä½†æ˜¯ROSçš„APIåœ¨VSCodeä¸­æ‰¾ä¸åˆ°ï¼Œå¤´æ–‡ä»¶ä¹Ÿæ‰¾ä¸åˆ°ï¼Œä½†æ˜¯ç¼–è¯‘æ˜¯å¯ä»¥æˆåŠŸçš„ï¼Œè¯´æ˜åªæ˜¯vscodeçš„é…ç½®é—®é¢˜ã€‚æœ€æœ€é‡è¦çš„æ˜¯ï¼Œvscodeæ‰¾ä¸åˆ°å¤´æ–‡ä»¶ï¼Œåœ¨å†™ä»£ç çš„æ—¶å€™å°±æ²¡æœ‰ä»£ç æç¤ºï¼Œå°±æ— æ³•çŸ¥é“å˜é‡ä¸‹è¿˜æœ‰å“ªäº›å€¼ï¼Œè¿™å°±å¯¼è‡´æ ¹æœ¬å°±æ— æ³•å†™ä»£ç ã€‚ä¾‹å¦‚åœ¨å¤´æ–‡ä»¶ä¸­æ‰¾ä¸åˆ°#include sensor_msgs/JointState.hå¤´æ–‡ä»¶ï¼Œè§£å†³æ–¹æ³•å¦‚ä¸‹ï¼šç»è¿‡æŸ¥æ‰¾ï¼ŒJointState.hä½äº/opt/ros/noetic/include/sensor_msgs/JointState.h åœ¨c_cpp_properties.jsonä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š includePath: [ $workspaceFolder/**, /opt/ros/noetic/include], æ¥ç€source devel/setup.bash,å°±ä¼šå‘ç°å¤´æ–‡ä»¶ä¸‹çš„æ³¢æµªçº¿æ¶ˆå¤±äº†ï¼Œä¹Ÿå¯ä»¥æ­£å¸¸æ‰“å¼€JointState.hæ–‡ä»¶ã€‚PS:åœ¨ä¸€å¼€å§‹çš„è§£å†³æ–¹æ¡ˆé‡Œï¼Œåœ¨CMakeLists.txtä¸­æ·»åŠ äº†include_directories(${Boost_INCLUDE_DIR} ${catkin_INCLUDE_DIRS} /opt/ros/noetic/include)ï¼Œä½†æ˜¯cmakeæ˜¯ç¼–è¯‘çš„æ—¶å€™æ‰å»æŸ¥æ‰¾å¤´æ–‡ä»¶ï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦æ·»åŠ åˆ°c_cpp_properties.jsonä¸­ï¼Œå¯ä»¥ä¸ç”¨ç®¡CMakeLists.txt.","tags":["vscodeé…ç½®"],"categories":["C++ç¬”è®°"]},{"title":"è¿ç®—ç¬¦é‡è½½å°çŸ¥è¯†ç‚¹","path":"/2024/10/31/è¿ç®—ç¬¦é‡è½½å°çŸ¥è¯†ç‚¹/","content":"è¿ç®—ç¬¦é‡è½½å°çŸ¥è¯†ç‚¹åœ¨ C++ ä¸­ï¼Œè¿ç®—ç¬¦é‡è½½å¯ä»¥é€šè¿‡æˆå‘˜å‡½æ•°æˆ–å‹å…ƒå‡½æ•°æ¥å®ç°ã€‚å¯¹äºæˆå‘˜å‡½æ•°å½¢å¼çš„è¿ç®—ç¬¦é‡è½½ï¼Œè¾“å…¥å‚æ•°çš„æ•°é‡ç¡®å®çœ‹èµ·æ¥åªæœ‰ä¸€ä¸ªï¼Œä½†å®é™…ä¸Šæœ‰ä¸¤ä¸ªå‚æ•°ï¼š éšå¼å‚æ•°ï¼šå³è°ƒç”¨è¯¥è¿ç®—ç¬¦çš„å¯¹è±¡æœ¬èº«ã€‚åœ¨æˆå‘˜å‡½æ•°ä¸­ï¼Œè¿™ä¸ªå¯¹è±¡å¯ä»¥é€šè¿‡ this æŒ‡é’ˆè®¿é—®ã€‚æ˜¾å¼å‚æ•°ï¼šå³ä¼ é€’ç»™æˆå‘˜å‡½æ•°çš„å‚æ•° Complex c1(3.5, 2.0);Complex c2(1.0, 4.0);Complex sum = c1 + c2; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œc1 + c2 å®é™…ä¸Šè¢«ç¼–è¯‘å™¨è§£é‡Šä¸º c1.operator+(c2)ã€‚è¿™é‡Œï¼š c1 æ˜¯éšå¼å‚æ•°ï¼Œå¯¹åº” this æŒ‡é’ˆã€‚c2 æ˜¯æ˜¾å¼å‚æ•°ï¼Œä¼ é€’ç»™ operator+ å‡½æ•°ã€‚å› æ­¤ï¼Œè™½ç„¶ operator+ å‡½æ•°çš„å®šä¹‰ä¸­åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œä½†åœ¨å®é™…è°ƒç”¨æ—¶ï¼Œc1 å’Œ c2 éƒ½å‚ä¸äº†è¿ç®—ã€‚ ## å®Œæ•´ä»£ç #include iostreamclass Complex private: double real; double imag;public: // æ„é€ å‡½æ•° Complex(double r = 0, double i = 0) : real(r), imag(i) // åŠ æ³•è¿ç®—ç¬¦é‡è½½ Complex operator+(const Complex other) const Complex result; result.real = this-real + other.real; result.imag = this-imag + other.imag; return result; // å‡æ³•è¿ç®—ç¬¦é‡è½½ Complex operator-(const Complex other) const return Complex(real - other.real, imag - other.imag); // è¾“å‡ºè¿ç®—ç¬¦é‡è½½ friend std::ostream operator(std::ostream os, const Complex c) os c.real + c.imag i; return os; ;int main() Complex c1(3.5, 2.0); Complex c2(1.0, 4.0); Complex sum = c1 + c2; Complex diff = c1 - c2; std::cout c1: c1 std::endl; std::cout c2: c2 std::endl; std::cout c1 + c2: sum std::endl; std::cout c1 - c2: diff std::endl; return 0; å®Œ","tags":["c++","è¿ç®—ç¬¦é‡è½½"],"categories":["C++ç¬”è®°"]},{"title":"Cmakeæ„å»ºè‡ªåŠ¨åŒ–ç¼–è¯‘ç¯å¢ƒ","path":"/2024/10/30/Cmakeæ„å»ºè‡ªåŠ¨åŒ–ç¼–è¯‘ç¯å¢ƒ/","content":"Cmakeæ„å»ºè‡ªåŠ¨åŒ–ç¼–è¯‘ç¯å¢ƒå®Œæ•´é¡¹ç›®æ–‡ä»¶ç»“æ„ï¼šä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®åº”è¯¥åŒ…æ‹¬å¦‚ä¸‹æ–‡ä»¶ç»“æ„ï¼š ProjectName/â”œâ”€â”€ CMakeLists.txtâ”œâ”€â”€ src/â”‚ â”œâ”€â”€ main.cppâ”‚ â”œâ”€â”€ xxx.cppâ”‚ â””â”€â”€ yyy.cppâ”œâ”€â”€ include/â”‚ â”œâ”€â”€ xxx.hâ”‚ â””â”€â”€ yyy.hâ”‚â”€â”€ build/â”‚â”€â”€ lib/â””â”€â”€ test/example/â”œâ”€â”€ thridparty/â”œâ”€â”€ README.mdâ””â”€â”€ autobuild.sh bin:ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ libï¼šç”Ÿæˆçš„ä¸­é—´åº“æ–‡ä»¶ include: src: build:ç¼–è¯‘è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸´æ—¶æ–‡ä»¶ testexample:ç¤ºæ„æ–‡ä»¶ thridparty:ç¬¬ä¸‰æ–¹åº“æ–‡ä»¶ CMakeLists.txs: autobuild.sh:ä¸€é”®ç¼–è¯‘ï¼Œå…¶å®å°±æ˜¯æ‰§è¡Œçš„cmakeæ–‡ä»¶ license: readme: ChatServeræ–‡ä»¶ç»“æ„ChatServer/â”œâ”€â”€ .vscode/â”œâ”€â”€ src/â”‚ â”œâ”€â”€ serverâ”‚ â”‚ â”œâ”€â”€ chat_server.cppâ”‚ â”‚ â””â”€â”€ CmakeLists.txtâ”‚ â”‚â”‚ â””â”€â”€ clientâ”‚ â”œâ”€â”€ chat_client.cppâ”‚ â””â”€â”€ CmakeLists.txtâ”œâ”€â”€ include/â”‚ â”œâ”€â”€ chat_server.hâ”‚ â”œâ”€â”€ chat_client.hâ”‚ â””â”€â”€ otherfile.hâ”œâ”€â”€ build/Makefileâ”œâ”€â”€ bin/â”‚ â””â”€â”€ ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶â”œâ”€â”€ thridparty/ â”‚ â””â”€â”€ json.hppâ”œâ”€â”€ test/â”œâ”€â”€ CMakeLists.txtâ”œâ”€â”€ README.mdâ””â”€â”€ autobuild.sh CMakeLists.txtæ–‡ä»¶è§£é‡Šä»é¡¶å±‚å¼€å§‹ï¼Œæ¯ä¸€ä¸ªå­ç›®å½•ä¸‹éƒ½æœ‰è‡ªå·±çš„CMakeLists.txtæ–‡ä»¶.ä¸‹é¢æ˜¯æ¯ä¸€å±‚çš„CMakeLists.txtæ–‡ä»¶,éå¸¸ä¸å®Œå–„ï¼Œæ­£åœ¨è¡¥å……ä¸­â€¦ é¡¶å±‚CMakeListsï¼Œè·¯å¾„ï¼šchatserverCMakeLists.txt cmake_minimum_required(VERSION 3.0)project(chat)# é…ç½®ç¼–è¯‘é€‰é¡¹set(CMAKE_CXX_FLAGS $CMAKE_CXX_FLAGS -g)# æ·»åŠ å­ç›®å½•#é…ç½®æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶çš„è¾“å‡ºè·¯å¾„,PROJECT_SOURCE_DIRè¡¨ç¤ºå½“å‰é¡¹ç›®çš„æ ¹ç›®å½•set(EXECUTABLE_OUTPUT_PATH $PROJECT_SOURCE_DIR/bin)#é…ç½®å¤´æ–‡ä»¶çš„æœç´¢è·¯å¾„include_directories($PROJECT_SOURCE_DIR/include)include_directories($PROJECT_SOURCE_DIR/include/server)#åŠ è½½å­ç›®å½•,å­ç›®å½•ä¸‹ä¹Ÿéœ€è¦æœ‰CMakeLists.txtæ–‡ä»¶ï¼Œå­ç›®å½•éƒ½å†™åœ¨srcæ–‡ä»¶ä¸‹add_subdirectory(src) srcä¸­CMakeListsï¼Œè·¯å¾„ï¼šchatserversrcCMakeLists.txt #æ·»åŠ å­ç›®å½•ï¼Œåœ¨serverç›®å½•ä¸‹ä¹Ÿæœ‰ä¸€ä¸ªCMakeLists.txtæ–‡ä»¶add_subdirectory(server) srcserverä¸­CMakeListsï¼Œè·¯å¾„ï¼šchatserversrcserverCMakeLists.txt #å®šä¹‰äº†ä¸€ä¸ªSRC_LISTå˜é‡ï¼ŒåŒ…å«å½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„æºæ–‡ä»¶aux_source_directory(. SRC_LIST)#ç”±æ‰€æœ‰æºç ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶,æŒ‡å®šç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶çš„åç§°ä¸ºChatServeradd_executable(ChatServer $SRC_LIST)#æŒ‡å®šå¯æ‰§è¡Œæ–‡ä»¶éœ€è¦é“¾æ¥æ—¶æ‰€ä¾èµ–çš„åº“ï¼Œmuduo_net muduo_base pthreadtarget_link_libraries(ChatServer muduo_net muduo_base pthread) srcclientä¸­CMakeListsï¼Œè·¯å¾„ï¼šchatserversrcclientCMakeLists.txt # å®šä¹‰äº†ä¸€ä¸ªSRC_LISTå˜é‡ï¼ŒåŒ…å«äº†è¯¥ç›®å½•ä¸‹æ‰€æœ‰çš„æºæ–‡ä»¶aux_source_directory(. SRC_LIST)# æŒ‡å®šç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶add_executable(ChatClient $SRC_LIST)# æŒ‡å®šå¯æ‰§è¡Œæ–‡ä»¶é“¾æ¥æ—¶éœ€è¦ä¾èµ–çš„åº“æ–‡ä»¶target_link_libraries(ChatClient pthread) æ‰§è¡Œå‘½ä»¤ï¼šcmake . æˆ–è€… cmake ..åœ¨å“ªé‡Œæ‰§è¡Œcmakeï¼Œå°±ä¼šåœ¨å“ªé‡Œç”Ÿæˆä¸­é—´æ–‡ä»¶å’Œå¯æ‰§è¡Œæ–‡ä»¶å› æ­¤å¯ä»¥è¿›å…¥buildç›®å½•æ‰§è¡Œcmake ..å‘½ä»¤ï¼Œè¿™æ ·ç”Ÿæˆçš„æ–‡ä»¶å°±åœ¨buildç›®å½•ä¸‹ æœªå®Œå¾…ç»­â€¦","tags":["c++","linux","Cmake"],"categories":["LINUX"]},{"title":"Makefileæ€»ç»“åŠé€šç”¨æ¨¡æ¿ä½¿ç”¨","path":"/2024/10/18/Makefileæ€»ç»“åŠé€šç”¨æ¨¡æ¿ä½¿ç”¨/","content":"Makefileæ€»ç»“åŠé€šç”¨æ¨¡æ¿ä½¿ç”¨é¡¹ç›®ç»“æ„./â”œâ”€â”€ aâ”‚ â”œâ”€â”€ Makefileâ”‚ â”œâ”€â”€ sub2.câ”‚ â””â”€â”€ sub3.câ”œâ”€â”€ includeâ”‚ â”œâ”€â”€ sub2.hâ”‚ â”œâ”€â”€ sub3.hâ”‚ â””â”€â”€ sub.hâ”œâ”€â”€ main.câ”œâ”€â”€ Makefileâ”œâ”€â”€ Makefile.buildâ””â”€â”€ sub.c ç¤ºä¾‹Cä»£ç Cä»£ç åªæ˜¯ä½œä¸ºç¤ºä¾‹ï¼Œä¸ºäº†ä¸å½±å“é˜…è¯»è§é™„å½• makefileæ–‡ä»¶é¡¶å±‚ç›®å½•ä¸‹çš„MakefileCROSS_COMPILE = AS = $(CROSS_COMPILE)asLD = $(CROSS_COMPILE)ldCC = $(CROSS_COMPILE)gccCPP = $(CC) -EAR = $(CROSS_COMPILE)arNM = $(CROSS_COMPILE)nmSTRIP = $(CROSS_COMPILE)stripOBJCOPY = $(CROSS_COMPILE)objcopyOBJDUMP = $(CROSS_COMPILE)objdumpexport AS LD CC CPP AR NMexport STRIP OBJCOPY OBJDUMPCFLAGS := -Wall -O2 -gCFLAGS += -I $(shell pwd)/includeLDFLAGS := export CFLAGS LDFLAGSTOPDIR := $(shell pwd)export TOPDIRTARGET := testobj-y += main.oobj-y += sub.oobj-y += a/# print:# @echo $(TARGET)# @echo $(shell find -name *.o)# @echo obj-y=$(obj-y)# @echo TOPDIR=$(TOPDIR)# TOPDIR=/home/book/Documents/makefile_learn/general_Makefile/example# æ‰§è¡Œmake ä¼šæ‰§è¡Œç¬¬ä¸€ä¸ª all ç›®æ ‡ã€‚all åˆ†æˆä¸¤ä¸ªä¾èµ– start_recursive_build å’Œ $(TARGET)all : start_recursive_build $(TARGET)\t@echo $(TARGET) has been built!start_recursive_build:\t@echo ------------------start_recursive_build begin---------------------\tmake -C ./ -f $(TOPDIR)/Makefile.build\t@echo ------------------start_recursive_build end------------------------$(TARGET) : start_recursive_build\t@echo -------------------------test begin---------------------------------\t$(CC) -o $(TARGET) built-in.o $(LDFLAGS)\t@echo -------------------------test end-----------------------------------clean:\trm -f $(shell find -name *.o)\trm -f $(TARGET)distclean:\trm -f $(shell find -name *.o)\trm -f $(shell find -name *.d)\trm -f $(TARGET) é¡¶å±‚ç›®å½•ä¸‹çš„Makefile.buildPHONY := __build__build:# å…ˆæ¸…ç©ºobj-y :=subdir-y :=EXTRA_CFLAGS :=# å†åŒ…å« Makefileinclude Makefile# obj-y := a.o b.o c/ d/# $(filter %/, $(obj-y)) : c/ d/# __subdir-y : c d# subdir-y : c d__subdir-y\t:= $(patsubst %/,%,$(filter %/, $(obj-y)))subdir-y\t+= $(__subdir-y)# c/built-in.o d/built-in.osubdir_objs := $(foreach f,$(subdir-y),$(f)/built-in.o)# a.o b.ocur_objs := $(filter-out %/, $(obj-y))dep_files := $(foreach f,$(cur_objs),.$(f).d)dep_files := $(wildcard $(dep_files))ifneq ($(dep_files),) include $(dep_files)endifPHONY += $(subdir-y)# ä¾èµ–äºå­ç›®å½•a ä¾èµ–äºbuilt-in.o__build : $(subdir-y) built-in.o# å…ˆå»å¤„ç†å­ç›®å½•a# make -C è¿›å…¥å­ç›®å½•a,ä½¿ç”¨é¡¶å±‚çš„makefile.buildæ¥å¤„ç†è¿™ä¸ªå­ç›®å½•,å³å°±æ˜¯è¿™ä¸ªmakefile.buildã€‚#å­ç›®å½•ä¸­çš„makefileä¼šå¯¹æ ‡å¿—ä½ï¼Œæ–‡ä»¶å•¥çš„è¿›è¡Œèµ‹å€¼ï¼Œç„¶åæ‰§è¡Œ%.o : %.cä¸‹é¢çš„è§„åˆ™ã€‚$(subdir-y):\t@echo --------------------subdir-y begin---------------------------\t@echo subdir-y=$(subdir-y)\t@echo @=$@\t@echo TOPDIR=$(TOPDIR)\tmake -C $@ -f $(TOPDIR)/Makefile.build\t@echo --------------------subdir-y end---------------------------#è¿™ä¸€éƒ¨åˆ†é€’å½’äº†å¥½å‡ æ¬¡ï¼Œç¬¬ä¸€æ¬¡é€’å½’ï¼šåœ¨å­ç›®å½•aä¸‹ç”Ÿæˆa/built-in.o# è¿™é‡Œsubdir-y subdir_objséƒ½ä¸ºç©º cur_objs=sub2.o sub3.o,å³ld -r -o built-in.o sub2.o sub3.o obj-y= sub2.o sub3.o# ç¬¬äºŒæ¬¡é€’å½’ï¼šld -r -o built-in.o main.o sub.o a/built-in.obuilt-in.o : $(subdir-y) $(cur_objs)\t@echo --------------------built-in.o begin---------------------------\t@echo subdir-y=$(subdir-y)\t@echo @=$@\t@echo cur_objs=$(cur_objs)\t@echo subdir_objs=$(subdir_objs)\t@echo obj-y=$(obj-y)\t@echo CFLAGS_sub3.o=$(CFLAGS_sub3.o)\t$(LD) -r -o $@ $(cur_objs) $(subdir_objs)\t@echo --------------------built-in.o end---------------------------dep_file = .$@.d%.o : %.c\t$(CC) $(CFLAGS) $(EXTRA_CFLAGS) $(CFLAGS_$@) -Wp,-MD,$(dep_file) -c -o $@ $\t.PHONY : $(PHONY) å­ç›®å½•ä¸‹çš„Makefileç›®å½•ï¼ša/Makefile # -D å³define ç›¸å½“äºåœ¨å¤´æ–‡ä»¶ä¸­å®šä¹‰äº†å®ï¼šDEBUGEXTRA_CFLAGS := -D DEBUG# å•ç‹¬ç»™sub3.c å®šä¹‰äº†å®ï¼šDEBUG_SUB3 åªé€‚ç”¨äºsub3.o å¹¶ä¸é€‚ç”¨sub2.oCFLAGS_sub3.o := -D DEBUG_SUB3obj-y += sub2.o obj-y += sub3.o makeè¾“å‡ºç»“æœmake -C ./ -f /home/book/Makefile_example/Makefile.buildmake[1]: Entering directory /home/book/Makefile_example--------------------subdir-y begin---------------------------subdir-y= a@=aTOPDIR=/home/book/Makefile_examplemake -C a -f /home/book/Makefile_example/Makefile.buildmake[2]: Entering directory /home/book/Makefile_example/agcc -Wall -O2 -g -I /home/book/Makefile_example/include -D DEBUG -Wp,-MD,.sub2.o.d -c -o sub2.o sub2.cgcc -Wall -O2 -g -I /home/book/Makefile_example/include -D DEBUG -D DEBUG_SUB3 -Wp,-MD,.sub3.o.d -c -o sub3.o sub3.c--------------------built-in.o begin---------------------------subdir-y=@=built-in.ocur_objs=sub2.o sub3.osubdir_objs=obj-y= sub2.o sub3.oCFLAGS_sub3.o=-D DEBUG_SUB3ld -r -o built-in.o sub2.o sub3.o --------------------built-in.o end---------------------------make[2]: Leaving directory /home/book/Makefile_example/a--------------------subdir-y end---------------------------gcc -Wall -O2 -g -I /home/book/Makefile_example/include -Wp,-MD,.main.o.d -c -o main.o main.cgcc -Wall -O2 -g -I /home/book/Makefile_example/include -Wp,-MD,.sub.o.d -c -o sub.o sub.c--------------------built-in.o begin---------------------------subdir-y= a@=built-in.ocur_objs=main.o sub.osubdir_objs=a/built-in.oobj-y= main.o sub.o a/CFLAGS_sub3.o=ld -r -o built-in.o main.o sub.o a/built-in.o--------------------built-in.o end---------------------------make[1]: Leaving directory /home/book/Makefile_example------------------start_recursive_build end-------------------------------------------------test begin---------------------------------gcc -o test built-in.o -------------------------test end-----------------------------------test has been built! åˆ†æè¿‡ç¨‹1.é¡¶å±‚ç›®å½•æ‰§è¡Œmakeä¹‹åï¼Œå…ˆä¼šæ‰§è¡Œç¬¬ä¸€ä¸ªç›®æ ‡all ï¼Œallä¾èµ–äºstart_recursive_buildå’Œ$(TARGET),$(TARGET)å³æœ€ç»ˆç”Ÿæˆçš„testã€‚æ‰€ä»¥å…ˆä¼šæ‰§è¡Œstart_recursive_buildè¿™ä¸ªç›®æ ‡ä¸‹çš„è§„åˆ™æ¥ç”Ÿæˆbuilt-in.oï¼Œæ¥ç€æ‰§è¡Œtestè¿™ä¸ªç›®æ ‡ä¸‹çš„è§„åˆ™ï¼Œå°†ç”Ÿæˆçš„built-in.oæ–‡ä»¶é“¾æ¥ç”Ÿæˆtestæœ€ç»ˆæ–‡ä»¶ 2.æœ€é‡è¦çš„æ˜¯start_recursive_build beginè¿™ä¸ªç›®æ ‡å¦‚ä½•åœ¨å„ä¸ªæºä»£ç ç›®å½•ä¸‹ç”Ÿæˆå„è‡ªçš„built-in.o. 2.1æ‰§è¡Œmake -C ./ -f $(TOPDIR)/Makefile.buildå‘½ä»¤ï¼Œè¿›å…¥å½“å‰ç›®å½•ï¼ˆè¿˜æ˜¯å½“å‰ç›®å½•ï¼Œæ²¡å˜ï¼‰ï¼Œä½¿ç”¨é¡¶å±‚ç›®å½•ï¼ˆè¿˜æ˜¯å½“å‰ç›®å½•ï¼‰ä¸‹çš„Makefile.buildä½œä¸ºmakeæ‰§è¡Œçš„makefileæ–‡ä»¶ã€‚ 2.1åœ¨Makefile.buildæ–‡ä»¶ä¸­ï¼Œé¦–å…ˆæ˜¯obj-y ,subdir-yï¼ŒEXTRA_CFLAGSè¿™äº›å˜é‡çš„æ¸…æ¥šï¼Œç„¶åå†é‡æ–°èµ‹å€¼ã€‚ä¸å†è¯¦ç»†åˆ†æã€‚ä¸»è¦çœ‹__build : $(subdir-y) built-in.oï¼Œåœ¨å½“å‰æƒ…å†µä¸‹subdir-yå°±æ˜¯aï¼Œæ‰§è¡Œ$(subdir-y):ä¸‹çš„è§„åˆ™make -C $@ -f $(TOPDIR)/Makefile.buildï¼Œè¿›å…¥aç›®å½•ï¼Œä½¿ç”¨é¡¶å±‚ç›®å½•ä¸‹çš„Makefile.buildå¯¹aç›®å½•ä¸‹çš„æ–‡ä»¶è¿›è¡Œå¤„ç†ã€‚å› ä¸ºaç›®å½•ä¸‹çš„makefileåšäº†ä¸€äº›å˜é‡çš„èµ‹å€¼æ“ä½œï¼Œæ‰€ä»¥æ­¤æ—¶çš„obj-y= sub2.o sub3.o CFLAGS_sub3.o=-D DEBUG_SUB3ã€‚æ‰€ä»¥æ­¤æ—¶çš„%.o : %.cè§„åˆ™å°±å±•å¼€æˆäº†è¿™ä¸ªæ ·å­ %.o : %.c\t$(CC) $(CFLAGS) $(EXTRA_CFLAGS) $(CF å±•å¼€ä¸ºï¼š gcc -Wall -O2 -g -I /home/book/Makefile_example/include -D DEBUG -Wp,-MD,.sub2.o.d -c -o sub2.o sub2.cgcc -Wall -O2 -g -I /home/book/Makefile_example/include -D DEBUG -D DEBUG_SUB3 -Wp,-MD,.sub3.o.d -c -o sub3.o sub3.c è¿™æ ·å°±ç”Ÿæˆäº†sub2.oå’Œsub3.o.ä½†æ˜¯æ­¤æ—¶è¿˜æ²¡å®Œï¼Œå› ä¸ºæˆ‘ä»¬çš„ç›®æ ‡æ˜¯åœ¨å­ç›®å½•ä¸‹ç”Ÿæˆa/built-in.o 2.2åœ¨å­ç›®å½•aä¸­å½“ç„¶ä¹Ÿä¼šæ‰§è¡Œåˆ°built-in.o : $(subdir-y) $(cur_objs),æ­¤æ—¶subdir-yä¸ºç©ºï¼Œå› ä¸ºaä¸‹é¢æ²¡æœ‰å­ç›®å½•äº†ã€‚è€Œcur_objs=sub2.o sub3.oã€‚æ­¤æ—¶é€šè¿‡è§„åˆ™$(LD) -r -o $@ $(cur_objs) $(subdir_objs)æ¥å°†sub2.o sub3.oé“¾æ¥æˆa/built-in.oã€‚è¿™ä¸ªå‘½ä»¤å±•å¼€å®é™…ä¸ºï¼š ld -r -o built-in.o sub2.o sub3.o æ­¤æ—¶å°±å®Œæˆäº†æˆ‘ä»¬çš„ä»»åŠ¡ï¼šç”Ÿæˆ:a/built-in.o. æ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯çœ‹åˆ°makeè¾“å‡ºï¼šç¦»å¼€aæ–‡ä»¶å¤¹ make[2]: Leaving directory /home/book/Makefile_example/a 3.å›åˆ°ä¸»ç›®å½•ä¹‹åï¼Œç»§ç»­ä½¿ç”¨makefile.buildæ¥å¤„ç†é¡¶å±‚æ–‡ä»¶å¤¹çš„æºæ–‡ä»¶ã€‚æ¯”å¦‚å°†main.c sub.cæ–‡ä»¶è½¬æ¢æˆ.o.dæ–‡ä»¶ï¼ˆå½“ç„¶åœ¨aç›®å½•ä¸‹ä¹Ÿåšäº†è¿™ä¸ªå·¥ä½œï¼‰ã€‚æ¥ä¸‹æ¥çš„å·¥ä½œå°±æ˜¯ç”Ÿæˆé¡¶å±‚ç›®å½•ä¸‹çš„built-in.oæ–‡ä»¶ã€‚æ³¨æ„æ­¤æ—¶makeå·²ç»åˆ‡æ¢åˆ°äº†é¡¶å±‚ç›®å½•ã€‚æ­¤æ—¶subdir-y=a,cur_objs=main.o sub.o subdir_objs=a/built-in.oã€‚æ­¤æ—¶é€šè¿‡è§„åˆ™$(LD) -r -o $@ $(cur_objs) $(subdir_objs)æ¥å°†main.o sub.o a/built-in.oé“¾æ¥æˆé¡¶å±‚ç›®å½•ä¸‹çš„built-in.o è¿™ä¸ªå‘½ä»¤å±•å¼€å®é™…ä¸º ld -r -o built-in.o main.o sub.o a/built-in.o 3.1è‡³æ­¤ï¼Œbuilt-in.oçš„ç”Ÿæˆå·¥ä½œå°±å¤§åŠŸå‘Šæˆäº†ï¼Œæ­¤æ—¶å¯ä»¥çœ‹åˆ°makeç¦»å¼€æ–‡ä»¶å¤¹ï¼ˆä¸çŸ¥é“ç¦»å¼€äº†æ²¡ï¼Œæˆ‘æ„Ÿè§‰æ²¡æœ‰ï¼‰ï¼Œstart_recursive_build endend. make[1]: Leaving directory /home/book/Makefile_example 4.ç°åœ¨é¡¶å±‚ç›®å½•çš„built-in.oå·²ç»æœ‰äº†ï¼Œé¡¶å±‚ç›®å½•ä¸‹çš„built-in.oæ±‡èšäº†æ‰€æœ‰å­ç›®å½•çš„.oä¿¡æ¯ä»¥åŠmain.oçš„ä¿¡æ¯ã€‚åªéœ€è¦é€šè¿‡gcc -o test built-in.o å³å¯ç”Ÿæˆæˆ‘ä»¬çš„æœ€ç»ˆç›®æ ‡test 5.æœ€ç»ˆstart_recursive_buildå’Œ$(TARGET)éƒ½æœ‰äº†ï¼Œæ‰“å°è¾“å‡ºï¼š test has been built! Makefileé›¶ç¢çŸ¥è¯†ç‚¹ç›®æ ‡å†’å·åé¢æ²¡æœ‰ä¾èµ–é¡¹çš„æƒ…å†µå¯¹äºåªæœ‰ç›®æ ‡è€Œæ²¡æœ‰ä¾èµ–é¡¹çš„æƒ…å†µï¼Œè¯´æ˜è¯¥ç›®æ ‡ä¸ä¾èµ–ä»»ä½•æ–‡ä»¶æˆ–è€…ç›®æ ‡ï¼Œç›´æ¥æ‰§è¡Œåé¢çš„å‘½ä»¤ã€‚è¿™ç§æƒ…å†µä¸€èˆ¬ç”¨äºä¼ªç›®æ ‡ã€‚ å¸¸è§çš„ä¼ªç›®æ ‡æœ‰ï¼šclean install help æ¸…ç†æ“ä½œ clean:\trm -f *.o å®‰è£…æ“ä½œ install: modules_install\t$(MAKE) -C $(KERNELDIR) M=$(shell pwd) $@\tmodules_install:\t$(MAKE) -C $(KERNELDIR) M=$(shell pwd) $@ install ç›®æ ‡ä¾èµ–äº modules_installï¼Œä½†è¿™é‡Œæˆ‘ä»¬å…³æ³¨çš„æ˜¯ modules_install è‡ªèº«ã€‚modules_install æ²¡æœ‰ä¾èµ–é¡¹ï¼Œç›´æ¥æ‰§è¡Œå‘½ä»¤è¿›å…¥å†…æ ¸æºç ç›®å½•å¹¶å®‰è£…æ¨¡å— å…¶æ‰§è¡Œé€»è¾‘å¤§æ¦‚å°±æ˜¯makeåˆ¤æ–­å½“å‰ç›®æ ‡æ˜¯å¦æ¯”ä¾èµ–æ–°ï¼Œç»“æœæ²¡æœ‰å‘ç°ç›®æ ‡æ–‡ä»¶ï¼Œå½“ç„¶ä¸å¯èƒ½æ¯”ä¾èµ–æ–°ï¼Œå°±æ‰§è¡Œåé¢çš„è¯­å¥ã€‚ä½†æ˜¯å½“Makefileç›®å½•ä¸‹å¦‚æœæœ‰cleanæ–‡ä»¶æ—¶å€™ï¼Œå†æ‰§è¡Œmakeæ—¶å€™å°±ä¼šæç¤ºmake: clean is up to date.ã€‚å¦‚æœæƒ³é¿å…è¿™ç§æƒ…å†µï¼Œå°±éœ€è¦ä½¿ç”¨ .PHONY : cleanå‘Šè¯‰make cleanæ˜¯ä¸ªä¼ªç›®æ ‡ï¼Œä¸ç®¡æœ‰æ²¡æœ‰cleanè¿™ä¸ªæ–‡ä»¶ã€‚ ä¸ºä»€ä¹ˆä½¿ç”¨æ— ä¾èµ–é¡¹çš„ç›®æ ‡ï¼Ÿ ä¼ªç›®æ ‡ï¼šç”¨äºè§¦å‘ç‰¹å®šæ“ä½œè€Œéç”Ÿæˆæ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œcleanã€installã€help ç­‰ç›®æ ‡é€šå¸¸ä¸ç”Ÿæˆå®é™…æ–‡ä»¶ï¼Œè€Œæ˜¯æ‰§è¡Œæ¸…ç†ã€å®‰è£…æˆ–æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ç­‰æ“ä½œã€‚ ç®€åŒ–é€»è¾‘ï¼šæŸäº›æ“ä½œä¸éœ€è¦ä¾èµ–å…¶ä»–æ–‡ä»¶æˆ–ç›®æ ‡ï¼Œç›´æ¥æ‰§è¡Œå‘½ä»¤å³å¯ã€‚ä¾‹å¦‚ï¼Œæ¸…ç†æ“ä½œåªéœ€è¦åˆ é™¤ç‰¹å®šæ–‡ä»¶ï¼Œè€Œä¸éœ€è¦ç­‰å¾…å…¶ä»–æ–‡ä»¶ç”Ÿæˆã€‚ çµæ´»æ€§ï¼šå…è®¸å¼€å‘è€…å®šä¹‰ä»»æ„æ•°é‡çš„ä¼ªç›®æ ‡ï¼Œæ–¹ä¾¿æ‰©å±•å’Œç»´æŠ¤ Makefileã€‚ å¤šä¸ªç›®æ ‡å…±äº«åŒä¸€ç»„å‘½ä»¤modules modules_install help clean:\t$(MAKE) -C $(KERNELDIR) M=$(shell pwd) $@ å½“è°ƒç”¨è¿™äº›ç›®æ ‡ä¸­çš„ä»»ä½•ä¸€ä¸ªæ—¶ï¼Œéƒ½ä¼šæ‰§è¡Œç›¸åŒçš„å‘½ä»¤ï¼Œå³è¿›å…¥å†…æ ¸æºç ç›®å½•å¹¶æ ¹æ®ç›®æ ‡åç§°æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚ é»˜è®¤æ‰§è¡Œç¬¬ä¸€ä¸ªç›®æ ‡å¦‚æœæœ‰å¤šä¸ªä¼ªç›®æ ‡ï¼Œé»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨makeå‘½ä»¤æŒ‡æŒ¥æ‰§è¡Œç¬¬ä¸€ä¸ªç›®æ ‡ã€‚ä¾‹å¦‚ä¸€ä¸ªå®Œæ•´çš„Makefileå†…å®¹å¦‚ä¸‹(æµ‹è¯•ç”¨ä¾‹)ï¼Œé»˜è®¤æ˜¯æ‰§è¡Œç¬¬ä¸€ä¸ªç›®æ ‡helpï¼Œå¯ä»¥ä½¿ç”¨make cleanæ‰§è¡Œcleanç›®æ ‡ã€‚ help:\t@echo Available targets:\t@echo all - Build the module\t@echo install - Install the module\t@echo clean - Clean up build filesclean:\trm -f *.o make -C directory [target] -C directoryï¼šè¡¨ç¤ºè¿›å…¥æŒ‡å®šçš„ç›®å½• directoryï¼Œç„¶ååœ¨è¯¥ç›®å½•ä¸­æ‰§è¡ŒMakeå‘½ä»¤ [target]ï¼šå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºè¦æ‰§è¡Œçš„ç›®æ ‡ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šç›®æ ‡ï¼Œåˆ™é»˜è®¤æ‰§è¡ŒMakefileä¸­çš„ç¬¬ä¸€ä¸ªç›®æ ‡ã€‚ æ“ä½œç¤ºä¾‹1ï¼šæ‰§è¡Œå‘½ä»¤make -C testï¼Œè¾“å‡ºä¸ºã€‚è¿™ä¸ªæ¡ˆä¾‹çš„Makefileå†…å®¹å°±æ˜¯ä¸Šæ–‡åªåŒ…å«helpå’Œcleançš„é‚£ä¸ªã€‚ book@100ask:~/Documents/makefile_learn$ make -C testmake: Entering directory /home/book/Documents/makefile_learn/testAvailable targets: all - Build the module install - Install the module clean - Clean up build filesmake: Leaving directory /home/book/Documents/makefile_learn/test æ“ä½œç¤ºä¾‹2ï¼šæ‰§è¡Œå‘½ä»¤make -C test clean book@100ask:~/Documents/makefile_learn$ make -C test clean make: Entering directory /home/book/Documents/makefile_learn/testrm -f *.omake: Leaving directory /home/book/Documents/makefile_learn/test make -C directory -f makefile -C directoryï¼šè¡¨ç¤ºè¿›å…¥æŒ‡å®šçš„ç›®å½• directoryï¼Œç„¶ååœ¨è¯¥ç›®å½•ä¸­æ‰§è¡ŒMakeå‘½ä»¤ã€‚ -f makefileï¼šæŒ‡å®šè¦ä½¿ç”¨çš„Makefileæ–‡ä»¶ä¸º makefileã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œmake ä¼šæŸ¥æ‰¾åä¸º Makefile æˆ– makefile çš„æ–‡ä»¶ï¼Œä½†ä½¿ç”¨ -f å¯ä»¥æ˜ç¡®æŒ‡å®šå…¶ä»–æ–‡ä»¶ã€‚ make -C ./ -f $(TOPDIR)/Makefile.build -C ./ï¼šè¡¨ç¤ºè¿›å…¥å½“å‰ç›®å½•ï¼ˆ. è¡¨ç¤ºå½“å‰ç›®å½•ï¼‰ã€‚è¿™é€šå¸¸ç”¨äºç¡®ä¿åœ¨ç‰¹å®šçš„å·¥ä½œç›®å½•ä¸­æ‰§è¡ŒMakeæ“ä½œã€‚ -f $(TOPDIR)/Makefile.buildï¼šæŒ‡å®šä½¿ç”¨ä½äº $(TOPDIR) ç›®å½•ä¸‹çš„ Makefile.build æ–‡ä»¶ä½œä¸ºMakefileã€‚$(TOPDIR) æ˜¯ä¸€ä¸ªå˜é‡ï¼Œé€šå¸¸å®šä¹‰ä¸ºé¡¹ç›®çš„é¡¶å±‚ç›®å½•è·¯å¾„ã€‚ é™„å½•ï¼šç¤ºä¾‹Cä»£ç main.c#include stdio.hextern void sub_fun(void);extern void sub2_fun(void);void sub3_fun(void);int main(int argc, char* argv[]) printf(Main fun! ); sub_fun(); sub2_fun(); sub3_fun(); return 0; sub.c#include stdio.h#include sub.hvoid sub_fun(void) printf(Sub fun, A = %d! , A); asub2.c#include stdio.h#include sub2.hvoid sub2_fun(void) printf(Sub2 fun, B = %d! , B); #ifdef DEBUG\tprintf(%s %s line %d , __FILE__, __FUNCTION__, __LINE__);#endif asub3.c#include stdio.h#include sub3.hvoid sub3_fun(void) printf(Sub3 fun, C = %d! , C);\t#ifdef DEBUG printf(%s %s line %d , __FILE__, __FUNCTION__, __LINE__);#endif#ifdef DEBUG_SUB3 printf(It is only debug info for sub3. );#endif includesub.h#define A 1void sub_fun(void); includesub2.h#define B 2void sub2_fun(void); includesub3.h#define B 2void sub2_fun(void); Makefileæ¨¡æ¿é¡¶å±‚Makefile# å¦‚æœç»™pcæœºç¼–è¯‘åˆ™ä¸éœ€è¦è®¾ç½®ï¼Œå¦‚æœç»™armæ¿ç¼–è¯‘åˆ™éœ€è¦è®¾ç½®# arm-buildroot-linux-gnueabihf-CROSS_COMPILE = AS = $(CROSS_COMPILE)asLD = $(CROSS_COMPILE)ldCC = $(CROSS_COMPILE)gccCPP = $(CC) -EAR = $(CROSS_COMPILE)arNM = $(CROSS_COMPILE)nmSTRIP = $(CROSS_COMPILE)stripOBJCOPY = $(CROSS_COMPILE)objcopyOBJDUMP = $(CROSS_COMPILE)objdumpexport AS LD CC CPP AR NMexport STRIP OBJCOPY OBJDUMPCFLAGS := -Wall -O2 -g# ä»¥åæ‰€æœ‰çš„.cæ–‡ä»¶éƒ½ä¼šå» å½“å‰ç›®å½•ä¸‹çš„includeç›®å½•ä¸‹æŸ¥æ‰¾å¤´æ–‡ä»¶ï¼Œç»™æ‰€æœ‰çš„.cæ–‡ä»¶éƒ½è¦ç”¨åˆ°è¿™ä¸ªå±æ€§CFLAGS += -I $(shell pwd)/include# é“¾æ¥é€‰é¡¹ å¯ä»¥æŒ‡å®šåº“åœ¨å“ªé‡Œï¼Œéœ€è¦é“¾æ¥å“ªäº›åº“ LDFLAGS := -L dir -l libnameLDFLAGS := export CFLAGS LDFLAGSTOPDIR := $(shell pwd)export TOPDIRTARGET := testobj-y += main.oobj-y += sub.oobj-y += a/all : start_recursive_build $(TARGET)\t@echo $(TARGET) has been built!start_recursive_build:\tmake -C ./ -f $(TOPDIR)/Makefile.build$(TARGET) : start_recursive_build\t$(CC) -o $(TARGET) built-in.o $(LDFLAGS)clean:\trm -f $(shell find -name *.o)\trm -f $(TARGET)distclean:\trm -f $(shell find -name *.o)\trm -f $(shell find -name *.d)\trm -f $(TARGET) é¡¶å±‚ç›®å½•Makefile.buildPHONY := __build__build:obj-y :=subdir-y :=EXTRA_CFLAGS :=include Makefile# obj-y := a.o b.o c/ d/# $(filter %/, $(obj-y)) : c/ d/# __subdir-y : c d# subdir-y : c d__subdir-y\t:= $(patsubst %/,%,$(filter %/, $(obj-y)))subdir-y\t+= $(__subdir-y)# c/built-in.o d/built-in.osubdir_objs := $(foreach f,$(subdir-y),$(f)/built-in.o)# a.o b.ocur_objs := $(filter-out %/, $(obj-y))dep_files := $(foreach f,$(cur_objs),.$(f).d)dep_files := $(wildcard $(dep_files))ifneq ($(dep_files),) include $(dep_files)endifPHONY += $(subdir-y)__build : $(subdir-y) built-in.o$(subdir-y):\tmake -C $@ -f $(TOPDIR)/Makefile.buildbuilt-in.o : $(subdir-y) $(cur_objs)\t$(LD) -r -o $@ $(cur_objs) $(subdir_objs)dep_file = .$@.d%.o : %.c\t$(CC) $(CFLAGS) $(EXTRA_CFLAGS) $(CFLAGS_$@) -Wp,-MD,$(dep_file) -c -o $@ $\t.PHONY : $(PHONY) å­ç›®å½•Makefileä¸€èˆ¬æ˜¯æŒ‡å®šæºæ–‡ä»¶å’Œç¼–è¯‘é€‰é¡¹ # EXTRA_CFLAGS := -D DEBUG# CFLAGS_sub3.o := -D DEBUG_SUB3obj-y += sub2.o obj-y += sub3.o ä½¿ç”¨è¯´æ˜æœ¬ç¨‹åºçš„Makefileåˆ†ä¸º3ç±»:1. é¡¶å±‚ç›®å½•çš„Makefile2. é¡¶å±‚ç›®å½•çš„Makefile.build3. å„çº§å­ç›®å½•çš„Makefileä¸€ã€å„çº§å­ç›®å½•çš„Makefileï¼š å®ƒæœ€ç®€å•ï¼Œå½¢å¼å¦‚ä¸‹ï¼šEXTRA_CFLAGS := CFLAGS_file.o := obj-y += file.oobj-y += subdir/ obj-y += file.o è¡¨ç¤ºæŠŠå½“å‰ç›®å½•ä¸‹çš„file.cç¼–è¿›ç¨‹åºé‡Œï¼Œ obj-y += subdir/ è¡¨ç¤ºè¦è¿›å…¥subdirè¿™ä¸ªå­ç›®å½•ä¸‹å»å¯»æ‰¾æ–‡ä»¶æ¥ç¼–è¿›ç¨‹åºé‡Œï¼Œæ˜¯å“ªäº›æ–‡ä»¶ç”±subdirç›®å½•ä¸‹çš„Makefileå†³å®šã€‚ EXTRA_CFLAGS, å®ƒç»™å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶(ä¸å«å…¶ä¸‹çš„å­ç›®å½•)è®¾ç½®é¢å¤–çš„ç¼–è¯‘é€‰é¡¹, å¯ä»¥ä¸è®¾ç½® CFLAGS_xxx.o, å®ƒç»™å½“å‰ç›®å½•ä¸‹çš„xxx.cè®¾ç½®å®ƒè‡ªå·±çš„ç¼–è¯‘é€‰é¡¹, å¯ä»¥ä¸è®¾ç½®æ³¨æ„: 1. subdir/ä¸­çš„æ–œæ /ä¸å¯çœç•¥2. é¡¶å±‚Makefileä¸­çš„CFLAGSåœ¨ç¼–è¯‘ä»»æ„ä¸€ä¸ª.cæ–‡ä»¶æ—¶éƒ½ä¼šä½¿ç”¨3. CFLAGS EXTRA_CFLAGS CFLAGS_xxx.o ä¸‰è€…ç»„æˆxxx.cçš„ç¼–è¯‘é€‰é¡¹äºŒã€é¡¶å±‚ç›®å½•çš„Makefileï¼š å®ƒé™¤äº†å®šä¹‰obj-yæ¥æŒ‡å®šæ ¹ç›®å½•ä¸‹è¦ç¼–è¿›ç¨‹åºå»çš„æ–‡ä»¶ã€å­ç›®å½•å¤–ï¼Œ ä¸»è¦æ˜¯å®šä¹‰å·¥å…·é“¾å‰ç¼€CROSS_COMPILE, å®šä¹‰ç¼–è¯‘å‚æ•°CFLAGS, å®šä¹‰é“¾æ¥å‚æ•°LDFLAGS, è¿™äº›å‚æ•°å°±æ˜¯æ–‡ä»¶ä¸­ç”¨exportå¯¼å‡ºçš„å„å˜é‡ã€‚ä¸‰ã€é¡¶å±‚ç›®å½•çš„Makefile.buildï¼š è¿™æ˜¯æœ€å¤æ‚çš„éƒ¨åˆ†ï¼Œå®ƒçš„åŠŸèƒ½å°±æ˜¯æŠŠæŸä¸ªç›®å½•åŠå®ƒçš„æ‰€æœ‰å­ç›®å½•ä¸­ã€éœ€è¦ç¼–è¿›ç¨‹åºå»çš„æ–‡ä»¶éƒ½ç¼–è¯‘å‡ºæ¥ï¼Œæ‰“åŒ…ä¸ºbuilt-in.o è¯¦ç»†çš„è®²è§£è¯·çœ‹è§†é¢‘ã€‚å››ã€æ€ä¹ˆä½¿ç”¨è¿™å¥—Makefileï¼š1ï¼æŠŠé¡¶å±‚Makefile, Makefile.buildæ”¾å…¥ç¨‹åºçš„é¡¶å±‚ç›®å½• åœ¨å„è‡ªå­ç›®å½•åˆ›å»ºä¸€ä¸ªç©ºç™½çš„Makefile2ï¼ç¡®å®šç¼–è¯‘å“ªäº›æºæ–‡ä»¶ ä¿®æ”¹é¡¶å±‚ç›®å½•å’Œå„è‡ªå­ç›®å½•Makefileçš„obj-y : obj-y += xxx.o\tobj-y += yyy/\tè¿™è¡¨ç¤ºè¦ç¼–è¯‘å½“å‰ç›®å½•ä¸‹çš„xxx.c, è¦ç¼–è¯‘å½“å‰ç›®å½•ä¸‹çš„yyyå­ç›®å½•\t3. ç¡®å®šç¼–è¯‘é€‰é¡¹ã€é“¾æ¥é€‰é¡¹ ä¿®æ”¹é¡¶å±‚ç›®å½•Makefileçš„CFLAGSï¼Œè¿™æ˜¯ç¼–è¯‘æ‰€æœ‰.cæ–‡ä»¶æ—¶éƒ½è¦ç”¨çš„ç¼–è¯‘é€‰é¡¹; ä¿®æ”¹é¡¶å±‚ç›®å½•Makefileçš„LDFLAGSï¼Œè¿™æ˜¯é“¾æ¥æœ€åçš„åº”ç”¨ç¨‹åºæ—¶çš„é“¾æ¥é€‰é¡¹; ä¿®æ”¹å„è‡ªå­ç›®å½•ä¸‹çš„Makefileï¼š EXTRA_CFLAGS, å®ƒç»™å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶(ä¸å«å…¶ä¸‹çš„å­ç›®å½•)è®¾ç½®é¢å¤–çš„ç¼–è¯‘é€‰é¡¹, å¯ä»¥ä¸è®¾ç½® CFLAGS_xxx.o, å®ƒç»™å½“å‰ç›®å½•ä¸‹çš„xxx.cè®¾ç½®å®ƒè‡ªå·±çš„ç¼–è¯‘é€‰é¡¹, å¯ä»¥ä¸è®¾ç½® 4. ä½¿ç”¨å“ªä¸ªç¼–è¯‘å™¨ï¼Ÿ ä¿®æ”¹é¡¶å±‚ç›®å½•Makefileçš„CROSS_COMPILE, ç”¨æ¥æŒ‡å®šå·¥å…·é“¾çš„å‰ç¼€(æ¯”å¦‚arm-linux-) 5. ç¡®å®šåº”ç”¨ç¨‹åºçš„åå­—ï¼š ä¿®æ”¹é¡¶å±‚ç›®å½•Makefileçš„TARGET, è¿™æ˜¯ç”¨æ¥æŒ‡å®šç¼–è¯‘å‡ºæ¥çš„ç¨‹åºçš„åå­—6. æ‰§è¡Œmakeæ¥ç¼–è¯‘ï¼Œæ‰§è¡Œmake cleanæ¥æ¸…é™¤ï¼Œæ‰§è¡Œmake distcleanæ¥å½»åº•æ¸…é™¤ å‚è€ƒéŸ¦ä¸œå±±ã€Šé€šç”¨Makefileçš„ä½¿ç”¨ã€‹","tags":["linux","makefile"],"categories":["c"]},{"title":"typedefæ€»ç»“","path":"/2024/10/18/typedefæ€»ç»“/","content":"typedefæ€»ç»“CC++ typedefç”¨æ³•è¯¦è§£ï¼ˆçœŸçš„å¾ˆè¯¦ç»†ï¼‰-CSDNåšå®¢ ä»¥ä¸‹æ˜¯3ä¸­å¸¸è§çš„é€šè¿‡typedefå®šä¹‰é‡å‘½åç»“æ„ä½“çš„å½¢å¼ï¼š åŒ¿åæ–¹å¼å®šä¹‰ç»“æ„ä½“ typedef struct int a; char b; mystruct;//ä½¿ç”¨mystruct s1; å‘½åæ–¹å¼å®šä¹‰ç»“æ„ä½“(ç”¨çš„æœ€å¤š) typedef struct mystruct int a; char b; T_mystruct;//ä½¿ç”¨T_mystruct s1; T_mystructä¸ºstruct mystruct å®šä¹‰äº†ä¸€ä¸ªç±»å‹åˆ«å å®šä¹‰äº†ä¸€ä¸ªç»“æ„ä½“ï¼šmystruct.å¯ä»¥é€šè¿‡struct mystruct xxx;æ¥å®šä¹‰ç»“æ„ä½“ æ›´æ¨èçš„è§„èŒƒåšæ³•(å®é™…ä¸Šæ„Ÿè§‰ç”¨çš„å¾ˆå°‘)ï¼š struct mystruct int a; int b;;typedef struct mystruct T_mystruct;//typedef struct mystruct pT_mystruct; è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªåä¸º mystruct çš„ç»“æ„ä½“ï¼ŒåŒ…å«ä¸¤ä¸ªæ•´æ•°æˆå‘˜ a å’Œ bã€‚ ä½¿ç”¨ typedef ä¸º struct mystruct å®šä¹‰äº†ä¸€ä¸ªåˆ«å T_mystruct T_mystruct å¯ä»¥ç”¨æ¥å£°æ˜ mystruct ç±»å‹çš„å˜é‡","tags":["linux","typedef"],"categories":["c"]},{"title":"ä¸‰æ•°ä¹‹å’Œ","path":"/2024/10/15/leetcodeåˆ·é¢˜/æ¯æ—¥ä¸€åˆ·day37(æ¢¦ç ´ç¢çš„åœ°æ–¹)/","content":"æ¢¦ç ´ç¢çš„åœ°æ–¹ï¼ŒçœŸæ˜¯å¤ªéš¾äº†.-_-â€¦ ä¸‰æ•°ä¹‹å’Œï¼šæ¢¦ç ´ç¢çš„åœ°æ–¹é¢˜ç›®ï¼šä¸‰æ•°ä¹‹å’Œç»™ä½ ä¸€ä¸ªåŒ…å« n ä¸ªæ•´æ•°çš„æ•°ç»„ numsï¼Œåˆ¤æ–­ nums ä¸­æ˜¯å¦å­˜åœ¨ä¸‰ä¸ªå…ƒç´  aï¼Œbï¼Œc ï¼Œä½¿å¾— a + b + c 0 ï¼Ÿè¯·ä½ æ‰¾å‡ºæ‰€æœ‰æ»¡è¶³æ¡ä»¶ä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚æ³¨æ„ï¼š ç­”æ¡ˆä¸­ä¸å¯ä»¥åŒ…å«é‡å¤çš„ä¸‰å…ƒç»„ã€‚ç¤ºä¾‹ï¼šç»™å®šæ•°ç»„ nums [-1, 0, 1, 2, -1, -4]ï¼Œæ»¡è¶³è¦æ±‚çš„ä¸‰å…ƒç»„é›†åˆä¸ºï¼š [ [-1, 0, 1], [-1, -1, 2] ] è§£æ³•-åŒæŒ‡é’ˆæ³•æ€è·¯ï¼š 1.2.3. å¤æ‚åº¦ï¼š æ—¶é—´å¤æ‚åº¦ï¼š ç©ºé—´å¤æ‚åº¦ï¼š ä»£ç ï¼šï¼ˆæˆåŠŸæäº¤ä½†æ˜¯æœ‰é€»è¾‘é”™è¯¯å’Œæ³¨é‡Šç†è§£é”™è¯¯ï¼‰ #include vector#include algorithm#include iostreamusing namespace std;class Solution public: vectorvectorint threeSum(vectorint nums) vectorvectorint result; //è®¡ç®—nums[i] + nums[left] + nums[right] = 0; //å…ˆå¯¹nums[]è¿›è¡Œä¸€æ¬¡æ’åºï¼Œæ–¹ä¾¿åˆ¤æ–­ sort(nums.begin(),nums.end()); for(int i = 0;i nums.size();i++) cout nums[i] ; cout endl; //éå†æ•°ç»„ for(int i = 0;i nums.size();i++) //aå»é‡ï¼Œåˆ¤æ–­é¦–ä½å…ƒç´ æ˜¯å¦å¤§äº0ï¼Œå¦‚æœå¤§äº0ï¼Œåˆ™ä¸‰ä¸ªæ­£æ•°ç›¸åŠ ä¸ä¸º0 if(nums[i] 0)return result; //bå»é‡ if(i 0 nums[i] == nums[i-1]) continue; int left = i+1; int right = nums.size()-1; //å¼€å§‹æ”¶ç¼© while(leftright) //è¯´æ˜rightåå³äº† if(nums[i] + nums[left] + nums[right] 0) right--; else if(nums[i] + nums[left] + nums[right] 0) //è¯´æ˜leftåå·¦äº† left++; else if(nums[i] + nums[left] + nums[right]==0) result.push_back(vectorintnums[i],nums[left],nums[right]); //å»é‡ï¼Œå¦‚æœæœ‰çš„è¯ while(i0nums[left] == nums[left+1]) left++; while(i0nums[right] == nums[right-1]) right--; left++;right--; //if(nums[i] + nums[left] + nums[right]==0) // result.push_back(nums[i],nums[left],nums[right]); // //å»é‡ï¼Œå¦‚æœæœ‰çš„è¯ // while(i0nums[left] == nums[left+1]) left++; // while(i0nums[right] == nums[right-1]) right--; // left++;right--; // return result; ;int main() Solution solution; vectorint nums1 = -1,0,1,2,-1,-4; //vectorvectorint expected1 = -1, -1, 2, -1, 0, 1; vectorvectorint result1 = solution.threeSum(nums1); //éå†äºŒç»´æ•°ç»„ for (int i = 0; i result1.size(); i++) for (int j = 0; j result1[i].size(); j++) cout result1[i][j] ; cout endl; return 0; é”™è¯¯æè¿°ï¼š if(nums[i] 0){return result;}è¿™å¥è¯ä¸æ˜¯å¯¹aå»é‡ï¼Œè€Œæ˜¯åˆ¤æ–­é¦–ä½å…ƒç´ æ˜¯å¦å¤§äº0ï¼Œå¦‚æœå¤§äº0ï¼Œåˆ™ä¸‰ä¸ªæ­£æ•°ç›¸åŠ ä¸ä¸º0.ä¸‹ä¸€å¥if(i 0 nums[i] == nums[i-1])æ‰æ˜¯å¯¹aå»é‡ while(i0nums[left] == nums[left+1]) left++;é€»è¾‘é”™è¯¯ï¼Œåº”è¯¥æ”¹ä¸ºwhile(leftright nums[left] == nums[left+1]) left++;,i0çš„æ¡ä»¶åº”è¯¥ä¸å¯¹ï¼Œè™½ç„¶é€šè¿‡LeetCodeäº† ä»£ç (æ›´æ­£å) class Solution public: vectorvectorint threeSum(vectorint nums) vectorvectorint result; //è®¡ç®—nums[i] + nums[left] + nums[right] = 0; //å…ˆå¯¹nums[]è¿›è¡Œä¸€æ¬¡æ’åºï¼Œæ–¹ä¾¿åˆ¤æ–­ sort(nums.begin(),nums.end()); for(int i = 0;i nums.size();i++) cout nums[i] ; cout endl; //éå†æ•°ç»„ for(int i = 0;i nums.size();i++) //åˆ¤æ–­é¦–ä½å…ƒç´ æ˜¯å¦å¤§äº0ï¼Œå¦‚æœå¤§äº0ï¼Œåˆ™ä¸‰ä¸ªæ­£æ•°ç›¸åŠ ä¸ä¸º0 if(nums[i] 0)return result; //aå»é‡,å¦‚æœå¯ä»¥åŒ…å«é‡å¤çš„ä¸‰å…ƒç»„ï¼Œåˆ™æŠŠè¿™ä¸ªifè¯­å¥æ³¨é‡Šæ‰,è™½ç„¶ä¹Ÿä¸å¤ªèƒ½ä¿ç•™æ‰€æœ‰é‡å¤çš„ä¸‰å…ƒç»„ if(i 0 nums[i] == nums[i-1]) continue; int left = i+1; int right = nums.size()-1; //å¼€å§‹æ”¶ç¼© while(leftright) //è¯´æ˜rightåå³äº† if(nums[i] + nums[left] + nums[right] 0) right--; else if(nums[i] + nums[left] + nums[right] 0) //è¯´æ˜leftåå·¦äº† left++; else if(nums[i] + nums[left] + nums[right]==0) result.push_back(vectorintnums[i],nums[left],nums[right]); //å»é‡ï¼Œå¦‚æœæœ‰çš„è¯ //whileç›®çš„æ˜¯ä¸ºäº†ï¼šä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚ //å¦‚æœå¯ä»¥æœ‰é‡å¤çš„ä¸‰å…ƒç»„ï¼Œåˆ™æŠŠè¿™ä¸¤ä¸ªwhileæ³¨é‡Šæ‰ã€‚ //å®é™…æµ‹è¯•è™½ç„¶ä¹Ÿä¸å¤ªèƒ½ä¿ç•™æ‰€æœ‰é‡å¤çš„ä¸‰å…ƒç»„ï¼Œä¸è¿‡åº”è¯¥æ˜¯left++;right--;åŒæ—¶æ”¶ç¼©çš„ç¼˜æ•… while(leftright nums[left] == nums[left+1]) left++; cout left = left endl; while(leftright nums[right] == nums[right-1]) right--; cout right = right endl; left++;right--; return result; ; è¯­æ³•å°è®¡ è¯¥é¢˜æ²¡æœ‰è¯­æ³•å°è®¡ *","tags":["c++","ä¸‰æ•°ä¹‹å’Œ"],"categories":["C++åˆ·é¢˜ç¬”è®°"]},{"title":"å››æ•°ä¹‹å’Œä¹‹2","path":"/2024/10/15/leetcodeåˆ·é¢˜/æ¯æ—¥ä¸€åˆ·day38å››æ•°ä¹‹å’Œ/","content":"ä¸‰æ•°ä¹‹å’Œç»™æˆ‘å†™å´©æºƒäº†éƒ½ï¼Œä¸è¿‡æœ€åè¿˜æ˜¯ç†è§£äº†åŒæŒ‡é’ˆæ³•ã€‚å››æ•°ä¹‹å’Œè·Ÿä¸‰æ•°ä¹‹å’Œç”¨çš„æ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼ŒåŸºæœ¬å¯ä»¥å®Œå…¨ç…§ç€æŠ„ã€‚åˆå¯ä»¥ç»§ç»­é‡æ‹³å‡ºå‡»äº†ï¼ å››æ•°ä¹‹å’Œä¹‹2é¢˜ç›®ï¼šç»™ä½ ä¸€ä¸ªç”± n ä¸ªæ•´æ•°ç»„æˆçš„æ•°ç»„ nums ï¼Œå’Œä¸€ä¸ªç›®æ ‡å€¼ target ã€‚è¯·ä½ æ‰¾å‡ºå¹¶è¿”å›æ»¡è¶³ä¸‹è¿°å…¨éƒ¨æ¡ä»¶ä¸”ä¸é‡å¤çš„å››å…ƒç»„ [nums[a], nums[b], nums[c], nums[d]] ï¼ˆè‹¥ä¸¤ä¸ªå››å…ƒç»„å…ƒç´ ä¸€ä¸€å¯¹åº”ï¼Œåˆ™è®¤ä¸ºä¸¤ä¸ªå››å…ƒç»„é‡å¤ï¼‰ç»™ä½ ä¸€ä¸ªç”± n ä¸ªæ•´æ•°ç»„æˆçš„æ•°ç»„ nums ï¼Œå’Œä¸€ä¸ªç›®æ ‡å€¼ target ã€‚è¯·ä½ æ‰¾å‡ºå¹¶è¿”å›æ»¡è¶³ä¸‹è¿°å…¨éƒ¨æ¡ä»¶ä¸”ä¸é‡å¤çš„å››å…ƒç»„ [nums[a], nums[b], nums[c], nums[d]] ï¼ˆè‹¥ä¸¤ä¸ªå››å…ƒç»„å…ƒç´ ä¸€ä¸€å¯¹åº”ï¼Œåˆ™è®¤ä¸ºä¸¤ä¸ªå››å…ƒç»„é‡å¤ï¼‰ï¼š 0 = a, b, c, d n aã€bã€c å’Œ d äº’ä¸ç›¸åŒ(äº’ä¸ç›¸åŒæŒ‡çš„æ˜¯ç´¢å¼•ä¸åŒï¼Œå¹¶ä¸æ˜¯å€¼ä¸ç›¸åŒï¼Œå³å¯ä»¥åŒæ—¶æœ‰ä¸¤ä¸ª2ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ª2ä¸æ˜¯åŒä¸€ä¸ªæ•°)äº’ä¸ç›¸åŒï¼ša,b,c,d éƒ½æ˜¯å››ä¸ªä¸åŒçš„å…ƒç´ ï¼Œä½†å€¼å¯ä»¥ç›¸åŒã€‚ä¸å¦‚ä¸‰æ•°ä¹‹å’Œå¥½ç†è§£ nums[a] + nums[b] + nums[c] + nums[d] == target ä½ å¯ä»¥æŒ‰ ä»»æ„é¡ºåº è¿”å›ç­”æ¡ˆ ã€‚ç¤ºä¾‹ 1ï¼š è¾“å…¥ï¼šnums [1,0,-1,0,-2,2], target 0 è¾“å‡ºï¼š[[-2,-1,1,2],[-2,0,0,2],[-1,0,0,1]]ç¤ºä¾‹ 2ï¼š è¾“å…¥ï¼šnums [2,2,2,2,2], target 8 è¾“å‡ºï¼š[[2,2,2,2]] è§£æ³•-åŒæŒ‡é’ˆæ³•æ€è·¯ï¼š 1. 2. 3. å¤æ‚åº¦ï¼š æ—¶é—´å¤æ‚åº¦ï¼š ç©ºé—´å¤æ‚åº¦ï¼š ä»£ç ï¼š #include vector#include algorithm#include iostreamusing namespace std;class Solution public: vectorvectorint fourSum(vectorint nums, int target) vectorvectorint result; sort(nums.begin(),nums.end()); //è®¡ç®—nums[i]+nums[j]+nums[left]+nums[right] = target; for(int i=0;inums.size();i++) //aå»é‡ if(i0nums[i]targetnums[i]0)return result; if(i0nums[i] == nums[i-1] )continue; for(int j=i+1;jnums.size();j++) if(ji+1 nums[j] == nums[j-1])continue; int left = j+1; int right = nums.size()-1; while(leftright) //è¯´æ˜rightåå³äº† if(nums[i]+nums[j]+nums[left]+nums[right] target) right--; else if(nums[i]+nums[j]+nums[left]+nums[right] target) //è¯´æ˜leftåå·¦äº† left++; else if(nums[i]+nums[j]+nums[left]+nums[right] == target) //è¯´æ˜æ‰¾åˆ°äº† result.push_back(vectorintnums[i],nums[j],nums[left],nums[right]); //å»é‡ while(leftrightnums[left]==nums[left+1])left++; while(leftrightnums[right]==nums[right-1])right--; left++;right--; return result; ;int main(int argc, char const *argv[]) Solution solution; vectorint nums1 = -1,0,-5,-2,-2,-4,0,1,-2; //vectorvectorint expected1 = -1, -1, 2, -1, 0, 1; vectorvectorint result1 = solution.fourSum(nums1,-9); //éå†äºŒç»´æ•°ç»„ for (int i = 0; i result1.size(); i++) for (int j = 0; j result1[i].size(); j++) cout result1[i][j] ; cout endl; return 0; è¯­æ³•å°è®¡ è¯¥é¢˜æ²¡è¯­æ³•å°è®¡ *","tags":["c++","å››æ•°ä¹‹å’Œ"],"categories":["C++åˆ·é¢˜ç¬”è®°"]},{"title":"ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯","path":"/2024/10/15/leetcodeåˆ·é¢˜/æ¯æ—¥ä¸€åˆ·day40ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯/","content":"ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯ ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯é¢˜ç›®ï¼šç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé€ä¸ªç¿»è½¬å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå•è¯ã€‚è§£é‡Š: å¦‚æœä¸¤ä¸ªå•è¯é—´æœ‰å¤šä½™çš„ç©ºæ ¼ï¼Œå°†åè½¬åå•è¯é—´çš„ç©ºæ ¼å‡å°‘åˆ°åªå«ä¸€ä¸ªã€‚ä½ å¯ä»¥æŒ‰ ä»»æ„é¡ºåº è¿”å›ç­”æ¡ˆ ã€‚ç¤ºä¾‹ 1ï¼š è¾“å…¥ï¼šâ€ the sky is blue â€œ è¾“å‡ºï¼šâ€blue is sky theâ€ç¤ºä¾‹ 2ï¼š è¾“å…¥ï¼šâ€ hello world! â€œ è¾“å‡ºï¼šâ€world! helloâ€ç¤ºä¾‹ 3ï¼š è¾“å…¥: â€œa good exampleâ€ è¾“å‡º: â€œexample good aâ€ è§£æ³•-åŒæŒ‡é’ˆæ³•æ€è·¯ï¼šä»¥ the sky is blue ä¸ºä¾‹ ç§»é™¤å¤šä½™ç©ºæ ¼the sky is blue åè½¬æ•´ä¸ªå­—ç¬¦ä¸²eulb si yks eht å°†æ¯ä¸ªå•è¯åè½¬blue is sky the å¤æ‚åº¦ï¼š æ—¶é—´å¤æ‚åº¦ï¼š ç©ºé—´å¤æ‚åº¦ï¼š ä»£ç ï¼š class Solution public: //åè½¬,é—­åŒºé—´ void reverse(string s,int start,int end) int slow = start,fast = end; while(slow fast) swap(s[slow++],s[fast--]); //å»é™¤å¤šä½™ç©ºæ ¼ void removeExtraSpaces(string s) //å»é™¤é¦–ç©ºæ ¼ int slow = 0,fast = 0; while(s[fast] == ) fast++; //å»é™¤ä¸­é—´ç©ºæ ¼ for(;fast s.size();fast++) if(s[fast] == s[fast-1] == s[fast]) //è¯´æ˜æ­¤å¤„æ˜¯å¤šä½™ç©ºæ ¼ï¼Œè·³è¿‡,fast++ continue; else s[slow]=s[fast]; slow++; //å»é™¤å°¾ç©ºæ ¼,å› ä¸ºå»é™¤ä¸­é—´ç©ºæ ¼æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°æœ€åä¸€ä¸ªå­—ç¬¦æ˜¯ç©ºæ ¼çš„æƒ…å†µ if(s[slow-1] == ) s.resize(slow-1); else//æ›´æ–°æ–°çš„å­—ç¬¦ä¸²é•¿åº¦ s.resize(slow); //åè½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯ string reverseWords(string s) //å»é™¤å¤šä½™ç©ºæ ¼ removeExtraSpaces(s); // //åè½¬æ•´ä¸ªå­—ç¬¦ä¸²,åè½¬åçš„å­—ç¬¦ä¸²é¦–å°¾éƒ½æ˜¯å­—æ¯ reverse(s,0,s.size()-1); //å°†æ¯ä¸ªå•è¯åè½¬ int begin = 0; for(int i = 0;is.size();++i) if(s[i] == ) reverse(s,begin,i-1); begin = i+1; //å•ç‹¬å¤„ç†æœ€åä¸€ä¸ªå­—æ¯ reverse(s,begin,s.size()-1); return s; ; è¯­æ³•å°è®¡ è¯¥é¢˜æ²¡è¯­æ³•å°è®¡ *","tags":["c++","ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯"],"categories":["C++åˆ·é¢˜ç¬”è®°"]},{"title":"stackå®ç°queue","path":"/2024/10/14/stackå®ç°queue/","content":"class MyQueue {public: stack stIn;è¾“å…¥æ ˆ stack stOut;è¾“å‡ºæ ˆ MyQueue() { } void push(int x) { stIn.push(x); } int pop() { //å¦‚æœè¾“å‡ºæ ˆä¸ºç©ºï¼Œåˆ™å°†è¾“å…¥æ ˆçš„å…ƒç´ å…¨éƒ¨å¼¹å‡ºå¹¶å‹å…¥è¾“å‡ºæ ˆ if(stOut.empty()){ while (!stIn.empty()) { stOut.push(stIn.top()); stIn.pop(); } } int result = stOut.top(); stOut.pop(); return result; } //æŸ¥çœ‹é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´  int peek() { int ret = this-pop();//ä½¿ç”¨å·²æœ‰çš„popå‡½æ•°ï¼Œå¼¹å‡ºæ ˆé¡¶å…ƒç´  stOut.push(ret);//å†å°†å¼¹å‡ºçš„å…ƒç´ å‹å…¥stOutæ ˆä¸­ return ret; } bool empty() { return stIn.empty() stOut.empty(); } };","tags":["c++","stack","queue"],"categories":["C++åˆ·é¢˜ç¬”è®°"]},{"title":"æ•‘èµé‡‘","path":"/2024/10/14/leetcodeåˆ·é¢˜/æ¯æ—¥ä¸€åˆ·day36/","content":"æ•‘èµé‡‘é¢˜ç›®ï¼šæ•‘èµé‡‘ç»™ä½ ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼šransomNote å’Œ magazine ï¼Œåˆ¤æ–­ ransomNote èƒ½ä¸èƒ½ç”± magazine é‡Œé¢çš„å­—ç¬¦æ„æˆã€‚ å¦‚æœå¯ä»¥ï¼Œè¿”å› true ï¼›å¦åˆ™è¿”å› false ã€‚ magazine ä¸­çš„æ¯ä¸ªå­—ç¬¦åªèƒ½åœ¨ ransomNote ä¸­ä½¿ç”¨ä¸€æ¬¡ã€‚ è§£æ³•-æ•°ç»„å“ˆå¸Œè¡¨æ€è·¯ï¼š å®šä¹‰record[26]æ•°ç»„ï¼Œç”¨äºè®°å½•æ¯ä¸ªå­—æ¯å‡ºç°çš„æ¬¡æ•° ç»Ÿè®¡rä¸­æ¯ä¸ªå­—æ¯å‡ºç°çš„æ¬¡æ•°ï¼Œè®°å½•recordå¯¹åº”çš„ä½ç½®ä¸Šï¼Œå®ç°æ–¹å¼ä¸ºrecordé€’å¢ ç»Ÿè®¡mä¸­æ¯ä¸ªå­—æ¯å‡ºç°çš„æ¬¡æ•°ï¼Œå®ç°æ–¹å¼ä¸ºï¼šrecordå¯¹åº”ä½ç½®ä¸Šé€’å‡ éå†record[26]ï¼Œåªè¦æœ‰record[i]0,åˆ™è¯´æ˜mä¸­çš„å…ƒç´ rä¸­æ²¡æœ‰æˆ–æ¯”rä¸­å¤šï¼Œè¿”å›false å¦‚æœrecord[26]æ‰€æœ‰çš„å€¼éƒ½0,åˆ™è¯´æ˜rå¯ä»¥ä»mä¸­æŒ‘é€‰å­—æ¯ç»„æˆï¼ˆrä¸­çš„å­—æ¯mä¸­éƒ½æœ‰ï¼Œå¹¶ä¸”mä¸­å¯ä»¥æ¯”rä¸­å¤šï¼‰ï¼Œç¬¦åˆé¢˜æ„ï¼ å¤æ‚åº¦ï¼š æ—¶é—´å¤æ‚åº¦ï¼š ç©ºé—´å¤æ‚åº¦ï¼š ä»£ç ï¼š class Solution public: bool canConstruct(string r, string m) //ç”¨äºè®°å½•æ¯ä¸ªå­—æ¯å‡ºç°çš„æ¬¡æ•° int record[26] = 0; //è®°å½•rå­—ç¬¦ä¸²ä¸­æ¯ä¸ªå­—æ¯å‡ºç°çš„æ¬¡æ•° for(int i = 0;i r.length();i++) record[r[i] - a]++; //å°†rå¯¹åº”ä½ç½®çš„æ¬¡æ•°é€’å‡ for(int i = 0;i m.length();i++) record[m[i] - a]--; for(int i = 0;i 26;i++) //å¦‚æœrecordæœ‰ä½ç½®å¤§äº0ï¼Œè¯´æ˜mä¸­çš„å…ƒç´ rä¸­æ²¡æœ‰æˆ–æ¯”rä¸­å¤šï¼Œè¿”å›false if(record[i]0)return false; return true; ; è¯­æ³•å°è®¡ è¯¥é¢˜æ²¡æœ‰è¯­æ³•å°è®¡ *","tags":["c++","æ•‘èµé‡‘"],"categories":["C++åˆ·é¢˜ç¬”è®°"]},{"title":"åè½¬å­—ç¬¦ä¸²","path":"/2024/10/14/leetcodeåˆ·é¢˜/æ¯æ—¥ä¸€åˆ·day39/","content":"åè½¬å­—ç¬¦ä¸²é¢˜ç›®ï¼šåè½¬å­—ç¬¦ä¸²ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä½œç”¨æ˜¯å°†è¾“å…¥çš„å­—ç¬¦ä¸²åè½¬è¿‡æ¥ã€‚è¾“å…¥å­—ç¬¦ä¸²ä»¥å­—ç¬¦æ•°ç»„ s çš„å½¢å¼ç»™å‡ºã€‚ä¸è¦ç»™å¦å¤–çš„æ•°ç»„åˆ†é…é¢å¤–çš„ç©ºé—´ï¼Œä½ å¿…é¡»åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„ã€ä½¿ç”¨ O(1) çš„é¢å¤–ç©ºé—´è§£å†³è¿™ä¸€é—®é¢˜ã€‚ç¤ºä¾‹ 1ï¼š è¾“å…¥ï¼šs [â€œhâ€,â€eâ€,â€lâ€,â€lâ€,â€oâ€] è¾“å‡ºï¼š[â€œoâ€,â€lâ€,â€lâ€,â€eâ€,â€hâ€]ç¤ºä¾‹ 2ï¼š è¾“å…¥ï¼šs [â€œHâ€,â€aâ€,â€nâ€,â€nâ€,â€aâ€,â€hâ€] è¾“å‡ºï¼š[â€œhâ€,â€aâ€,â€nâ€,â€nâ€,â€aâ€,â€Hâ€] è§£æ³•-æ€è·¯ï¼šä¸ºä»€ä¹ˆè¿˜æœ‰è¿™ä¹ˆè¿™æ ·çš„é¢˜ç›®å•Šï¼Ÿ ä¸ºä»€ä¹ˆæˆ‘åˆšå¼€å§‹åˆ·leetcodeçš„æ—¶å€™é‡åˆ°çš„é¢˜è¿™ä¹ˆéš¾ï¼Œç›´æ¥ç»™æˆ‘åŠé€€å‘¢ï¼Ÿ ä¸ºä»€ä¹ˆè¦å¦‚æ­¤æˆè€æˆ‘ï¼ğŸ¤¯å¤æ‚åº¦ï¼š æ—¶é—´å¤æ‚åº¦ï¼š ç©ºé—´å¤æ‚åº¦ï¼šä»£ç ï¼š void reverseString(vectorchar s) char temp; for(int i = 0;i s.size()/2;i++) temp = s[i]; s[i] = s[s.size()-1-i]; s[s.size()-1-i] = temp;","tags":["c++","åè½¬å­—ç¬¦ä¸²"],"categories":["C++åˆ·é¢˜ç¬”è®°"]},{"title":"åæ§½","path":"/2024/10/14/leetcodeåˆ·é¢˜/æ¯æ—¥ä¸€åˆ·ä¹‹æŠ±æ€¨/","content":"çœŸçš„æ²¡æœ‰å¤´ç»ªâ€¦.çƒ¦æ­»äº† çƒ¦æ­»äº†","tags":["c++","åæ§½"],"categories":["C++åˆ·é¢˜ç¬”è®°"]},{"title":"ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†","path":"/2024/10/12/leetcodeåˆ·é¢˜/æ¯æ—¥ä¸€åˆ·day32/","content":"å­—æ¯å¼‚ä½è¯é¢˜ç›®ï¼šä¸¤ä¸ªæ•°ç»„çš„äº¤é›† è§£æ³•-å“ˆå¸Œè¡¨æ€è·¯ï¼š å°†Num1å­˜å‚¨åœ¨setå®¹å™¨nums_setä¸­ï¼Œå¯ä»¥å»é‡ éå†num2,å¦‚æœNums_setä¸­æœ‰num2ï¼Œåˆ™å°†num2æ’å…¥åˆ°result_setä¸­ å¤æ‚åº¦ï¼š æ—¶é—´å¤æ‚åº¦ï¼š ç©ºé—´å¤æ‚åº¦ï¼š ä»£ç ï¼š #includeiostream#includevector#includeunordered_setusing namespace std;class Solution public: vectorint intersection(vectorint nums1, vectorint nums2) unordered_setint result_set; // å­˜æ”¾ç»“æœï¼Œä¹‹æ‰€ä»¥ç”¨setæ˜¯ä¸ºäº†ç»™ç»“æœé›†å»é‡ //é€šè¿‡ä¼ é€’ nums1.begin() å’Œ nums1.end()ï¼Œ //å¯ä»¥å°† nums1 ä¸­çš„æ‰€æœ‰å…ƒç´ ä¸€æ¬¡æ€§æ’å…¥åˆ° unordered_set ä¸­ï¼Œä»è€Œå¿«é€Ÿæ„å»ºé›†åˆã€‚ //unordered_set è‡ªåŠ¨å»é™¤é‡å¤å…ƒç´ ï¼Œå› æ­¤å¯ä»¥ç¡®ä¿æœ€ç»ˆé›†åˆä¸­æ²¡æœ‰é‡å¤é¡¹ã€‚ unordered_setint nums_set(nums1.begin(), nums1.end()); // éå†nums2 for (int num : nums2) // å‘ç°nums2çš„å…ƒç´  åœ¨nums_seté‡Œåˆå‡ºç°è¿‡ if (nums_set.find(num) != nums_set.end()) result_set.insert(num); return vectorint(result_set.begin(), result_set.end()); ; è¯­æ³•å°ç‚¹ï¼š unordered_set æ•°æ®ç»“æ„ï¼šåŸºäºå“ˆå¸Œè¡¨ æ— åºå­˜å‚¨ å»é‡ set(ordered_set) æ•°æ®ç»“æ„ï¼šåŸºäºçº¢é»‘æ ‘ æœ‰åºå­˜å‚¨ï¼šå…ƒç´ æŒ‰ç…§å‡åºæ’åº å»é‡ è§£é‡Šï¼šunordered_setint nums_set(nums1.begin(), nums1.end()); nums1.begin()ï¼šè¿”å›æŒ‡å‘nums1å‘é‡ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„è¿­ä»£å™¨ nums1.end()ï¼šè¿”å›æŒ‡å‘nums1å‘é‡ä¸­æœ€åä¸€ä¸ªå…ƒç´ ä¸‹ä¸€ä¸ªä½ç½®çš„è¿­ä»£å™¨ å°†nums1å‘é‡ä¸­çš„æ‰€æœ‰å…ƒç´ æ’å…¥åˆ°ä¸€ä¸ªæ— åºé›†åˆnums_setä¸­ï¼Œç”¨äºå»é™¤é‡å¤å…ƒç´ å¹¶æä¾›å¿«é€ŸæŸ¥æ‰¾ã€‚ è§£é‡Šï¼š for (int num : nums2) forå¾ªç¯ç”¨äºéå†åä¸ºnums2çš„å®¹å™¨ä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚å¾ªç¯å˜é‡numä¾æ¬¡å–nums2ä¸­çš„æ¯ä¸€ä¸ªå€¼ã€‚é€šå¸¸ç”¨äºå¯¹nums2ä¸­çš„æ¯ä¸ªå…ƒç´ æ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚ è§£é‡Šï¼š if (nums_set.find(num) != nums_set.end()) { result_set.insert(num); } nums_set.find(num):è¿™ä¸ªæ–¹æ³•ä¼šåœ¨ nums_set ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨å€¼ä¸º num çš„å…ƒç´ ã€‚æŸ¥æ‰¾æˆåŠŸä¼šè¿”å›ä¸€ä¸ªæŒ‡å‘è¯¥å…ƒç´ çš„è¿­ä»£å™¨ï¼›æŸ¥æ‰¾å¤±è´¥ä¼šè¿”å› nums_set.end()ï¼Œè¡¨ç¤ºæŸ¥æ‰¾æœªæ‰¾åˆ°è¯¥å…ƒç´ ã€‚ nums_set.find(num) ! nums_set.end()ï¼šè¿™ä¸ªæ¡ä»¶åˆ¤æ–­è¿”å›çš„è¿­ä»£å™¨æ˜¯å¦ç­‰äº nums_set.end()ã€‚ å¦‚æœä¸ç­‰äºnums_set.end()ï¼Œè¯´æ˜æ‰¾åˆ°äº† numï¼Œå³ nums_set ä¸­å­˜åœ¨ numã€‚ å¦‚æœç­‰äº nums_set.end()ï¼Œè¯´æ˜æ²¡æœ‰æ‰¾åˆ° numï¼Œå³ nums_set ä¸­ä¸å­˜åœ¨ numã€‚","tags":["c++","ä¸¤ä¸ªæ•°ç»„çš„äº¤é›†"],"categories":["C++åˆ·é¢˜ç¬”è®°"]},{"title":"å¿«ä¹æ•°","path":"/2024/10/12/leetcodeåˆ·é¢˜/æ¯æ—¥ä¸€åˆ·day33/","content":"é¢˜ç›®ï¼šå¿«ä¹æ•°:19 è§£æ³•-å“ˆå¸Œè¡¨æ€è·¯ï¼š 1.2.3. å¤æ‚åº¦ï¼š æ—¶é—´å¤æ‚åº¦ï¼š ç©ºé—´å¤æ‚åº¦ï¼š ä»£ç ï¼š class Solutionprivate: /* data */public: int getSum(int n) int sum = 0; int temp = 0; while (n 0) temp = n % 10; temp *= temp; sum += temp; n/=10; return sum; bool isHappy(int n) unordered_setint record; int sum = 0; while(1) sum = getSum(n); if(n==1)return true; if(record.find(sum) != record.end()) //å¦‚æœsumåœ¨recordé‡Œé¢æ‰¾åˆ°äº†ï¼Œè¯´æ˜é™·å…¥äº†å¾ªç¯ï¼Œç›´æ¥è¿”å›false return false; else record.insert(sum); n=sum; std::coutsum= sumstd::endl; //return true; ; è¯­æ³•å°ç‚¹ï¼š 1. * * *2. * * *","tags":["c++","å¿«ä¹æ•°"],"categories":["C++åˆ·é¢˜ç¬”è®°"]},{"title":"ä¸¤æ•°ä¹‹å’Œ","path":"/2024/10/12/leetcodeåˆ·é¢˜/æ¯æ—¥ä¸€åˆ·day34/","content":"ä¸¤æ•°ä¹‹å’Œé¢˜ç›®ï¼šæ±‚ä¸¤æ•°ä¹‹å’Œ è§£æ³•-å“ˆå¸Œè¡¨æ€è·¯ï¼š 1.2.3. å¤æ‚åº¦ï¼š æ—¶é—´å¤æ‚åº¦ï¼š ç©ºé—´å¤æ‚åº¦ï¼š ä»£ç ï¼š class Solutionprivate: /* data */public: vectorint twoSum(vectorint nums, int target) unordered_mapint,int record; for(int i = 0;inums.size();i++) auto iter = record.find(target-nums[i]); if(iter != record.end()) //æ‰¾åˆ°äº† //è¿”å›å€¼ï¼Œå’Œç´¢å¼• return iter-second,i; else record.insert(nums[i],i); return ; ; è¯­æ³•å°ç‚¹ï¼š mapè¿­ä»£å™¨çš„ä½¿ç”¨ï¼š è¿­ä»£å™¨ iter æŒ‡å‘æ˜ å°„ä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼Œæˆ‘ä¸€ç›´ç†è§£ä¸ºä¸€ä¸ªæŒ‡é’ˆï¼Œæš‚æ—¶æ²¡æœ‰å‡ºç°é—®é¢˜ iter-first è®¿é—®çš„æ˜¯é”®ï¼ˆkeyï¼‰éƒ¨åˆ†ã€‚ iter-second è®¿é—®çš„æ˜¯å€¼ï¼ˆvalueï¼‰éƒ¨åˆ† è§£é‡Šï¼šreturn {iter-second,i}; å°†è¿­ä»£å™¨ iter-second å’Œ i å°è£…æˆä¸€ä¸ªâ€œæ•°ç»„â€ï¼Œå¹¶è¿”å›ï¼Œå…ˆæš‚æ—¶è¿™æ ·ç†è§£ï¼","tags":["c++","ä¸¤æ•°ä¹‹å’Œ"],"categories":["C++åˆ·é¢˜ç¬”è®°"]},{"title":"å››æ•°ä¹‹å’Œ","path":"/2024/10/12/leetcodeåˆ·é¢˜/æ¯æ—¥ä¸€åˆ·day35/","content":"å››æ•°ä¹‹å’Œé¢˜ç›®ï¼šå››æ•°ä¹‹å’Œ è§£æ³•-å“ˆå¸Œè¡¨æ€è·¯ï¼šåªè¦æ‰¾åˆ°A[i] + B[j] + C[k] + D[l] 0å°±å¯ä»¥ï¼Œä¸ç”¨è€ƒè™‘æœ‰é‡å¤çš„å››ä¸ªå…ƒç´ ç›¸åŠ ç­‰äº0çš„æƒ…å†µ é¦–å…ˆå®šä¹‰ ä¸€ä¸ªunordered_mapï¼Œkeyæ”¾aå’Œbä¸¤æ•°ä¹‹å’Œï¼Œvalue æ”¾aå’Œbä¸¤æ•°ä¹‹å’Œå‡ºç°çš„æ¬¡æ•° éå†å¤§Aå’Œå¤§Bæ•°ç»„ï¼Œç»Ÿè®¡ä¸¤ä¸ªæ•°ç»„å…ƒç´ ä¹‹å’Œï¼Œå’Œå‡ºç°çš„æ¬¡æ•°ï¼Œæ”¾åˆ°mapä¸­ å®šä¹‰intå˜é‡countï¼Œç”¨æ¥ç»Ÿè®¡ a+b+c+d 0 å‡ºç°çš„æ¬¡æ•° å†éå†å¤§Cå’Œå¤§Dæ•°ç»„ï¼Œæ‰¾åˆ°å¦‚æœ 0-(c+d) åœ¨mapä¸­å‡ºç°è¿‡çš„è¯ï¼Œå°±ç”¨countæŠŠmapä¸­keyå¯¹åº”çš„valueä¹Ÿå°±æ˜¯å‡ºç°æ¬¡æ•°ç»Ÿè®¡å‡ºæ¥ æœ€åè¿”å›ç»Ÿè®¡å€¼ count å°±å¯ä»¥äº† å¤æ‚åº¦ï¼š æ—¶é—´å¤æ‚åº¦ï¼š ç©ºé—´å¤æ‚åº¦ï¼š ä»£ç ï¼š #include vector#include unordered_map#include iostreamusing namespace std;class Solution public: int fourSumCount(vectorint A, vectorint B, vectorint C, vectorint D) unordered_mapint, int umap; //key:a+bçš„æ•°å€¼ï¼Œvalue:a+bæ•°å€¼å‡ºç°çš„æ¬¡æ•° // éå†å¤§Aå’Œå¤§Bæ•°ç»„ï¼Œç»Ÿè®¡ä¸¤ä¸ªæ•°ç»„å…ƒç´ ä¹‹å’Œï¼Œå’Œå‡ºç°çš„æ¬¡æ•°ï¼Œæ”¾åˆ°mapä¸­ //æ³¨æ„ï¼šumapåˆå§‹å€¼ä¸ºç©ºï¼Œæ‰€ä»¥umap[a+b]++æ˜¯1ï¼Œå¦‚æœå†æ¬¡å‡ºç°ç›¸åŒçš„a+bï¼Œé‚£ä¹ˆumap[a+b]++å°±æ˜¯2 for (int a : A) for (int b : B) umap[a + b]++; cout a=ab=bumap[ a+b] = umap[a+b]endl; //éå†umap for(auto i:umap) couti.first=i.first i.second=i.secondendl; int count = 0; // ç»Ÿè®¡a+b+c+d = 0 å‡ºç°çš„æ¬¡æ•° // å†éå†å¤§Cå’Œå¤§Dæ•°ç»„ï¼Œæ‰¾åˆ°å¦‚æœ 0-(c+d) åœ¨mapä¸­å‡ºç°è¿‡çš„è¯ï¼Œå°±æŠŠmapä¸­keyå¯¹åº”çš„valueä¹Ÿå°±æ˜¯å‡ºç°æ¬¡æ•°ç»Ÿè®¡å‡ºæ¥ã€‚ for (int c : C) for (int d : D) //å¦‚æœåœ¨umapä¸­æ‰¾åˆ°0-(c+d)è¿™ä¸ªkeyï¼Œé‚£ä¹ˆå°±æŠŠå¯¹åº”çš„valueä¹Ÿå°±æ˜¯å‡ºç°æ¬¡æ•°ç»Ÿè®¡å‡ºæ¥ if (umap.find(0 - (c + d)) != umap.end()) count += umap[0 - (c + d)]; return count; ;// å•å…ƒæµ‹è¯•int main() Solution solution; vectorint A = 1, 2; vectorint B = -2, -1; vectorint C = -1, 2; vectorint D = 0, 2; int result = solution.fourSumCount(A, B, C, D); cout The count of four sum is: result endl; // åº”è¾“å‡º 2 return 0; è¯­æ³•å°ç‚¹ï¼š è§£é‡Šï¼šumap[a + b]++; umapåˆå§‹å€¼ä¸ºç©ºï¼Œæ‰€ä»¥umap[a+b]++æ˜¯1ï¼Œå¦‚æœå†æ¬¡å‡ºç°ç›¸åŒçš„a+bï¼Œé‚£ä¹ˆumap[a+b]++å°±æ˜¯2 **","tags":["c++","å››æ•°ä¹‹å’Œ"],"categories":["C++åˆ·é¢˜ç¬”è®°"]},{"title":"pollç¬”è®°","path":"/2024/09/30/pollç¬”è®°/","content":"POLLç¬”è®°å‡½æ•°åŸå‹#include poll.hint poll(struct pollfd *fds, nfds_t nfds, int timeout); å‚æ•°ï¼š fdsï¼šä¸€ä¸ªpollfdç»“æ„ä½“æ•°ç»„æŒ‡é’ˆï¼Œç”¨äºæè¿°éœ€è¦ç­‰å¾…çš„äº‹ä»¶ï¼Œæ¯ä¸ªæ•°ç»„ä¸­åŒ…å«ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ nfdsï¼šfd æ•°ç»„çš„å¤§å°ï¼Œå³éœ€è¦ç­‰å¾…çš„äº‹ä»¶çš„æ•°é‡ timeoutï¼šç­‰å¾…äº‹ä»¶å‘ç”Ÿçš„æ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ã€‚å¦‚æœä¸º -1ï¼Œè¡¨ç¤ºä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°æœ‰äº‹ä»¶å‘ç”Ÿã€‚å¦‚æœä¸º 0ï¼Œè¡¨ç¤ºä¸é˜»å¡ï¼Œç«‹å³è¿”å›ã€‚ è¿”å›å€¼ï¼šå¦‚æœæœ‰äº‹ä»¶å‘ç”Ÿï¼Œè¿”å›å€¼ä¸ºæ­£æ•°ï¼Œè¡¨ç¤ºæœ‰å¤šå°‘ä¸ªæ–‡ä»¶æè¿°ç¬¦å‘ç”Ÿäº†äº‹ä»¶ï¼Œè¶…æ—¶åˆ™è¿”å›0ï¼Œé”™è¯¯è¿”å›å€¼ä¸º -1ã€‚ struct pollfdçš„ç»“æ„ä½“ï¼š struct pollfdã€€int fdï¼› // æ–‡ä»¶æè¿°ç¬¦ã€€short eventï¼›// è¯·æ±‚çš„äº‹ä»¶ã€€short reventï¼›// è¿”å›çš„äº‹ä»¶ fd:è¦ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æœfdæ— æ•ˆçš„è¯é‚£ä¹ˆeventsç›‘è§†äº‹ä»¶ä¹Ÿæ— æ•ˆï¼Œå¹¶ä¸”reventsè¿”å›0. event:è¡¨ç¤ºè¦ç›‘è§†çš„äº‹ä»¶ï¼Œå¯ä»¥ç›‘è§†çš„äº‹ä»¶å¦‚ä¸‹(ä¸å…¨)ï¼š äº‹ä»¶å æè¿° POLLIN è¾“å…¥æ•°æ®å¯è¯» POLLOUT è¾“å‡ºç¼“å†²åŒºæœ‰ç©ºé—²ç©ºé—´ï¼Œå¯ä»¥å†™å…¥æ•°æ® POLLHUP æœ‰æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦æŒ‚èµ· POLLPRI è¾“å…¥æ•°æ®æœ‰ç´§æ€¥æ•°æ®å¯è¯»ï¼ˆæ¯”å¦‚å¸¦å¤–æ•°æ®ï¼‰ POLLNVAL æ— æ•ˆçš„æ–‡ä»¶æè¿°ç¬¦ POLLRDNORM åŒ POLLIN revents :è¿”å›çš„äº‹ä»¶ï¼Œç”±linuxå†…æ ¸è®¾ç½®å…·ä½“çš„è¿”å›äº‹ä»¶ ä½¿ç”¨ poll å‡½æ•°æ¥ç­‰å¾…æ ‡å‡†è¾“å…¥ï¼ˆé”®ç›˜è¾“å…¥ï¼‰å’Œä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„å˜åŒ– åˆå§‹åŒ– pollfd ç»“æ„ä½“ï¼š fds[0] ç”¨äºæ ‡å‡†è¾“å…¥ï¼ˆSTDIN_FILENOï¼‰ï¼Œå…³å¿ƒå¯è¯»äº‹ä»¶ï¼ˆPOLLINï¼‰ã€‚ fds[1] ç”¨äºæ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä¹Ÿå…³å¿ƒå¯è¯»äº‹ä»¶ï¼ˆPOLLINï¼‰ã€‚ è°ƒç”¨ poll å‡½æ•°ï¼š ä½¿ç”¨ while (1) å¾ªç¯æ¥æŒç»­è°ƒç”¨ pollï¼Œä»¥ä¾¿æŒç»­ç›‘æµ‹æ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€ã€‚ poll(fds, 2, 5000) è¡¨ç¤ºç­‰å¾… fds æ•°ç»„ä¸­çš„ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦åœ¨ 5000 æ¯«ç§’å†…å˜å¾—å¯è¯»ã€‚ å¦‚æœè¿”å›å€¼ä¸º -1ï¼Œè¡¨ç¤ºå‘ç”Ÿé”™è¯¯ã€‚ å¦‚æœè¿”å›å€¼ä¸º 0ï¼Œè¡¨ç¤ºè¶…æ—¶ã€‚ å¦‚æœè¿”å›å€¼ä¸ºæ­£æ•°ï¼Œè¡¨ç¤ºæœ‰æ–‡ä»¶æè¿°ç¬¦å‘ç”Ÿäº†äº‹ä»¶ã€‚ å¤„ç†äº‹ä»¶ï¼š æ£€æŸ¥ fds[0].revents å’Œ fds[1].reventsï¼Œåˆ¤æ–­å“ªäº›æ–‡ä»¶æè¿°ç¬¦å‘ç”Ÿäº†äº‹ä»¶ã€‚ å¦‚æœæ–‡ä»¶æè¿°ç¬¦å¯è¯»ï¼Œè¯»å–æ•°æ®å¹¶æ‰“å°ã€‚ å¦‚æœæ–‡ä»¶æè¿°ç¬¦å¯¹ç«¯å…³é—­è¿æ¥æˆ–å‘ç”Ÿé”™è¯¯ï¼Œæ‰“å°ç›¸åº”çš„ä¿¡æ¯ã€‚ å®Œæ•´ä»£ç #include stdio.h#include stdlib.h#include unistd.h#include poll.h#include fcntl.h#include string.h#include errno.hint main() struct pollfd fds[2]; int ret; char buffer[1024]; // åˆå§‹åŒ– pollfd ç»“æ„ä½“ fds[0].fd = STDIN_FILENO; // æ ‡å‡†è¾“å…¥ fds[0].events = POLLIN; // å…³å¿ƒå¯è¯»äº‹ä»¶ // æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ fds[1].fd = open(example.txt, O_RDONLY); if (fds[1].fd == -1) perror(open); return -1; fds[1].events = POLLIN; // å…³å¿ƒå¯è¯»äº‹ä»¶ // è°ƒç”¨ poll å‡½æ•° while (1) ret = poll(fds, 2, 5000); // ç­‰å¾… 5000 æ¯«ç§’ if (ret == -1) perror(poll); close(fds[1].fd); return -1; else if (ret == 0) printf(poll è¶…æ—¶ ); else // å½“è¾“å…¥å†…å®¹åï¼ŒæŒ‰ä¸‹å›è½¦ï¼Œå°±ä¼šæœ‰äº‹ä»¶å‘ç”Ÿï¼Œå¹¶ä¸”è¾“å‡ºæ ‡å‡†è¾“å…¥çš„å†…å®¹ if (fds[0].revents POLLIN) printf(æ ‡å‡†è¾“å…¥å¯è¯» ); ssize_t bytes_read = read(STDIN_FILENO, buffer, sizeof(buffer) - 1); if (bytes_read 0) buffer[bytes_read] = \\0; // ç¡®ä¿å­—ç¬¦ä¸²ä»¥ null ç»“å°¾ printf(è¯»å–åˆ°: %s , buffer); // å°†æ–‡ä»¶æè¿°ç¬¦ä»å¯è¯»æ”¹ä¸ºä¸å¯è¯»ï¼Œå½“è§£å¼€æ³¨é‡Šåï¼Œè¾“å…¥å†…å®¹å°±ä¼šå°†æ–‡ä»¶æè¿°ç¬¦å˜ä¸ºä¸å¯è¯» // fds[1].events = 0; // ä¸å…³å¿ƒä»»ä½•äº‹ä»¶ if (fds[1].revents POLLIN) printf(æ–‡ä»¶æè¿°ç¬¦å¯è¯» ); //æ¯æ¬¡æ›´æ–°example.txtä¸­çš„å†…å®¹åæ‰ä¼šè¾“å‡ºexample.txtçš„å†…å®¹ ssize_t bytes_read = read(fds[1].fd, buffer, sizeof(buffer) - 1); if (bytes_read 0) buffer[bytes_read] = \\0; // ç¡®ä¿å­—ç¬¦ä¸²ä»¥ null ç»“å°¾ printf(ä»æ–‡ä»¶è¯»å–åˆ°: %s , buffer); if (fds[0].revents POLLHUP) printf(æ ‡å‡†è¾“å…¥å¯¹ç«¯å…³é—­è¿æ¥ ); if (fds[1].revents POLLHUP) printf(æ–‡ä»¶æè¿°ç¬¦å¯¹ç«¯å…³é—­è¿æ¥ ); if (fds[0].revents POLLERR) printf(æ ‡å‡†è¾“å…¥å‘ç”Ÿé”™è¯¯ ); if (fds[1].revents POLLERR) printf(æ–‡ä»¶æè¿°ç¬¦å‘ç”Ÿé”™è¯¯ ); sleep(1); close(fds[1].fd); return 0;","tags":["poll"],"categories":["åµŒå…¥å¼"]},{"title":"pollç¬”è®°æ·±å…¥","path":"/2024/09/30/pollç¬”è®°æ·±å…¥/","content":"POLLç¬”è®°æ·±å…¥å‚è€ƒéŸ¦ä¸œå±±ï¼š pollå‡½æ•°æ‰§è¡Œæµç¨‹pollå‡½æ•°æ‰§è¡Œæµç¨‹ï¼š å‡½æ•°æ‰§è¡Œæµç¨‹å¦‚ä¸Šå›¾â‘ ï½â‘§æ‰€ç¤ºï¼Œé‡ç‚¹ä»â‘¢å¼€å§‹çœ‹ã€‚å‡è®¾ä¸€å¼€å§‹æ— æŒ‰é”®æ•°æ®ï¼š â‘¢ APPè°ƒç”¨pollä¹‹åï¼Œè¿›å…¥å†…æ ¸æ€ï¼› â‘£ å¯¼è‡´é©±åŠ¨ç¨‹åºçš„drv_pollè¢«è°ƒç”¨ï¼š æ³¨æ„ï¼Œdrv_pollè¦æŠŠè‡ªå·±è¿™ä¸ªçº¿ç¨‹æŒ‚å…¥ç­‰å¾…é˜Ÿåˆ—wqä¸­ï¼›å‡è®¾ä¸æ”¾å…¥é˜Ÿåˆ—é‡Œï¼Œé‚£ä»¥å- å‘ç”Ÿä¸­æ–­æ—¶ï¼Œä¸­æ–­æœåŠ¡ç¨‹åºå»å“ªé‡Œæ‰¾åˆ°ä½ å˜›ï¼Ÿ drv_pollè¿˜ä¼šåˆ¤æ–­ä¸€ä¸‹ï¼šæœ‰æ²¡æœ‰æ•°æ®å•Šï¼Ÿè¿”å›è¿™ä¸ªçŠ¶æ€ã€‚ â‘¤ å‡è®¾å½“å‰æ²¡æœ‰æ•°æ®ï¼Œåˆ™ä¼‘çœ ä¸€ä¼šï¼› â‘¥ åœ¨ä¼‘çœ è¿‡ç¨‹ä¸­ï¼ŒæŒ‰ä¸‹äº†æŒ‰é”®ï¼Œå‘ç”Ÿäº†ä¸­æ–­ï¼š åœ¨ä¸­æ–­æœåŠ¡ç¨‹åºé‡Œè®°å½•äº†æŒ‰é”®å€¼ï¼Œå¹¶ä¸”ä»wqä¸­æŠŠçº¿ç¨‹å”¤é†’äº†ã€‚ â‘¦ çº¿ç¨‹ä»ä¼‘çœ ä¸­è¢«å”¤é†’ï¼Œç»§ç»­æ‰§è¡Œforå¾ªç¯ï¼Œå†æ¬¡è°ƒç”¨drv_pollï¼š drv_pollè¿”å›æ•°æ®çŠ¶æ€ â‘§ å“¦ï¼Œä½ æœ‰æ•°æ®ï¼Œé‚£ä»å†…æ ¸æ€è¿”å›åˆ°åº”ç”¨æ€å§ â‘¨ APPè°ƒç”¨readå‡½æ•°è¯»æ•°æ® å¦‚æœä¸€ç›´æ²¡æœ‰æ•°æ®ï¼Œè°ƒç”¨æµç¨‹ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œé‡ç‚¹ä»â‘¢å¼€å§‹çœ‹ï¼Œå¦‚ä¸‹ï¼š â‘¢ APPè°ƒç”¨pollä¹‹åï¼Œè¿›å…¥å†…æ ¸æ€ï¼› â‘£ å¯¼è‡´é©±åŠ¨ç¨‹åºçš„drv_pollè¢«è°ƒç”¨ï¼š æ³¨æ„ï¼Œdrv_pollè¦æŠŠè‡ªå·±è¿™ä¸ªçº¿ç¨‹æŒ‚å…¥ç­‰å¾…é˜Ÿåˆ—wqä¸­ï¼›å‡è®¾ä¸æ”¾å…¥é˜Ÿåˆ—é‡Œï¼Œé‚£ä»¥åå‘ç”Ÿä¸­æ–­æ—¶ï¼Œä¸­æ–­æœåŠ¡ç¨‹åºå»å“ªé‡Œæ‰¾åˆ°ä½ å˜›ï¼Ÿ drv_pollè¿˜ä¼šåˆ¤æ–­ä¸€ä¸‹ï¼šæœ‰æ²¡æœ‰æ•°æ®å•Šï¼Ÿè¿”å›è¿™ä¸ªçŠ¶æ€ã€‚ â‘¤ å‡è®¾å½“å‰æ²¡æœ‰æ•°æ®ï¼Œåˆ™ä¼‘çœ ä¸€ä¼šï¼› â‘¥ åœ¨ä¼‘çœ è¿‡ç¨‹ä¸­ï¼Œä¸€ç›´æ²¡æœ‰æŒ‰ä¸‹äº†æŒ‰é”®ï¼Œè¶…æ—¶æ—¶é—´åˆ°ï¼šå†…æ ¸æŠŠè¿™ä¸ªçº¿ç¨‹å”¤é†’ï¼› â‘¦ çº¿ç¨‹ä»ä¼‘çœ ä¸­è¢«å”¤é†’ï¼Œç»§ç»­æ‰§è¡Œforå¾ªç¯ï¼Œå†æ¬¡è°ƒç”¨drv_pollï¼š drv_pollè¿”å›æ•°æ®çŠ¶æ€ â‘§ å“¦ï¼Œä½ è¿˜æ˜¯æ²¡æœ‰æ•°æ®ï¼Œä½†æ˜¯è¶…æ—¶æ—¶é—´åˆ°äº†ï¼Œé‚£ä»å†…æ ¸æ€è¿”å›åˆ°åº”ç”¨æ€å§ â‘¨ APPä¸èƒ½è°ƒç”¨readå‡½æ•°è¯»æ•°æ® æ³¨æ„å‡ ç‚¹ï¼š â‘  drv_pollè¦æŠŠçº¿ç¨‹æŒ‚å…¥é˜Ÿåˆ—wqï¼Œä½†æ˜¯å¹¶ä¸æ˜¯åœ¨drv_pollä¸­è¿›å…¥ä¼‘çœ ï¼Œè€Œæ˜¯åœ¨è°ƒç”¨drv_pollä¹‹åä¼‘çœ  â‘¡ drv_pollè¦è¿”å›æ•°æ®çŠ¶æ€ â‘¢ APPè°ƒç”¨ä¸€æ¬¡pollï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´drv_pollè¢«è°ƒç”¨2æ¬¡ â‘£ çº¿ç¨‹è¢«å”¤é†’çš„åŸå› æœ‰2ï¼šä¸­æ–­å‘ç”Ÿäº†å»é˜Ÿåˆ—wqä¸­æŠŠå®ƒå”¤é†’ï¼Œè¶…æ—¶æ—¶é—´åˆ°äº†å†…æ ¸æŠŠå®ƒå”¤é†’ â‘¤ APPè¦åˆ¤æ–­pollè¿”å›çš„åŸå› ï¼šæœ‰æ•°æ®ï¼Œè¿˜æ˜¯è¶…æ—¶ã€‚æœ‰æ•°æ®æ—¶å†å»è°ƒç”¨readå‡½æ•°ã€‚ é©±åŠ¨ä½¿ç”¨pollæœºåˆ¶æ—¶ï¼Œé©±åŠ¨ç¨‹åºçš„æ ¸å¿ƒå°±æ˜¯æä¾›å¯¹åº”çš„drv_pollå‡½æ•°ã€‚ åœ¨drv_pollå‡½æ•°ä¸­è¦åš2ä»¶äº‹ï¼š â‘  æŠŠå½“å‰çº¿ç¨‹æŒ‚å…¥é˜Ÿåˆ—wqï¼špoll_wait APPè°ƒç”¨ä¸€æ¬¡pollï¼Œå¯èƒ½å¯¼è‡´drv_pollè¢«è°ƒç”¨2æ¬¡ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸éœ€è¦æŠŠå½“å‰çº¿ç¨‹æŒ‚å…¥é˜Ÿåˆ—2æ¬¡ã€‚å¯ä»¥ä½¿ç”¨å†…æ ¸çš„å‡½æ•°poll_waitæŠŠçº¿ç¨‹æŒ‚å…¥é˜Ÿåˆ—ï¼Œå¦‚æœçº¿ç¨‹å·²ç»åœ¨é˜Ÿåˆ—é‡Œäº†ï¼Œå®ƒå°±ä¸ä¼šå†æ¬¡æŒ‚å…¥ã€‚ â‘¡ è¿”å›è®¾å¤‡çŠ¶æ€ï¼š APPè°ƒç”¨pollå‡½æ•°æ—¶ï¼Œæœ‰å¯èƒ½æ˜¯æŸ¥è¯¢â€œæœ‰æ²¡æœ‰æ•°æ®å¯ä»¥è¯»â€ï¼šPOLLINï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æŸ¥è¯¢â€œä½ æœ‰æ²¡æœ‰ç©ºé—´ç»™æˆ‘å†™æ•°æ®â€ï¼šPOLLOUTã€‚ æ‰€ä»¥drv_pollè¦è¿”å›è‡ªå·±çš„å½“å‰çŠ¶æ€ï¼š(POLLIN | POLLRDNORM) æˆ– (POLLOUT | POLLWRNORM)ã€‚ POLLRDNORMç­‰åŒäºPOLLINï¼Œä¸ºäº†å…¼å®¹æŸäº›APPæŠŠå®ƒä»¬ä¸€èµ·è¿”å›ã€‚ POLLWRNORMç­‰åŒäºPOLLOUT ï¼Œä¸ºäº†å…¼å®¹æŸäº›APPæŠŠå®ƒä»¬ä¸€èµ·è¿”å›ã€‚ å®Œæ•´ä»£ç  åªéœ€è¦çœ‹static unsigned int gpio_key_drv_poll(struct file *fp, poll_table * wait)è¿™ä¸€éƒ¨åˆ†å³å¯ #include linux/module.h#include linux/poll.h#include linux/fs.h#include linux/errno.h#include linux/miscdevice.h#include linux/kernel.h#include linux/major.h#include linux/mutex.h#include linux/proc_fs.h#include linux/seq_file.h#include linux/stat.h#include linux/init.h#include linux/device.h#include linux/tty.h#include linux/kmod.h#include linux/gfp.h#include linux/gpio/consumer.h#include linux/platform_device.h#include linux/of_gpio.h#include linux/of_irq.h#include linux/interrupt.h#include linux/irq.h#include linux/slab.hstruct gpio_key\tint gpio;\tstruct gpio_desc *gpiod;\tint flag;\tint irq; ;static struct gpio_key *gpio_keys_100ask;/* ä¸»è®¾å¤‡å· */static int major = 0;static struct class *gpio_key_class;/* ç¯å½¢ç¼“å†²åŒº */#define BUF_LEN 128static int g_keys[BUF_LEN];static int r, w;#define NEXT_POS(x) ((x+1) % BUF_LEN)static int is_key_buf_empty(void)\treturn (r == w);static int is_key_buf_full(void)\treturn (r == NEXT_POS(w));static void put_key(int key)\tif (!is_key_buf_full()) g_keys[w] = key; w = NEXT_POS(w);\tstatic int get_key(void)\tint key = 0;\tif (!is_key_buf_empty()) key = g_keys[r]; r = NEXT_POS(r); return key;static DECLARE_WAIT_QUEUE_HEAD(gpio_key_wait);/* å®ç°å¯¹åº”çš„open/read/writeç­‰å‡½æ•°ï¼Œå¡«å…¥file_operationsç»“æ„ä½“ */static ssize_t gpio_key_drv_read (struct file *file, char __user *buf, size_t size, loff_t *offset)\t//printk(%s %s line %d , __FILE__, __FUNCTION__, __LINE__);\tint err;\tint key; wait_event_interruptible(gpio_key_wait, !is_key_buf_empty());\tkey = get_key();\terr = copy_to_user(buf, key, 4); return 4;static unsigned int gpio_key_drv_poll(struct file *fp, poll_table * wait)\t//è°ƒç”¨ä¸€æ¬¡pollå¯èƒ½ä¼šè°ƒç”¨ä¸¤æ¬¡drv_poll\tprintk(%s %s line %d , __FILE__, __FUNCTION__, __LINE__);\t//æ‰§è¡Œpoll_waitå¹¶ä¸ä¼šä¼‘çœ \tpoll_wait(fp, gpio_key_wait, wait);\treturn is_key_buf_empty() ? 0 : POLLIN | POLLRDNORM;/* å®šä¹‰è‡ªå·±çš„file_operationsç»“æ„ä½“ */static struct file_operations gpio_key_drv = .owner = THIS_MODULE,\t.read = gpio_key_drv_read,\t.poll = gpio_key_drv_poll,;static irqreturn_t gpio_key_isr(int irq, void *dev_id)\tstruct gpio_key *gpio_key = dev_id;\tint val;\tint key; val = gpiod_get_value(gpio_key-gpiod); printk(key %d %d , gpio_key-gpio, val);\tkey = (gpio_key-gpio 8) | val;\tput_key(key);\twake_up_interruptible(gpio_key_wait); return IRQ_HANDLED;/* 1. ä»platform_deviceè·å¾—GPIO * 2. gpio=irq * 3. request_irq */static int gpio_key_probe(struct platform_device *pdev)\tint err;\tstruct device_node *node = pdev-dev.of_node;\tint count;\tint i;\tenum of_gpio_flags flag; printk(%s %s line %d , __FILE__, __FUNCTION__, __LINE__);\tcount = of_gpio_count(node);\tif (!count) printk(%s %s line %d, there isnt any gpio available , __FILE__, __FUNCTION__, __LINE__); return -1; gpio_keys_100ask = kzalloc(sizeof(struct gpio_key) * count, GFP_KERNEL);\tfor (i = 0; i count; i++) gpio_keys_100ask[i].gpio = of_get_gpio_flags(node, i, flag); if (gpio_keys_100ask[i].gpio 0) printk(%s %s line %d, of_get_gpio_flags fail , __FILE__, __FUNCTION__, __LINE__); return -1; gpio_keys_100ask[i].gpiod = gpio_to_desc(gpio_keys_100ask[i].gpio); gpio_keys_100ask[i].flag = flag OF_GPIO_ACTIVE_LOW; gpio_keys_100ask[i].irq = gpio_to_irq(gpio_keys_100ask[i].gpio); for (i = 0; i count; i++) err = request_irq(gpio_keys_100ask[i].irq, gpio_key_isr, IRQF_TRIGGER_RISING | IRQF_TRIGGER_FALLING, 100ask_gpio_key, gpio_keys_100ask[i]); /* æ³¨å†Œfile_operations */\tmajor = register_chrdev(0, 100ask_gpio_key, gpio_key_drv); /* /dev/gpio_key */\tgpio_key_class = class_create(THIS_MODULE, 100ask_gpio_key_class);\tif (IS_ERR(gpio_key_class)) printk(%s %s line %d , __FILE__, __FUNCTION__, __LINE__); unregister_chrdev(major, 100ask_gpio_key); return PTR_ERR(gpio_key_class); device_create(gpio_key_class, NULL, MKDEV(major, 0), NULL, 100ask_gpio_key); /* /dev/100ask_gpio_key */ return 0; static int gpio_key_remove(struct platform_device *pdev)\t//int err;\tstruct device_node *node = pdev-dev.of_node;\tint count;\tint i;\tdevice_destroy(gpio_key_class, MKDEV(major, 0));\tclass_destroy(gpio_key_class);\tunregister_chrdev(major, 100ask_gpio_key);\tcount = of_gpio_count(node);\tfor (i = 0; i count; i++) free_irq(gpio_keys_100ask[i].irq, gpio_keys_100ask[i]); kfree(gpio_keys_100ask); return 0;static const struct of_device_id ask100_keys[] = .compatible = 100ask,gpio_key , ,;/* 1. å®šä¹‰platform_driver */static struct platform_driver gpio_keys_driver = .probe = gpio_key_probe, .remove = gpio_key_remove, .driver = .name = 100ask_gpio_key, .of_match_table = ask100_keys, ,;/* 2. åœ¨å…¥å£å‡½æ•°æ³¨å†Œplatform_driver */static int __init gpio_key_init(void) int err; printk(%s %s line %d , __FILE__, __FUNCTION__, __LINE__); err = platform_driver_register(gpio_keys_driver); return err;/* 3. æœ‰å…¥å£å‡½æ•°å°±åº”è¯¥æœ‰å‡ºå£å‡½æ•°ï¼šå¸è½½é©±åŠ¨ç¨‹åºæ—¶ï¼Œå°±ä¼šå»è°ƒç”¨è¿™ä¸ªå‡ºå£å‡½æ•° * å¸è½½platform_driver */static void __exit gpio_key_exit(void)\tprintk(%s %s line %d , __FILE__, __FUNCTION__, __LINE__); platform_driver_unregister(gpio_keys_driver);/* 7. å…¶ä»–å®Œå–„ï¼šæä¾›è®¾å¤‡ä¿¡æ¯ï¼Œè‡ªåŠ¨åˆ›å»ºè®¾å¤‡èŠ‚ç‚¹ */module_init(gpio_key_init);module_exit(gpio_key_exit);MODULE_LICENSE(GPL); åº”ç”¨éƒ¨åˆ† åœ¨è°ƒç”¨pollå‡½æ•°æ—¶ï¼Œè¦æŒ‡æ˜ï¼š â‘  ä½ è¦ç›‘æµ‹å“ªä¸€ä¸ªæ–‡ä»¶ï¼šå“ªä¸€ä¸ªfd â‘¡ ä½ æƒ³ç›‘æµ‹è¿™ä¸ªæ–‡ä»¶çš„å“ªç§äº‹ä»¶ï¼šæ˜¯POLLINã€è¿˜æ˜¯POLLOUT â‘¢ åœ¨pollå‡½æ•°è¿”å›æ—¶ï¼Œè¦åˆ¤æ–­çŠ¶æ€ã€‚ å®Œæ•´ä»£ç  #include sys/types.h#include sys/stat.h#include fcntl.h#include unistd.h#include stdio.h#include string.h#include poll.h/* * ./button_test /dev/100ask_button0 * */int main(int argc, char **argv)\tint fd;\tint val;\tstruct pollfd fds[1];\tint timeout_ms = 5000;\tint ret; /* 1. åˆ¤æ–­å‚æ•° */\tif (argc != 2) printf(Usage: %s dev , argv[0]); return -1; /* 2. æ‰“å¼€æ–‡ä»¶ */\tfd = open(argv[1], O_RDWR);\tif (fd == -1) printf(can not open file %s , argv[1]); return -1; fds[0].fd = fd;\tfds[0].events = POLLIN; while (1) /* 3. è¯»æ–‡ä»¶ */ //æ ¹æ®pollçš„è¿”å›å€¼ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰æ•°æ®å¯è¯» ret = poll(fds, 1, timeout_ms); if ((ret == 1) (fds[0].revents POLLIN)) read(fd, val, 4); printf(get button : 0x%x , val); else printf(timeout ); close(fd); return 0; pollæœºåˆ¶ ä»åº”ç”¨ç¨‹åºä¸­çš„pollè°ƒç”¨ï¼Œæœ€ç»ˆä¼šä¸€æ­¥ä¸€æ­¥å¾—è°ƒç”¨åˆ°do_pollå‡½æ•°ï¼Œå…·ä½“æµç¨‹ï¼› poll - drv_poll - sys_poll - do_sys_poll - do_poll do_poll â‘  ä»è¿™é‡Œå¼€å§‹ï¼Œå°†ä¼šå¯¼è‡´é©±åŠ¨ç¨‹åºçš„pollå‡½æ•°è¢«ç¬¬ä¸€æ¬¡è°ƒç”¨ã€‚ æ²¿ç€â‘¡â‘¢â‘£â‘¤ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼šé©±åŠ¨ç¨‹åºé‡Œçš„poll_waitä¼šè°ƒç”¨__pollwaitå‡½æ•°æŠŠçº¿ç¨‹æ”¾å…¥æŸä¸ªé˜Ÿåˆ—ã€‚ å½“æ‰§è¡Œå®Œâ‘ ä¹‹åï¼Œåœ¨â‘¥æˆ–â‘¦å¤„ï¼Œpt-_qprocè¢«è®¾ç½®ä¸ºNULLï¼Œæ‰€ä»¥ç¬¬äºŒæ¬¡è°ƒç”¨é©±åŠ¨ç¨‹åºçš„pollæ—¶ï¼Œä¸ä¼šå†æ¬¡æŠŠçº¿ç¨‹æ”¾å…¥æŸä¸ªé˜Ÿåˆ—é‡Œã€‚ â‘§ å¦‚æœé©±åŠ¨ç¨‹åºçš„pollè¿”å›æœ‰æ•ˆå€¼ï¼Œåˆ™counté0ï¼Œè·³å‡ºå¾ªç¯ï¼› â‘¨ å¦åˆ™ä¼‘çœ ä¸€æ®µæ—¶é—´ï¼›å½“ä¼‘çœ æ—¶é—´åˆ°ï¼Œæˆ–æ˜¯è¢«ä¸­æ–­å”¤é†’æ—¶ï¼Œä¼šå†æ¬¡å¾ªç¯ã€å†æ¬¡è°ƒç”¨é©±åŠ¨ç¨‹åºçš„pollã€‚ å›é¡¾APPçš„ä»£ç ï¼ŒAPPå¯ä»¥æŒ‡å®šâ€œæƒ³ç­‰å¾…æŸäº›äº‹ä»¶â€ï¼Œpollå‡½æ•°è¿”å›åï¼Œå¯ä»¥çŸ¥é“â€œå‘ç”Ÿäº†å“ªäº›äº‹ä»¶â€ï¼š é©±åŠ¨ç¨‹åºé‡Œæ€ä¹ˆä½“ç°å‘¢ï¼Ÿåœ¨ä¸Šä¸Šä¸€ä¸ªå›¾ä¸­ï¼Œçœ‹â‘¡ä½ç½®å¤„ï¼Œç»†è¯´å¦‚ä¸‹ï¼š å‚è€ƒé“¾æ¥ http://blog.chinaunix.net/uid-30592332-id-5599907.html https://cloud.tencent.com/developer/article/1708996","tags":["poll"],"categories":["åµŒå…¥å¼"]},{"title":"å°æœçš„é‡åº†ä¹‹è¡Œ","path":"/2024/09/29/æ‚è®°/å°æœçš„é‡åº†ä¹‹è¡Œ/","content":"å°æœçš„é‡åº†ä¹‹è¡Œ å‡ºå‘æ—¶é—´ æŠµè¾¾æ—¶é—´ 2024å¹´9æœˆ30æ—¥ 15:06 2024å¹´10æœˆ1æ—¥ 15:43 Day1 åœ°ç‚¹ æ³¨æ„ é—¨ç¥¨ è§£æ”¾ç¢‘ï¼ˆæŠ—æˆ˜èƒœåˆ©çš„çºªå¿µç¢‘ï¼‰ æ³¨æ„æ‹æ‘„è§’åº¦ å¸¦å¢¨é•œ å…è´¹ å±±åŸä¹¦åº—ï¼ˆçˆ±å¿ƒä¹¦åº— ï¼‰ æ³¨æ„æ‹æ‘„è§’åº¦å›¾ å…è´¹ å…«ä¸€å¥½åƒè¡—ï¼ˆç‰¹è‰²ç¾é£Ÿï¼‰ åƒä»€ä¹ˆ è‡ªè´¹çš„ï¼Œ ç½—æ±‰å¯º æ‹ç…§æ‰“å¡ç‚¹ 20å…ƒ day 2 åœ°ç‚¹ æ³¨æ„ é—¨ç¥¨ ç™½è±¡å±… å¯ä»¥æ‹é•¿æ±Ÿç´¢é“ æ¹–å¹¿ä¼šé¦† æ‹ç…§å‡ºç‰‡ ï¼ˆ25å…ƒï¼‰ é•¿æ±Ÿç´¢é“ ï¼ˆæå‰é¢„çº¦ï¼‰ 25-30å…ƒ åå…«æ¢¯ å‡ºç‰‡ å—æ»¨è·¯ ï¼ˆå¤œæ™¯ï¼‰ day3 åœ°ç‚¹ æ”»ç•¥ æˆ´å®¶å·· å‡ºç‰‡ æ¥ç¦å£« å¤§å•†åœº æœå¤©é—¨ ï¼ˆä¸¤æ±Ÿäº¤æ±‡ï¼‰ æ´ªå´–æ´ å¤œæ™¯ åƒå®é—¨å¤§æ¡¥ ï¼ˆæ‹æ´ªå´–æ´å…¨æ™¯ï¼‰ day4 åœ°ç‚¹ æ³¨æ„ é—¨ç¥¨ å¼€åŸ é—å€å…¬å›­ ï¼ˆé‡åº†æ–‡åŒ–ï¼‰ é¾™é—¨æµ©è€è¡— ï¼ˆçˆ¬å¡ï¼Œï¼‰ æ€€æ—§è½®æ¸¡ ï¼ˆ15å…ƒï¼‰ å¼¹å­çŸ³è€è¡— ï¼ˆä¸­å¼åº­é™¢ï¼‰ å—å±±ä¸€é¢—æ ‘ ï¼ˆç¾æ™¯ï¼‰ day5 åœ°ç‚¹ æ”»ç•¥ é¹…å²­äºŒå‚ ï¼ˆåºŸå¼ƒå…±å‚æ”¹é€ ï¼‰ é¹…å²­å…¬å›­ ï¼ˆæ–‡è‰ºç…§ç‰‡ï¼‰ æå­å ï¼ˆè½»è½¨ï¼‰ åŒ—ä»“æ–‡åˆ›é™¢ ï¼ˆæ–‡è‰ºç‰‡ï¼‰ è§‚éŸ³æ¡¥ ï¼ˆåœ°æ ‡ï¼‰ day6 åœ°ç‚¹ æ”»ç•¥ ç£å™¨å£ ï¼ˆå¤é•‡ï¼‰ ç™½å…¬é¦† æ¸£æ»“æ´ ç½—ä¸­ç«‹ç¾æœ¯é¦† é©¬æˆ¿æ¹¾ä¸ƒå½©å·· day7 åœ°ç‚¹ æ³¨æ„ é—¨ç¥¨ é‡åº†åŠ¨ç‰©å›­ ï¼ˆï¼Œå››å–œä¸¸å­ï¼‰ 25å…ƒ é’Ÿä¹¦é˜ ï¼ˆ å“ˆåˆ©æ³¢ç‰¹ä¹¦å±‹ï¼‰ æ¶‚é¸¦ä¸€æ¡è¡— äº¤é€šèŒ¶é¦† ç‹æºåŒæ¬¾èŒ¶ 10 é»„æ¡·å¨…è€è¡— å®‰é€¸å–”~ æ¥ä¸‹æ¥æ˜¯è¦å»é¢„çº¦çš„æ™¯ç‚¹~ éœ€è¦é¢„çº¦çš„æ™¯ç‚¹ æ”¾ç¥¨æ—¶é—´ ç¥¨ä»· ç‰¹è‰² é•¿æ±Ÿç´¢é“ æ¯å¤©7ï¼›15æ”¾ç¥¨ ç½—ä¸­ç«‹ç¾æœ¯é¦†ï¼ˆå››å·ç¾é™¢ç¾æœ¯é¦†ï¼‰ æœ‰åé¢é™åˆ¶ é‡åº†ä¸‰å³¡åšç‰©é¦† ï¼ˆé‡åº†ä¸­å›½å±±å³¡åšç‰©é¦†ï¼‰ é¢„çº¦æˆåŠŸï¼ˆå‘¨ä¸‰ï¼‰å‘¨ä¸€é—­é¦† å—å±±ä¸€æ£µæ ‘ï¼šâ€œé‡åº†å—å±±æ¤ç‰©é¦†â€ é—¨ç¥¨30 æ¹–å¹¿ä¼šé¦† æ€€æ—§è½®æ¸¡ï¼ˆé‡åº†ä¸¤æ±Ÿäº¤è¿ï¼‰ 15 ï¼ˆ å¤§ç¾é‡åº† ï¼‰ äººæ°‘å¤§ç¤¼å ‚ â€œé‡åº†å¸‚äººæ°‘å¤§ç¤¼å ‚â€ ä¸€ä¸‹å¯é¢„çº¦ä¸¤å¤© å‘¨ä¸€é—­å…³ 8å…ƒ æ¥ä¸‹æ¥æ˜¯ä¸€äº›å¥½åƒçš„ï¼ ç¾é£Ÿ ç‰¹ç‚¹ æœå¤©é—¨å¤©æ¡¥æ»‘è‚‰ ä¸€åªé…¸å¥¶ç‰› ï¼ˆèŒ¶è¯å¼„ï¼‰ æ­Œä¹å±±è¾£å­é¸¡ çœ‹ç€ç‰¹åˆ«è¾£ï¼Œæœ‰ç™¾åå—çš„ æ˜¥çº¢ç«é”… ä¹°åˆ¸äº†150å¤š å—å±±æœ‰çƒ§çƒ¤ 200å¤šï¼Œè´µåœ¨æ™¯è‰² éƒ½æ²¡å¬è¿‡å‘¢~ å¼€å§‹æœŸå¾…â€¦ å¿ƒæƒ…å¤šäº‘è½¬æ™´äº†","tags":["é‡åº†","æ—…è¡Œ"],"categories":["æ‚è®°"]},{"title":"gccçš„å››ä¸ªè¿‡ç¨‹","path":"/2024/09/24/gccçš„å››ä¸ªè¿‡ç¨‹/","content":"gccå››ä¸ªè¿‡ç¨‹CC++é€šè¿‡gccg++ç¼–è¯‘å™¨åŒ…æ‹¬ä»¥ä¸‹å››ä¸ªè¿‡ç¨‹ï¼šé¢„å¤„ç†ï¼Œç¼–è¯‘ï¼Œæ±‡ç¼–ï¼Œé“¾æ¥ é¢„å¤„ç†(preprocess)é¢„å¤„ç†å¯ä»¥ç†è§£ä¸ºå°†#é‡Œè¾¹çš„å†…å®¹å±•å¼€ï¼ŒåŒ…æ‹¬å®å®šä¹‰ï¼Œå¤´æ–‡ä»¶è·¯å¾„ç­‰ç­‰ï¼Œç„¶åç›´æ¥æ’å…¥åˆ°ç¨‹åºé‡Œè¾¹å»ã€‚é¢„å¤„ç†é€šè¿‡é¢„å¤„ç†å™¨å°†.cæ–‡ä»¶è½¬æ¢æˆ.iæ–‡ä»¶ã€‚é¢„å¤„ç†é˜¶æ®µä¸ä¼šæ£€æŸ¥è¯­æ³•é”™è¯¯ ç¼–è¯‘(compile)ç¼–è¯‘æ˜¯é€šè¿‡ç¼–è¯‘å™¨(ccl)å°†.iæ–‡ä»¶è½¬æ¢ä¸ºæ±‡ç¼–ä»£ç æ–‡ä»¶ï¼Œä¸€èˆ¬æ˜¯.sæ–‡ä»¶ã€‚åœ¨ç¼–è¯‘é˜¶æ®µä¼šè¿›è¡Œè¯­æ³•åˆ†æç­‰ æ±‡ç¼–(assemble)æ±‡ç¼–å™¨(as)å°†.sæ–‡ä»¶ç¿»è¯‘æˆäºŒè¿›åˆ¶æœºå™¨è¯­è¨€æŒ‡ä»¤ï¼ˆäºŒè¿›åˆ¶æœºå™¨ç ï¼‰ï¼Œç”Ÿæˆ.oæ–‡ä»¶ã€‚ é“¾æ¥(link)é“¾æ¥å™¨(ld)å°†ä¸Šè¿°äº§ç”Ÿçš„ä¸€å †æ–‡ä»¶è¿˜æœ‰å„ç§åº“é€šè¿‡æŸç§æ–¹å¼é“¾æ¥èµ·æ¥ï¼Œç”Ÿæˆ.out(.exe)æ–‡ä»¶ ä»¥ä¸Šéƒ½æ˜¯è‡ªå·±ç†è§£","tags":["c++","ç¬”è®°"],"categories":["C++"]},{"title":"rosAPI","path":"/2024/09/24/rosAPI/","content":"ROS API init å‡½æ•° //æœ‰3ä¸ªé‡è½½ï¼Œå¸¸ç”¨ä»¥ä¸‹void ros::init(int argc, char **argv, const std::string name, uint32_t options = 0U) ä½œç”¨ï¼š åˆå§‹åŒ–ROSç³»ç»Ÿï¼Œå¹¶åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹åç§°ä¸ºname argc å‚æ•°ä¸ªæ•° argv å‚æ•°æ•°ç»„ï¼Œéœ€è¦ç¬¦åˆrosçš„ç‰¹å®šæ ¼å¼ name èŠ‚ç‚¹åç§°ï¼Œé»˜è®¤ä¸ºargv[0]ï¼Œä¸å…è®¸é‡å¤ options ROSä¸­åŒä¸€ä¸ªèŠ‚ç‚¹ä¸èƒ½é‡å¤å¯åŠ¨ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡optionsé€‰é¡¹æ¥è®¾ç½®æ˜¯å¦å…è®¸é‡å¤å¯åŠ¨,åŸç†æ˜¯åœ¨èŠ‚ç‚¹åç§°ååŠ ä¸Šç”Ÿæˆéšæœºæ•°å­—å°¾ç¼€ã€‚ä½¿ç”¨æ–¹æ³•ï¼šros::init_options::AnonymousName ä½¿ç”¨ç»†èŠ‚ å‘å¸ƒå¯¹è±¡ //ä½¿ç”¨ç¤ºä¾‹ros::Publisher pub = nh.advertisegeometry_msgs::Twist(/turtle1/cmd_vel,1000);//å‡½æ•°åŸå‹inline ros::Publisher ros::NodeHandle::advertisestd_msgs::String(const std::string topic, uint32_t queue_size, bool latch = false) ä½œç”¨ï¼š åˆ›å»ºå‘å¸ƒè€…å¯¹è±¡ æ¨¡æ¿ è¢«å‘å¸ƒè€…çš„æ¶ˆæ¯ç±»å‹ topic è¯é¢˜åç§° queue_size ç¼“å­˜æ¶ˆæ¯ä¸ªæ•°ï¼Œå¦‚æœæ»¡äº†ä¸¢å¼ƒä¹‹å‰çš„ latch å¦‚æœä¸ºture,ä¼šä¿å­˜å‘å¸ƒæ–¹çš„æœ€åä¸€æ¡æ¶ˆæ¯ï¼Œå¹¶ä¸”å½“æ–°çš„è®¢é˜…è€…è¿æ¥åˆ°å‘å¸ƒæ–¹æ—¶ï¼Œå‘å¸ƒæ–¹ä¼šå°†è¿™æ¡ä¿¡æ¯å‘é€ç»™è®¢é˜…è€…ã€‚åº”ç”¨åœºæ™¯ï¼šé™æ€åœ°å›¾ ä½¿ç”¨ç»†èŠ‚ 3. å›æ—‹å‡½æ•° æœ‰å›è°ƒå°±ä¼´éšç€å›æ—‹ void ros::spin()void ros::spinOnce() ä½œç”¨ï¼š å¤„ç†å›è°ƒå‡½æ•° spin() æ˜¯è¿›å…¥äº†å¾ªç¯æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œè¿›å…¥å¾ªç¯åä¸ä¼šè‡ªå·±é€€å‡ºï¼Œåœ¨ ros::spin() åçš„è¯­å¥ä¸ä¼šæ‰§è¡Œåˆ° spinOnce() åªä¼šæ‰§è¡Œä¸€æ¬¡å›è°ƒå‡½æ•°(æ²¡æœ‰å¾ªç¯)ï¼Œros::spinOnce() åçš„è¯­å¥å¯ä»¥æ‰§è¡Œ æ—¶åˆ»å‚è€ƒç³»1970å¹´1æœˆ1æ—¥0æ—¶0åˆ†0ç§’ ros::Time::now()//now() è¿”å›ä¸€ä¸ªros::Timeå¯¹è±¡ï¼Œè¡¨ç¤ºå½“å‰æ—¶é—´//ros::Time::now().toSec()//ros::Time::now().sec å®šæ—¶å™¨ros::Timer timer = nh.createTimer(ros::Duration(0.5),doSomeThing,true);//åªæ‰§è¡Œä¸€æ¬¡ https://support.3dsystems.com/s/article/OpenHaptics-for-Linux-Developer-Edition-v34?language=en_US","tags":["ros","ç¬”è®°"],"categories":["ROS"]},{"title":"æ­å»ºåšå®¢å‚è€ƒè¿‡çš„é“¾æ¥","path":"/2024/09/22/æ­å»ºåšå®¢å‚è€ƒè¿‡çš„é“¾æ¥/","content":"https://yuanlichenai.cn/2020/02/02/chic/https://blog.csdn.net/QFREX/article/details/108798945https://www.bilibili.com/video/BV1Eg41157tL/?spm_id_from=333.337.search-card.all.clickhttps://did321.gitee.io/","tags":["hexo","æ­å»ºåšå®¢","blog"],"categories":["æ­å»ºåšå®¢"]},{"title":"å›¾åºŠé“¾æ¥æ ¼å¼æµ‹è¯•","path":"/2024/09/20/å›¾åºŠé“¾æ¥æ ¼å¼æµ‹è¯•/","content":"æœ¬åœ°æ–‡ä»¶åï¼šã€é›ªã€‘2024-09-20 23_57_02.pnggithubæ–‡ä»¶åï¼šhttps://github.com/dkyou/ImageHostingdku/blob/main/img/%E3%80%90%E9%9B%AA%E3%80%912024-09-20%2023_57_02.png https://github.com/dkyou/ImageHostingdku/blob/main/img/ã€é›ªã€‘2024-09-20%2023_57_02.png å¤åˆ¶markdown å¤åˆ¶HTML å¤åˆ¶URLhttps://cdn.jsdelivr.net/gh/dkyou/ImageHostingdku/img/%E3%80%90%E9%9B%AA%E3%80%912024-09-20%2023_57_02.png å¤åˆ¶UBB[IMG]https://cdn.jsdelivr.net/gh/dkyou/ImageHostingdku/img/%E3%80%90%E9%9B%AA%E3%80%912024-09-20%2023_57_02.png[/IMG] å¤åˆ¶customhttps://cdn.jsdelivr.net/gh/dkyou/ImageHostingdku/img/ã€é›ªã€‘2024-09-20 23_57_02.png è‡ªå·±å¸¸ç”¨æ ¼å¼ï¼š","tags":["hexo","æ­å»ºåšå®¢"],"categories":["æ­å»ºåšå®¢"]},{"title":"æ­å»ºå›¾åºŠç¬”è®°","path":"/2024/09/20/æ­å»ºå›¾åºŠç¬”è®°/","content":"å›¾åºŠå‡†å¤‡å·¥ä½œ githubè´¦å·æ³¨å†Œï¼šå¿…é¡»ï¼Œä½†çœç•¥ ä¸‹è½½PicGo,é“¾æ¥å¦‚ä¸‹ï¼šå¿…é¡» â€‹\thttps://mirrors.sdu.edu.cn/github-release/Molunerfinn_PicGo/v2.3.1/ typoraè½¯ä»¶ï¼šéå¿…é¡»ï¼Œæœ€å¥½æœ‰ã€‚ä¹Ÿå¯æ‰¾å…¶ä»–mrakdownä»£æ›¿ï¼Œæ¯”å¦‚æˆ‘ä½¿ç”¨çš„vscode+Markdown All in One å›¾åºŠæ˜¯ä»€ä¹ˆå›¾åºŠå¯ä»¥ç¿»è¯‘ä¸ºâ€image hostingâ€æˆ–è€…â€image storageâ€ï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š å›¾ç‰‡ä¸Šä¼ ï¼šç”¨æˆ·å¯ä»¥å°†å›¾ç‰‡ä¸Šä¼ åˆ°å›¾åºŠå¹³å°ã€‚ å›¾ç‰‡å­˜å‚¨ï¼šå¹³å°ä¼šå­˜å‚¨ç”¨æˆ·çš„å›¾ç‰‡ï¼Œå¹¶æä¾›ä¸€å®šçš„ç®¡ç†å’Œè®¿é—®æƒé™ã€‚ å›¾ç‰‡åˆ†äº«ï¼šç”¨æˆ·å¯ä»¥è·å¾—å›¾ç‰‡çš„ç›´æ¥é“¾æ¥ï¼Œå¹¶é€šè¿‡è¿™äº›é“¾æ¥åœ¨å…¶ä»–ç½‘ç«™ã€è®ºå›ã€ç¤¾äº¤åª’ä½“ç­‰åœ°æ–¹åˆ†äº«å›¾ç‰‡ã€‚ å›¾ç‰‡ç®¡ç†ï¼šç”¨æˆ·å¯ä»¥åœ¨å›¾åºŠä¸Šç®¡ç†è‡ªå·±çš„å›¾ç‰‡ï¼ŒåŒ…æ‹¬æŸ¥çœ‹ã€ç¼–è¾‘ã€åˆ é™¤ç­‰æ“ä½œã€‚ å›½å†…å¸¸è§çš„å›¾åºŠæœåŠ¡ ä¸ƒç‰›äº‘ é˜¿é‡Œäº‘oss åˆæ‹äº‘ ä¹‹å‰æˆ‘ä¸€ç›´å°†å›¾ç‰‡ä¸Šä¼ åˆ°ä¸ƒç‰›äº‘ï¼Œä½†æ˜¯ä¸ƒç‰›äº‘çš„å…è´¹åŸŸååªæœ‰30å¤©ï¼Œåˆ°æœŸäº†æœ‰éœ€è¦é‡æ–°ç”³è¯·ï¼Œè§£å†³æ–¹æ¡ˆæ˜¯è‡ªå·±ç”³è¯·ä¸€ä¸ªåŸŸåï¼Œä¾¿å¯ä»¥é•¿æœŸä½¿ç”¨ä¸ƒç‰›äº‘çš„å…è´¹ç©ºé—´é¢åº¦è¿›è¡Œå›¾åºŠæ­å»ºã€‚ä¸ªäººå®åœ¨ä¸æƒ³æŠ˜è…¾ï¼Œäºæ˜¯é€‰æ‹©äº†githubçš„æ­å»ºæ–¹æ¡ˆï¼Œç›¸æ¯”äºå…¶ä»–å›½å†…çš„æ­å»ºæ–¹æ¡ˆï¼Œæ­¥éª¤å¯è°“éå¸¸ç®€å•ï¼Œè€Œä¸”ä¸é™åˆ¶å®¹é‡ã€‚ ç½‘ä¸ŠæŸ¥äº†ä¸€äº›æ”»ç•¥è¯´githubæ­å»ºå›¾åºŠçš„ç¼ºç‚¹æ˜¯è®¿é—®é€Ÿåº¦æ…¢ï¼Œä½†æ˜¯ä»”ç»†ä¸€æƒ³ï¼Œæˆ‘çš„ç¬”è®°å†™æ¥æ˜¯ç»™è‡ªå·±çœ‹çš„ï¼Œå¯¹é€Ÿåº¦æ²¡æœ‰è¦æ±‚ã€‚ ä½¿ç”¨githubæ­å»ºå›¾åºŠæ€è·¯ï¼šå…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨githubä¸Šå»ºç«‹ä¸€ä¸ªpublicçš„ä»“åº“ï¼Œç„¶åä½¿ç”¨è¯¥ä»“åº“ä½œä¸ºå›¾åºŠæœåŠ¡å™¨å­˜å‚¨ 1. åˆ›å»ºæ–°ä»“åº“é»˜è®¤ ä»“åº“åéšæ„ï¼Œä¸€å®šè®¾ç½®ä¸ºpublic 2. ç”Ÿæˆtokenä»¤ç‰Œsetting-Developer Settings-Personal access tokens-Tokens(classic)-Generate new token(classic) ç„¶ååˆ›å»ºtokenså³å¯ï¼Œè¿™ä¸ªæ­¥éª¤å¯èƒ½è®©ä½ éªŒè¯è´¦å·ä¹‹ç±»çš„ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä¸€äº›tokençš„è®¾ç½®å¦‚ä¸‹ï¼š **noteï¼š**éšä¾¿å¡«å†™ï¼Œæ²¡æœ‰å½±å“ **expirationï¼š**ä¹Ÿå¯ä»¥éšä¾¿å¡«å†™ï¼Œå¯ä»¥å¡«æ°¸ä¹…ï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚å¡«å†™ï¼Œæˆ‘ç›®å‰è¿˜ä¸çŸ¥é“åˆ°æœŸäº†æœ‰ä»€ä¹ˆå½±å“2024å¹´10æœˆ14æ—¥æ›´æ–°ï¼šå®æµ‹7å¤©è¿‡æœŸä¹‹ååªéœ€è¦é‡æ–°ç”Ÿæˆå³å¯ï¼Œä¸éœ€è¦è¿›è¡Œä»»ä½•å¤šä½™çš„æ“ä½œï¼Œååˆ†ç®€å•ã€‚å› æ­¤ï¼Œä¸å»ºè®®æ°¸ä¹…æœ‰æ•ˆã€‚ **select scopes:**å‹¾é€‰repoå‰è¾¹çš„é€‰é¡¹ å…·ä½“è®¾ç½®è§ä¸‹å›¾ï¼š å…¶ä»–è®¾ç½®å…¨éƒ¨é»˜è®¤ï¼Œç„¶åæ‹‰åˆ°æœ€åç‚¹å‡»è“è‰²çš„Generate Tokesç­‰å¾…ç”Ÿæˆå³å¯ æ³¨æ„ï¼šç”Ÿæˆçš„tokenè®°å¾—å¤åˆ¶å¤‡ä»½ï¼Œä¹‹åçš„PicGoè®¾ç½®éœ€è¦ç”¨åˆ° PicGoæ¥å®ç°å›¾ç‰‡ä¸Šä¼ PicGoæ˜¯æ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œå›¾ç‰‡ä¸Šä¼ çš„ï¼Œè€Œä¸”æ–¹ä¾¿æˆ‘ä»¬å¯¹å›¾ç‰‡è¿›è¡Œç®¡ç†ã€‚ ä¸‹è½½åœ°å€ï¼šhttps://mirrors.sdu.edu.cn/github-release/Molunerfinn_PicGo/v2.3.1/ 1. PicGoè®¾ç½®ï¼šé€‰æ‹©ï¼šå›¾åºŠè®¾ç½®-Githubï¼Œç„¶åè¿›è¡Œæ ¸å¿ƒé…ç½® **è®¾å®šä»“åº“åï¼š**æ ¼å¼ä¸ºç”¨æˆ·å/ä»“åº“åç›´æ¥å¤åˆ¶ä¸‹æ–¹çº¢æ¡†ä¸­çš„å†…å®¹ä¹Ÿå¯ã€‚ **è®¾å®šåˆ†æ”¯åï¼š**ä¸€èˆ¬ä¸ºmainæˆ–è€…masterï¼Œå…·ä½“éœ€è¦çœ‹è‡ªå·±çš„è®¾ç½® è®¾ç½®tokenï¼šå°±æ˜¯githubæ­å»ºå›¾åºŠç”Ÿæˆçš„token è®¾å®šå­˜å‚¨è·¯å¾„ï¼šimg/å¯æ ¹æ®è‡ªå·±å–œå¥½å¡«å†™å³å¯ **è‡ªå®šä¹‰åŸŸåï¼š**è¿™ä¸ªéœ€è¦ä¸€ä¸ªå…è´¹çš„åŠ é€ŸåŸŸåï¼Œå¯ä»¥ç›´æ¥ç”¨https://cdn.jsdelivr.net/gh/,æˆ–è€…è‡ªå·±ç”³è¯·ä¸€ä¸ªã€‚ å…·ä½“æ ¼å¼ä¸ºï¼šåŠ é€ŸåŸŸå+è´¦æˆ·å+ä»“åº“å/åˆ†æ”¯åï¼Œä¸­é—´+å·ä¸ç”¨å¡«å†™ï¼Œä¸¾ä¾‹ï¼š https://cdn.jsdelivr.net/gh/dkyou/ImageHostingdku ä»¥ä¸Šä¾¿å®Œæˆäº†PicGoçš„æ‰€æœ‰è®¾ç½®ï¼Œè¯¦æƒ…è§ä¸‹å›¾ï¼š ä¹‹åï¼Œå¯ä»¥è¿”å›ä¸Šä¼ åŒºåŸŸï¼Œç›´æ¥ä¸Šä¼ å³å¯ï¼Œä¹Ÿå¯ä»¥æŠŠgithubè®¾ç½®ä¸ºé»˜è®¤å›¾åºŠ 2. ä½¿ç”¨PicGoä¸Šä¼ å›¾ç‰‡åˆ°githubä»“åº“æ‹–æ‹½å³å¯ï¼Œéå¸¸ç®€å• 3. å¼•ç”¨PicGoçš„é“¾æ¥åˆ°typoraä¸­è¿›è¡Œæµ‹è¯•ç‚¹å‡»å¤åˆ¶å³å¯å¾—åˆ°ä»¥ä¸‹markdownæ ¼å¼çš„å›¾ç‰‡é“¾æ¥ï¼Œæ’å…¥åˆ°markdownä¸­å³å¯è§£æå‡ºå›¾ç‰‡ ![](https://cdn.jsdelivr.net/gh/dkyou/ImageHostingdku/img/%E3%80%90%E9%9B%AA%E3%80%912024-09-20%2023_57_02.png)` å½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©HTML URLç­‰ç­‰å…¶ä»–æ ¼å¼çš„é“¾æ¥ï¼Œéå¸¸çµæ´» 4. æµ‹è¯•ç»“æœ è®¾ç½®Typoraå®ç°æ’å…¥åˆ°typoraçš„å›¾ç‰‡è‡ªåŠ¨ä¸Šä¼ åˆ°å›¾åºŠå‰æï¼šå¼€å¯ä»£ç† æ‰“å¼€typoraï¼Œä¾æ¬¡ç‚¹å‡»ï¼šæ–‡ä»¶-åå¥½è®¾ç½®-å›¾åƒã€‚é€‰æ‹© ä¸Šä¼ æœåŠ¡ï¼Œè®¾ç½®ä¸€ä¸‹picgoå’Œpicgoè·¯å¾„ã€‚æ¯”è¾ƒç®€å•ï¼Œå°±ä¸è´´å›¾äº†ã€‚ è¿™æ ·ä¹‹åæ’å…¥åˆ°Typoraçš„å›¾ç‰‡å°±ä¼šè‡ªåŠ¨ä¸Šä¼ åˆ°githubä»“åº“é‡Œäº† æ‰¹é‡è½¬ç§»å›¾åºŠè¿™é‡Œåªæ˜¯è®°å½•ä¸€ä¸‹æ‰¹é‡è½¬ç§»å›¾åºŠçš„æ€è·¯ï¼Œå…·ä½“æˆ‘è¿˜æ²¡æœ‰é‡åˆ°è¿‡ï¼Œä½†æ˜¯æˆ‘æ„Ÿè§‰æˆ‘å¾ˆæœ‰å¯èƒ½ä»¥åä¼šé‡åˆ°ã€‚ ç®€å•æ€è·¯ï¼šä½¿ç”¨vscodeæˆ–è€…typoraçš„æ‰¹é‡æ›¿æ¢åŠŸèƒ½å¯ä»¥å®ç°å›¾ç‰‡å…³é”®ä¿¡æ¯é“¾æ¥çš„æ›¿æ¢ï¼Œvscodeä¼¼ä¹å¯ä»¥æ›¿æ¢å¤šä¸ªæ–‡ä»¶ã€‚ å‚è€ƒé“¾æ¥ å¦‚ä½•ç”¨githubæ­å»ºå›¾åºŠï¼ˆäº²æµ‹æœ‰æ•ˆï¼‰_githubå›¾åºŠ-CSDNåšå®¢ 2024æ–°ç‰ˆ-ä½¿ç”¨GitHubæ­å»ºä¸ªäººå›¾åºŠ-CSDNåšå®¢","tags":["hexo","æ­å»ºåšå®¢"],"categories":["æ­å»ºåšå®¢"]},{"title":"æ­å»ºåšå®¢","path":"/2024/09/20/ç½‘ä¸Šä¸€äº›ä¸»é¢˜æ¨è/","content":"Stellar ä¸»é¢˜ https://xaoxuu.com/wiki/stellar/#startSolitude ä¸»é¢˜ https://solitude.js.org/config/basic https://blog.everfu.cn/https://blog.lixiaomu.fun/posts/43857/ 16 æ¬¾ç²¾ç¾çš„ hexo åšå®¢ä¸»é¢˜æ¨è https://pengtech.net/hexo/hexo_theme_recommendation.html#5-Stellar-%E4%B8%BB%E9%A2%98 æ›´æ–°ä¸»é¢˜æˆªæ­¢åˆ°2024å¹´12æœˆ25æ—¥ï¼Œæˆ‘æ‰€ä½¿ç”¨çš„ä¸»é¢˜æ˜¯ Stellar ç¨³å®šç‰ˆ å®‰è£…æ–¹æ³•ï¼š è¿›å…¥myblogç›®å½•ï¼Œæ‰§è¡Œ npm i hexo-theme-stellar åœ¨myblog_config.ymlæ–‡ä»¶ä¸­ä¿®æ”¹ä¸ºï¼š theme: stellar æ›´æ–°æ–¹æ³•ï¼š è¿›å…¥myblogç›®å½•ï¼Œæ‰§è¡Œï¼š npm i hexo-theme-stellar ä»¥ä¸Šå†…å®¹æ›´æ–°æ—¶é—´ä¸ºï¼š2024å¹´12æœˆ25æ—¥","tags":["hexo","æ­å»ºåšå®¢","ä¸»é¢˜"],"categories":["æ­å»ºåšå®¢"]},{"title":"LVGL","path":"/2024/09/20/LVGL/","content":"LVGLå¸¸ç”¨APIå¯¹é½lv_obj_alignå’Œlv_obj_align_toåŒºåˆ« void lv_obj_align(lv_obj_t * obj, lv_align_t align, int32_t x_ofs, int32_t y_ofs) åŠŸèƒ½ï¼šå°†å¯¹è±¡objå¯¹é½åˆ°å…¶çˆ¶å¯¹è±¡å‚æ•°ï¼šobjï¼šè¦å¯¹é½çš„å¯¹è±¡ alignï¼šå¯¹é½æ–¹å¼ x_ofsï¼šxè½´åç§» y_ofsï¼šyè½´åç§» void lv_obj_align_to(lv_obj_t * obj, const lv_obj_t * base, lv_align_t align, int32_t x_ofs, int32_t y_ofs)åŠŸèƒ½ï¼šå°†å¯¹è±¡objå¯¹é½åˆ°æŒ‡å®šçš„åŸºå‡†å¯¹è±¡baseå‚æ•°ï¼šobjï¼šè¦å¯¹é½çš„å¯¹è±¡ baseï¼šåŸºå‡†å¯¹è±¡ alignï¼šå¯¹é½æ–¹å¼ x_ofsï¼šxè½´åç§» y_ofsï¼šyè½´åç§» åŒºåˆ«ï¼šlv_obj_align æ˜¯å°†å¯¹è±¡å¯¹é½åˆ°å…¶çˆ¶å¯¹è±¡ã€‚lv_obj_align_to æ˜¯å°†å¯¹è±¡å¯¹é½åˆ°æŒ‡å®šçš„åŸºå‡†å¯¹è±¡ baseï¼Œçµæ´»æ€§æ›´é«˜","tags":["åµŒå…¥å¼","LVGL"],"categories":["LVGL"]},{"title":"hexo+githubæ­å»ºåšå®¢ç¬”è®°","path":"/2024/09/20/hexo+githubæ­å»ºåšå®¢ç¬”è®°/","content":"hexo+githubæ­å»ºåšå®¢ç¬”è®°1. è½¯ä»¶å®‰è£…å’Œä½¿ç”¨1.Git æŸ¥çœ‹æ˜¯å¦æˆåŠŸå®‰è£… git version ç»‘å®šgité‚®ç®±å’Œgitç”¨æˆ·ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š git config --global user.name dkyou #è¾“å…¥gitä¸éœ€è¦åŒå¼•å·git config --global user.email 2323@xx.com 2.å®‰è£…NodeJS 2.1 NodeJS æ˜¯ä¸€ä¸ªåŸºäº Chrome V8 å¼•æ“çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚Node.js ä½¿ç”¨äº†ä¸€ä¸ªäº‹ä»¶é©±åŠ¨ã€éé˜»å¡å¼ IO çš„æ¨¡å‹ï¼Œä½¿å…¶è½»é‡åˆé«˜æ•ˆã€‚ ç®€å•çš„è¯´ Node.js å°±æ˜¯è¿è¡Œåœ¨æœåŠ¡ç«¯çš„ JavaScriptï¼Œåˆ©ç”¨JavaScriptåœ¨æœåŠ¡ç«¯è¿›è¡Œç¼–ç¨‹ã€‚ å…³äºNodeJSæ˜¯ä»€ä¹ˆå¯ä»¥å‚è€ƒï¼šnodejs(ç¬¬ä¸€ç¯‡)ï¼šnodejsæ˜¯ä»€ä¹ˆï¼Ÿ 2.2 å®‰è£…å¹¶é…ç½®ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥å‚è€ƒï¼š[Node.jså®‰è£…åŠç¯å¢ƒé…ç½®è¶…è¯¦ç»†æ•™ç¨‹](Node.jså®‰è£…åŠç¯å¢ƒé…ç½®è¶…è¯¦ç»†æ•™ç¨‹[Windowsç³»ç»Ÿ]_windows å®‰è£…nodejs-CSDNåšå®¢) 2025å¹´11æœˆ1æ—¥è¡¥å……å‚è€ƒé“¾æ¥ï¼Œå¯ä¼˜å…ˆå‚è€ƒï¼š2024æœ€æ–°ç‰ˆNode.jsä¸‹è½½å®‰è£…åŠç¯å¢ƒé…ç½®æ•™ç¨‹ã€ä¿å§†çº§ã€‘_nodejsä¸‹è½½-CSDNåšå®¢ 2.3 åŒæ ·çš„ï¼Œä½¿ç”¨å‘½ä»¤æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ node -vnpm -v 3.Hexoå®‰è£…å’Œè®¾ç½® 3.1 hexoå®‰è£…å‘½ä»¤ npm install -g hexo-cli#ç”¨äºå…¨å±€å®‰è£… Hexo çš„å‘½ä»¤è¡Œå·¥å…· ä»¥ä¸‹æ˜¯ä¸Šè¿°å‘½ä»¤çš„è§£é‡Šï¼š 1.npmnpm æ˜¯ Node.js åŒ…ç®¡ç†å™¨ï¼ˆNode Package Managerï¼‰çš„ç¼©å†™ï¼Œç”¨äºç®¡ç†å’Œå®‰è£… Node.js åº”ç”¨ç¨‹åºçš„ä¾èµ–åŒ…ã€‚2.installinstall æ˜¯ npm çš„ä¸€ä¸ªå­å‘½ä»¤ï¼Œç”¨äºå®‰è£…æŒ‡å®šçš„åŒ…ã€‚3. -g-g è¡¨ç¤ºå…¨å±€å®‰è£…ï¼ˆglobalï¼‰ã€‚è¿™æ„å‘³ç€åŒ…å°†è¢«å®‰è£…åˆ°ç³»ç»Ÿçš„å…¨å±€ä½ç½®ï¼Œè€Œä¸æ˜¯é¡¹ç›®çš„æœ¬åœ° node_modules ç›®å½•ä¸­ã€‚å…¨å±€å®‰è£…çš„åŒ…å¯ä»¥åœ¨ç³»ç»Ÿä¸­çš„ä»»ä½•ä½ç½®ä½¿ç”¨ã€‚hexo-cli4. hexo-cli æ˜¯ Hexo çš„å‘½ä»¤è¡Œæ¥å£å·¥å…·ã€‚Hexo æ˜¯ä¸€ä¸ªé™æ€ç«™ç‚¹ç”Ÿæˆå™¨ï¼Œå¯ä»¥ç”¨æ¥å¿«é€Ÿç”Ÿæˆé™æ€åšå®¢æˆ–ç½‘ç«™ã€‚ 3.2 æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä¾‹å¦‚â€D:\\myblogâ€ï¼Œä¸éœ€è¦è¿›å…¥è¯¥æ–‡ä»¶å¤¹ï¼Œç›´æ¥é¼ æ ‡å³é”®â€”Git Bash Hereï¼Œä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ åˆå§‹åŒ–myblog,å³ä»https://github.com/hexojs/hexo-starter.gitå…‹éš†æ–‡ä»¶ï¼Œå¹¶ä¸”å®‰è£…ä¾èµ– hexo init myBlog è¿›å…¥myblogæ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”æ‰§è¡Œnpm installå‘½ä»¤ cd myBlognpm install è¿è¡Œhexo så‘½ä»¤ hexo s æ ¹æ®æç¤ºï¼Œå¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¾“å…¥http://localhost:4000/,å›è½¦å³å¯çœ‹åˆ°æ•ˆæœ è¿™æ˜¯éƒ¨ç½²åœ¨æœ¬åœ°çš„é»˜è®¤çš„ä¸€ç¯‡hello worldåšå®¢ï¼Œä½¿ç”¨çš„æ˜¯é»˜è®¤theme: landscapeä¸»é¢˜ï¼Œæ­¤æ—¶å’Œgithubè¿˜æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚ è¡¥å……å·¥ä½œ Stellar 1.33.1ç‰ˆæœ¬çš„è„šæœ¬ä¾èµ–probe-image-sizeï¼ˆå¯é€‰ï¼‰ npm i probe-image-size --save hexo dä¾èµ–hexo-deployer-gitå·¥å…· npm i hexo-deployer-git --save å¦åˆ™å‡ºç°ä»¥ä¸‹æŠ¥é”™ $ hexo dINFO Validating configINFO ------------------------------------------------INFO Welcome to Stellar 1.33.1DOCS https://xaoxuu.com/wiki/stellar/REPO https://github.com/xaoxuu/hexo-theme-stellar.gitINFO ------------------------------------------------ERROR Deployer not found: git 2. ä¸»é¢˜å®‰è£…å¯ä»ä¸»é¢˜å®˜ç½‘ä¸‹è½½è‡ªå·±å–œæ¬¢çš„ä¸»é¢˜ï¼šThemes | Hexo ä»¥hexo-theme-Chicä¸ºä¾‹è®¾ç½®è‡ªå·±çš„ä¸»é¢˜,é“¾æ¥ï¼šhttps://github.com/Siricee/hexo-theme-Chic.git æ‰§è¡Œgit clone https://github.com/Siricee/hexo-theme-Chic.gitæˆ–è€…ç›´æ¥download zipå°†ä¸‹è½½çš„ä¸»é¢˜æ–‡ä»¶è§£å‹æ”¾åœ¨D:\\myblog\\themesæ–‡ä»¶å¤¹ä¸­ã€‚æ³¨æ„æ–‡ä»¶åä¸ºhexo-theme-Chicåè¾¹æ²¡æœ‰-masterå’Œå…¶ä»–ä¿¡æ¯ã€‚ åœ¨D:\\myblogä¸­æ‰¾åˆ°_config.ymlï¼Œä½¿ç”¨è®°äº‹æœ¬æˆ–è€…vscodeç­‰æ‰“å¼€ï¼Œåœ¨ç¬¬100è¡Œå·¦å³æ‰¾åˆ°theme: landscapeï¼Œæ”¹ä¸ºtheme: hexo-theme-Chicã€‚ æ³¨æ„ï¼šè¿™é‡Œçš„_config.ymlæ˜¯æ ¹ç›®å½•ä¸‹çš„ï¼Œå³â€D:\\myblog\\_config.ymlâ€ï¼Œä¸æ˜¯D:\\myblog\\themes\\hexo-theme-Chicä¸‹çš„_config.yml ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ hexo ghexo s æ ¹æ®æç¤ºï¼Œå¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¾“å…¥http://localhost:4000/,å›è½¦å³å¯çœ‹åˆ°æ›´æ¢ä¸»é¢˜ä¹‹åçš„æ•ˆæœ themesä¸»é¢˜æ–‡ä»¶ç»“æ„ï¼š .â”œâ”€â”€ _config.ymlâ”œâ”€â”€ languagesâ”œâ”€â”€ layoutâ”œâ”€â”€ scriptsâ””â”€â”€ source ä¸»é¢˜é…ç½®æ–‡ä»¶è®¾ç½®ï¼šD:\\myblog\\themes\\hexo-theme-Chicä¸‹çš„_config.yml #æ–‡ä»¶ä½ç½®`D:\\myblog\\themes\\hexo-theme-Chic`ä¸‹çš„`_config.yml`# Header navname: dkus Blog //å¯¹åº”å·¦ä¸Šè§’# å¯¹åº”å³ä¸Šè§’ Posts Categories Tags About# navigatior itemsnav: Posts: /archives Categories: /category Tags: /tag About: /about# favicon æµè§ˆå™¨ç½‘å€æ æ˜¾ç¤ºçš„å›¾æ ‡ï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘é»˜è®¤çš„ä¸æ˜¯favicon.icoï¼Œè€Œæ˜¯æˆ‘ä¹‹å‰è®¾ç½®çš„ç¥é‡Œå‡Œåçš„å›¾ç‰‡ï¼Œæœ‰ç‚¹å¥‡æ€ªfavicon: /favicon.ico# Profile ä¸­é—´æ˜¾ç¤ºçš„åå­—nickname: Dku### this variable is MarkDown form.# ä¸ªäººæè¿° æ˜¾ç¤ºåœ¨å›¾åƒä¸‹è¾¹description: Lorem ipsum dolor sit amet, **consectetur adipiscing elit.** brFusce eget urna vitae velit *eleifend interdum at ac* nisi.# ä¸ªäººå¤´åƒå›¾ç‰‡avatar: /image/avatar.jpeg# main menu navigation## links key words should not be changed.## Complete url after key words.## Unused key can be commented out.#å¸¸ç”¨ç½‘ç«™çš„ä¸ªäººé“¾æ¥ï¼Œå–æ¶ˆæ³¨é‡Šæ·»åŠ å³å¯links: Blog: /archives # Category: # Tags: # Link: # Resume: # Publish: # Trophy: # Gallery: # RSS: # AliPay: ZhiHu: https://www.zhihu.com/people/sirice # LinkedIn: # FaceBook: # Twitter: # Skype: # CodeSandBox: # CodePen: # Sketch: # Gitlab: # Dribbble: Instagram: Reddit: # YouTube: # QQ: # Weibo: # WeChat: Github: https://github.com/Siricee# how links show: you have 2 choice--text or icon.# å›¾æ ‡æˆ–è€…æ–‡å­—æ˜¾ç¤ºå¸¸ç”¨ç½‘ç«™çš„ä¸ªäººé“¾æ¥links_text_enable: falselinks_icon_enable: true# Post page## Post_metapost_meta_enable: truepost_author_enable: truepost_date_enable: truepost_category_enable: true## Post copyrightpost_copyright_enable: truepost_copyright_author_enable: truepost_copyright_permalink_enable: truepost_copyright_license_enable: truepost_copyright_license_text: Copyright (c) 2019 a href=http://creativecommons.org/licenses/by-nc/4.0/CC-BY-NC-4.0/a LICENSEpost_copyright_slogan_enable: truepost_copyright_slogan_text: Do you believe in strongDESTINY/strong?## tocpost_toc_enable: true# Pagepage_title_enable: true# Date / Time format## Hexo uses Moment.js to parse and display date## You can customize the date format as defined in## http://momentjs.com/docs/#/displaying/format/#æ—¥æœŸæ ¼å¼date_format: MMMM D, YYYYtime_format: H:mm:ss# stylesheets loaded in the headstylesheets: - /css/style.css# scripts loaded in the end of the bodyscripts: - /js/script.js - /js/tocbot.min.js # tscanlin/tocbot: Build a table of contents from headings in an HTML document. # https://github.com/tscanlin/tocbot# plugin functions## Mathjax: Math Formula Support## https://www.mathjax.orgmathjax: enable: true import: demand # global or demand ## global: all pages will load mathjax,this will degrade performance and some grammers may be parsed wrong. ## demand: Recommend option,if your post need fomula, you can declare mathjax: true in Front-matter æ›´æ”¹å®ŒD:\\myblog\\themes\\hexo-theme-Chicä¸‹çš„_config.ymlé…ç½®æ–‡ä»¶ä¹‹åï¼Œå¯ä»¥ä¾æ¬¡æ‰§è¡Œhexo g hexo sæ ¹æ®æç¤ºï¼Œåœ¨æµè§ˆå™¨ä¸­è¾“å…¥http://localhost:4000/,å›è½¦å³å¯çœ‹åˆ°è®¾ç½®ä¸»é¢˜ä¹‹åçš„æ•ˆæœ å¯ä»¥è®¾ç½®çš„ä¸œè¥¿æŒºå¤šï¼Œç®€å•è®¾ç½®çš„æ•ˆæœ è¡¥å……å·¥ä½œå®‰è£…ä¸»é¢˜å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼è¿›è¡Œï¼Œä»¥æˆ‘ç°åœ¨ä½¿ç”¨çš„Stellar 1.33.1ä¸ºä¾‹ é€šè¿‡npmæ–¹å¼å®‰è£… å®‰è£…å’Œæ›´æ–°å‡æ‰§è¡Œnpm i hexo-theme-stellar åœ¨ blog/_config.yml æ–‡ä»¶ä¸­æ‰¾åˆ°å¹¶ä¿®æ”¹ theme: stellar æºç æ–¹å¼å®‰è£… é€šè¿‡npmæ–¹å¼å®‰è£…éå¸¸ç®€å•ï¼Œä½†æ˜¯å¯¹äºé€šè¿‡åœ¨themeæ–‡ä»¶å¤¹ä¸‹æ–°å¢æºä»£ç çš„æ–¹å¼ï¼Œéœ€è¦å¤šåšä¸€æ­¥æ“ä½œã€‚ æŠŠ Stellar ä¸»é¢˜ä»“åº“æ·»åŠ ä¸ºåšå®¢ä»“åº“çš„å­æ¨¡å—ï¼Œè¿™é‡Œæˆ‘forkäº†ä½œè€…çš„ä»“åº“ git submodule add https://github.com/dkyou/hexo-theme-stellar.git themes/stellar å¤åˆ¶themes\\hexo-theme-stellar\\_config.ymlåˆ°æ ¹ç›®å½•ï¼Œå¹¶é‡å‘½åä¸º_config.stellar.yml è¯´æ˜ï¼šä¸¤ä¸ªé…ç½®æ–‡ä»¶åº”è¯¥éƒ½è¦è®¾ç½®ï¼Œå¹¶ä¸”æ ¹ç›®å½•ä¸‹çš„_config.stellar.ymlä¼˜å…ˆçº§å¤§äºä¸»é¢˜æ–‡ä»¶å¤¹ä¸‹çš„é…ç½®æ–‡ä»¶ åœ¨ blog/_config.yml æ–‡ä»¶ä¸­æ‰¾åˆ°å¹¶ä¿®æ”¹ï¼š theme: hexo-theme-stellar 3.å°†hexoåšå®¢éƒ¨ç½²åˆ°githubä¸Šä»¥ä¸Šï¼Œæ‰€æœ‰çš„è®¾ç½®å’Œå†…å®¹éƒ½åªèƒ½æ˜¾ç¤ºåœ¨è‡ªå·±çš„ç”µè„‘ä¸Šï¼Œå¦‚ä½•éƒ¨ç½²åˆ°githubä¸Šï¼Ÿ 3.1 å‡†å¤‡å·¥ä½œâ€”æ–°å»ºä»“åº“å¹¶è®¾ç½®ssh key å¦‚æœä¹‹å‰å·²ç»ä½¿ç”¨hexoæ­å»ºè¿‡åšå®¢ï¼Œæˆ–è€…è®¾ç½®è¿‡ä»¥ä¸‹å†…å®¹ï¼Œåˆ™æ— éœ€å†è¿›è¡Œè®¾ç½®ï¼å¦‚æœæƒ³äº†è§£ä»€ä¹ˆæ˜¯ssh keyåŠå…¶åŸç†ï¼Œå¯ä»¥å‚è€ƒssh_keyç®€è®°ï¼Œæœ¬æ–‡åªè®²å¦‚ä½•æ“ä½œã€‚ æ–°å»ºä¸€ä¸ªgithubä»“åº“ï¼Œä»“åº“åè¦æŒ‰ç…§ï¼šç”¨æˆ·å.github.ioè®¾ç½® é…ç½®ssh key,ä½¿ç”¨gité…ç½®ssh keyï¼Œå‘½ä»¤å¦‚ä¸‹ git config --global user.name dkyou #è¾“å…¥gitä¸éœ€è¦åŒå¼•å·git config --global user.email 2323@xx.comssh-keygen -t rsa -C 2323@xx.com æŸ¥çœ‹ssh cat ~/.ssh/id_rsa.pub æ·»åŠ å¯ä¿¡åˆ—è¡¨ã€‚è‹¥è¿”å› Hi xxx! Youâ€™ve successfully authenticated, but GitHub does not provide shell access. å†…å®¹ï¼Œåˆ™è¯å®æ·»åŠ æˆåŠŸã€‚ ssh -T git@github.com ç™»é™† Github ä¸Šæ·»åŠ åˆšåˆšç”Ÿæˆçš„SSH keyï¼ŒæŒ‰å¦‚ä¸‹æ­¥éª¤æ·»åŠ ï¼Œå³ä¸Šè§’ç‚¹å‡»å¤´åƒ- settings - SSH and GPG keysï¼Œå»ºç«‹ä¸€ä¸ªæ–°çš„ SSH key, æ ‡é¢˜éšä¾¿ï¼Œkey å°±å¡«åˆšæ‰ç”Ÿæˆé‚£ä¸ªï¼Œç¡®è®¤å»ºç«‹ï¼Œè¿™æ ·åœ¨ä½ çš„ SSH keys åˆ—è¡¨é‡Œå°±ä¼šçœ‹åˆ°ä½ åˆšåˆšæ·»åŠ çš„å¯†é’¥ã€‚ 3.2 éƒ¨ç½² åœ¨D:\\myblogä¸­æ‰¾åˆ°_config.ymlï¼Œä½¿ç”¨è®°äº‹æœ¬æˆ–è€…vscodeç­‰æ‰“å¼€ï¼Œæ‰¾åˆ°æœ€åå‡ è¡Œï¼Œæ”¹ä¸º # æ–‡ä»¶è·¯å¾„ï¼šD:\\myblog\\_config.ymldeploy: type: git repo: https://github.com/dkyou/dkyou.github.io branch: master å®‰è£… hexo-deployer-git npm install hexo-deployer-git --save æ‰§è¡Œå‘½ä»¤ä¸Šä¼  hexo g #ç”Ÿæˆhexo d #ä¸Šä¼  æœ‰æ—¶å€™åœ¨æ‰§è¡Œhexo dä¼šæŠ¥é”™ï¼Œå†æ‰§è¡Œä¸€æ¬¡å°±å¯ä»¥ æˆåŠŸçš„æˆªå›¾ æ¥ä¸‹æ¥ä½¿ç”¨ç”¨æˆ·å.github.ioå³å¯è®¿é—®éƒ¨ç½²åˆ°githubä¸Šçš„åšå®¢ æˆåŠŸéƒ¨ç½²åˆ°githubæ•ˆæœæ¼”ç¤º 4.æ›´æ–°æ–‡ç« å¯ä»¥ä½¿ç”¨hexo new æ–‡ç« æ ‡é¢˜å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªæ–‡ç« æ ‡é¢˜.mdæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§æ ¼å¼ç›´æ¥å°†è‡ªå·±çš„.md æ–‡ä»¶å¤åˆ¶åˆ°D:\\myblog\\source\\_posts\\æ–‡ä»¶å¤¹ä¸­ï¼ŒåŒæ—¶æŒ‰ç…§ä»¥ä¸‹æ ¼å¼æ·»åŠ ä¸€äº›å‘½ä»¤ ä½¿ç”¨hexo new æ–‡ç« æ ‡é¢˜å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªæ–‡ç« æ ‡é¢˜.mdæ–‡ä»¶ hexo new æ–‡ç« æ ‡é¢˜ åšå®¢è¯­æ³•ç»“æ„: ---title: Hello World #æ–‡ç« æ ‡é¢˜date: 2024-09-20 20:13:20tags: [tag1,tag2,...]categories: --- å°†æ–°æ–‡ç« éƒ¨ç½²åˆ°githubä¸Š hexo g # ç”Ÿæˆï¼Œå¿…é¡»hexo s # æœ¬åœ°æ¸²æŸ“ï¼Œéå¿…è¦hexo d # éƒ¨ç½²åˆ°Github ä¸Šï¼Œå¿…é¡» æ³¨æ„ï¼šä¸€ä¸ªä¸»é¢˜å¯èƒ½æœ‰ä»¥ä¸‹æ–‡ä»¶ç»“æ„ .â”œâ”€â”€ _config.ymlâ”œâ”€â”€ languagesâ”œâ”€â”€ layoutâ”œâ”€â”€ scriptsâ””â”€â”€ source æ¶‰åŠåˆ°hexo dçš„æ–‡ä»¶ Source æ–‡ä»¶å¤¹ã€‚ å°†æ‚¨çš„ç´ æï¼ˆå¦‚ CSS å’Œ JavaScript æ–‡ä»¶ï¼‰æ”¾åœ¨è¿™é‡Œã€‚ æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹å¼€å¤´åç§°ä¸º _ï¼ˆä¸‹åˆ’çº¿ï¼‰æˆ–éšè—çš„æ–‡ä»¶ä¼šè¢«å¿½ç•¥ã€‚ Hexo å°†å¤„ç†æ‰€æœ‰å¯æ¸²æŸ“çš„æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬ä¿å­˜åˆ° public æ–‡ä»¶å¤¹ä¸‹ã€‚ ä¸å¯æ¸²æŸ“çš„æ–‡ä»¶å°†ç›´æ¥å¤åˆ¶åˆ° public æ–‡ä»¶å¤¹ã€‚ hexo dä¹Ÿä¼šæŠŠD:\\myblog\\source_postsä¸­çš„mdæ–‡ä»¶ä¸Šä¼ åˆ° public æ–‡ä»¶å¤¹ä¸‹ï¼Œå¦‚æœ_postçš„mdæ–‡ä»¶è¢«åˆ é™¤æˆ–è€…å¢åŠ ï¼Œåˆ™ä¼šå®Œå…¨è¦†ç›–githubä¸­çš„mdæ–‡ä»¶ï¼Œæ‰€ä»¥ä¸è¦è½»æ˜“åˆ é™¤_postæ–‡ä»¶å¤¹ä¸‹çš„mdæ–‡ä»¶ã€‚ 5.åšå®¢å¤‡ä»½ä¸ºäº†æ–¹ä¾¿æ¢ç”µè„‘çš„æ—¶å€™ç§»æ¤ç¬”è®°ï¼Œæˆ‘å°†ç¬”è®°é€šè¿‡ GitHub æ‰˜ç®¡æºä»£ç ã€‚åŒæ—¶å°†ä¸»é¢˜ä½œä¸ºä»“åº“å­æ¨¡å—ã€‚ å…‹éš†é¡¹ç›®ï¼š git clone git@github.com:dkyou/blog-source.gitcd blog-sourcegit submodule update --init --recursive å®‰è£… Hexo ç¯å¢ƒï¼š npm install hexo-cli -gnpm install å®‰è£…deployer npm i hexo-deployer-git --save ç¡®è®¤ _config.yml é‡Œéƒ¨ç½²è®¾ç½®ï¼ˆSSH æ¨¡å¼ï¼‰ æµ‹è¯•ï¼š hexo g hexo s æ‰“å¼€ http://localhost:4000 çœ‹æ˜¯å¦æ­£å¸¸ éƒ¨ç½²ï¼š hexo d ä¹‹åå¯¹ä¸»é¢˜çš„ä¿®æ”¹éƒ½åœ¨ themes/hexo-theme-stellar é‡Œåšï¼š cd themes/hexo-theme-stellar# ä¿®æ”¹æ–‡ä»¶...git add .git commit -m xxxgit push -u origin maincd -# å›åˆ°ä¸»ä»“åº“ï¼Œæäº¤â€œå­æ¨¡å—æŒ‡é’ˆâ€çš„å˜æ›´git add themes/hexo-theme-stellargit commit -m xxxgit push 6.æ‹‰å–åŸä»“åº“é—®é¢˜æè¿°ï¼šåœ¨forkå®ŒåŸ https://github.com/xaoxuu/hexo-theme-stellar.gitä»“åº“ä¸ºè‡ªèº«ä»“åº“it@github.com:dkyou/hexo-theme-stellar.gitä¹‹åï¼Œä¿®æ”¹å¹¶æ¨é€äº†_config.ymlæ–‡ä»¶ã€‚ç°åœ¨æƒ³è¦æ–°å»ºmain-dkyåˆ†æ”¯ç”¨äºä¿å­˜è‡ªå·±çš„ä¿®æ”¹ï¼Œmainåˆ†æ”¯ç”¨äºè·Ÿè¸ªåŸä»“åº“æ›´æ–°ï¼Œå†åˆå¹¶å˜åŸºè¿›main-dkyã€‚æ³¨æ„ä»¥åä¸è¦åœ¨mainåˆ†æ”¯ä¸Šå†™ä»£ç ã€‚ upstream â†’ åŸä½œè€…çš„ä»“åº“ï¼ˆxaoxuu/hexo-theme-stellarï¼‰ origin â†’ è‡ªå·±çš„ forkï¼ˆdkyou/hexo-theme-stellarï¼‰ æœ¬åœ°æœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼š mainï¼šåªç”¨æ¥åŒæ­¥ä¸Šæ¸¸ï¼Œä¸åšæ”¹åŠ¨ï¼› main-dkyï¼šä½ è‡ªå·±çš„å¼€å‘åˆ†æ”¯ï¼Œç”¨æ¥æ”¹é…ç½®æ–‡ä»¶ã€ä¸»é¢˜æ ·å¼ç­‰ã€‚ æ•´ç†å†å²æ·»åŠ  upstreamï¼ˆåªéœ€ä¸€æ¬¡ï¼‰ git remote add upstream https://github.com/xaoxuu/hexo-theme-stellar.gitgit fetch upstream æŠŠå½“å‰ main ä¸Šçš„ä¸ªäººæ”¹åŠ¨â€œæ¬å®¶â€åˆ°æ–°åˆ†æ”¯ï¼Œåšä¸ªå¤‡ä»½ git checkout -b main-dkygit push -u origin main-dky # å¤‡ä»½åˆ°ä½ çš„ fork æŠŠ main é‡ç½®ä¸ºä¸Šæ¸¸ï¼ˆä¿æŒ main å¹²å‡€é•œåƒ upstreamï¼‰ git checkout main# å¦‚æœä¸ç¡®å®šä¸Šæ¸¸é»˜è®¤åˆ†æ”¯åï¼Œå…ˆçœ‹ä¸€ä¸‹ï¼ˆé€šå¸¸æ˜¯ mainï¼‰ï¼šgit remote show upstream # ä¼šæ˜¾ç¤º HEAD branch: maingit reset --hard upstream/main è¦†ç›– fork çš„ mainï¼ˆéœ€è¦å¼ºæ¨ï¼‰ git push -f origin main åŒæ­¥å’Œæ›´æ–°åŒæ­¥ä¸Šæ¸¸ â†’ main git checkout main# --ff-only (fast-forward)å‚æ•°å¿«è¿›æ–¹å¼æ›´æ–°æœ¬åœ°maingit pull --ff-only upstream main# æœ¬åœ°æ›´æ–°åçš„ main æ¨é€å›è‡ªå·±åœ¨ GitHub ä¸Šçš„ forkï¼ˆoriginï¼‰git push origin main æŠŠä¸Šæ¸¸æ›´æ–°å¸¦åˆ°è‡ªå·±å¼€å‘åˆ†æ”¯ git checkout main-dky# æŠŠåˆšæ‰åŒæ­¥åˆ° main çš„ä¸Šæ¸¸æ›´æ–°åˆå¹¶è¿› main-dkygit merge main # æˆ–ï¼šgit rebase mainï¼ˆæ›´çº¿æ€§ï¼‰# æ›´æ–°åçš„ main-dky æ¨å›ä½ çš„è¿œç¨‹ä»“åº“ï¼ˆorigin/main-dkyï¼‰git push origin main-dky å®Œç»“ï¼","tags":["hexo","æ­å»ºåšå®¢"],"categories":["æ­å»ºåšå®¢"]},{"title":"ssh_keyç®€è®°","path":"/2024/09/20/ssh_key/","content":"æ‘˜è¦ï¼šæœ¬æ–‡æ˜¯ä¸Šç¯‡ã€Šhexo+githubæ­å»ºåšå®¢ç¬”è®°ã€‹çš„ä¸€äº›è¡¥å……ã€‚ç¿»é˜…åšå®¢çš„æ—¶å€™ï¼Œå¯¹æœ¬åœ°åšå®¢æ€ä¹ˆéƒ¨ç½²åˆ°githubä¸Šï¼Œä»¥åŠå¦‚ä½•é…ç½®SSHå¯†é’¥ï¼Œä»¥åŠå¦‚ä½•å°†å…¬é’¥æ·»åŠ åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„åŸç†æœ‰ä¸€äº›ä¸æ¸…æ¥šï¼Œäºæ˜¯ä½œäº†ä¸€ä¸ªç¬”è®°ï¼Œè®°å½•ä¸‹æ¥ã€‚ SSH å¯†é’¥ç”ŸæˆSSHå¯†é’¥SSH å¯†é’¥ç”¨äºå®‰å…¨åœ°è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œé€šå¸¸ç”¨äºæ— å¯†ç ç™»å½•å’Œèº«ä»½éªŒè¯ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ç”Ÿæˆå’Œä½¿ç”¨ SSH å¯†é’¥çš„æ­¥éª¤ï¼š ç”Ÿæˆ SSH å¯†é’¥æ‰“å¼€ç»ˆç«¯ï¼š åœ¨ Linux ï¼Œæ‰“å¼€ç»ˆç«¯ã€‚åœ¨ Windows ä¸Šï¼Œä½¿ç”¨ Git Bashã€‚ç”Ÿæˆ SSH å¯†é’¥å¯¹ï¼š ssh-keygen -t rsa -b 4096 -C your_email@example.com -t rsa æŒ‡å®šå¯†é’¥ç±»å‹ä¸º RSAã€‚ -b 4096 æŒ‡å®šå¯†é’¥é•¿åº¦ä¸º 4096 ä½ã€‚ -C â€œyour_email@example.comâ€œ æ·»åŠ ä¸€ä¸ªæ ‡ç­¾ï¼Œé€šå¸¸æ˜¯ä½ çš„ç”µå­é‚®ä»¶åœ°å€ã€‚ ä¿å­˜å¯†é’¥ï¼šæŒ‰å›è½¦é”®æ¥å—é»˜è®¤æ–‡ä»¶ä½ç½®ï¼ˆé€šå¸¸æ˜¯ ~.sshid_rsaï¼‰ã€‚è¾“å…¥ä¸€ä¸ªå¯†ç ï¼ˆå¯é€‰ï¼‰ä»¥å¢åŠ å®‰å…¨æ€§ã€‚æŸ¥çœ‹ç”Ÿæˆçš„å¯†é’¥ç”Ÿæˆçš„å¯†é’¥å¯¹å°†ä¿å­˜åœ¨ ~.ssh ç›®å½•ä¸‹ï¼š ç§é’¥ï¼šid_rsa å…¬é’¥ï¼šid_rsa.pub å…¬é’¥ï¼š åŠ å¯†ï¼šç”¨äºåŠ å¯†æ•°æ®ï¼Œåªæœ‰å¯¹åº”çš„ç§é’¥æ‰èƒ½è§£å¯†ã€‚ ç­¾åéªŒè¯ï¼šç”¨äºéªŒè¯ä½¿ç”¨ç§é’¥ç­¾åçš„æ•°æ®çš„æ­£ç¡®æ€§å’Œå®Œæ•´æ€§ã€‚ ä¿å¯†æ€§ï¼šå¯ä»¥å…¬å¼€å…±äº«ï¼Œé€šå¸¸ç”¨äºæ·»åŠ åˆ°è¿œç¨‹æœåŠ¡å™¨çš„ ~.sshauthorized_keys æ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿è¿›è¡Œæ— å¯†ç ç™»å½•ã€‚ ç§é’¥ï¼š è§£å¯†ï¼šç”¨äºè§£å¯†ä½¿ç”¨å…¬é’¥åŠ å¯†çš„æ•°æ®ã€‚ ç­¾åï¼šç”¨äºå¯¹æ•°æ®è¿›è¡Œç­¾åï¼Œä»¥è¯æ˜æ•°æ®çš„æ¥æºå’Œå®Œæ•´æ€§ã€‚ ä¿å¯†æ€§ï¼šå¿…é¡»ä¸¥æ ¼ä¿å¯†ï¼Œä¸èƒ½å…¬å¼€ã€‚å¦‚æœç§é’¥æ³„éœ²ï¼Œæ”»å‡»è€…å¯ä»¥å†’å……ä½ è¿›è¡Œèº«ä»½éªŒè¯æˆ–è§£å¯†æ•°æ®ã€‚ æ€»ç»“ä¸¤è€…ä¹‹é—´çš„å…³ç³»ï¼š å…¬é’¥ï¼šæ·»åŠ åˆ° GitHub è´¦æˆ·ä¸­ï¼Œç”¨äºéªŒè¯ä½ çš„èº«ä»½ã€‚ ç§é’¥ï¼šä¿å­˜åœ¨ä½ çš„æœ¬åœ°æœºå™¨ä¸Šï¼Œç”¨äºè§£å¯† GitHub å‘é€çš„æŒ‘æˆ˜ã€‚ å°†å…¬é’¥æ·»åŠ åˆ°GitHubä¸Š ç™»å½•åˆ°ä½ çš„ GitHub è´¦æˆ·ã€‚ è¿›å…¥ Settings SSH and GPG keysã€‚ ç‚¹å‡» New SSH keyã€‚ åœ¨ Title ä¸­è¾“å…¥ä¸€ä¸ªæè¿°æ€§çš„åç§°ï¼Œä¾‹å¦‚ â€œMy Laptopâ€ã€‚ åœ¨ Key ä¸­ç²˜è´´ä½ ä¹‹å‰å¤åˆ¶çš„å…¬é’¥å†…å®¹ã€‚ ç‚¹å‡» Add SSH keyã€‚ æµ‹è¯• SSH è¿æ¥ï¼š ssh -T git@github.com% -T é€‰é¡¹ï¼šç¦ç”¨ä¼ªç»ˆç«¯åˆ†é…ã€‚è¿™ä½¿å¾—å‘½ä»¤çš„è¾“å‡ºæ›´ç®€æ´ï¼Œæ›´é€‚åˆè„šæœ¬å’Œè‡ªåŠ¨åŒ–ä»»åŠ¡ã€‚% git@github.comï¼šæŒ‡å®šä½ è¦è¿æ¥çš„ GitHub æœåŠ¡å™¨å’Œç”¨æˆ·ï¼ˆgit ç”¨æˆ·ï¼‰ã€‚ å‘½ä»¤è§£é‡Šï¼šç®€å•å›ç­”ï¼šssh -T git@github.com æ˜¯ä¸€ä¸ªç”¨äºæµ‹è¯• SSH è¿æ¥åˆ° GitHub çš„å‘½ä»¤ã€‚è¿™ä¸ªå‘½ä»¤å¯ä»¥å¸®åŠ©ä½ éªŒè¯ä½ çš„ SSH å¯†é’¥æ˜¯å¦å·²ç»æ­£ç¡®åœ°æ·»åŠ åˆ° GitHub è´¦æˆ·ä¸­ï¼Œå¹¶ä¸”å¯ä»¥æˆåŠŸåœ°è¿›è¡Œèº«ä»½éªŒè¯ã€‚è¯¦ç»†å›ç­”ï¼š èº«ä»½éªŒè¯ï¼šå½“ä½ è¿è¡Œ ssh -T git@github.com æ—¶ï¼ŒGitHub æœåŠ¡å™¨ä¼šä½¿ç”¨ä½ æä¾›çš„å…¬é’¥æ¥éªŒè¯ä½ çš„èº«ä»½ã€‚å…·ä½“æ¥è¯´ï¼ŒGitHub ä¼šä½¿ç”¨ä½ çš„å…¬é’¥æ¥è§£å¯†ä¸€ä¸ªæŒ‘æˆ˜ï¼ˆchallengeï¼‰ï¼Œå¦‚æœä½ çš„ç§é’¥èƒ½å¤ŸæˆåŠŸè§£å¯†è¿™ä¸ªæŒ‘æˆ˜ï¼ŒGitHub ä¼šè®¤ä¸ºä½ æ˜¯åˆæ³•ç”¨æˆ·ã€‚ å…¬é’¥å’Œç§é’¥çš„å…³ç³»ï¼šå…¬é’¥å’Œç§é’¥æ˜¯ä¸€å¯¹ï¼Œå…¬é’¥ç”¨äºåŠ å¯†ï¼Œç§é’¥ç”¨äºè§£å¯†ã€‚å½“ä½ åœ¨ GitHub ä¸Šæ·»åŠ å…¬é’¥åï¼ŒGitHub ä¼šä½¿ç”¨è¿™ä¸ªå…¬é’¥æ¥éªŒè¯ä½ æä¾›çš„ç§é’¥æ˜¯å¦åŒ¹é…ã€‚ é€šè¿‡ ssh -T git@github.com å‘½ä»¤ï¼Œä½ å¯ä»¥éªŒè¯ä½ çš„å…¬é’¥æ˜¯å¦å·²ç»æ­£ç¡®æ·»åŠ åˆ° GitHub è´¦æˆ·ä¸­ï¼Œå¹¶ä¸”ä½ çš„ç§é’¥æ˜¯å¦èƒ½å¤ŸæˆåŠŸè¿›è¡Œèº«ä»½éªŒè¯ é¢„æœŸè¾“å‡ºé¦–æ¬¡è¿æ¥ï¼š å¦‚æœè¿™æ˜¯ä½ ç¬¬ä¸€æ¬¡è¿æ¥åˆ° GitHubï¼Œç³»ç»Ÿä¼šæç¤ºä½ ç¡®è®¤ GitHub çš„ä¸»æœºå¯†é’¥æŒ‡çº¹ï¼š The authenticity of host github.com (IP_ADDRESS) cant be established.RSA key fingerprint is SHA256:nThbg6kXUpJWGl7E1IGOCspRomTxdCARLviKw6E5SY8.Are you sure you want to continue connecting (yes/no/[fingerprint])? è¾“å…¥ yes ç»§ç»­è¿æ¥ã€‚æˆåŠŸè¿æ¥ï¼š å¦‚æœä½ çš„ SSH å¯†é’¥å·²æ­£ç¡®æ·»åŠ åˆ° GitHub è´¦æˆ·ä¸­ï¼Œä½ ä¼šçœ‹åˆ°ä»¥ä¸‹æ¶ˆæ¯ï¼š Hi username! Youve successfully authenticated, but GitHub does not provide shell access. å…¶ä¸­ username æ˜¯ä½ çš„ GitHub ç”¨æˆ·åã€‚ å°†å…¬é’¥æ·»åŠ åˆ°è¿œç¨‹æœåŠ¡å™¨å¤åˆ¶å…¬é’¥ï¼š cat ~/.ssh/id_rsa.pub å¤åˆ¶è¾“å‡ºçš„å†…å®¹ã€‚å°†å…¬é’¥æ·»åŠ åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼šç™»å½•åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼š ssh user@remote_host åˆ›å»º .ssh ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ï¼š mkdir -p ~/.ssh å°†å…¬é’¥æ·»åŠ åˆ° authorized_keys æ–‡ä»¶ï¼š echo your_public_key ~/.ssh/authorized_keys è®¾ç½®æ­£ç¡®çš„æƒé™ï¼š chmod 700 ~/.sshchmod 600 ~/.ssh/authorized_keys æµ‹è¯• SSH è¿æ¥é€€å‡ºè¿œç¨‹æœåŠ¡å™¨ï¼š exit å°è¯•æ— å¯†ç ç™»å½•ï¼š ssh user@remote_host å¦‚æœä¸€åˆ‡é…ç½®æ­£ç¡®ï¼Œä½ åº”è¯¥èƒ½å¤Ÿæ— å¯†ç ç™»å½•åˆ°è¿œç¨‹æœåŠ¡å™¨ã€‚ å¸¸è§é—®é¢˜ æƒé™é—®é¢˜ï¼šç¡®ä¿ .ssh ç›®å½•å’Œ authorized_keys æ–‡ä»¶çš„æƒé™è®¾ç½®æ­£ç¡®ã€‚ å¯†é’¥å¯†ç ï¼šå¦‚æœä½ åœ¨ç”Ÿæˆå¯†é’¥æ—¶è®¾ç½®äº†å¯†ç ï¼Œæ¯æ¬¡ä½¿ç”¨ SSH è¿æ¥æ—¶éƒ½éœ€è¦è¾“å…¥è¯¥å¯†ç ã€‚å¯ä»¥ä½¿ç”¨ ssh-agent æ¥ç®¡ç†å¯†é’¥å¯†ç ï¼š eval $(ssh-agent -s)ssh-add ~/.ssh/id_rsa å®Œ","tags":["hexo","æ­å»ºåšå®¢"],"categories":["æ­å»ºåšå®¢"]},{"title":"å‹é“¾","path":"/2024/09/20/å‹é“¾/","content":"å‹é“¾åˆ›å»ºå¤šä¸ªå‹é“¾ç»„æ•°æ®æ–‡ä»¶åœ¨ D:myblogsource_datalinks ç›®å½•ä¸‹åˆ›å»ºå¤šä¸ª YAML æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶å¯¹åº”ä¸€ä¸ªå‹é“¾ç»„ã€‚ ç¤ºä¾‹æ–‡ä»¶ç»“æ„ myblog/â”œâ”€â”€ source/â”‚ â”œâ”€â”€ _data/â”‚ â”‚ â””â”€â”€ links/â”‚ â”‚ â”œâ”€â”€ ios_developer.ymlâ”‚ â”‚ â”œâ”€â”€ web_developer.ymlâ”‚ â”‚ â””â”€â”€ design.yml ç¤ºä¾‹æ•°æ®æ–‡ä»¶å†…å®¹ios_developer.yml - title: æŸæŸæŸ url: https://example1.com cover: https://example1.com/cover.jpg icon: https://example1.com/icon.png description: è¿™æ˜¯ä¸€ä¸ª iOS å¼€å‘è€…çš„å‹é“¾ã€‚ web_developer.yml - title: æŸæŸæŸ url: https://example2.com cover: https://example2.com/cover.jpg icon: https://example2.com/icon.png description: è¿™æ˜¯ä¸€ä¸ª Web å¼€å‘è€…çš„å‹é“¾ã€‚ design.yml - title: æŸæŸæŸ url: https://example3.com cover: https://example3.com/cover.jpg icon: https://example3.com/icon.png description: è¿™æ˜¯ä¸€ä¸ªè®¾è®¡å¸ˆçš„å‹é“¾ã€‚ åœ¨é¡µé¢ä¸­æ’å…¥ä¸åŒçš„å‹é“¾ç»„åœ¨éœ€è¦æ˜¾ç¤ºä¸åŒå‹é“¾ç»„çš„ä½ç½®ï¼Œä½¿ç”¨ç›¸åº”çš„ Liquid æ ‡ç­¾ã€‚ ç¤ºä¾‹é¡µé¢æ–‡ä»¶å‡è®¾ä½ åœ¨ myblog/source/_posts/2023-10-01-my-post.md æ–‡ä»¶ä¸­æ’å…¥å¤šä¸ªå‹é“¾ç»„ï¼Œç¼–è¾‘åçš„markdownæ–‡ä»¶å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š ---title: å‹é“¾date: 2024-09-20 20:13:20tags: [hexo,æ­å»ºåšå®¢]categories: æ­å»ºåšå®¢---# æ–‡ç« æ ‡é¢˜è¿™æ˜¯æˆ‘çš„æ–‡ç« å†…å®¹ã€‚## iOS å¼€å‘è€…å‹é“¾% friends ios_developer %## Web å¼€å‘è€…å‹é“¾% friends web_developer %## è®¾è®¡å¸ˆå‹é“¾% friends design %## å‹é“¾ç»„% friends ios_developer %## å…¶ä»–å†…å®¹å…¶ä»–æ–‡ç« å†…å®¹ã€‚ æ•ˆæœå±•ç¤ºå¤‡æ³¨ï¼šç”±äºæ¢ä¸»é¢˜ï¼Œä¸èƒ½æ’å…¥å‹é“¾ï¼Œå› æ­¤æš‚æ—¶æ³¨é‡Šæ‰","tags":["hexo","æ­å»ºåšå®¢"],"categories":["æ­å»ºåšå®¢"]},{"title":"åŒæŒ‡é’ˆæ³•åˆå¹¶é¡ºåºè¡¨","path":"/2024/09/20/åŒæŒ‡é’ˆæ³•åˆå¹¶é¡ºåºè¡¨/","content":"åŒæŒ‡é’ˆæ³•åˆå¹¶é¡ºåºè¡¨é¢˜ç›®ï¼šæœ‰2ä¸ªé¡ºåºè¡¨table1å’Œtable2ï¼Œåˆå¹¶æˆä¸€ä¸ªæ–°çš„é¡ºåºè¡¨ è§£æ³•1æ€è·¯ï¼š åŒæŒ‡é’ˆæ–¹æ³• å¤æ‚åº¦ï¼š æ—¶é—´å¤æ‚åº¦ï¼š ç©ºé—´å¤æ‚åº¦ï¼š ä»£ç ï¼š std::vectorint test::solution(std::vectorint table1, std::vectorint table2) std::vectorint result; int slow = 0,fast = 0; while (slowtable1.size()fasttable2.size()) if (table1[slow]table2[fast]) result.push_back(table1[slow]); slow++; else result.push_back(table2[fast]); fast++; while (slowtable1.size()) result.push_back(table1[slow]); slow++; while (fasttable2.size()) result.push_back(table2[fast]); fast++; return result;","tags":["c++","åˆ·é¢˜"],"categories":["C++åˆ·é¢˜ç¬”è®°"]},{"title":"å­—æ¯å¼‚ä½è¯","path":"/2024/09/20/leetcodeåˆ·é¢˜/æ¯æ—¥ä¸€åˆ·day31/","content":"å­—æ¯å¼‚ä½è¯é¢˜ç›®ï¼šç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸²så’Œtï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­ t æ˜¯å¦æ˜¯ s çš„å­—æ¯å¼‚ä½è¯ã€‚ è§£æ³•-å“ˆå¸Œè¡¨æ€è·¯ï¼šæœ¬èƒ½æš´åŠ›å¾ªç¯ï¼Œå­¦ä¹ å“ˆå¸Œè¡¨è§£å†³ 1.2.3. å¤æ‚åº¦ï¼š æ—¶é—´å¤æ‚åº¦ï¼š ç©ºé—´å¤æ‚åº¦ï¼š ä»£ç ï¼š class Solution public: //aee //eae bool isAnagram(string s, string t) int record[26] = 0; //è®¾å®šä¸€ä¸ªè¡¨ï¼Œå¯¹åº”ä½ç½®++ for (int i = 0; i s.size(); i++) record[s[i] - a]++; //ç„¶åå†åœ¨å¯¹åº”ä½ç½®-- for (int i = 0; i t.size(); i++) record[t[i] - a]--; for (int i = 0; i 26; i++) if (record[i] != 0) return false; return true; ;","tags":["c++","å­—æ¯å¼‚ä½è¯"],"categories":["C++åˆ·é¢˜ç¬”è®°"]},{"title":"LinuxåµŒå…¥å¼å­¦ä¹ ç²—ç•¥ç¬”è®°","path":"/2024/09/18/LinuxåµŒå…¥å¼/","content":"ğŸ§ğŸ§ğŸ§ğŸ§ğŸ§ğŸ§ğŸ§ğŸ§ğŸ§ğŸ§ğŸ§ ä¸€äº›ç¼©å†™.elf æ–‡ä»¶ï¼šExecutable and Linkable Formatï¼Œå¯æ‰§è¡Œè¿æ¥æ ¼å¼ç¼–è¯‘(compilation)æŒ‡ä»¤ï¼šgcc -S hello.c -o hello.sæ±‡ç¼–(assembly)æŒ‡ä»¤ï¼šgcc -c hello.s -o hello.oä¿¡å·é‡ï¼šsemaphoremisc:æ–‡ä»¶ä½äºdrivers\\char\\misc.c msicæ„æ€æ˜¯æ‚é¡¹ã€‚å› æ­¤ MISC é©±åŠ¨ä¹Ÿå«åšæ‚é¡¹é©±åŠ¨ï¼Œä¹Ÿå°±æ˜¯å½“æˆ‘ä»¬æ¿å­ä¸Šçš„æŸäº›å¤–è®¾æ— æ³•è¿›è¡Œåˆ†ç±»çš„æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ MISC é©±åŠ¨ã€‚ MISC é©±åŠ¨å…¶å®å°±æ˜¯æœ€ç®€å•çš„å­—ç¬¦è®¾å¤‡é©±åŠ¨ï¼Œé€šå¸¸åµŒå¥—åœ¨ platform æ€»çº¿é©±åŠ¨ä¸­ï¼Œå®ç°å¤æ‚çš„é©±åŠ¨ï¼Œæ‰€æœ‰çš„ MISC è®¾å¤‡é©±åŠ¨çš„ä¸»è®¾å¤‡å·éƒ½ä¸º 10ï¼Œä¸åŒçš„è®¾å¤‡ä½¿ç”¨ä¸åŒçš„ä»è®¾å¤‡å·ã€‚éšç€ Linuxå­—ç¬¦è®¾å¤‡é©±åŠ¨çš„ä¸æ–­å¢åŠ ï¼Œè®¾å¤‡å·å˜å¾—è¶Šæ¥è¶Šç´§å¼ ï¼Œå°¤å…¶æ˜¯ä¸»è®¾å¤‡å·ï¼Œ MISC è®¾å¤‡é©±åŠ¨å°±ç”¨äºè§£å†³æ­¤é—®é¢˜ã€‚ MISC è®¾å¤‡ä¼šè‡ªåŠ¨åˆ›å»º cdevï¼Œä¸éœ€è¦åƒæˆ‘ä»¬ä»¥å‰é‚£æ ·æ‰‹åŠ¨åˆ›å»ºï¼Œå› æ­¤é‡‡ç”¨ MISC è®¾å¤‡é©±åŠ¨å¯ä»¥ç®€åŒ–å­—ç¬¦è®¾å¤‡é©±åŠ¨çš„ç¼–å†™ã€‚IOMUXæ˜¯â€œInputOutput Multiplexer and Unifierâ€çš„ç¼©å†™ï¼Œä¸­æ–‡å¯ä»¥ç¿»è¯‘ä¸ºâ€œè¾“å…¥è¾“å‡ºå¤šè·¯å¤ç”¨å™¨å’Œç»Ÿä¸€å™¨â€ã€‚å®ƒæ˜¯ä¸€ç§ç”µå­è®¾å¤‡æˆ–ç”µè·¯ï¼Œç”¨äºåœ¨å¤šä¸ªä¿¡å·æºå’Œç›®æ ‡ä¹‹é—´è¿›è¡Œé€‰æ‹©å’Œè½¬æ¢ã€‚åœ¨å…·ä½“åº”ç”¨ä¸­ï¼ŒIOMUXé€šå¸¸ç”¨äºå¤„ç†ç”µå­è®¾å¤‡ä¸­çš„ä¿¡å·è¾“å…¥å’Œè¾“å‡ºã€‚å®ƒå¯ä»¥å°†å¤šä¸ªä¿¡å·æºï¼ˆå¦‚ä¸åŒçš„ä¼ æ„Ÿå™¨æˆ–æ•°æ®æºï¼‰ä¸å¤šä¸ªç›®æ ‡ï¼ˆå¦‚ä¸åŒçš„å¤„ç†å™¨æˆ–è¾“å‡ºè®¾å¤‡ï¼‰è¿›è¡Œè¿æ¥å’Œåˆ†é…ï¼Œä»è€Œå®ç°ä¿¡å·çš„å¤ç”¨å’Œè½¬æ¢ã€‚å…³é”®è¯è§£é‡Šï¼š InputOutputï¼ˆè¾“å…¥è¾“å‡ºï¼‰ï¼šæŒ‡è®¾å¤‡æˆ–ç³»ç»Ÿæ¥æ”¶å’Œå‘é€æ•°æ®çš„æ¥å£ã€‚ Multiplexerï¼ˆå¤šè·¯å¤ç”¨å™¨ï¼‰ï¼šä¸€ç§è®¾å¤‡æˆ–æŠ€æœ¯ï¼Œå¯ä»¥å°†å¤šä¸ªä¿¡å·æˆ–æ•°æ®æµåˆå¹¶ä¸ºä¸€ä¸ªä¿¡å·æµè¿›è¡Œä¼ è¾“æˆ–å¤„ç†ã€‚ Unifierï¼ˆç»Ÿä¸€å™¨ï¼‰ï¼šç”¨äºå°†ä¸åŒæ¥æºæˆ–æ ¼å¼çš„æ•°æ®ã€ä¿¡å·ç­‰ç»Ÿä¸€å¤„ç†æˆ–è¾“å‡ºçš„è®¾å¤‡æˆ–æŠ€æœ¯ã€‚IOMUXåœ¨è®¸å¤šç”µå­è®¾å¤‡å’Œç³»ç»Ÿä¸­éƒ½æœ‰åº”ç”¨ï¼Œå¦‚åµŒå…¥å¼ç³»ç»Ÿã€å¾®æ§åˆ¶å™¨ã€FPGAç­‰ï¼Œå®ƒå¯ä»¥å¸®åŠ©æé«˜ç³»ç»Ÿçš„æ•ˆç‡å’Œæ€§èƒ½ï¼ŒåŒæ—¶å‡å°‘ç¡¬ä»¶çš„å¤æ‚æ€§å’Œæˆæœ¬ã€‚ ä¸€äº›Cè¯­æ³•cè¯­è¨€ä¸­å°†intå˜é‡è½¬æ¢ä¸ºvoid *æŒ‡é’ˆæˆ–int *æŒ‡é’ˆåœ¨Cè¯­è¨€ä¸­ï¼Œå°†ä¸€ä¸ªæ•´å‹å˜é‡å¼ºåˆ¶è½¬æ¢ä¸ºvoid *æŒ‡é’ˆç±»å‹é€šå¸¸æ˜¯ä¸ºäº†å°†æ•´æ•°å€¼ä½œä¸ºä¸€ä¸ªé€šç”¨æŒ‡é’ˆä¼ é€’ç»™å‡½æ•°ï¼Œæˆ–è€…åœ¨ç‰¹å®šçš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨è¿™ä¸ªæ•´æ•°çš„å€¼ä½œä¸ºå†…å­˜åœ°å€ã€‚è¿›è¡Œè¿™æ ·çš„è½¬æ¢å¯ä»¥ç”¨ç±»å‹è½¬æ¢è¿ç®—ç¬¦ (void *)ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š int integerValue = 12345;void *pointerValue = (void *)(intptr_t)integerValue; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ•´å‹å˜é‡integerValueçš„å€¼è¢«è½¬æ¢ä¸ºä¸€ä¸ªintptr_tç±»å‹ï¼Œç„¶åå†è½¬æ¢ä¸ºvoid *ç±»å‹ã€‚intptr_tæ˜¯ä¸€ç§æ•´æ•°ç±»å‹ï¼Œå®ƒçš„å¤§å°è¶³å¤Ÿå­˜æ”¾æŒ‡é’ˆï¼Œè¿™ä¿è¯äº†è½¬æ¢è¿‡ç¨‹ä¸­ä¸ä¼šä¸¢å¤±ä¿¡æ¯ã€‚è¿™ç§è½¬æ¢æ–¹æ³•æ˜¯å¯ç§»æ¤æ€§è¾ƒå¥½çš„ï¼Œå› ä¸ºå®ƒè€ƒè™‘åˆ°äº†ä¸åŒå¹³å°ä¸ŠæŒ‡é’ˆå’Œæ•´æ•°å¤§å°å¯èƒ½ä¸ä¸€è‡´çš„æƒ…å†µã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™æ ·çš„è½¬æ¢å¹¶ä¸æ„å‘³ç€æ•´æ•°çœŸçš„å˜æˆäº†ä¸€ä¸ªæœ‰æ•ˆçš„å†…å­˜åœ°å€ã€‚å¦‚æœä½ æ‰“ç®—é€šè¿‡è¿™æ ·çš„æŒ‡é’ˆå»è®¿é—®å†…å­˜ï¼Œå¿…é¡»éå¸¸å°å¿ƒï¼Œç¡®ä¿è¿™ä¸ªæ•´æ•°å€¼ç¡®å®å¯¹åº”äºä¸€ä¸ªåˆæ³•ä¸”å¯è®¿é—®çš„å†…å­˜åœ°å€ï¼Œå¦åˆ™ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºï¼Œæ¯”å¦‚ç¨‹åºå´©æºƒæˆ–è€…æ•°æ®æŸåã€‚åœ¨å¤šçº¿ç¨‹å’Œå¼‚æ­¥ç¼–ç¨‹ä¸­ï¼Œå°†æ•´æ•°ç®€å•åœ°ä½œä¸ºæ•°æ®é€šè¿‡æŒ‡é’ˆä¼ é€’ç»™çº¿ç¨‹å‡½æ•°æ˜¯ä¸€ç§å¸¸è§ä¸”å®‰å…¨çš„ç”¨é€”ã€‚äºæ˜¯æƒ³åˆ°æ˜¯å¦è§£å¼•ç”¨pointerValueçš„å€¼ï¼Œå‘ç°æ˜¯ä¸å¯ä»¥çš„ã€‚ç›®å‰æš‚æ—¶ä¸çŸ¥é“å°†int å˜é‡è½¬æ¢ä¸ºvoidæŒ‡é’ˆçš„ç›®çš„æ˜¯ä»€ä¹ˆ #includestdio.hint main() int integerValue = 12345; int * pointerValue = (int *)integerValue;\t//int * pointerValue = (int *)(long)integerValue; printf(* pointerValue2 = %d,*pointerValue);\treturn 0; è¿™ä¸€éƒ¨åˆ†é—®é¢˜åœ¨äºï¼š å°†ä¸€ä¸ªæ•´æ•°ç›´æ¥è½¬æ¢ä¸ºæŒ‡é’ˆå¹¶è§£å¼•ç”¨è¯¥æŒ‡é’ˆï¼Œè¿™é€šå¸¸ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºï¼ˆundefined behaviorï¼‰ã€‚å› ä¸ºåœ¨ç°ä»£æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿™æ ·çš„æŒ‡é’ˆå‡ ä¹ä¸å¯èƒ½æŒ‡å‘åˆæ³•çš„å†…å­˜ä½ç½®ï¼Œå› æ­¤è§£å¼•ç”¨å®ƒçš„ç»“æœæ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç¨‹åºå´©æºƒã€æ•°æ®æŸåæˆ–å®‰å…¨æ¼æ´ã€‚æ­£ç¡®çš„åšæ³•æ˜¯ç¡®ä¿æŒ‡é’ˆæ€»æ˜¯æŒ‡å‘æœ‰æ•ˆçš„ã€å·²åˆ†é…çš„å†…å­˜ä½ç½®ã€‚å¯¹äºæµ‹è¯•çš„ç›®çš„ï¼Œæˆ‘ä»¬åº”è¯¥æ„é€ ä¸€ä¸ªå®‰å…¨çš„ç¯å¢ƒæ¥æ¨¡æ‹Ÿå’ŒéªŒè¯é€»è¾‘ï¼Œè€Œä¸æ˜¯ç›´æ¥æ‰§è¡Œå¯èƒ½å¯¼è‡´æœªå®šä¹‰è¡Œä¸ºçš„æ“ä½œã€‚ ä¸€äº›æœ‰ç”¨çš„å‘½ä»¤æŸ¥çœ‹å·¥å…·é“¾ä¸­å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶çš„è·¯å¾„echo main(){}| arm-linux-gnueabihf-gcc -E -v -æœç´¢æŸä¸€ä¸ªå­—ç¬¦grep prefix * -nwr MakefileMakefileçš„å¼•å…¥åŠè§„åˆ™ä½¿ç”¨keil, mdk,avrç­‰å·¥å…·å¼€å‘ç¨‹åºæ—¶ç‚¹å‡»é¼ æ ‡å°±å¯ä»¥ç¼–è¯‘äº†ï¼Œå®ƒçš„å†…éƒ¨æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæ€ä¹ˆç»„ç»‡ç®¡ç†ç¨‹åºï¼Ÿæ€ä¹ˆå†³å®šç¼–è¯‘å“ªä¸€ä¸ªæ–‡ä»¶ï¼Ÿ ç­”ï¼šå®é™…ä¸Šwindowså·¥å…·ç®¡ç†ç¨‹åºçš„å†…éƒ¨æœºåˆ¶ï¼Œä¹Ÿæ˜¯Makefileï¼Œæˆ‘ä»¬åœ¨linuxä¸‹æ¥å¼€å‘è£¸æ¿ç¨‹åºçš„æ—¶å€™ï¼Œä½¿ç”¨Makefileç»„ç»‡ç®¡ç†è¿™äº›ç¨‹åºï¼Œæœ¬èŠ‚æˆ‘ä»¬æ¥è®²è§£Makefileæœ€åŸºæœ¬çš„è§„åˆ™ã€‚Makefileè¦åšä»€ä¹ˆäº‹æƒ…å‘¢ï¼Ÿç»„ç»‡ç®¡ç†ç¨‹åºï¼Œç»„ç»‡ç®¡ç†æ–‡ä»¶ï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªç¨‹åºæ¥å®éªŒä¸€ä¸‹ï¼š æ–‡ä»¶a.c 02\t#include stdio.h0304\tint main()05\t06\tfunc_b();07\treturn 0;08 æ–‡ä»¶b.c 2\t#include stdio.h34\tvoid func_b()5\t6 printf(This is B );7 ç¼–è¯‘ï¼š gcc -o test a.c b.c è¿è¡Œï¼š ./test ç»“æœï¼š This is B gcc -o test a.c b.c è¿™æ¡å‘½ä»¤è™½ç„¶ç®€å•ï¼Œä½†æ˜¯å®ƒå®Œæˆçš„åŠŸèƒ½ä¸ç®€å•ã€‚ æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒåšäº†å“ªäº›äº‹æƒ…ï¼Œ æˆ‘ä»¬çŸ¥é“.cç¨‹åº ã€‹ å¾—åˆ°å¯æ‰§è¡Œç¨‹åºå®ƒä»¬ä¹‹é—´è¦ç»è¿‡å››ä¸ªæ­¥éª¤ï¼š 1.é¢„å¤„ç† 2.ç¼–è¯‘ 3.æ±‡ç¼– 4.é“¾æ¥ æˆ‘ä»¬ç»å¸¸æŠŠå‰ä¸‰ä¸ªæ­¥éª¤ç»Ÿç§°ä¸ºç¼–è¯‘äº†ã€‚æˆ‘ä»¬å…·ä½“åˆ†æï¼šgcc -o test a.c b.cè¿™æ¡å‘½ä»¤å®ƒä»¬è¦ç»è¿‡ä¸‹é¢å‡ ä¸ªæ­¥éª¤ï¼š 1ï¼‰å¯¹äºa.cï¼šæ‰§è¡Œï¼šé¢„å¤„ç† ç¼–è¯‘ æ±‡ç¼– çš„è¿‡ç¨‹ï¼Œa.c xxx.s xxx.o æ–‡ä»¶ã€‚ 2ï¼‰å¯¹äºb.cï¼šæ‰§è¡Œï¼šé¢„å¤„ç† ç¼–è¯‘ æ±‡ç¼– çš„è¿‡ç¨‹ï¼Œb.c yyy.s yyy.o æ–‡ä»¶ã€‚ 3ï¼‰æœ€åï¼šxxx.oå’Œyyy.oé“¾æ¥åœ¨ä¸€èµ·å¾—åˆ°ä¸€ä¸ªteståº”ç”¨ç¨‹åºã€‚ æç¤ºï¼šgcc -o test a.c b.c -v ï¼šåŠ ä¸Šä¸€ä¸ª**â€˜-vâ€™**é€‰é¡¹å¯ä»¥çœ‹åˆ°å®ƒä»¬çš„å¤„ç†è¿‡ç¨‹ï¼Œ ç¬¬ä¸€æ¬¡ç¼–è¯‘ a.c å¾—åˆ° xxx.o æ–‡ä»¶ï¼Œè¿™æ˜¯å¾ˆåˆä¹æƒ…ç†çš„ï¼Œ æ‰§è¡Œå®Œç¬¬ä¸€æ¬¡ä¹‹åï¼Œå¦‚æœä¿®æ”¹ a.c åˆå†æ¬¡æ‰§è¡Œï¼šgcc -o test a.c b.cï¼Œå¯¹äº a.c åº”è¯¥é‡æ–°ç”Ÿæˆ xxx.oï¼Œä½†æ˜¯å¯¹äº b.c åˆä¼šé‡æ–°ç¼–è¯‘ä¸€æ¬¡ï¼Œè¿™å®Œå…¨æ²¡æœ‰å¿…è¦ï¼Œb.c æ ¹æœ¬æ²¡æœ‰ä¿®æ”¹ï¼Œç›´æ¥ä½¿ç”¨ç¬¬ä¸€æ¬¡ç”Ÿæˆçš„ yyy.o æ–‡ä»¶å°±å¯ä»¥äº†ã€‚ ç¼ºç‚¹ï¼šå¯¹æ‰€æœ‰çš„æ–‡ä»¶éƒ½ä¼šå†å¤„ç†ä¸€æ¬¡ï¼Œå³ä½¿ b.c æ²¡æœ‰ç»è¿‡ä¿®æ”¹ï¼Œb.c ä¹Ÿä¼šé‡æ–°ç¼–è¯‘ä¸€æ¬¡ï¼Œå½“æ–‡ä»¶æ¯”è¾ƒå°‘æ—¶ï¼Œè¿™æ²¡æœ‰æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå½“æ–‡ä»¶éå¸¸å¤šçš„æ—¶å€™ï¼Œå°±ä¼šå¸¦æ¥éå¸¸å¤šçš„æ•ˆç‡é—®é¢˜å¦‚æœæ–‡ä»¶éå¸¸å¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬ï¼Œåªæ˜¯ä¿®æ”¹äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰€ç”¨çš„æ–‡ä»¶å°±ä¼šé‡æ–°å¤„ç†ä¸€æ¬¡ï¼Œç¼–è¯‘çš„æ—¶å€™å°±ä¼šç­‰å¾…å¾ˆé•¿æ—¶é—´ã€‚ å¯¹äºè¿™äº›æºæ–‡ä»¶ï¼Œæˆ‘ä»¬åº”è¯¥åˆ†åˆ«å¤„ç†ï¼Œæ‰§è¡Œï¼šé¢„å¤„ç† ç¼–è¯‘ æ±‡ç¼–ï¼Œå…ˆåˆ†åˆ«ç¼–è¯‘å®ƒä»¬ï¼Œæœ€åå†æŠŠå®ƒä»¬é“¾æ¥åœ¨ä¸€æ¬¡ï¼Œæ¯”å¦‚ï¼š ç¼–è¯‘ï¼š gcc -o a.o a.cgcc -o b.o b.c é“¾æ¥ï¼š gcc -o test a.o b.o æ¯”å¦‚ï¼šä¸Šé¢çš„ä¾‹å­ï¼Œå½“æˆ‘ä»¬ä¿®æ”¹a.cä¹‹å,a.cä¼šé‡ç°ç¼–è¯‘ç„¶åå†æŠŠå®ƒä»¬é“¾æ¥åœ¨ä¸€èµ·å°±å¯ä»¥äº†ã€‚b.cå°±ä¸éœ€è¦é‡æ–°ç¼–è¯‘ã€‚ é‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼Œæ€ä¹ˆçŸ¥é“å“ªäº›æ–‡ä»¶è¢«æ›´æ–°äº†è¢«ä¿®æ”¹äº†ï¼Ÿ æ¯”è¾ƒæ—¶é—´ï¼šæ¯”è¾ƒ a.o å’Œ a.c çš„æ—¶é—´ï¼Œå¦‚æœa.cçš„æ—¶é—´æ¯” a.o çš„æ—¶é—´æ›´åŠ æ–°çš„è¯ï¼Œå°±è¡¨æ˜ a.c è¢«ä¿®æ”¹äº†ï¼ŒåŒç†b.oå’Œb.cä¹Ÿä¼šè¿›è¡ŒåŒæ ·çš„æ¯”è¾ƒã€‚æ¯”è¾ƒtestå’Œ a.o,b.o çš„æ—¶é—´ï¼Œå¦‚æœa.oæˆ–è€…b.oçš„æ—¶é—´æ¯”testæ›´åŠ æ–°çš„è¯ï¼Œå°±è¡¨æ˜åº”è¯¥é‡æ–°ç”Ÿæˆtestã€‚Makefileå°±æ˜¯è¿™æ ·åšçš„ã€‚æˆ‘ä»¬ç°åœ¨æ¥å†™å‡ºä¸€ä¸ªç®€å•çš„Makefile: makefieæœ€åŸºæœ¬çš„è¯­æ³•æ˜¯è§„åˆ™ï¼Œè§„åˆ™ï¼š ç›®æ ‡ : ä¾èµ–1 ä¾èµ–2 ...[TAB]å‘½ä»¤ å½“â€œä¾èµ–â€æ¯”â€œç›®æ ‡â€æ–°ï¼Œæ‰§è¡Œå®ƒä»¬ä¸‹é¢çš„å‘½ä»¤ã€‚æˆ‘ä»¬è¦æŠŠä¸Šé¢ä¸‰ä¸ªå‘½ä»¤å†™æˆmakefileè§„åˆ™ï¼Œå¦‚ä¸‹ï¼š test ï¼ša.o b.o //testæ˜¯ç›®æ ‡ï¼Œå®ƒä¾èµ–äºa.o b.oæ–‡ä»¶ï¼Œä¸€æ—¦a.oæˆ–è€…b.oæ¯”testæ–°çš„æ—¶å€™ï¼Œå°±éœ€è¦æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œé‡æ–°ç”Ÿæˆtestå¯æ‰§è¡Œç¨‹åºã€‚gcc -o test a.o b.oa.o : a.c //a.oä¾èµ–äºa.cï¼Œå½“a.cæ›´åŠ æ–°çš„è¯ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥ç”Ÿæˆa.ogcc -c -o a.o a.cb.o : b.c //b.oä¾èµ–äºb.c,å½“b.cæ›´åŠ æ–°çš„è¯ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œæ¥ç”Ÿæˆb.ogcc -c -o b.o b.c æˆ‘ä»¬æ¥ä½œä¸€ä¸‹å®éªŒï¼š åœ¨æ”¹ç›®å½•ä¸‹æˆ‘ä»¬å†™ä¸€ä¸ªMakefileæ–‡ä»¶ï¼š æ–‡ä»¶ï¼šMakefile 1\ttest:a.o b.o2 gcc -o test a.o b.o3\t4\ta.o : a.c5 gcc -c -o a.o a.c7\tb.o : b.c8 gcc -c -o b.o b.c ä¸Šé¢æ˜¯makefileä¸­çš„ä¸‰æ¡è§„åˆ™ã€‚makefile,å°±æ˜¯åå­—ä¸ºâ€œmakefileâ€çš„æ–‡ä»¶ã€‚å½“æˆ‘ä»¬æƒ³ç¼–è¯‘ç¨‹åºæ—¶ï¼Œç›´æ¥æ‰§è¡Œmakeå‘½ä»¤å°±å¯ä»¥äº†ï¼Œä¸€æ‰§è¡Œmakeå‘½ä»¤å®ƒæƒ³ç”Ÿæˆç¬¬ä¸€ä¸ªç›®æ ‡testå¯æ‰§è¡Œç¨‹åº,å¦‚æœå‘ç°a.o æˆ–è€…b.oæ²¡æœ‰ï¼Œå°±è¦å…ˆç”Ÿæˆa.oæˆ–è€…b.oï¼Œå‘ç°a.oä¾èµ–a.cï¼Œæœ‰a.cä½†æ˜¯æ²¡æœ‰a.o,ä»–å°±ä¼šè®¤ä¸ºa.cæ¯”a.oæ–°ï¼Œå°±ä¼šæ‰§è¡Œå®ƒä»¬ä¸‹é¢çš„å‘½ä»¤æ¥ç”Ÿæˆa.oï¼ŒåŒç†b.oå’Œb.cçš„å¤„ç†å…³ç³»ä¹Ÿæ˜¯è¿™æ ·çš„ã€‚ å¦‚æœä¿®æ”¹a.c ï¼Œæˆ‘ä»¬å†æ¬¡æ‰§è¡Œmakeï¼Œå®ƒçš„æœ¬æ„æ˜¯æƒ³ç”Ÿæˆç¬¬ä¸€ä¸ªç›®æ ‡teståº”ç”¨ç¨‹åº,å®ƒéœ€è¦å…ˆç”Ÿæˆa.o,å‘ç°a.oä¾èµ–a.c(æ‰§è¡Œæˆ‘ä»¬ä¿®æ”¹äº†a.c)å‘ç°a.cæ¯”a.oæ›´åŠ æ–°ï¼Œå°±ä¼šæ‰§è¡Œgcc -c -o a.oa.cå‘½ä»¤æ¥ç”Ÿæˆa.oæ–‡ä»¶ã€‚b.oä¾èµ–b.cï¼Œå‘ç°b.cå¹¶æ²¡æœ‰ä¿®æ”¹ï¼Œå°±ä¸ä¼šæ‰§è¡Œgcc -c -o b.ob.cæ¥é‡æ–°ç”Ÿæˆb.oæ–‡ä»¶ã€‚ç°åœ¨a.o b.oéƒ½æœ‰äº†ï¼Œå…¶ä¸­çš„a.oæ¯”testæ›´åŠ æ–°ï¼Œå°±ä¼šæ‰§è¡Œ gcc -otest a.ob.oæ¥é‡æ–°é“¾æ¥å¾—åˆ°testå¯æ‰§è¡Œç¨‹åºã€‚æ‰€ä»¥å½“æ‰§è¡Œmakeå‘½ä»¤æ—¶å€™å°±ä¼šæ‰§è¡Œä¸‹é¢ä¸¤æ¡æ‰§è¡Œï¼š gcc -c -o a.o a.cgcc -o test a.o b.o æˆ‘ä»¬ç¬¬ä¸€æ¬¡æ‰§è¡Œmakeçš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œä¸‹é¢ä¸‰æ¡å‘½ä»¤(ä¸‰æ¡å‘½ä»¤éƒ½æ‰§è¡Œ)ï¼š gcc -c -o a.o a.cgcc -c -o b.o b.cgcc -o test a.o b.o å†æ¬¡æ‰§è¡Œmake å°±ä¼šæ˜¾ç¤ºä¸‹é¢çš„æç¤ºï¼š make: `test is up to date. æˆ‘ä»¬å†æ¬¡æ‰§è¡Œmakeå°±ä¼šåˆ¤æ–­Makefileæ–‡ä»¶ä¸­çš„ä¾èµ–ï¼Œå‘ç°ä¾èµ–æ²¡æœ‰æ›´æ–°ï¼Œæ‰€ä»¥ç›®æ ‡æ–‡ä»¶å°±ä¸ä¼šé‡ç°ç”Ÿæˆï¼Œå°±ä¼šæœ‰ä¸Šé¢çš„æç¤ºã€‚å½“æˆ‘ä»¬ä¿®æ”¹a.cåï¼Œé‡æ–°æ‰§è¡Œmake, å°±ä¼šæ‰§è¡Œä¸‹é¢ä¸¤æ¡æŒ‡ä»¤ï¼š gcc -c -o a.o a.cgcc -o test a.o b.o æˆ‘ä»¬åŒæ—¶ä¿®æ”¹a.c b.cï¼Œæ‰§è¡Œmakeå°±ä¼šæ‰§è¡Œä¸‹é¢ä¸‰æ¡æŒ‡ä»¤ã€‚ gcc -c -o a.o a.cgcc -c -o b.o b.cgcc -o test a.o b.o a.cæ–‡ä»¶ä¿®æ”¹äº†ï¼Œé‡æ–°ç¼–è¯‘ç”Ÿæˆa.o, b.cä¿®æ”¹äº†é‡æ–°ç¼–è¯‘ç”Ÿæˆb.oï¼Œa.o,b.oéƒ½æ›´æ–°äº†é‡æ–°é“¾æ¥ç”Ÿæˆtestå¯æ‰§è¡Œç¨‹åºï¼Œmakefileçš„è§„åˆ™å…¶å®è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚è§„åˆ™æ˜¯Makefieçš„æ ¸å¿ƒï¼Œ æ‰§è¡Œmakeå‘½ä»¤çš„æ—¶å€™ï¼Œå°±ä¼šåœ¨å½“å‰ç›®å½•ä¸‹é¢æ‰¾åˆ°åå­—ä¸ºï¼šMakefileçš„æ–‡ä»¶ï¼Œæ ¹æ®é‡Œé¢çš„å†…å®¹æ¥æ‰§è¡Œé‡Œé¢çš„åˆ¤æ–­å‘½ä»¤ã€‚ shell pwd å’ŒPWDçš„åŒºåˆ«pwd:æ˜¯ä¸€æ¡å‘½ä»¤ï¼Œå¯ä»¥åœ¨makefileæ–‡ä»¶ä¸­å¼•ç”¨(shel pwd)æ¥è·å–å½“å‰ç›®å½•PWD:æ˜¯ä¸€ä¸ªå˜é‡ï¼Œå¯ä»¥ç›´æ¥echo $PWDæ¥è·å–å½“å‰ç›®å½•ç»è¿‡æµ‹è¯•echo pwdå’Œecho $PWDç»“æœæ˜¯ä¸€æ ·çš„ï¼Œæ¨æµ‹å¯ä»¥åœ¨makefileæ–‡ä»¶ä¸­æ›¿æ¢ä½¿ç”¨pwd $PWD $(shell pwd)ä¸€ä¸ªshell pwdçš„ä¾‹å­ï¼Œè¿™æ ·çš„ä¾‹å­å¾ˆå¸¸è§ INCDIR := $(shell pwd) //å°†shell pwdä½œä¸ºå˜é‡ï¼Œé€šè¿‡ $(shell pwd)å½¢å¼å¼•ç”¨è¿™ä¸ªå˜é‡// Cé¢„å¤„ç†å™¨çš„flagï¼Œflagå°±æ˜¯ç¼–è¯‘å™¨å¯é€‰çš„é€‰é¡¹CPPFLAGS := -nostdlib -nostdinc -I$(INCDIR)/include //-nostdlibè¡¨ç¤ºä¸ä½¿ç”¨æ ‡å‡†åº“ //-nostdincè¡¨ç¤ºä¸ä½¿ç”¨æ ‡å‡†å¤´æ–‡ä»¶//-Iæ˜¯ç”¨æ¥æŒ‡å®šç›¸å¯¹è·¯å¾„çš„ï¼Œè¿™é‡Œè¡¨ç¤ºæˆ‘ä»¬éœ€è¦é¢„å¤„ç†çš„æ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„æ˜¯ç›¸å¯¹è·¯å¾„ä¸‹çš„includeæ–‡ä»¶å¤¹ æ–‡ä»¶IOæ ‡å‡†ioå’Œç³»ç»Ÿioçš„åŒºåˆ«åœ¨äºæ ‡å‡†ioå¼•å…¥äº†ä¸€ä¸ªç”¨æˆ·bufferï¼Œç³»ç»Ÿioæ²¡æœ‰ã€‚ ç³»ç»Ÿioæ–‡ä»¶å¥æŸ„ï¼šfd 0 1 2 3æ–‡ä»¶å¥æŸ„å¦‚ä½•å’Œå…·ä½“æ–‡ä»¶æŒ‚é’©ï¼Ÿ 0 - devpts0 ä»£è¡¨æ ‡å‡†è¾“å…¥ 1 - devpts0 ä»£è¡¨æ ‡å‡†è¾“å‡º 2 - devpts0 ä»£è¡¨æ ‡å‡†é”™è¯¯ 3 - homebook01_all_series_quickstart04_åµŒå…¥å¼Linuxåº”ç”¨å¼€å‘åŸºç¡€çŸ¥è¯†source06_fileio01_open1.txt ä»£è¡¨è‡ªå·±æ‰“å¼€çš„æ–‡ä»¶ open å‡½æ•°errno: é”™è¯¯ç ï¼Œå¯ä»¥é…åˆstrerror(errno)æ¥æ‰“å°é”™è¯¯ä¿¡æ¯ï¼Œæ•ˆæœåŒperrorperror(â€œopen errorâ€)ç”¨æ¥æ‰“å°é”™è¯¯ä¿¡æ¯ O_RDONLY: ä»¥åªè¯»æ–¹å¼æ‰“å¼€æ–‡ä»¶ã€‚O_WRONLY: ä»¥åªå†™æ–¹å¼æ‰“å¼€æ–‡ä»¶ã€‚O_RDWR: ä»¥è¯»å†™æ–¹å¼æ‰“å¼€æ–‡ä»¶ã€‚O_CREAT: å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¹‹ã€‚ä»¥é»˜è®¤æƒé™åˆ›å»ºï¼Œæœ€ç»ˆçš„æƒé™ç”±modeå’Œumaskå†³å®šã€‚O_EXCL: å½“ä¸O_CREATä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå¦‚æœæ–‡ä»¶å·²å­˜åœ¨åˆ™æ‰“å¼€å¤±è´¥ã€‚O_TRUNC: æ‰“å¼€æ–‡ä»¶åå°†å…¶é•¿åº¦æˆªæ–­ä¸º0ã€‚O_APPEND: å†™å…¥æ—¶ï¼Œæ•°æ®å°†è¢«è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ã€‚ int open(const char *pathname, int flags); 1)ä½¿ç”¨openåˆ›å»ºä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶ fd =open(argv[1],O_CREAT|O_RDWR)ssize_t write(int fd, const void *buf, size_t count);ssize_t read(int fd, void *buf, size_t count); äº¤å‰ç¼–è¯‘ freetype1.ç¼–è¯‘ç¨‹åºæ—¶å»å“ªæ‰¾å¤´æ–‡ä»¶ 1ï¼‰ç³»ç»Ÿç›®å½•ï¼šäº¤å‰ç¼–è¯‘å·¥å…·é“¾çš„æŸä¸ªinclude ç›®å½• 2ï¼‰è‡ªè¡ŒæŒ‡å®šï¼šä½¿ç”¨ -I dir æ¥æŒ‡å®š2.é“¾æ¥æ—¶å»å“ªæ‰¾åº“æ–‡ä»¶ 1ï¼‰ç³»ç»Ÿç›®å½•ï¼šäº¤å‰ç¼–è¯‘å·¥å…·é“¾çš„æŸä¸ªlib ç›®å½• 2ï¼‰è‡ªè¡ŒæŒ‡å®šï¼šä½¿ç”¨ -L dir æ¥æŒ‡å®š3.è¿è¡Œæ—¶å»å“ªæ‰¾åº“æ–‡ä»¶ 1ï¼‰ç³»ç»Ÿç›®å½•ï¼šæ¿å­ä¸Šçš„lib usrlib ç›®å½• 2ï¼‰è‡ªè¡ŒæŒ‡å®šï¼šä½¿ç”¨ LD_LIBRARY_PATH æ¥æŒ‡å®š4.è¿è¡Œæ—¶ä¸éœ€è¦å¤´æ–‡ä»¶ homebook100ask_imx6ull-sdkToolChainarm-buildroot-linux-gnueabihf_sdk-buildrootarm-buildroot-linux-gnueabihfsysrootusrinclude LIBRARY_PATHhomebook100ask_imx6ull-sdkToolChainarm-buildroot-linux-gnueabihf_sdk-buildrootarm-buildroot-linux-gnueabihfsysrootusrlib è¾“å…¥è®¾å¤‡å†…æ ¸ä¸­ä½¿ç”¨input_devç»“æ„ä½“æ¥æè¿°ä¸€ä¸ªè¾“å…¥è®¾å¤‡ã€‚ //D:\\Linux-4.9.88\\include\\linux\\input.hstruct input_dev const char *name;\tconst char *phys;\tconst char *uniq;\tstruct input_id id;\tunsigned long propbit[BITS_TO_LONGS(INPUT_PROP_CNT)];\tunsigned long evbit[BITS_TO_LONGS(EV_CNT)];\tunsigned long keybit[BITS_TO_LONGS(KEY_CNT)];\tunsigned long relbit[BITS_TO_LONGS(REL_CNT)];\tunsigned long absbit[BITS_TO_LONGS(ABS_CNT)];\tunsigned long mscbit[BITS_TO_LONGS(MSC_CNT)];\tunsigned long ledbit[BITS_TO_LONGS(LED_CNT)];\tunsigned long sndbit[BITS_TO_LONGS(SND_CNT)];\tunsigned long ffbit[BITS_TO_LONGS(FF_CNT)];\tunsigned long swbit[BITS_TO_LONGS(SW_CNT)];\tunsigned int hint_events_per_packet;\tunsigned int keycodemax;\tunsigned int keycodesize;\tvoid *keycode;\tint (*setkeycode)(struct input_dev *dev, const struct input_keymap_entry *ke, unsigned int *old_keycode);\tint (*getkeycode)(struct input_dev *dev, struct input_keymap_entry *ke);\tstruct ff_device *ff;\tunsigned int repeat_key;\tstruct timer_list timer;\tint rep[REP_CNT];\tstruct input_mt *mt;\tstruct input_absinfo *absinfo;\tunsigned long key[BITS_TO_LONGS(KEY_CNT)];\tunsigned long led[BITS_TO_LONGS(LED_CNT)];\tunsigned long snd[BITS_TO_LONGS(SND_CNT)];\tunsigned long sw[BITS_TO_LONGS(SW_CNT)];\tint (*open)(struct input_dev *dev);\tvoid (*close)(struct input_dev *dev);\tint (*flush)(struct input_dev *dev, struct file *file);\tint (*event)(struct input_dev *dev, unsigned int type, unsigned int code, int value);\tstruct input_handle __rcu *grab;\tspinlock_t event_lock;\tstruct mutex mutex;\tunsigned int users;\tbool going_away;\tstruct device dev;\tstruct list_head\th_list;\tstruct list_head\tnode;\tunsigned int num_vals;\tunsigned int max_vals;\tstruct input_value *vals;\tbool devres_managed;;è®¾å¤‡IDç»“æ„ä½“ä¸º```C struct input_id __u16 bustype;\t__u16 vendor;\t__u16 product;\t__u16 version;;__u16 bustype;//æšä¸¾ç±»å‹ï¼Œå¦‚usb,pciç­‰ç­‰å–å€¼ä¸ºï¼š#define BUS_PCI 0x01#define BUS_ISAPNP 0x02#define BUS_USB 0x03#define BUS_HIL 0x04#define BUS_BLUETOOTH 0x05#define BUS_VIRTUAL 0x06#define BUS_ISA 0x10#define BUS_I8042 0x11#define BUS_XTKBD 0x12#define BUS_RS232 0x13#define BUS_GAMEPORT 0x14#define BUS_PARPORT 0x15#define BUS_AMIGA 0x16#define BUS_ADB 0x17#define BUS_I2C 0x18#define BUS_HOST 0x19#define BUS_GSC 0x1A#define BUS_ATARI 0x1B#define BUS_SPI 0x1C#define BUS_RMI 0x1D#define BUS_CEC 0x1E#define BUS_INTEL_ISHTP 0x1F__u16 vendor;__u16 product;__u16 version;å‚å•†å·ï¼Œäº§å“å·ï¼Œç‰ˆæœ¬å· å†…æ ¸ä½¿ç”¨input_eventç»“æ„ä½“æ¥æè¿°â€œè¾“å…¥äº‹ä»¶â€ //include\\uapi\\linux\\input.hstruct input_event struct timeval time;\t__u16 type;\t__u16 code;\t__s32 value;;struct timeval\tlong tv_sec;\tlong tv_usec;;struct timeval time;è®°å½•äº†input_eventæ—¶é—´å‘ç”Ÿçš„æ—¶é—´ï¼Œè¿™ä¸ªåŒ…æ‹¬ç§’å’Œå¾®ç§’ï¼Œæ—¶é—´èµ·ç‚¹æ˜¯ç³»ç»Ÿå¯åŠ¨çš„æ—¶åˆ»ã€‚__u16 type;è®°å½•äº†å“ªä¸€ç±»äº‹ä»¶åœ¨include\\uapi\\linux\\input-event-codes.hä¸­ï¼Œè¯¦ç»†å®šä¹‰äº†äº‹ä»¶ç±»å‹ /* * Event types */#define EV_SYN 0x00//è¡¨ç¤ºè®¾å¤‡æ”¯æŒæ‰€æœ‰çš„äº‹ä»¶?#define EV_KEY 0x01//é”®ç›˜æˆ–è€…æŒ‰é”®#define EV_REL 0x02//relative,é¼ æ ‡æˆ–è€…ç›¸å¯¹åæ ‡ä½ç½®#define EV_ABS 0x03//absoluteï¼Œæ‰‹å†™æ¿çš„å€¼ï¼Œç»å¯¹æ•´æ•°å€¼#define EV_MSC 0x04//å…¶ä»–ç±»å‹äº‹ä»¶#define EV_SW 0x05#define EV_LED 0x11//LEDè®¾å¤‡äº‹ä»¶#define EV_SND 0x12//èœ‚é¸£å™¨äº‹ä»¶#define EV_REP 0x14//é‡å¤æŒ‰é”®ç±»å‹äº‹ä»¶#define EV_FF 0x15#define EV_PWR 0x16//ç”µæºç®¡ç†äº‹ä»¶#define EV_FF_STATUS 0x17#define EV_MAX 0x1f#define EV_CNT (EV_MAX+1)__u16 code;è®°å½•äº†å“ªä¸€ä¸ªäº‹ä»¶code æ ¹æ®typeçš„ä¸åŒè€Œæœ‰ä¸åŒçš„å«ä¹‰ä¾‹å¦‚ï¼štype = EV_KEY//æŒ‰é”®äº‹ä»¶ï¼Œcodeè¡¨ç¤ºé”®ç›˜codeæˆ–é¼ æ ‡buttonå€¼#define REL_X 0x00#define REL_Y 0x01#define REL_Z 0x02#define REL_RX 0x03#define REL_RY 0x04#define REL_RZ 0x05#define ...#define KEY_MAX 0x2ff#define KEY_CNT (KEY_MAX+1)ä¾‹å¦‚ï¼š\ttype = EV_RELæ—¶ï¼Œcodeè¡¨ç¤ºæ“ä½œçš„æ˜¯å“ªä¸ªåæ ‡è½´ï¼Œå¦‚REL_X,REL_Y /* * Relative axes */#define REL_X 0x00#define REL_Y 0x01#define REL_Z 0x02#define REL_RX 0x03#define REL_RY 0x04#define REL_RZ 0x05#define REL_HWHEEL 0x06#define REL_DIAL 0x07#define REL_WHEEL 0x08#define REL_MISC 0x09#define REL_MAX 0x0f#define REL_CNT (REL_MAX+1)ä¾‹å¦‚ï¼štype = EV_ABSæ—¶ï¼Œcodeè¡¨ç¤ºç»å¯¹åæ ‡è½´çš„å€¼ /* * Absolute axes */#define ABS_X 0x00#define ABS_Y 0x01#define ABS_Z 0x02#define ABS_RX 0x03#define ABS_RY 0x04#define ABS_RZ 0x05#define ...//è¡¨ç¤ºæ­£åœ¨ä¿®æ”¹çš„å¤šç‚¹è§¦æ§æ§½ä½ï¼Œç”¨äºè·Ÿè¸ªå¤šä¸ªæ¥è§¦ç‚¹ã€‚#define ABS_MT_SLOT 0x2f\t/* MT slot being modified *///è§¦æ‘¸æ¤­åœ†çš„ä¸»è¦è½´é•¿ï¼Œè¡¨ç¤ºæ¥è§¦åŒºåŸŸçš„æœ€å¤§å°ºå¯¸ã€‚#define ABS_MT_TOUCH_MAJOR\t0x30\t/* Major axis of touching ellipse *///è§¦æ‘¸æ¤­åœ†çš„æ¬¡è¦è½´é•¿ï¼Œå¦‚æœæ¥è§¦åŒºåŸŸæ˜¯åœ†å½¢ï¼Œåˆ™å¿½ç•¥æ­¤å€¼#define ABS_MT_TOUCH_MINOR\t0x31\t/* Minor axis (omit if circular) *///æ¥è¿‘æ¤­åœ†çš„ä¸»è¦è½´é•¿ï¼Œå¯èƒ½æ¯”å®é™…æ¥è§¦åŒºåŸŸæ›´å¤§ã€‚#define ABS_MT_WIDTH_MAJOR\t0x32\t/* Major axis of approaching ellipse *///æ¥è¿‘æ¤­åœ†çš„æ¬¡è¦è½´é•¿ï¼Œå¦‚æœæ¥è¿‘åŒºåŸŸæ˜¯åœ†å½¢ï¼Œåˆ™å¿½ç•¥æ­¤å€¼#define ABS_MT_WIDTH_MINOR\t0x33\t/* Minor axis (omit if circular) *///æ¤­åœ†çš„æ–¹å‘ï¼Œç”¨äºæè¿°æ¥è§¦ç‚¹çš„å€¾æ–œè§’åº¦ã€‚#define ABS_MT_ORIENTATION\t0x34\t/* Ellipse orientation */// è§¦æ‘¸ä¸­å¿ƒçš„Xåæ ‡ä½ç½®ã€‚#define ABS_MT_POSITION_X\t0x35\t/* Center X touch position */#define ABS_MT_POSITION_Y\t0x36\t/* Center Y touch position *///è§¦æ‘¸è®¾å¤‡çš„ç±»å‹ï¼Œå¦‚æ‰‹æŒ‡ã€ç¬”ç­‰ã€‚#define ABS_MT_TOOL_TYPE\t0x37\t/* Type of touching device *///å°†ä¸€ç»„æ•°æ®åŒ…åˆ†ç»„ä¸ºä¸€ä¸ªâ€œblobâ€ï¼ˆæ•°æ®å—ï¼‰ï¼Œç”¨äºå…³è”ç›¸å…³çš„è§¦æ‘¸äº‹ä»¶ã€‚#define ABS_MT_BLOB_ID 0x38\t/* Group a set of packets as a blob *///è·Ÿè¸ªæ¥è§¦çš„å”¯ä¸€IDï¼Œç”¨äºè¯†åˆ«ç‰¹å®šçš„è§¦æ‘¸æ¥è§¦ã€‚æˆ–è®¸åº”è¯¥ç¿»è¯‘æˆåˆå§‹è§¦æ‘¸ç‚¹å”¯ä¸€idï¼Ÿ#define ABS_MT_TRACKING_ID\t0x39\t/* Unique ID of initiated contact *///åœ¨æ¥è§¦åŒºåŸŸä¸Šçš„å‹åŠ›å¤§å°ã€‚#define ABS_MT_PRESSURE 0x3a\t/* Pressure on contact area *///æ¥è§¦ç‚¹æ‚¬åœæ—¶çš„è·ç¦»ï¼Œç”¨äºæ£€æµ‹æœªå®é™…æ¥è§¦ä½†é è¿‘ä¼ æ„Ÿå™¨çš„æƒ…å†µã€‚#define ABS_MT_DISTANCE 0x3b\t/* Contact hover distance *///å·¥å…·ä¸­å¿ƒçš„Xåæ ‡ä½ç½®ï¼Œå¯èƒ½ä¸ABS_MT_POSITION_Xä¸åŒï¼Œä¾‹å¦‚å¯¹äºç¬”æˆ–å…¶ä»–å·¥å…·ã€‚#define ABS_MT_TOOL_X 0x3c\t/* Center X tool position */#define ABS_MT_TOOL_Y 0x3d\t/* Center Y tool position */#define ABS_MAX 0x3f#define ABS_CNT (ABS_MAX+1)__s32 value;è®°å½•äº†äº‹ä»¶çš„å€¼åŒæ ·çš„valueä¹Ÿä¼šæ ¹æ®typeçš„å€¼ä¸åŒè€Œæœ‰ä¸åŒçš„å«ä¹‰ä¾‹å¦‚ï¼štype = EV_KEYæ—¶ï¼Œvalueè¡¨ç¤ºæŒ‰é”®çš„å€¼ï¼Œ0è¡¨ç¤ºæŒ‰é”®æ²¡æœ‰æŒ‰ä¸‹ï¼Œ1è¡¨ç¤ºæŒ‰é”®æŒ‰ä¸‹//è¿™é‡Œæ²¡æœ‰æ‰¾åˆ°å®šä¹‰ï¼Œç½‘ä¸ŠæŸ¥çš„type = EV_RELæ—¶ï¼Œvalueè¡¨ç¤ºç§»åŠ¨çš„å€¼å’Œæ–¹å‘ï¼ˆæ­£è´Ÿï¼‰type = EV_ABSæ—¶ï¼Œvalueè¡¨ç¤ºç§»åŠ¨çš„ç»å¯¹åæ ‡ å½“ä¸€ä¸ªäº‹ä»¶ä¸Šä¼ å®Œä¹‹åï¼Œä¼šä¸ŠæŠ¥ä¸€ä¸ªâ€œåŒæ­¥äº‹ä»¶â€ï¼Œè¡¨ç¤ºæ•°æ®ä¸Šä¼ å®Œæ¯•ã€‚åŒæ­¥äº‹ä»¶ä¹Ÿæ˜¯ä¸€ä¸ªinput_eventç»“æ„ä½“ï¼Œtype EV_SYNï¼Œcode SYN_REPORTï¼Œvalue 0.å³0 0 0 æŸ¥çœ‹æœ‰å“ªäº›è¾“å…¥è®¾å¤‡ï¼š ls /dev/input/* -lcrw-rw---- 1 root input 13, 64 Jan 1 00:00 /dev/input/event0crw-rw---- 1 root input 13, 65 Jan 1 00:00 /dev/input/event1crw-rw---- 1 root input 13, 66 Jan 1 00:00 /dev/input/event2crw-rw---- 1 root input 13, 63 Jan 1 00:00 /dev/input/mice//é¼ æ ‡/dev/input/by-path:total 0lrwxrwxrwx 1 root root 9 Jan 1 00:00 platform-20cc000.snvs:snvs-powerkey-event - ../event0lrwxrwxrwx 1 root root 9 Jan 1 00:00 platform-gpio-keys-event - ../event2è·å–ä¸ event å¯¹åº”çš„ç›¸å…³è®¾å¤‡ä¿¡æ¯ cat /proc/bus/input/devicesI: Bus=0019 Vendor=0000 Product=0000 Version=0000//I è®¾å¤‡IDN: Name=20cc000.snvs:snvs-powerkey//Name P: Phys=snvs-pwrkey/input0//ç‰©ç†è·¯å¾„S: Sysfs=/devices/soc0/soc/2000000.aips-bus/20cc000.snvs/20cc000.snvs:snvs-powerkey/input/input0//ä½äº sys æ–‡ä»¶ç³»ç»Ÿçš„è·¯å¾„U: Uniq=//å”¯ä¸€æ ‡è¯†ç¬¦H: Handlers=kbd event0 evbug//è¾“å…¥å¥æŸ„HandlerB: PROP=0//Bä½å›¾B: EV=3B: KEY=100000 0 0 0 //ä¸04_åµŒå…¥å¼Linuxåº”ç”¨å¼€å‘åŸºç¡€çŸ¥è¯†\\source\\11_input\\01_app_demo\\01_get_input_info.cç»“æœç›¸åŒI: Bus=0018 Vendor=dead Product=beef Version=28bbN: Name=goodix-ts//è§¦æ‘¸å±å³#define BUS_I2C 0x18P: Phys=input/tsS: Sysfs=/devices/virtual/input/input1U: Uniq=H: Handlers=event1 evbugB: PROP=2B: EV=bB: KEY=1c00 0 0 0 0 0 0 0 0 0 0B: ABS=6e18000 0I: Bus=0019 Vendor=0001 Product=0001 Version=0100N: Name=gpio-keysP: Phys=gpio-keys/input0S: Sysfs=/devices/soc0/gpio-keys/input/input2U: Uniq=H: Handlers=kbd event2 evbugB: PROP=0B: EV=3B: KEY=c è·å–è®¾å¤‡ä¿¡æ¯ä½¿ç”¨hexdumpå‘½ä»¤hexdump /dev/input/event1æ¥è·å–è®¾å¤‡ä¿¡æ¯ //ä¸‹è¡¨ä¸­ä¸å€¼ç›¸å¯¹åº”çš„äº‹ä»¶ç±»å‹type#define EV_ABS 0x03//ç»å¯¹åæ ‡äº‹ä»¶#define EV_KEY 0x01//é”®ç›˜æˆ–è€…æŒ‰é”®äº‹ä»¶#define EV_SYN 0x00//ä¸‹è¡¨ä¸­ä¸å€¼ç›¸å¯¹åº”çš„äº‹ä»¶code#define BTN_TOUCH 0x14a ä¸‹è¡¨ä¸ºä½¿ç”¨ä¸€ä¸ªæ‰‹æŒ‡ç‚¹å‡»è§¦æ‘¸å±è¿”å›çš„æ•°æ® åºå· ç§’ å¾®ç§’ type code value type code valueæ•°å€¼ä»£è¡¨çš„è¯¦ç»†ä¿¡æ¯ 0000000 7180 0000 57bc 0006 0003 0039 0014 0000 EV_ABS ABS_MT_TRACKING_ID 14 0000010 7180 0000 57bc 0006 0003 0035 006f 0000 EV_ABS ABS_MT_POSITION_X 0000020 7180 0000 57bc 0006 0003 0036 013a 0000 EV_ABS ABS_MT_POSITION_Y 0000030 7180 0000 57bc 0006 0003 0030 001e 0000 EV_ABS ABS_MT_TOUCH_MAJOR 0000040 7180 0000 57bc 0006 0003 003a 001e 0000 EV_ABS ABS_MT_PRESSURE 0000050 7180 0000 57bc 0006 0001 014a 0001 0000 EV_KEY BTN_TOUCH 0000060 7180 0000 57bc 0006 0000 0000 0000 0000 EV_SYN 0000070 7180 0000 27c5 0007 0003 0039 ffff ffff ABS_MT_TRACKING_ID -1 0000080 7180 0000 27c5 0007 0001 014a 0000 0000 EV_KEY BTN_TOUCH 0000090 7180 0000 27c5 0007 0000 0000 0000 0000 EV_SYN å¯¹äºå¤šç‚¹è§¦æ‘¸ä¼šä¸Šä¼ ABS_MT_SLOT,æ•°æ®æ›´åŠ å¤æ‚ä¸€äº›ï¼Œä½†æ˜¯åŸç†æ˜¯å·®ä¸å¤šçš„ï¼Œä¼šçœ‹ä¿¡æ¯è¡¨å³å¯ è·å–è®¾å¤‡ä¿¡æ¯int ioctl(int fd, unsigned long request, ...)//è¾“å…¥æ ¼å¼requestè¦æ±‚ï¼š//include\\uapi\\asm-generic\\ioctl.h#define _IOC(dir,type,nr,size) \\\t(((dir) _IOC_DIRSHIFT) | \\ ((type) _IOC_TYPESHIFT) | \\ ((nr) _IOC_NRSHIFT) | \\ ((size) _IOC_SIZESHIFT))dir:_IOC_READ è¯»æ•°æ® _IOC_WRITE å†™æ•°æ®size:ioctlä¼ è¾“çš„å­—èŠ‚æ•°type:nr: _IOC_NR _IOC_TYPE _IOC_SIZE _IOC_DIRå¯ä»¥å‚è€ƒè¿™ç¯‡åšå®¢ requretå¯ä»¥å–ä»¥ä¸‹å€¼ï¼š //include\\uapi\\linux\\input.h#define EVIOCGVERSION _IOR(E, 0x01, int) /* get driver version */#define EVIOCGID _IOR(E, 0x02, struct input_id)\t/* get device ID */#define EVIOCGREP _IOR(E, 0x03, unsigned int[2])\t/* get repeat settings */#define EVIOCSREP _IOW(E, 0x03, unsigned int[2])\t/* set repeat settings */#define EVIOCGKEYCODE _IOR(E, 0x04, unsigned int[2]) /* get keycode */#define EVIOCGKEYCODE_V2\t_IOR(E, 0x04, struct input_keymap_entry)#define EVIOCSKEYCODE _IOW(E, 0x04, unsigned int[2]) /* set keycode */#define EVIOCSKEYCODE_V2\t_IOW(E, 0x04, struct input_keymap_entry)#define EVIOCGNAME(len) _IOC(_IOC_READ, E, 0x06, len) /* get device name */#define EVIOCGPHYS(len) _IOC(_IOC_READ, E, 0x07, len) /* get physical location */#define EVIOCGUNIQ(len) _IOC(_IOC_READ, E, 0x08, len) /* get unique identifier */#define EVIOCGPROP(len) _IOC(_IOC_READ, E, 0x09, len) /* get device properties */#define EVIOCGBIT(ev,len)\t_IOC(_IOC_READ, E, 0x20 + (ev), len)\t/* get event bits */#define EVIOCGABS(abs) _IOR(E, 0x40 + (abs), struct input_absinfo)\t/* get abs value/limits */#define EVIOCSABS(abs) _IOW(E, 0xc0 + (abs), struct input_absinfo)\t/* set abs value/limits */#define ... è½¯ä»¶è®¿é—®ç¡¬ä»¶çš„å‡ ç§æ–¹å¼1.æŸ¥è¯¢æ–¹å¼ç¤ºä¾‹ï¼šè½¯ä»¶è°ƒç”¨openå‡½æ•°ï¼Œä¼ å…¥éé˜»å¡å‚æ•°O_NONBLOCK,å¦‚æœé©±åŠ¨ç¨‹åºä¸­æœ‰æ•°æ®åˆ™ç«‹åˆ»è¿”å›æ•°æ®ï¼Œå¦åˆ™è¿”å›é”™è¯¯ 2.ä¼‘çœ å”¤é†’æ–¹å¼ç¤ºä¾‹ï¼šè½¯ä»¶è°ƒç”¨openå‡½æ•°ï¼Œä¸ä¼ å…¥éé˜»å¡å‚æ•°O_NONBLOCKï¼Œå¦‚æœé©±åŠ¨ç¨‹åºä¸­æœ‰æ•°æ®ï¼Œåˆ™è¿”å›æ•°æ®ï¼›å¦åˆ™é©±åŠ¨ç¨‹åºä¼‘çœ ï¼Œç›´åˆ°æœ‰æ•°æ®å”¤é†’ã€‚ 3.pollselectæ–¹å¼åœ¨pollselectä¸­ä¼ å…¥è¶…æ—¶å‚æ•°ï¼Œæ¯”å¦‚ret poll(fds, nfds, 5000);ï¼Œåˆ™åœ¨æœ‰æ•°æ®å¯è¯»æˆ–è€…æœ‰ç©ºé—´å¯å†™æ—¶ï¼Œè¿”å›æ•°æ®ï¼›å¦åˆ™ç­‰åˆ°è¶…æ—¶æ—¶é—´5såï¼Œè¿”å›é”™è¯¯ã€‚pollselectå¯ä»¥æ£€æµ‹å¤šä¸ªæ–‡ä»¶ï¼Œå¤šä¸ªäº‹ä»¶ï¼›pollselectçš„ç¼ºç‚¹ï¼š 4.å¼‚æ­¥é€šçŸ¥æ–¹å¼æš‚æ—¶æ²¡å†™ å¤šçº¿ç¨‹ç¼–ç¨‹åŸºæœ¬æ¦‚å¿µä½¿ç”¨topå‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿå ç”¨çš„èµ„æºï¼ŒæŸ¥çœ‹çº¿ç¨‹æ•°ï¼ŒæŸ¥çœ‹è¿›ç¨‹æ•°ã€‚çº¿ç¨‹ï¼šthreadè¿›ç¨‹ï¼šprocessè°ƒåº¦æ˜¯ä»¥çº¿ç¨‹ä¸ºå•ä½çš„ï¼Œå³ç³»ç»Ÿè°ƒåº¦çš„æœ€å°å•ä½æ˜¯çº¿ç¨‹ã€‚è¿›ç¨‹æ˜¯çº¿ç¨‹çš„é›†åˆï¼Œèµ„æºåˆ†é…ä»¥è¿›ç¨‹ä¸ºåŸºæœ¬å•ä½ã€‚ äº’æ–¥é‡ï¼šmutexå…±äº«èµ„æºï¼šåœ¨è¿›ç¨‹ä¸­å‡ºç°çš„å…¨å±€å˜é‡ï¼Œçº¿ç¨‹éƒ½å¯ä»¥è®¿é—®å”¯ä¸€æ ‡è¯†ï¼šè¿›ç¨‹å·ï¼šPID çº¿ç¨‹å·ï¼šTID,pthread_tç±»å‹ç¼–è¯‘æ—¶å€™éœ€è¦æŒ‡æ˜åº“ gcc xxx.c -lpthread å¸¸ç”¨å‡½æ•° æŸ¥çœ‹çº¿ç¨‹idï¼špthread_t pthread_self(void);è¿”å›å€¼ä¸ºpthread_tï¼Œä¸€ä¸ªé•¿æ•´å‹ åˆ›å»ºçº¿ç¨‹ï¼šint pthread_create(pthread_t *thread, const pthread_attr_t *attr, void *(*start_routine) (void *), void *arg)é‡è¦å‚æ•°è§£é‡Šï¼š pthread_t *threadï¼šå¦‚æœæˆåŠŸåˆ›å»ºçº¿ç¨‹ï¼Œåˆ™è¿”å›çº¿ç¨‹æ ‡è¯†ç¬¦ï¼Œä¿å­˜åœ¨threadä¸­ const pthread_attr_t *attrï¼šçº¿ç¨‹å±æ€§ï¼ˆæ ˆå¤§å°ï¼Œä¼˜å…ˆçº§ç­‰ï¼‰ï¼Œé»˜è®¤ä¸ºNULL void *(*start_routine)(void *):cå‡½æ•°æŒ‡é’ˆï¼Œå£°æ˜äº†ä¸€ä¸ªåä¸ºstart_routineçš„å‡½æ•°æŒ‡é’ˆï¼Œè¯¥å‡½æ•°æŒ‡é’ˆå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š å‡½æ•°æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œä¸”å‚æ•°ä¸ºvoid * å‡½æ•°è¿”å›ä¸€ä¸ªvoid *æŒ‡é’ˆ å‡½æ•°åä¸ºstart_routine,start_routineå¯ä»¥è¢«æ›¿æ¢ä¸ºä»»æ„å­—ç¬¦ void *arg:ä¼ é€’ç»™start_routineçš„å‚æ•°ï¼Œå¯ä»¥è®¾ç½®ä¸ºNULLã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œéœ€è¦æŒ‡å‘argæŒ‡å‘ä¸€ä¸ªå…¨å±€å †å˜é‡ è¿”å›å€¼ï¼šæˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›é”™è¯¯ç  çº¿ç¨‹é€€å‡º start_routineå‡½æ•°æ‰§è¡Œreturn çº¿ç¨‹è°ƒç”¨prhread_exit(void retval)å‡½æ•° pthread_exit å‡½æ•°ä¸ºçº¿ç¨‹é€€å‡ºå‡½æ•°ï¼Œåœ¨é€€å‡ºæ—¶å€™å¯ä»¥ä¼ é€’ä¸€ä¸ª voidç±»å‹çš„æ•°æ®å¸¦ç»™ä¸»çº¿ç¨‹ï¼Œè‹¥é€‰æ‹©ä¸ä¼ å‡ºæ•°æ®ï¼Œå¯å°†å‚æ•°å¡«å……ä¸º NULLã€‚å‡½æ•°åŸå‹ä¸ºvoid pthread_exit(void *retval); è°ƒç”¨pthread_cancel(pthread_t thread)å‡½æ•°å‡½æ•°åŸå‹ä¸ºï¼šint pthread_cancel(pthread_t thread);ä¼ å…¥ä¸€ä¸ªtidï¼Œåˆ™ä¼šå¼ºåˆ¶é€€å‡ºè¯¥tidå¯¹åº”çš„çº¿ç¨‹ã€‚æˆåŠŸè¿”å›0 éœ€è¦æ³¨æ„ï¼šå¦‚æœè¿›ç¨‹ä¸­ä»»æ„çº¿ç¨‹è°ƒç”¨exit(),_exit(),_Exit()å‡½æ•°ï¼Œåˆ™è¿›ç¨‹é€€å‡ºï¼Œæ‰€æœ‰çº¿ç¨‹é€€å‡ºã€‚ å›æ”¶çº¿ç¨‹ int pthread_join(pthread_t thread, void **retval);é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°æˆåŠŸå›æ”¶çº¿ç¨‹åæ‰è¿”å›ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¦å›æ”¶çº¿ç¨‹çš„ tid å·ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºçº¿ç¨‹å›æ”¶åæ¥å—çº¿ç¨‹ä¼ å‡ºçš„æ•°æ®ã€‚ int pthread_tryjoin_np(pthread_t thread, void **retval);éé˜»å¡æ¨¡å¼å›æ”¶å‡½æ•°ï¼Œé€šè¿‡è¿”å›å€¼åˆ¤æ–­æ˜¯å¦å›æ”¶æ‰çº¿ç¨‹ï¼ŒæˆåŠŸå›æ”¶åˆ™è¿”å› 0ï¼Œå…¶ä½™å‚æ•°ä¸ pthread_join ä¸€è‡´ çº¿ç¨‹æ§åˆ¶-äº’æ–¥é” äº’æ–¥é”è§£å†³ä¸´ç•Œèµ„æºè®¿é—®å†²çªé—®é¢˜ã€‚é€šè¿‡å¯¹ä¸´ç•Œèµ„æºåŠ é”æ¥ä¿æŠ¤èµ„æºåªè¢«å•ä¸ªçº¿ç¨‹æ“ä½œï¼Œå¾…æ“ä½œç»“æŸåè§£é”ï¼Œå…¶ä½™çº¿ç¨‹æ‰å¯è·å¾—æ“ä½œæƒã€‚ä¾‹å¦‚ï¼šå¯¹æŸä¸ªå…¨å±€å˜é‡è¿›è¡Œè®¿é—®æ—¶ï¼Œé€šè¿‡äº’æ–¥é”ä¿è¯åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®äº’æ–¥é”å®ç°çš„è¿‡ç¨‹å¯ä»¥å¦‚ä¸‹ï¼š åˆ›å»ºäº’æ–¥é”å‡½æ•°åŸå‹ä¸ºï¼šint pthread_mutex_init(phtread_mutex_t *mutex,const pthread_mutexattr_t *restrict attr);å…¶ä¸­ï¼šmutex (pthread_mutex_t *): äº’æ–¥é‡æŒ‡é’ˆã€‚æŒ‡å‘æœªåˆå§‹åŒ–çš„äº’æ–¥é”å¯¹è±¡çš„æŒ‡é’ˆã€‚æˆåŠŸåˆå§‹åŒ–åï¼Œè¿™ä¸ªäº’æ–¥é”å¯ç”¨äºçº¿ç¨‹é—´çš„åŒæ­¥ã€‚ å‚æ•°ï¼šattr (const pthread_mutexattr_t *restrict): æŒ‡å‘äº’æ–¥é”å±æ€§å¯¹è±¡çš„æŒ‡é’ˆï¼Œè¯¥å¯¹è±¡æŒ‡å®šäº†äº’æ–¥é”çš„ç‰¹æ€§ã€‚å¦‚æœè®¾ä¸ºNULLï¼Œåˆ™ä½¿ç”¨é»˜è®¤å±æ€§ã€‚restrictå…³é”®å­—è¡¨æ˜åœ¨å‡½æ•°æ‰§è¡ŒæœŸé—´ï¼ŒattræŒ‡é’ˆä¸ä¸å…¶ä»–è®¿é—®çš„å†…å­˜åˆ«åï¼Œè¿™å…è®¸ç¼–è¯‘å™¨è¿›è¡Œæ½œåœ¨çš„ä¼˜åŒ–ã€‚è¿”å›å€¼ 0: æˆåŠŸï¼Œè¡¨ç¤ºäº’æ–¥é”å·²æˆåŠŸåˆå§‹åŒ–ã€‚errno (é”™è¯¯ç ): å¤±è´¥æ—¶ï¼Œè¿”å›ä¸€ä¸ªé”™è¯¯ç¼–å·ä»¥æŒ‡ç¤ºé‡åˆ°çš„é”™è¯¯ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœå†…å­˜ä¸è¶³æ— æ³•åˆå§‹åŒ–äº’æ–¥é”ï¼Œåˆ™è¿”å›ENOMEMï¼‰ã€‚å‡½æ•°åº”åœ¨äº’æ–¥é”é¦–æ¬¡ä½¿ç”¨å‰è¢«è°ƒç”¨.ä¸€æ—¦åˆå§‹åŒ–ï¼Œçº¿ç¨‹å¯ä»¥ä½¿ç”¨å¦‚pthread_mutex_lockã€pthread_mutex_trylockå’Œpthread_mutex_unlockç­‰å‡½æ•°æ¥ç®¡ç†å¯¹å…±äº«èµ„æºçš„è®¿é—® åŠ é”å»é”(é˜»å¡) å½“æŸä¸€ä¸ªçº¿ç¨‹è·å¾—äº†æ‰§è¡Œæƒåï¼Œæ‰§è¡Œ lock å‡½æ•°ï¼Œä¸€æ—¦åŠ é”æˆåŠŸåï¼Œå…¶ä½™çº¿ç¨‹é‡åˆ° lock å‡½æ•°æ—¶å€™ä¼šå‘ç”Ÿé˜»å¡ï¼Œç›´è‡³è·å–èµ„æºçš„çº¿ç¨‹æ‰§è¡Œ unlock å‡½æ•°åã€‚unlock å‡½æ•°ä¼šå”¤é†’å…¶ä»–æ­£åœ¨ç­‰å¾…äº’æ–¥é‡çš„çº¿ç¨‹ã€‚ åŠ é”å‡½æ•°åŸå‹ä¸ºï¼šint pthread_mutex_lock(pthread_mutex_t *mutex);æˆåŠŸåä¼šè¿”å› 0 å»é”å‡½æ•°åŸå‹ä¸ºï¼šint pthread_mutex_unlock(pthread_mutex_t *mutex); ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œå½“è·å– lock ä¹‹åï¼Œå¿…é¡»åœ¨é€»è¾‘å¤„ç†ç»“æŸåæ‰§è¡Œ unlockï¼Œå¦åˆ™ä¼šå‘ç”Ÿæ­»é”ç°è±¡ï¼å¯¼è‡´å…¶ä½™çº¿ç¨‹ä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œæ— æ³•æ‰§è¡Œä¸‹å»ã€‚åœ¨ä½¿ç”¨äº’æ–¥é‡çš„æ—¶å€™ï¼Œå°¤å…¶è¦æ³¨æ„ä½¿ç”¨ pthread_cancel å‡½æ•°ï¼Œé˜²æ­¢å‘ç”Ÿæ­»é”ç°è±¡ï¼ åŠ é”(éé˜»å¡æ¨¡å¼)å‡½æ•°åŸå‹ï¼šint pthread_mutex_trylock(pthread_mutex_t *mutex);è¯¥å‡½æ•°æ˜¯éé˜»å¡æ¨¡å¼é€šè¿‡è¿”å›å€¼æ¥åˆ¤æ–­æ˜¯å¦åŠ é”æˆåŠŸï¼Œç”¨æ³•ä¸ä¸Šè¿°é˜»å¡åŠ é”å‡½æ•°ä¸€è‡´ é”€æ¯äº’æ–¥é‡(éé˜»å¡)å‡½æ•°åŸå‹ï¼šint pthread_mutex_destory(pthread_mutex_t *mutex);ï¼Œä¼ å…¥äº’æ–¥é‡çš„æŒ‡é’ˆï¼Œå°±å¯ä»¥å®Œæˆäº’æ–¥é‡çš„é”€æ¯ï¼ŒæˆåŠŸè¿”å› 0ã€‚ çº¿ç¨‹æ§åˆ¶-ä¿¡å·é‡äº’æ–¥é‡ï¼šé˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€ä¸ªä¸´ç•Œèµ„æºå†²çªé—®é¢˜ä¿¡å·é‡ï¼šé€šçŸ¥ åˆ›å»ºä¿¡å·é‡int sem_init(sem_t *sem,int pshared,unsigned int value); sem_t *semï¼šæŒ‡å‘ä¿¡å·é‡ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œè¿™ä¸ªç»“æ„ä½“éœ€è¦åœ¨è°ƒç”¨sem_initå‰ç”±ç”¨æˆ·åˆ†é…ç©ºé—´ã€‚å‡½æ•°ä¼šåˆå§‹åŒ–è¿™ä¸ªä¿¡å·é‡ã€‚ int psharedï¼šæŒ‡å®šä¿¡å·é‡æ˜¯å¦å¯ä»¥åœ¨è¿›ç¨‹é—´å…±äº«ã€‚ å¦‚æœpsharedä¸º0ï¼Œè¡¨ç¤ºä¿¡å·é‡ä»…åœ¨å½“å‰è¿›ç¨‹ä¸­æœ‰æ•ˆï¼Œä¸èƒ½è¢«å…¶ä»–è¿›ç¨‹è®¿é—®ã€‚ å¦‚æœpsharedä¸ºé0å€¼ï¼ˆé€šå¸¸ä¸º1ï¼‰ï¼Œåˆ™ä¿¡å·é‡å¯ä»¥åœ¨å¤šä¸ªè¿›ç¨‹é—´å…±äº«ï¼Œè¦æ±‚semä½äºå…±äº«å†…å­˜ä¸­ã€‚ unsigned int valueï¼šåˆå§‹åŒ–ä¿¡å·é‡çš„å€¼ï¼Œå³ä¿¡å·é‡è®¡æ•°å™¨çš„åˆå§‹å€¼ã€‚è¡¨ç¤ºæœ€åˆå¯ä»¥åŒæ—¶è®¿é—®å…±äº«èµ„æºçš„çº¿ç¨‹æˆ–è¿›ç¨‹çš„æ•°é‡ã€‚ ä¿¡å·é‡æ“ä½œ int sem_wait(sem_t *sem);int sem_post(sem_t *sem);int sem_trywait(sem_t *sem); sem_wait:å‡½æ•°ä½œç”¨ä¸ºæ£€æµ‹æŒ‡å®šä¿¡å·é‡æ˜¯å¦æœ‰èµ„æºå¯ç”¨ï¼Œè‹¥æ— èµ„æºå¯ç”¨ä¼šé˜»å¡ç­‰å¾…ï¼Œè‹¥æœ‰èµ„æºå¯ç”¨ä¼šè‡ªåŠ¨çš„æ‰§è¡Œâ€œsem-1â€çš„æ“ä½œã€‚æ‰€è°“çš„â€œsem-1â€æ˜¯ä¸ä¸Šè¿°åˆå§‹åŒ–å‡½æ•°ä¸­ç¬¬ä¸‰ä¸ªå‚æ•°å€¼ä¸€è‡´ï¼ŒæˆåŠŸæ‰§è¡Œä¼šè¿”å› 0ã€‚ sem_postï¼š å‡½æ•°ä¼šé‡Šæ”¾æŒ‡å®šä¿¡å·é‡çš„èµ„æºï¼Œæ‰§è¡Œâ€œsem+1â€æ“ä½œã€‚ sem_trywaitï¼šéé˜»å¡æ–¹å¼ ä¿¡å·é‡é”€æ¯int sem_destory(sem_t *sem); Linuxä¸²å£æ•°æ®æˆå‘˜ermios å‡½æ•°æ—æä¾›äº†ä¸€ä¸ªå¸¸è§„çš„ç»ˆç«¯æ¥å£ï¼Œç”¨äºæ§åˆ¶éåŒæ­¥é€šä¿¡ç«¯å£ã€‚ è¿™ä¸ªç»“æ„åŒ…å«äº†è‡³å°‘ä¸‹åˆ—æˆå‘˜ï¼š struct termios\tunsigned short c_iflag; /* è¾“å…¥æ¨¡å¼æ ‡å¿—*/\tunsigned short c_oflag; /* è¾“å‡ºæ¨¡å¼æ ‡å¿—*/\tunsigned short c_cflag; /* æ§åˆ¶æ¨¡å¼æ ‡å¿—*/\tunsigned short c_lflag; /*åŒºåŸŸæ¨¡å¼æ ‡å¿—æˆ–æœ¬åœ°æ¨¡å¼æ ‡å¿—æˆ–å±€éƒ¨æ¨¡å¼*/\tunsigned char c_line; /*è¡Œæ§åˆ¶line discipline */\tunsigned char c_cc[NCC]; /* æ§åˆ¶å­—ç¬¦ç‰¹æ€§*/; å¸¸ç”¨å‡½æ•°tc:terminao control cd control flag å‡½æ•°å æè¿° int tcgetattr(int fd, struct termios *termios_p); è·å–ç»ˆç«¯å±æ€§ int tcsetattr(int fd, int optional_actions, const struct termios *termios_p); è®¾ç½®ç»ˆç«¯å±æ€§ int tcflush(int fd, int queue_selector); æ¸…é™¤ç»ˆç«¯ç¼“å†²åŒº int tcflow(int fd, int action); æ§åˆ¶ç»ˆç«¯çš„è¾“å…¥è¾“å‡ºæµ int tcdrain(int fd); ç­‰å¾…è¾“å‡ºç¼“å†²åŒºä¸­çš„æ‰€æœ‰å­—ç¬¦è¢«å‘é€ int tcsendbreak(int fd, int duration); å‘é€ä¸€ä¸ªæŒç»­durationçš„BREAKä¿¡å· int cfsetospeed(struct termios *termios_p, speed_t speed); è®¾ç½®è¾“å‡ºæ³¢ç‰¹ç‡ int cfsetispeed(struct termios *termios_p, speed_t speed); è®¾ç½®è¾“å…¥æ³¢ç‰¹ç‡ speed_t cfgetospeed(const struct termios *termios_p); è·å–è¾“å‡ºæ³¢ç‰¹ç‡ speed_t cfgetispeed(const struct termios *termios_p); è·å–è¾“å…¥æ³¢ç‰¹ç‡ int cfsetspeed(struct termios *termios_p, speed_t speed); è®¾ç½®æ³¢ç‰¹ç‡ é©±åŠ¨ å‡†å¤‡å·¥ä½œç¼–è¯‘é©±åŠ¨ç¨‹åºä¹‹å‰éœ€è¦å…ˆç¼–è¯‘å†…æ ¸ï¼Œå†…æ ¸çš„é…ç½®æ–‡ä»¶åœ¨arch/arm/configs/ç›®å½•ä¸‹ï¼Œå†…æ ¸ç¼–è¯‘è¿‡ç¨‹ä¸º: make mrpropermake 100_ask_imx6ull_defconfigmake zImage -j4make dtbs ç”Ÿæˆarch/arm/boot/zImageå’Œarch/arm/boot/dts/100ask_imx6ull-14x14.dtbæ–‡ä»¶,å°†è¿™ä¸¤ä¸ªæ–‡ä»¶å¤åˆ¶åˆ°homebooknfs_rootfsç›®å½•ä¸‹å¤‡ç”¨ cp arch/arm/boot/zImage ~/nfs_rootfscp arch/arm/boot/dts/100ask_imx6ull-14x14.dtb ~/nfs_rootfs è¿›å…¥å†…æ ¸æºç ç›®å½•ï¼Œç¼–è¯‘å†…æ ¸æ¨¡å— cd /home/book/100ask_imx6ull-sdk/Linux-4.9.88/make modules å®‰è£…å†…æ ¸æ¨¡å—åˆ°/home/book/nfs_rootfs make ARCH=arm INSTALL_MOD_PATH=/home/book/nfs_rootfs modules_install å®‰è£…å†…æ ¸å’Œæ¨¡å—åˆ°å¼€å‘æ¿ä¸Šï¼Œå…ˆæ‰§è¡ŒæŒ‚åœ¨å‘½ä»¤ï¼Œå†æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ cp /mnt/zImage /bootcp /mnt/100ask_imx6ull-14x14.dtb /bootcp /mnt/lib/modules /lib -rfdsync å®Œæˆä»¥ä¸Šé…ç½®é©±åŠ¨ç¨‹åºæµç¨‹ï¼š ç¡®å®šä¸»è®¾å¤‡å·ï¼Œä¹Ÿå¯ä»¥è®©å†…æ ¸åˆ†é… å®šä¹‰è‡ªå·±çš„file_operationsç»“æ„ä½“ å®ç°å¯¹åº”çš„drv_opendrv_readdrv_wtireç­‰å‡½æ•°ï¼Œå¡«å…¥file_operationsç»“æ„ä½“ æŠŠfile_operationsç»“æ„ä½“æ³¨å†Œåˆ°å†…æ ¸ä¸­:register_chrdev(ä¸»è®¾å¤‡å·ï¼Œè®¾å¤‡åï¼Œfile_operationsç»“æ„ä½“æŒ‡é’ˆ)? å…¥å£å‡½æ•°ï¼šå®‰è£…é©±åŠ¨ç¨‹åºæ—¶ï¼Œå°±ä¼šè°ƒç”¨æ­¤å…¥å£å‡½æ•° å‡ºå£å‡½æ•°ï¼šå¸è½½é©±åŠ¨ç¨‹åºï¼Œå‡ºå£å‡½æ•°è°ƒç”¨unregister_chrdev(ä¸»è®¾å¤‡å·ï¼Œè®¾å¤‡å)? æä¾›è®¾å¤‡ä¿¡æ¯ï¼Œè‡ªåŠ¨åˆ›å»ºè®¾å¤‡èŠ‚ç‚¹ï¼šclass_create,device_create é‡è¦çš„ç±»classè§£é‡Šå‚è€ƒåšå®¢ï¼šLinuxå†…æ ¸ä¸­çš„ struct class ç®€ä»‹ä»£ç ä¸­å‡ºç°çš„ class æŒ‡çš„æ˜¯ è®¾å¤‡ç±»ï¼ˆdevice classesï¼‰ï¼Œæ˜¯å¯¹äºè®¾å¤‡çš„é«˜çº§æŠ½è±¡ã€‚ä½† å®é™…ä¸Š class ä¹Ÿæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œåªä¸è¿‡ class ç»“æ„ä½“åœ¨å£°æ˜æ—¶æ˜¯æŒ‰ç…§ç±»çš„æ€æƒ³æ¥ç»„ç»‡å…¶æˆå‘˜çš„ã€‚è¿ç”¨ classï¼Œå¯ä»¥è®©ç”¨æˆ·ç©ºé—´çš„ç¨‹åºæ ¹æ®è‡ªå·±è¦å¤„ç†çš„äº‹æƒ…æ¥è°ƒç”¨è®¾å¤‡ï¼Œè€Œä¸æ˜¯æ ¹æ®è®¾å¤‡è¢«æ¥å…¥åˆ°ç³»ç»Ÿçš„æ–¹å¼æˆ–è®¾å¤‡çš„å·¥ä½œåŸç†æ¥è°ƒç”¨ã€‚ //include\\linux\\device.hstruct class const char *name; // ç±»åç§° struct module *owner; // ç±»æ‰€å±çš„æ¨¡å—ï¼Œæ¯”å¦‚ usbæ¨¡å—ã€ledæ¨¡å—ç­‰ struct class_attribute *class_attrs; // ç±»æ‰€æ·»åŠ çš„å±æ€§ const struct attribute_group **dev_groups; // ç±»æ‰€åŒ…å«çš„è®¾å¤‡æ‰€æ·»åŠ çš„å±æ€§ struct kobject *dev_kobj; // ç”¨äºæ ‡è¯† ç±»æ‰€åŒ…å«çš„è®¾å¤‡å±äºå—è®¾å¤‡è¿˜æ˜¯å­—ç¬¦è®¾å¤‡ int (*dev_uevent)(struct device *dev, struct kobj_uevent_env *env); // ç”¨äºåœ¨è®¾å¤‡å‘å‡º uevent æ¶ˆæ¯æ—¶æ·»åŠ ç¯å¢ƒå˜é‡ char *(*devnode)(struct device *dev, umode_t *mode); // è®¾å¤‡èŠ‚ç‚¹çš„ç›¸å¯¹è·¯å¾„å void (*class_release)(struct class *class); // ç±»è¢«é‡Šæ”¾æ—¶è°ƒç”¨çš„å‡½æ•° void (*dev_release)(struct device *dev); // è®¾å¤‡è¢«é‡Šæ”¾æ—¶è°ƒç”¨çš„å‡½æ•° int (*suspend)(struct device *dev, pm_message_t state); // è®¾å¤‡ä¼‘çœ æ—¶è°ƒç”¨çš„å‡½æ•° int (*resume)(struct device *dev); // è®¾å¤‡è¢«å”¤é†’æ—¶è°ƒç”¨çš„å‡½æ•° const struct kobj_ns_type_operations *ns_type; const void *(*namespace)(struct device *dev); const struct dev_pm_ops *pm; // ç”¨äºç”µæºç®¡ç†çš„å‡½æ•° struct subsys_private *p; // æŒ‡å‘ class_private ç»“æ„çš„æŒ‡é’ˆ; é‡è¦çš„ç±»file_operationsç»“æ„ä½“ï¼Œå‚è€ƒåšå®¢ï¼šLinux å­—ç¬¦è®¾å¤‡é©±åŠ¨ç»“æ„ï¼ˆå››ï¼‰â€”â€” file_operations ç»“æ„ä½“çŸ¥è¯†è§£æ //include\\linux\\fs.hstruct file_operations struct module *owner;//æ‹¥æœ‰è¯¥ç»“æ„çš„æ¨¡å—çš„æŒ‡é’ˆï¼Œä¸€èˆ¬ä¸ºTHIS_MODULES loff_t (*llseek) (struct file *, loff_t, int);//ç”¨æ¥ä¿®æ”¹æ–‡ä»¶å½“å‰çš„è¯»å†™ä½ç½® ssize_t (*read) (struct file *, char __user *, size_t, loff_t *);//ä»è®¾å¤‡ä¸­åŒæ­¥è¯»å–æ•°æ® ssize_t (*write) (struct file *, const char __user *, size_t, loff_t *);//å‘è®¾å¤‡å‘é€æ•°æ® ssize_t (*aio_read) (struct kiocb *, const struct iovec *, unsigned long, loff_t);//åˆå§‹åŒ–ä¸€ä¸ªå¼‚æ­¥çš„è¯»å–æ“ä½œ ssize_t (*aio_write) (struct kiocb *, const struct iovec *, unsigned long, loff_t);//åˆå§‹åŒ–ä¸€ä¸ªå¼‚æ­¥çš„å†™å…¥æ“ä½œ int (*readdir) (struct file *, void *, filldir_t);//ä»…ç”¨äºè¯»å–ç›®å½•ï¼Œå¯¹äºè®¾å¤‡æ–‡ä»¶ï¼Œè¯¥å­—æ®µä¸ºNULL unsigned int (*poll) (struct file *, struct poll_table_struct *); //è½®è¯¢å‡½æ•°ï¼Œåˆ¤æ–­ç›®å‰æ˜¯å¦å¯ä»¥è¿›è¡Œéé˜»å¡çš„è¯»å†™æˆ–å†™å…¥ int (*ioctl) (struct inode *, struct file *, unsigned int, unsigned long); //æ‰§è¡Œè®¾å¤‡I/Oæ§åˆ¶å‘½ä»¤ long (*unlocked_ioctl) (struct file *, unsigned int, unsigned long); //ä¸ä½¿ç”¨BLKæ–‡ä»¶ç³»ç»Ÿï¼Œå°†ä½¿ç”¨æ­¤ç§å‡½æ•°æŒ‡é’ˆä»£æ›¿ioctl long (*compat_ioctl) (struct file *, unsigned int, unsigned long); //åœ¨64ä½ç³»ç»Ÿä¸Šï¼Œ32ä½çš„ioctlè°ƒç”¨å°†ä½¿ç”¨æ­¤å‡½æ•°æŒ‡é’ˆä»£æ›¿ int (*mmap) (struct file *, struct vm_area_struct *); //ç”¨äºè¯·æ±‚å°†è®¾å¤‡å†…å­˜æ˜ å°„åˆ°è¿›ç¨‹åœ°å€ç©ºé—´ int (*open) (struct inode *, struct file *); //æ‰“å¼€ int (*flush) (struct file *, fl_owner_t id); int (*release) (struct inode *, struct file *); //å…³é—­ int (*fsync) (struct file *, struct dentry *, int datasync); //åˆ·æ–°å¾…å¤„ç†çš„æ•°æ® int (*aio_fsync) (struct kiocb *, int datasync); //å¼‚æ­¥åˆ·æ–°å¾…å¤„ç†çš„æ•°æ® int (*fasync) (int, struct file *, int); //é€šçŸ¥è®¾å¤‡FASYNCæ ‡å¿—å‘ç”Ÿå˜åŒ– int (*lock) (struct file *, int, struct file_lock *); ssize_t (*sendpage) (struct file *, struct page *, int, size_t, loff_t *, int); unsigned long (*get_unmapped_area)(struct file *, unsigned long, unsigned long, unsigned long, unsigned long); int (*check_flags)(int); int (*flock) (struct file *, int, struct file_lock *); ssize_t (*splice_write)(struct pipe_inode_info *, struct file *, loff_t *, size_t, unsigned int); ssize_t (*splice_read)(struct file *, loff_t *, struct pipe_inode_info *, size_t, unsigned int); int (*setlease)(struct file *, long, struct file_lock **); ; å¸¸ç”¨å‡½æ•° å‡½æ•°å æè¿° unsigned long copy_to_user(void *to, const void *from, unsigned long n); è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯å°†å†…æ ¸ç©ºé—´çš„æ•°æ®å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ toï¼šç›®æ ‡åœ°å€ï¼ˆç”¨æˆ·ç©ºé—´ï¼‰ fromï¼šæºåœ°å€ï¼ˆå†…æ ¸ç©ºé—´ï¼‰ nï¼šå°†è¦æ‹·è´æ•°æ®çš„å­—èŠ‚æ•° è¿”å›ï¼šæˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›æ²¡æœ‰æ‹·è´æˆåŠŸçš„æ•°æ®å­—èŠ‚æ•° unsigned long copy_from_user(void *to, const void *from, unsigned long n); è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯å°†ç”¨æˆ·ç©ºé—´çš„æ•°æ®å¤åˆ¶åˆ°å†…æ ¸ç©ºé—´ toï¼šç›®æ ‡åœ°å€ï¼ˆå†…æ ¸ç©ºé—´ï¼‰fromï¼šæºåœ°å€ï¼ˆç”¨æˆ·ç©ºé—´ï¼‰nï¼šå°†è¦æ‹·è´æ•°æ®çš„å­—èŠ‚æ•°è¿”å›ï¼šæˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›æ²¡æœ‰æ‹·è´æˆåŠŸçš„æ•°æ®å­—èŠ‚æ•° ledé©±åŠ¨static inline int register_chrdev(unsigned int major, const char *name, const struct file_operations *fops)","tags":["linux","åµŒå…¥å¼","imx6ull"],"categories":["LINUX"]},{"title":"roså¸¸ç”¨å‘½ä»¤","path":"/2024/09/18/roså¸¸ç”¨å‘½ä»¤/","content":"ROSæ–‡ä»¶ç³»ç»Ÿ WorkSpace --- è‡ªå®šä¹‰çš„å·¥ä½œç©ºé—´ |--- build:ç¼–è¯‘ç©ºé—´ï¼Œç”¨äºå­˜æ”¾CMakeå’Œcatkinçš„ç¼“å­˜ä¿¡æ¯ã€é…ç½®ä¿¡æ¯å’Œå…¶ä»–ä¸­é—´æ–‡ä»¶ã€‚ |--- devel:å¼€å‘ç©ºé—´ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘åç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶ï¼ŒåŒ…æ‹¬å¤´æ–‡ä»¶ã€åŠ¨æ€é™æ€é“¾æ¥åº“ã€å¯æ‰§è¡Œæ–‡ä»¶ç­‰ã€‚ |--- src: æºç  |-- packageï¼šåŠŸèƒ½åŒ…(ROSåŸºæœ¬å•å…ƒ)åŒ…å«å¤šä¸ªèŠ‚ç‚¹ã€åº“ä¸é…ç½®æ–‡ä»¶ï¼ŒåŒ…åæ‰€æœ‰å­—æ¯å°å†™ï¼Œåªèƒ½ç”±å­—æ¯ã€æ•°å­—ä¸ä¸‹åˆ’çº¿ç»„æˆ |-- CMakeLists.txt é…ç½®ç¼–è¯‘è§„åˆ™ï¼Œæ¯”å¦‚æºæ–‡ä»¶ã€ä¾èµ–é¡¹ã€ç›®æ ‡æ–‡ä»¶ |-- package.xml åŒ…ä¿¡æ¯ï¼Œæ¯”å¦‚:åŒ…åã€ç‰ˆæœ¬ã€ä½œè€…ã€ä¾èµ–é¡¹...(ä»¥å‰ç‰ˆæœ¬æ˜¯ manifest.xml) |-- scripts å­˜å‚¨pythonæ–‡ä»¶ |-- src å­˜å‚¨C++æºæ–‡ä»¶ |-- include å¤´æ–‡ä»¶ |-- msg æ¶ˆæ¯é€šä¿¡æ ¼å¼æ–‡ä»¶ |-- srv æœåŠ¡é€šä¿¡æ ¼å¼æ–‡ä»¶ |-- action åŠ¨ä½œæ ¼å¼æ–‡ä»¶ |-- launch å¯ä¸€æ¬¡æ€§è¿è¡Œå¤šä¸ªèŠ‚ç‚¹ |-- config é…ç½®ä¿¡æ¯ |-- CMakeLists.txt: ç¼–è¯‘çš„åŸºæœ¬é…ç½® package.xmlè¯¥æ–‡ä»¶å®šä¹‰æœ‰å…³è½¯ä»¶åŒ…çš„å±æ€§ï¼Œä¾‹å¦‚è½¯ä»¶åŒ…åç§°ï¼Œç‰ˆæœ¬å·ï¼Œä½œè€…ï¼Œç»´æŠ¤è€…ä»¥åŠå¯¹å…¶ä»–catkinè½¯ä»¶åŒ…çš„ä¾èµ–æ€§ã€‚è¯·æ³¨æ„ï¼Œè¯¥æ¦‚å¿µç±»ä¼¼äºæ—§ç‰ˆ rosbuild æ„å»ºç³»ç»Ÿä¸­ä½¿ç”¨çš„manifest.xmlæ–‡ä»¶ã€‚ CMakeLists.txtæ–‡ä»¶CMakeLists.txtæ˜¯CMakeæ„å»ºç³»ç»Ÿçš„è¾“å…¥ï¼Œç”¨äºæ„å»ºè½¯ä»¶åŒ…ã€‚ä»»ä½•å…¼å®¹CMakeçš„è½¯ä»¶åŒ…éƒ½åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªCMakeLists.txtæ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶æè¿°äº†å¦‚ä½•æ„å»ºä»£ç ä»¥åŠå°†ä»£ç å®‰è£…åˆ°ä½•å¤„ã€‚ rosæ–‡ä»¶ç³»ç»Ÿç›¸å…³å‘½ä»¤ å¢ åˆ  æ”¹ æŸ¥ å¯åœ roså¸¸ç”¨å‘½ä»¤å‚è€ƒç½‘å€ï¼šroså‘½ä»¤ rosnode ï¼šæ“ä½œèŠ‚ç‚¹ rostopic ï¼šæ“ä½œè¯é¢˜ rosservicea : æ“ä½œæœåŠ¡ rosmsg : æ“ä½œmsgæ¶ˆæ¯ rossrv : æ“ä½œsrvæœåŠ¡ rosparam : æ“ä½œå‚æ•° æ–°ç”Ÿæˆä¸€ä¸ªä¹Œé¾Ÿ rosservice call /spawn x: 0.0y: 0.0theta: 0.0name: å¸¸ç”¨API","tags":["ros","ç¬”è®°"],"categories":["ROS"]},{"title":"ç¯å½¢ç¼“å†²åŒº","path":"/2024/09/18/ç¯å½¢ç¼“å†²åŒº/","content":"ç¯å½¢ç¼“å†²åŒº ä½ç½®ï¼š èµ·å§‹ä½ç½® ç¼“å†²åŒºé•¿åº¦ è¯»ä½ç½® å†™ä½ç½® çŠ¶æ€ï¼š ç©º æ»¡ éç©ºéæ»¡","tags":["linux","åµŒå…¥å¼","ç¯å½¢ç¼“å†²åŒº"],"categories":["LINUX"]},{"title":"fileZillaè¿æ¥è™šæ‹Ÿæœºï¼ŒåŒæ ·é€‚ç”¨MobaXterm","path":"/2024/09/15/fileZillaè¿æ¥è™šæ‹Ÿæœº/","content":"fileZillaè¿æ¥è™šæ‹Ÿæœºï¼ŒåŒæ ·é€‚ç”¨MobaXtermä¸»è¦åˆ†ä¸ºfileZillaè®¾ç½®å’Œè™šæ‹Ÿæœºè®¾ç½®ï¼Œè™šæ‹Ÿæœºä¸»è¦æ˜¯è®¾ç½®ipåœ°å€å’Œç”¨æˆ·å ä¸€å›¾æŸ¥çœ‹ è™šæ‹Ÿæœºè®¾ç½® è®¾ç½®ç½‘ç»œé€‚é…å™¨ä¸ºNATæ¨¡å¼(ä¸çŸ¥é“æ˜¯ä¸æ˜¯å¿…é¡»NATï¼Œå› ä¸ºç°åœ¨ä½¿ç”¨çš„æ˜¯NATæ¨¡å¼) ä½¿ç”¨ifconfigæŸ¥çœ‹ip ä½¿ç”¨whoamiæŸ¥çœ‹ç”¨æˆ·åï¼Œå¾—åˆ°ç”¨æˆ·åbook æ³¨æ„è¿™é‡Œä¸æ˜¯ï¼šhostname,ä¹Ÿä¸æ˜¯ç®¡ç†å‘˜æƒé™ä¸‹çš„whoami åœ¨è®¾ç½®ä¸­æŸ¥çœ‹Detail-Aboutä¹Ÿä¸å¯¹ è‡³æ­¤ï¼Œå°±å®Œæˆäº†è™šæ‹Ÿæœºç›¸å…³çš„è®¾ç½®ï¼Œä¸»è¦æ˜¯æ³¨æ„ä½¿ç”¨ç”¨æˆ·å bookç”¨äºç™»å½•åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œä¸æ˜¯rootï¼Œä¹Ÿä¸æ˜¯ä¸»æœºå100ask FileZillaè®¾ç½® æŒ‰ç…§è™šæ‹Ÿæœºè®¾ç½®ï¼Œä¾æ¬¡è®¾ç½®å³å¯ ä¸»æœºï¼šå³ifconfigæŸ¥çœ‹çš„è¿œç¨‹ä¸»æœºçš„ipåœ°å€ ç”¨æˆ·åï¼šå³book å¯†ç ï¼šå³ä¹Œç­å›¾å¼€æœºå¯†ç  ç«¯å£ï¼šé»˜è®¤22 MobaXtermè¿æ¥è™šæ‹ŸæœºMobaXtermå’ŒfileZillaè®¾ç½®å¦‚å‡ºä¸€è¾™ï¼ŒæŒ‰ç…§ä¸‹å›¾è®¾ç½®å³å¯ï¼š Remote host ï¼šå³NATç½‘å¡ipåœ°å€ username :å³whoamiç”¨æˆ·å port : é»˜è®¤å€¼22å³å¯ éœ€è¦æ³¨æ„çš„æ˜¯MobaXtermä¹Ÿå¯ä»¥ä½¿ç”¨æ¡¥æ¥ç½‘å¡çš„ipä½†æ˜¯æˆ‘æ²¡æœ‰æµ‹è¯•ï¼ŒåŸç†åº”è¯¥æ˜¯ä¸€æ ·çš„","tags":["ç¬”è®°","ubuntu"],"categories":["UBUNTU"]},{"title":"ubuntuæ­å»ºå¼€å‘ç¯å¢ƒä»¥åŠå¼€å‘æ¿ubuntuäº’ping","path":"/2024/09/15/ubuntuæ­å»ºå¼€å‘ç¯å¢ƒä»¥åŠå¼€å‘æ¿ubuntuäº’ping/","content":"ubuntuæ­å»ºå¼€å‘ç¯å¢ƒä»¥åŠå¼€å‘æ¿ubuntuäº’pingåœ¨ubuntuä¸‹é…ç½®IMX6ULLçš„é…ç½®ç¯å¢ƒ ç›®æ ‡ï¼šå®ç°ubuntuä¸å¼€å‘æ¿äº’ping 1.å¼€å‘æ¿è®¾ç½®é™æ€IP ä¸´æ—¶è®¾ç½® ifconfig eth0** **192.168.5.9 ä¿®æ”¹é…ç½®æ–‡ä»¶æ°¸ä¹…è®¾ç½® vi /etc/network/interfaces ä½¿ç”¨viç¼–è¾‘å™¨å°†interfacesé‡Œå†…å®¹ä¿®æ”¹ä¸ºï¼š auto loiface lo inet loopbackauto eth0iface eth0 inet static\taddress 192.168.5.9\tnetmask 255.255.255.0\tgateway 192.168.5.1 viåˆ‡æ¢ä¸ºå‘½ä»¤è¡Œæ¨¡å¼ï¼Œä½¿ç”¨wqå¼ºåˆ¶ä¿å­˜å¹¶é€€å‡ºï¼Œå†æ‰§è¡Œ/etc/init.d/S40network restarté‡å¯ç½‘ç»œæœåŠ¡ ä½¿ç”¨ifconfigæŸ¥çœ‹ipï¼Œåœ¨eth0ä¸­å‡ºç°è®¾ç½®çš„192.168.5.9ä¾¿è¯´æ˜æˆåŠŸäº†ã€‚eth1æ˜¯è¿æ¥å¤–ç½‘çš„ï¼Œæ­¤æ—¶ä¸ç”¨ç®¡ 2. è®¾ç½®è™šæ‹Ÿæœºæ‰“å¼€è™šæ‹Ÿæœºâ€“å¯ç§»åŠ¨è®¾å¤‡ å¯ä»¥çœ‹åˆ°æœ‰ä»¥ä¸‹ä¸¤ä¸ªç§»åŠ¨è®¾å¤‡ï¼š Qingfeng USB Single Serial Realtek USB 10100 LAN åˆ†åˆ«æ˜¯ä¸²å£å’Œç½‘å¡ï¼Œè¿™é‡Œéƒ½éœ€è¦è¿æ¥åˆ°Ubuntuä¸Šï¼Œç¡®ä¿è¿™ä¸¤ä¸ªè¿æ¥çš„éƒ½æ˜¯è™šæ‹Ÿæœºè€Œä¸æ˜¯ä¸»æœºã€‚ 2.1 NATç½‘å¡Ubuntué€šè¿‡NATç½‘å¡ä¸Šç½‘ï¼Œæˆ‘ä»¬æä¾›çš„Ubuntué»˜è®¤å·²ç»æ”¯æŒäº†NATç½‘å¡ã€‚ æ‰“å¼€è™šæ‹Ÿæœºæ—¶ï¼Œç‚¹å‡»â€ç¼–è¾‘è™šæ‹Ÿæœºâ€ï¼Œç¡®ä¿ç½‘å¡æ˜¯NATç½‘å¡ï¼š æ³¨æ„è¿™é‡Œæ˜¯ï¼šè¿™é‡Œæ˜¯åœ¨ubuntuä¸‹è¿›è¡ŒåµŒå…¥å¼å¼€å‘ï¼Œä¸æ¶‰åŠåˆ°windowsï¼Œå› æ­¤åªéœ€è¦ä¸€ä¸ªç½‘ç»œé€‚é…å™¨ï¼Œå¹¶ä¸”è®¾ç½®ä¸ºNATæ¨¡å¼å³å¯ï¼Œå¦ä¸€ä¸ªç½‘ç»œé€‚é…å™¨2æ˜¯ä¸éœ€è¦çš„ 2.2 USBç½‘å¡2.1 è¿æ¥ç½‘å¡åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œå¼€å‘æ¿å’ŒUbuntuä¹‹é—´é€šè¿‡ç½‘ç»œä¼ è¾“æ•°æ®ï¼š 2 è®¾ç½®é™æ€IPåœ¨Ubuntuä¸­è®¾ç½®USBç½‘å¡çš„IPä½é™æ€IP è®¾ç½®-ç½‘ç»œ-USB Ethernet,ç‚¹å‡»å°é½¿è½® é€‰æ‹©æ‰‹åŠ¨åˆ†é…ï¼Œå³Manualï¼Œè®¾ç½®ä¸ºï¼š Address 192.168.5.11 Netmask 255.255.255.0 Gateway 192.168.5.1 3. éªŒè¯ä»¥ä¸Š2ä¸ªæ­¥éª¤å…¨éƒ¨åšå®Œå°±å¯ä»¥äº’pingäº† åœ¨å¼€å‘æ¿pingUbuntuï¼š ping 192.168.5.11 åœ¨Ubuntuä¸Špingå¼€å‘æ¿ï¼š ping 192.168.5.19 å› ä¸ºæ˜¯çº¯untuntuä¸‹é…ç½®ï¼Œæ²¡æœ‰ä½¿ç”¨åˆ°windowså› æ­¤ä¸éœ€è¦ping windowsï¼Œå¦‚æœè®¾ç½®äº†ç½‘ç»œé€‚é…å™¨2ï¼Œç†è®ºä¸Šå¯ä»¥pingé€šwindows","tags":["ç¬”è®°","ubuntu"],"categories":["UBUNTU"]},{"title":"è§£å†³ubuntu 20.04 GRUBå¯åŠ¨é¡¹é¡ºåºçš„é—®é¢˜","path":"/2024/09/15/ubuntu+GRUBå¯åŠ¨é¡¹/","content":"è§£å†³ubuntu 20.04 GRUBå¯åŠ¨é¡¹é¡ºåºçš„é—®é¢˜å‘½ä»¤ï¼š è¾“å…¥å‘½ä»¤ï¼šsudo gedit etcdefaultgrub æ›´æ”¹é…ç½®ï¼š GRUB_DEFAULT=2//æŒ‡å®šé»˜è®¤å¯åŠ¨çš„èœå•é¡¹ã€‚æ•°å­— 2 è¡¨ç¤ºå¯åŠ¨èœå•ä¸­çš„ç¬¬ ä¸‰ ä¸ªæ¡ç›®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚ //æ³¨æ„ï¼šæ­¤å¤„è®¾ç½®éœ€è¦æ ¹æ®å¯åŠ¨èœå•çš„æ˜¾ç¤ºé¡ºåºæ¥ç¡®å®šã€‚GRUB_TIMEOUT_STYLE=hidden//è®¾ç½® GRUB èœå•çš„æ˜¾ç¤ºæ ·å¼ã€‚hidden è¡¨ç¤ºåœ¨è¶…æ—¶ä¹‹å‰ä¸æ˜¾ç¤ºèœå•ï¼Œé™¤éç”¨æˆ·æŒ‰ä¸‹æŸä¸ªé”®ã€‚menuæ˜¾ç¤º GRUB èœå•ã€‚countdownï¼šæ˜¾ç¤ºå€’è®¡æ—¶ã€‚GRUB_TIMEOUT=10//è®¾ç½® GRUB èœå•çš„è¶…æ—¶æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚åœ¨ 10 ç§’åï¼ŒGRUB å°†è‡ªåŠ¨å¯åŠ¨é»˜è®¤çš„èœå•é¡¹ã€‚GRUB_DISTRIBUTOR=`lsb_release -i -s 2 /dev/null || echo Debian`GRUB_CMDLINE_LINUX_DEFAULT=quiet splashGRUB_CMDLINE_LINUX= æ‰§è¡Œå‘½ä»¤ï¼šsudo update-grub é‡å¯","tags":["ç¬”è®°","ubuntu"],"categories":["UBUNTU"]},{"title":"è§£å†³unbuntu 20.04 ä¸»æœºæ²¡æœ‰å£°éŸ³çš„é—®é¢˜","path":"/2024/09/15/ubuntuæ²¡æœ‰å£°éŸ³/","content":"è§£å†³ubuntu 20.04 ä¸»æœºæ²¡æœ‰å£°éŸ³çš„é—®é¢˜å®‰è£…pavucontrolï¼šè¾“å…¥å®‰è£…å‘½ä»¤ï¼šsudo apt install pavucontrol ç»ˆç«¯å¯åŠ¨ï¼špavucontrolé…ç½®ï¼š é…ç½®-HDA NVidia é€‰é¡¹å…³ é…ç½®-å†…ç½®éŸ³é¢‘ é€‰æ‹©æ¨¡æ‹Ÿç«‹ä½“å£°è¾“å‡º è¾“å‡ºè®¾å¤‡-å†…ç½®éŸ³é¢‘ æ¨¡æ‹Ÿç«‹ä½“å£°-æ¨¡æ‹Ÿè€³æœºå¤‡æ³¨ï¼šåªèƒ½æ’åœ¨ä¸»æœºä¸Šï¼Œæ’åœ¨æ˜¾ç¤ºå™¨ä¸Šè¿˜æ˜¯æ²¡æœ‰å£°éŸ³","tags":["ç¬”è®°","ubuntu"],"categories":["UBUNTU"]},{"title":"åŒºé—´å’Œ--å‰ç¼€å’Œæ•°ç»„","path":"/2024/09/03/leetcodeåˆ·é¢˜/æ¯æ—¥ä¸€åˆ·day4/","content":"åŒºé—´å’Œé¢˜ç›®ï¼šç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ Arrayï¼Œè¯·è®¡ç®—è¯¥æ•°ç»„åœ¨æ¯ä¸ªæŒ‡å®šåŒºé—´å†…å…ƒç´ çš„æ€»å’Œã€‚ è§£æ³•-é€šè¿‡å‰ç¼€å’Œæ•°ç»„æ€è·¯ï¼šç”±äºæš´åŠ›æ±‚è§£æ—¶é—´å¤æ‚åº¦è¾ƒå¤§ï¼Œå› æ­¤é‡‡ç”¨å‰ç¼€å’Œçš„æ–¹æ³• å¼•å…¥å‰ç¼€å’Œæ•°ç»„ï¼špresum[i]è¡¨ç¤ºå‰iä¸ªå…ƒç´ çš„å’Œ å¦‚æœè¦è®¡ç®—çš„åŒºé—´ä¸º[begin,end]ï¼Œåˆ™è®¡ç®—presum[end]-presum[begin-1] è¿™é‡Œçš„begin å’Œ end éƒ½æ˜¯ä»0å¼€å§‹ å¤æ‚åº¦ï¼š æ—¶é—´å¤æ‚åº¦ï¼š ç©ºé—´å¤æ‚åº¦ï¼š ä»£ç ï¼š int solution(vectorintnums,int begin,int end) int sum = 0; int result = 0; vectorint presum(nums.size(),0); for (int i = 0; i nums.size(); i++) sum += nums[i]; presum[i]=sum; coutpresum[i] = presum[i]endl; result = presum[end]-presum[begin-1]; return result;","tags":["c++","å‰ç¼€å’Œ"],"categories":["C++åˆ·é¢˜ç¬”è®°"]},{"title":"å¹³æ–¹æ–°æ•°ç»„","path":"/2024/09/02/leetcodeåˆ·é¢˜/æ¯æ—¥ä¸€åˆ·day3/","content":"å¹³æ–¹ç»„æˆçš„æ–°æ•°ç»„é¢˜ç›®ï¼šç»™ä½ ä¸€ä¸ªæŒ‰éé€’å‡é¡ºåºæ’åºçš„æ•´æ•°æ•°ç»„ numsï¼Œè¿”å› æ¯ä¸ªæ•°å­—çš„å¹³æ–¹ ç»„æˆçš„æ–°æ•°ç»„ï¼Œè¦æ±‚ä¹ŸæŒ‰ éé€’å‡é¡ºåº æ’åºã€‚ç¤ºä¾‹ 1ï¼šè¾“å…¥ï¼šnums [-4,-1,0,3,10]è¾“å‡ºï¼š[0,1,9,16,100]è§£é‡Šï¼šå¹³æ–¹åï¼Œæ•°ç»„å˜ä¸º [16,1,0,9,100]ï¼Œæ’åºåï¼Œæ•°ç»„å˜ä¸º [0,1,9,16,100]ç¤ºä¾‹ 2ï¼šè¾“å…¥ï¼šnums [-7,-3,2,3,11]è¾“å‡ºï¼š[4,9,9,49,121] è§£æ³•1æ€è·¯ï¼šæ¯ä¸ªæ•°å¹³æ–¹ä¹‹åï¼Œæ’ä¸ªåº è¿‡äºç®€å• å¤æ‚åº¦ï¼š æ—¶é—´å¤æ‚åº¦ï¼šO(n+nlogn) ç©ºé—´å¤æ‚åº¦ï¼š ä»£ç ï¼š std::vectorint test::solution(std::vectorint nums) std::vectorint result(nums.size()); for (int i = 0; i nums.size(); i++) result[i] = nums[i]*nums[i]; sort(result.begin(),result.end()); return result; è§£æ³•2â€“åŒæŒ‡é’ˆæ³•æ€è·¯ï¼šæœ¬æ¥å°±æ˜¯æœ‰åºçš„æ•°ç»„ï¼Œç”±äºè´Ÿæ•°å¹³æ–¹ä¹‹åå¯èƒ½ä¼šæ”¹å˜æ•°ç»„çš„é¡ºåºï¼Œæ‰€ä»¥é‡ç‚¹å…³æ³¨è´Ÿæ•°æ•°ç»„å¹³æ–¹çš„æœ€å¤§å€¼å‡ºç°åœ¨æ•°ç»„çš„ä¸¤ç«¯ï¼Œå·¦æˆ–è€…å³ï¼Œä¸å¯èƒ½æ˜¯ä¸­é—´ã€‚æ‰€ä»¥å¯ä»¥è€ƒè™‘åŒæŒ‡é’ˆæ³•ï¼Œleftå’Œright å®šä¹‰æ–°æ•°ç»„ï¼Œç”¨æ¥å­˜å‚¨ç»“æœï¼Œæ³¨æ„åˆå§‹åŒ–å¤§å°ï¼Œå¦åˆ™å®¹æ˜“å‡ºç°æº¢å‡ºé”™è¯¯ åˆ¤æ–­nums[left]*nums[left]å’Œnums[right]*nums[right]å¤§å°ï¼Œä»¥ä¾¿èµ‹å€¼ç»™result[i] å¦‚æœnums[left]*nums[left] nums[right]*nums[right] é‚£ä¹ˆ result[i] = nums[left]*nums[left] å¦‚æœnums[left]*nums[left] nums[right]*nums[right] é‚£ä¹ˆ result[i] = nums[right]*nums[right] åˆå§‹å€¼i = nums.size()-1,æ–¹ä¾¿ä»åå¾€å‰å¡«å…… å¤æ‚åº¦ï¼š æ—¶é—´å¤æ‚åº¦ï¼šo(n) ç©ºé—´å¤æ‚åº¦ï¼š ä»£ç ï¼š std::vectorint test::solution(std::vectorint nums) std::vectorint result(nums.size()); int left = 0,right = nums.size()-1; //ä»åå¾€å‰å¡«å…… //i=0 for(int i = nums.size()-1;i=0;i--) if(nums[left]*nums[left] nums[right]*nums[right]) result[i] = nums[left]*nums[left]; left++; else result[i] = nums[right]*nums[right]; right--; return result;","tags":["c++","å¹³æ–¹æ–°æ•°ç»„"],"categories":["C++åˆ·é¢˜ç¬”è®°"]},{"title":"matlabéçº¿æ€§æ–¹ç¨‹æ±‚è§£fsolve","path":"/2024/09/01/matlabéçº¿æ€§æ–¹ç¨‹æ±‚è§£fsolve/","content":"matlabéçº¿æ€§æ–¹ç¨‹æ±‚è§£fsolveæ‡’å¾—ä¸Šä¼ å›¾ç‰‡äº†â€¦ä»¥åä¹Ÿä¸ä¸ä¸€å®šç”¨å¾—åˆ°è¿™ä¸ªfsolve - å¯¹éçº¿æ€§æ–¹ç¨‹ç»„æ±‚è§£ - MATLAB - MathWorks ä¸­å›½ åŒ¿åå‡½æ•°f=@(x)acos(x)ï¼Œfä¸ºå‡½æ•°å¥æŸ„ï¼Œ@æ˜¯å®šä¹‰å¥æŸ„çš„è¿ç®—ç¬¦ã€‚f=@(x)acos(x)ç›¸å½“äºå»ºç«‹äº†ä¸€ä¸ªå‡½æ•°æ–‡ä»¶ï¼Œ%f.m function y=f(x) y=acos(x) æ­¤ç¤ºä¾‹è¿”å›è¿­ä»£è¾“å‡ºï¼Œå±•ç¤ºäº†ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªæ–¹ç¨‹å’Œä¸¤ä¸ªæœªçŸ¥æ•°çš„æ–¹ç¨‹ç»„çš„æ±‚è§£è¿‡ç¨‹ ä»¥ F(x)0 å½¢å¼é‡å†™æ–¹ç¨‹ï¼š ä» x0 = [-5 -5] å¼€å§‹æœç´¢è§£ã€‚ é¦–å…ˆï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°ç”¨æ¥è®¡ç®— Fï¼ˆæ–¹ç¨‹åœ¨ x å¤„çš„å€¼ï¼‰ã€‚ F = @(x) [2*x(1) - x(2) - exp(-x(1)); -x(1) + 2*x(2) - exp(-x(2))]; è¿™ä¸ªåŒ¿åå‡½æ•°æ¥å—ä¸€ä¸ªå‘é‡xä½œä¸ºè¾“å…¥å‚æ•°ã€‚å‘é‡xåœ¨è¿™é‡Œè¢«å‡å®šä¸ºåŒ…å«ä¸¤ä¸ªå…ƒç´ ï¼Œåˆ†åˆ«ç”¨x(1)å’Œx(2)è¡¨ç¤ºã€‚ åŒ¿åå‡½æ•°è¿”å›ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„å‘é‡ã€‚å‘é‡ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯è¡¨è¾¾å¼2*x(1) - x(2) - exp(-x(1))çš„å€¼ï¼Œå…¶ä¸­exp(-x(1))è¡¨ç¤ºè‡ªç„¶æŒ‡æ•°å‡½æ•°eçš„-x(1)æ¬¡æ–¹ã€‚ å‘é‡ä¸­çš„ç¬¬äºŒä¸ªå…ƒç´ æ˜¯è¡¨è¾¾å¼-x(1) + 2*x(2) - exp(-x(2))çš„å€¼ï¼ŒåŒæ ·exp(-x(2))è¡¨ç¤ºè‡ªç„¶æŒ‡æ•°å‡½æ•°eçš„-x(2)æ¬¡æ–¹ã€‚ è¿™ä¸ªåŒ¿åå‡½æ•°é€šå¸¸å¯èƒ½ç”¨äºæ±‚è§£æ–¹ç¨‹ç»„æˆ–è€…åœ¨å…¶ä»–æ•°å€¼è®¡ç®—æ–¹æ³•ä¸­ä½œä¸ºä¸€ä¸ªå‡½æ•°è¡¨è¾¾å¼æ¥ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨æ•°å€¼æ±‚è§£å™¨ï¼ˆå¦‚fsolveç­‰ï¼‰æ¥æ‰¾åˆ°ä½¿å¾—è¿™ä¸ªå‡½æ•°è¿”å›å€¼ä¸ºé›¶çš„å‘é‡xçš„å€¼ï¼Œä»è€Œæ±‚è§£ä¸€ä¸ªéçº¿æ€§æ–¹ç¨‹ç»„ã€‚ åˆ›å»ºåˆå§‹ç‚¹ x0ã€‚ x0 = [-5;-5]; è®¾ç½®é€‰é¡¹ä»¥è¿”å›è¿­ä»£è¾“å‡ºã€‚ options = optimoptions(fsolve,Display,iter); æ±‚è§£æ–¹ç¨‹ã€‚ [x,fval] = fsolve(F,x0,options)","tags":["c++","matlab"],"categories":["C++ç¬”è®°"]},{"title":"äºŒåˆ†æŸ¥æ‰¾","path":"/2024/08/20/leetcodeåˆ·é¢˜/æ¯æ—¥ä¸€åˆ·day1/","content":"äºŒåˆ†æŸ¥æ‰¾é¢˜ç›®ï¼šç»™å®šä¸€ä¸ªæ•´å‹æœ‰åºæ•°ç»„numså’Œä¸€ä¸ªç›®æ ‡ä¹‹target,å†™ä¸€ä¸ªæœç´¢å‡½æ•°æœç´¢target,å¦‚æœå­˜åœ¨åˆ™è¿”å›targetåœ¨æ•°ç»„ä¸­çš„ä¸‹ä¸‹æ ‡ï¼Œå¦‚æœtargetä¸å­˜åœ¨ï¼Œè¿”å›-1ã€‚ ä»£ç æ€è·¯ï¼š é‡‡å–é—­åŒºé—´[left,right]å†™æ³• while (left right) è¦ä½¿ç”¨ ï¼Œå› ä¸ºleft rightæ˜¯æœ‰æ„ä¹‰çš„ï¼Œæ‰€ä»¥ä½¿ç”¨ if (nums[middle] target) right è¦èµ‹å€¼ä¸º middle - 1ï¼Œå› ä¸ºå½“å‰è¿™ä¸ªnums[middle]ä¸€å®šä¸æ˜¯targetï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥è¦æŸ¥æ‰¾çš„å·¦åŒºé—´ç»“æŸä¸‹æ ‡ä½ç½®å°±æ˜¯ middle - 1 å¤æ‚åº¦ï¼š æ—¶é—´å¤æ‚åº¦ï¼šO(log n) ç©ºé—´å¤æ‚åº¦ï¼šO(1) int search::solution(vectorintnums,int target) int left = 0; int right = nums.size() - 1; // å®šä¹‰targetåœ¨å·¦é—­å³é—­çš„åŒºé—´é‡Œï¼Œ[left, right] while (left = right) // å½“left==rightï¼ŒåŒºé—´[left, right]ä¾ç„¶æœ‰æ•ˆï¼Œæ‰€ä»¥ç”¨ = int middle = left + ((right - left) / 2);// é˜²æ­¢æº¢å‡º ç­‰åŒäº(left + right)/2 if (nums[middle] target) right = middle - 1; // target åœ¨å·¦åŒºé—´ï¼Œæ‰€ä»¥[left, middle - 1] else if (nums[middle] target) left = middle + 1; // target åœ¨å³åŒºé—´ï¼Œæ‰€ä»¥[middle + 1, right] else // nums[middle] == target return middle; // æ•°ç»„ä¸­æ‰¾åˆ°ç›®æ ‡å€¼ï¼Œç›´æ¥è¿”å›ä¸‹æ ‡ // æœªæ‰¾åˆ°ç›®æ ‡å€¼ return -1;","tags":["c++","åˆ·é¢˜day1"],"categories":["C++åˆ·é¢˜ç¬”è®°"]},{"title":"ç§»é™¤å…ƒç´ ","path":"/2024/08/20/leetcodeåˆ·é¢˜/æ¯æ—¥ä¸€åˆ·day2/","content":"ç§»é™¤å…ƒç´ é¢˜ç›®ï¼šç»™ä½ ä¸€ä¸ªæ•°ç»„ nums å’Œä¸€ä¸ªå€¼ valï¼Œä½ éœ€è¦ åŸåœ° ç§»é™¤æ‰€æœ‰æ•°å€¼ç­‰äº val çš„å…ƒç´ ï¼Œå¹¶è¿”å›ç§»é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»ä»…ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´å¹¶åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„ã€‚å…ƒç´ çš„é¡ºåºå¯ä»¥æ”¹å˜ã€‚ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚ç¤ºä¾‹ 1: ç»™å®š nums [3,2,2,3], val 3, å‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 2, å¹¶ä¸” nums ä¸­çš„å‰ä¸¤ä¸ªå…ƒç´ å‡ä¸º 2ã€‚ ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚ç¤ºä¾‹ 2: ç»™å®š nums [0,1,2,2,3,0,4,2], val 2, å‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 5, å¹¶ä¸” nums ä¸­çš„å‰äº”ä¸ªå…ƒç´ ä¸º 0, 1, 3, 0, 4ã€‚ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚ è§£æ³•1æ€è·¯ï¼š ä¸¤å±‚forå¾ªç¯ï¼Œä¸€ä¸ªforå¾ªç¯éå†æ•°ç»„å…ƒç´  ï¼Œç¬¬äºŒä¸ªforå¾ªç¯æ›´æ–°æ•°ç»„ å¤æ‚åº¦ï¼š æ—¶é—´å¤æ‚åº¦ï¼šO(n^2) ç©ºé—´å¤æ‚åº¦ï¼š ä»£ç ï¼š // æ—¶é—´å¤æ‚åº¦ï¼šO(n^2)// ç©ºé—´å¤æ‚åº¦ï¼šO(1)class Solution public: int removeElement(vectorint nums, int val) int size = nums.size(); for (int i = 0; i size; i++) if (nums[i] == val) // å‘ç°éœ€è¦ç§»é™¤çš„å…ƒç´ ï¼Œå°±å°†æ•°ç»„é›†ä½“å‘å‰ç§»åŠ¨ä¸€ä½ for (int j = i + 1; j size; j++) nums[j - 1] = nums[j]; i--; // å› ä¸ºä¸‹æ ‡iä»¥åçš„æ•°å€¼éƒ½å‘å‰ç§»åŠ¨äº†ä¸€ä½ï¼Œæ‰€ä»¥iä¹Ÿå‘å‰ç§»åŠ¨ä¸€ä½ size--; // æ­¤æ—¶æ•°ç»„çš„å¤§å°-1 return size; ; è§£æ³•2â€“åŒæŒ‡é’ˆæ³•æ€è·¯ï¼šåŒæŒ‡é’ˆæ³•ï¼ˆå¿«æ…¢æŒ‡é’ˆæ³•ï¼‰ï¼š é€šè¿‡ä¸€ä¸ªå¿«æŒ‡é’ˆå’Œæ…¢æŒ‡é’ˆåœ¨ä¸€ä¸ªforå¾ªç¯ä¸‹å®Œæˆä¸¤ä¸ªforå¾ªç¯çš„å·¥ä½œã€‚ 1.2.3. å¤æ‚åº¦ï¼š æ—¶é—´å¤æ‚åº¦ï¼š ç©ºé—´å¤æ‚åº¦ï¼š ä»£ç ï¼š class pdeleteArrayprivate: /* data */public: pdeleteArray(/* args */); ~pdeleteArray(); int solution(std::vectorintnums,int val) int slow = 0; for (int fast = 0; fast nums.size(); fast++) if (nums[fast] != val) nums[slow] = nums[fast]; slow++; return slow; ;","tags":["c++","ç§»é™¤å…ƒç´ "],"categories":["C++åˆ·é¢˜ç¬”è®°"]},{"title":"çŸ­æ¨ªæ -çš„å«ä¹‰","path":"/2024/07/20/çŸ­æ¨ªæ -çš„å«ä¹‰/","content":"çŸ­æ¨ªæ -çš„å«ä¹‰çŒ›åœ°çœ‹åˆ°it - vec.begin()ç«Ÿçœ‹ä¸æ‡‚è¿™æ˜¯ä»€ä¹ˆï¼Œè¿˜ä»¥ä¸ºæ˜¯å’Œ.æˆ–è€…-ä¸€æ ·æ–°çš„è¿ç®—ç¬¦ã€‚æ•…è€Œæ€»ç»“ï¼š å‡æ³•è¿ç®—ç¬¦ å–è´Ÿè¿ç®—ç¬¦ æŒ‡é’ˆåŠ å‡è¿ç®—ç¬¦å¯ä»¥è®¡ç®—ä¸¤ä¸ªæŒ‡é’ˆä¹‹é—´çš„è·ç¦»int arr[] = 1, 2, 3, 4, 5; int *ptr1 = arr[0]; int *ptr2 = arr[2]; int distance = ptr2 - ptr1; // ç»“æœä¸º 2 è¿­ä»£å™¨ä¹‹é—´çš„å·®å€¼std::vectorint vec = 1, 2, 3, 4, 5;auto it1 = vec.begin();auto it2 = vec.begin() + 2;int distance = it2 - it1; // ç»“æœä¸º 2 ç±»ä¼¼äºæŒ‡é’ˆçš„è·ç¦»ï¼Œå› ä¸ºvec.begin()å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ç¬¬0å…ƒç´ çš„ä½ç½®ï¼Œå³*vec.begin()1.vec.end()æŒ‡å‘ç¬¬5ä¸ªå…ƒç´ çš„ä½ç½®ï¼Œå³*(vec.end()-1)6 å¯ä»¥é‡è½½è‡ªå®šä¹‰","tags":["c++"],"categories":["C++ç¬”è®°"]},{"title":"è™šå‡½æ•°","path":"/2024/07/20/è™šå‡½æ•°/","content":"è™šå‡½æ•° è™šå‡½æ•°æ˜¯åœ¨åŸºç±»ä¸­å£°æ˜çš„æˆå‘˜å‡½æ•°ï¼Œå‰é¢åŠ ä¸Švirtualå…³é”®å­— å…è®¸åœ¨æ´¾ç”Ÿç±»ä¸­é‡å†™è¿™ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡åŸºç±»æŒ‡é’ˆæˆ–è€…å¼•ç”¨è°ƒç”¨æ—¶ï¼Œè‡ªåŠ¨é€‰æ‹©æ­£ç¡®çš„å‡½æ•°ç‰ˆæœ¬å¦‚æœåœ¨æ´¾ç”Ÿç±»ä¸­ä¸æ‰“ç®—é‡å†™åŸºç±»çš„è™šå‡½æ•°ï¼Œå¯ä»¥åœ¨å£°æ˜æ—¶ä½¿ç”¨finalé˜²æ­¢é‡å†™ç”¨å¤„ï¼š éœ€è¦é€šè¿‡ç»§æ‰¿æ¥æ‰©å±•åŠŸèƒ½å¹¶ä¿æŒä»£ç çš„å¯ç»´æŠ¤æ€§å’Œçµæ´»æ€§ çº¯è™šå‡½æ•° æ˜¯ä¸€ç§ç‰¹æ®Šçš„è™šå‡½æ•° åœ¨åŸºç±»ä¸­å£°æ˜ï¼Œä½†æ˜¯æ²¡æœ‰å®ç° çº¯è™šå‡½æ•°ä½¿ç”¨0æ¥å£°æ˜ï¼Œè¡¨ç¤ºè¯¥å‡½æ•°å¿…é¡»åœ¨æ´¾ç”Ÿç±»ä¸­è¢«é‡å†™ æŠ½è±¡ç±»ï¼š åŒ…å«çº¯è™šå‡½æ•°çš„ç±»å«åšæŠ½è±¡ç±» æŠ½è±¡ç±»ä¸èƒ½å®ä¾‹åŒ–å¯¹è±¡ï¼Œåªèƒ½ä½œä¸ºå…¶ä»–ç±»çš„åŸºç±»ä¸¾ä¾‹ï¼š //å®šä¹‰æŠ½è±¡ç±»Baseclass Base public: vitrual int doSomething() = 0;//çº¯è™šå‡½æ•°ï¼Œä¸ºæŠ½è±¡ç±»;class Derived: public Base public: int doSomething()override/*å…·ä½“å®ç°*/return 0;;int main() Base* pbase = new Base();//é”™è¯¯ Base* pderived = new Derived();//æ­£ç¡® ä¸¾ä¾‹class Shape public: virtual double area() const = 0; // çº¯è™šå‡½æ•°;class Circle : public Shape public: double radius; Circle(double r) : radius(r) double area() const override return 3.14 * radius * radius; ;class Rectangle : public Shape public: double width, height; Rectangle(double w, double h) : width(w), height(h) double area() const override return width * height; ;int main() Shape* shapes[] = new Circle(5), new Rectangle(4, 6); for (auto shape : shapes) std::cout Area: shape-area() std::endl; for (auto shape : shapes) delete shape; // é‡Šæ”¾å†…å­˜ return 0;","tags":["c++"],"categories":["C++ç¬”è®°"]},{"title":"è½¦ç±»æ®‹å±€å®šå¼","path":"/2024/05/20/ChessLearning/","content":"å®ç”¨æ®‹å±€æœ¯è¯­è½¦ç±»å•è½¦å¿…èƒœå£«ç›¸ä¸å…¨å•è½¦ä¾‹èƒœå•ç¼ºå£«æ€»ä½“æ€è·¯ï¼šè½¦è¦åœ¨åŒç›¸çš„å¯¹ç«‹ä¾§ï¼Œå¯ä»¥åˆ©ç”¨å¸…ç ´æ‰å•å£«ï¼Œå½¢æˆå•è½¦ä¾‹èƒœåŒç›¸çš„å±€é¢ å•è½¦ä¾‹èƒœåŒç›¸æ€»ä½“æ€è·¯ï¼šå¸…å›ä¸­ï¼Œè½¦åˆ†è¾¹ï¼Œå…¥åº•ï¼ŒæŠ¢å°†ä½ï¼Œé«˜æ‰ç›¸ ç ´ç›¸å®šå¼ é»‘æ–¹åŒç›¸ä¸èƒ½ç›¸è¿ï¼Œè¿™ç§å±€é¢æ¯”è¾ƒå°‘è§ åˆ©ç”¨å¸…åœ¨ä¸­ï¼Œå°†å†›ååº•ç›¸è¢«åƒ åˆ©ç”¨å°†å†›ä¸Šå¸…å µä½ç›¸çœ¼ï¼Œä»è€Œç ´ç›¸ï¼Œæ­¤å±€é¢ä¸è¦æ±‚å¸…åœ¨ä¸­ å€ŸåŠ©å¸…åŠ›ï¼Œä»è€Œç ´ç›¸ æŠ¢å å°†ä½ï¼ˆåº•ä¸­çº¿ï¼‰åªè¦èƒ½å¤ŸæŠ¢å ä½åº•ä¸­çº¿ï¼Œé€šè¿‡é«˜æ‰ç›¸ï¼ˆå ä¸­ä¹‹åï¼Œé«˜æ‰ç›¸ä¹‹å‰æœ‰å¯èƒ½ä¼šç­‰ä¸€ç€ï¼‰ï¼Œé»‘æ–¹ä¸‰æ­¥ä»¥å†…å¿…ä¸¢ç›¸ï¼Œå¦‚ä½•æŠ¢å åº•ä¸­çº¿ï¼Œå¤§è‡´æœ‰ä»¥ä¸‹ä¸¤ç§æ€è·¯ã€‚ ç¬¬ä¸€ç§æ¯”è¾ƒç®€å•ã€‚å¦‚æœå°†ä¸åœ¨ä¸­çº¿ï¼Œå³å¯è¿›åº•å°†å†›ï¼Œç„¶åå¹³ä¸­å ä½ä¸­çº¿ å¦‚æœå°†åœ¨ä¸­çº¿ï¼Œå¯ä»¥å…ˆå ä½åº•çº¿ï¼ˆå¯èƒ½é¡ºåŠ¿å°†å†›ï¼‰ï¼Œå†æ‰ç›¸ï¼Œè¿«ä½¿å°†ç¦»å¼€å°†ä½ï¼Œç„¶åè½¦å å°†ä½è‡³æ­¤ï¼Œé«˜æ‰ç›¸å³å¯å–èƒœ å•è½¦ä¾‹èƒœé©¬åŒå£«å•è½¦ä¾‹å’Œé©¬å•ç¼ºå£«å…µç±»å•å…µéš¾èƒœå•å£«é»‘æ–¹æ±‚å’Œæ‰‹æ®µå…³é”®åœ¨äºå°†å ä½ä¸€æ¡çº¿å¦‚æœé»‘å°†æ²¡æœ‰å ä½ä¸€æ¡çº¿ï¼Œçº¢æ–¹å½¢æˆå·¦å¸…å³å…µçš„å›¾å½¢ï¼Œåˆ™çº¢èƒœã€‚çº¢æ–¹çš„æ€è·¯ï¼šå¸…å ä½ä¸€æ¡çº¿ä¸€å…µèƒœå­¤å°†ï¼Œåº•å…µä¸èƒœï¼Œé»‘æœ‰å£«éš¾èƒœã€‚ é«˜å…µå•å£«å·§èƒœå•å£«å¦‚æœé»‘å°†ç‡å…ˆå æ®è‚‹é“ï¼Œåˆ™å’Œæ£‹ã€‚æ‰€ä»¥çº¢æ–¹çš„æ€è·¯æ˜¯åˆ©ç”¨è‡ªå·±çš„å£«é¡ºåˆ©å°†å¸…ç§»åˆ°å¯¹ä¾§ï¼Œä»è€Œå½¢æˆå·¦å…µå³å¸…çš„å±€é¢ï¼Œæ–¹å¯å–èƒœ é«˜å…µå•ç›¸å·§èƒœå•å£«æ€è·¯ä¸é«˜å…µå•å£«å·§èƒœå•å£«ä¸€æ ·ï¼Œé»‘æ–¹å°†å ä½ä¸€æ¡çº¿ï¼Œçº¢æ–¹åˆ©ç”¨ç›¸å°†å¸…ç§»åˆ°å¯¹ä¾§ï¼Œå½¢æˆå·¦å…µå³å¸…çš„å±€é¢ï¼Œæ–¹å¯å–èƒœ é«˜å…µå·§åˆç‚®å•å£«é«˜å…µå°½é‡é è¿‘é»‘å°†ï¼Œä¸è®©é»‘æ–¹æ’‘èµ·å£«ï¼Œé»‘æ–¹æ²¡æœ‰ç‚®æ¶åˆ™å’Œæ£‹ é«˜ä½å…µä¾‹èƒœåŒå£«é«˜ä½å…µå¯ä»¥ç¨³èƒœåŒå£«ã€‚é«˜å…µä¸è¦ç›²ç›®æ€¥è¿›ï¼Œåº”å¾…æœºè€ŒåŠ¨ã€‚ é«˜åº•å…µä¾‹èƒœåŒå£«ä¸»å¸…åŠ©æ”»ï¼Œä»¥ç‰µåˆ¶é»‘å°†ï¼Œåº•å…µäº¦èƒ½å»ºåŠŸ åŒä½å…µä¾‹å’ŒåŒå£«","tags":["chess","è½¦ç±»æ®‹å±€","æ®‹å±€å®šå¼"],"categories":["CHESS"]},{"title":"constå’ŒæŒ‡é’ˆ","path":"/2023/09/20/constå’ŒæŒ‡é’ˆ/","content":"constå’ŒæŒ‡é’ˆconstä½äºæ•°æ®ç±»å‹çš„å‰é¢æ ¹æ®æœ‰æ— conståº”ç”¨äºå˜é‡å’ŒæŒ‡é’ˆï¼Œä¸¤ä¸¤ç»„åˆå¯ä»¥æœ‰4ç§æƒ…å†µï¼Œåˆ†åˆ«ï¼š å¸¸è§„å˜é‡çš„åœ°å€èµ‹å€¼ç»™å¸¸è§„æŒ‡é’ˆ å¸¸è§„å˜é‡çš„åœ°å€èµ‹å€¼ç»™æŒ‡å‘constçš„æŒ‡é’ˆ constå˜é‡çš„åœ°å€èµ‹å€¼ç»™æŒ‡å‘constçš„æŒ‡é’ˆ constå˜é‡çš„åœ°å€èµ‹å€¼ç»™å¸¸è§„æŒ‡é’ˆï¼ˆä¸è¢«å…è®¸ï¼‰ å¸¸è§„å˜é‡çš„åœ°å€èµ‹å€¼ç»™å¸¸è§„æŒ‡é’ˆæœ€å¸¸ç”¨çš„ä¸€ç§å½¢å¼ï¼Œæ²¡æœ‰constä½œç”¨ å¸¸è§„å˜é‡çš„åœ°å€èµ‹å€¼ç»™æŒ‡å‘constçš„æŒ‡é’ˆ int age =39;const int* pt = age; ä¸Šè¿°å£°æ˜æŒ‡å‡ºï¼ŒptæŒ‡å‘ä¸€ä¸ªconst intç±»å‹çš„å€¼(age39)ï¼Œ*ptçš„å€¼ä¸ºconstï¼Œä¸èƒ½ä¿®æ”¹ï¼Œå³ä¸èƒ½ä½¿ç”¨ptæ¥ä¿®æ”¹ageã€‚ *pt += 1;//invalid,å› ä¸ºptæŒ‡å‘ä¸€ä¸ªconst int ä½†æ˜¯ptçš„å£°æ˜å¹¶ä¸æ„å‘³ç€ptæŒ‡å‘çš„å€¼æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œåªæ˜¯æ„å‘³ç€å¯¹äºptæ¥è¯´è¿™ä¸ªå€¼æ˜¯å¸¸é‡ã€‚ä¾‹å¦‚ï¼ŒptæŒ‡å‘age,è€Œageå¹¶ä¸æ˜¯const,å› æ­¤å¯ä»¥ç›´æ¥é€šè¿‡ageå˜é‡æ¥ä¿®æ”¹ageçš„å€¼ï¼Œç„¶è€Œå´ä¸èƒ½ä½¿ç”¨ptæŒ‡é’ˆæ¥ä¿®æ”¹age. *pt = 20;//invalid,å› ä¸ºptæŒ‡å‘ä¸€ä¸ªconst intage = 20;//valid,å› ä¸ºageå¹¶ä¸æ˜¯const å¤šè¯´ä¸€ç‚¹ï¼šä¸Šè¿°å£°æ˜ä¸­ï¼Œconståªèƒ½é˜²æ­¢ä¿®æ”¹ptæŒ‡å‘çš„å€¼ï¼ˆæ­£å¦‚ä¸Šè¿°æ¼”ç¤ºçš„ä¸€æ ·ï¼‰ï¼Œè€Œä¸èƒ½é˜²æ­¢ä¿®æ”¹ptæœ¬èº«çš„å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥è®²ä¸€ä¸ªæ–°åœ°å€èµ‹å€¼ç»™pt int sage = 80;pt = sage;//invalid ä½†æ˜¯ä»ç„¶ä¸èƒ½é€šè¿‡ptæ¥ä¿®æ”¹ä»–æ–°æŒ‡å‘çš„å€¼ï¼ˆå³sageçš„å€¼80ï¼‰ã€‚ è¿™å°±å¥½åƒæ˜¯pté€šè¿‡åª’äººage çˆ±ä¸Šäº†39è¿™ä¸ªæ•°ã€‚ptä»¥ä¸º39æ˜¯æ’å®šä¸å˜çš„ï¼Œå´ä¸çŸ¥é“åª’äººageå¯ä»¥è®©39å˜æˆä»»ä½•æ•°ã€‚å¯¹ptæ¥è¯´ï¼Œå¾ˆæ˜æ˜¾39å¯¹è‡ªå·±ä¸æ„Ÿå…´è¶£ï¼Œæ—¢ç„¶æ”¹å˜ä¸äº†39,é‚£å°±æ”¹å˜è‡ªå·±ã€‚äºæ˜¯ä»–åˆé€šè¿‡æ–°åª’äººsageï¼Œä»‹ç»äº†ä¸ªæ–°å¯¹è±¡80ï¼Œå¯æ˜¯ptä»ç„¶ä»¥ä¸º80æ˜¯æ’å®šä¸å˜çš„ï¼Œæ®Šä¸çŸ¥sageå¯ä»¥è®©80å˜æˆä»»ä½•æ•°ã€‚ constå˜é‡çš„åœ°å€èµ‹å€¼ç»™æŒ‡å‘constçš„æŒ‡é’ˆ const float g_earth = 9.80;const float* pe = g_earth; ä¸Šè¿°å£°æ˜ï¼Œg_earthæ˜¯ä¸€ä¸ªconst floatç±»å‹çš„å˜é‡ï¼Œpeæ˜¯æŒ‡å‘const floatçš„ï¼Œå› æ­¤ä¸èƒ½ä½¿ç”¨peä¿®æ”¹è¿™ä¸ªå€¼ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨g_eatthä¿®æ”¹è¿™ä¸ªå€¼ constå˜é‡çš„åœ°å€èµ‹å€¼ç»™å¸¸è§„æŒ‡é’ˆï¼ˆä¸è¢«å…è®¸ï¼‰æ³¨æ„ï¼šè¿™æ˜¯ä¸è¢«å…è®¸çš„ï¼Œä¸‹é¢ç»™å‡ºä¸€ä¸ªè§£é‡Š const float g_earth = 9.80;float* pe = g_earth;//invalid å¦‚æœå¯ä»¥é€šè¿‡peçš„å€¼ä¿®æ”¹g_earthçš„è¯ï¼Œé‚£ä¹ˆä¹‹å‰æŠŠg_earthå£°æ˜ä¸ºconst floatåˆ™æ˜¾å¾—æ²¡å¿…è¦äº†ï¼Œå› æ­¤c++ç¦æ­¢è¿™ç§åšæ³• constä½äºæ•°æ®ç±»å‹çš„åé¢ä¸ä¸Šè¿°ä¸åŒçš„æ˜¯ï¼Œå…³é”®å­—constçš„ä½ç½®ä½äºæ•°æ®ç±»å‹çš„åé¢ï¼Œè€Œä¸”çœ‹ç€æ¯”è¾ƒåˆ«æ‰­ ä¾‹å­1 int sloth = 3;const int* ps = sloth;//ps æŒ‡å‘ const intint* const finger = sloth;//const figer æŒ‡å‘ int ä¸Šè¿°å£°æ˜ä¸­ï¼Œfigeråªèƒ½æŒ‡å‘sloth,ä½†æ˜¯å…è®¸ä½¿ç”¨fingeræ¥ä¿®æ”¹slothçš„å€¼ã€‚ä¸å…è®¸psä¿®æ”¹slothçš„å€¼ï¼Œä½†æ˜¯å…è®¸psæŒ‡å‘å¦ä¸€ä¸ªä½ç½®ã€‚ ç®€è€Œè¨€ä¹‹ï¼šfingerå’Œ*ps ä¸ºconst,è€Œ*figerå’Œpsä¸æ˜¯.ç»†ç»†ä½“ä¼šï¼ ä¾‹å­2â€“å£°æ˜æŒ‡å‘constå¯¹è±¡çš„constæŒ‡é’ˆ double troble = 2.00;const double* const stick = troble; ä¸Šè¿°å£°åä¸­ï¼Œstickä¸èƒ½ä¿®æ”¹troubleçš„å€¼ï¼Œä¸”stickåªèƒ½æŒ‡å‘trouleã€‚å‰è€…ç”±å‰ä¸€ä¸ªconstä½œç”¨ï¼Œåè€…ç”±åä¸€ä¸ªconstä½œç”¨ é€šè¿‡constå°†æŒ‡é’ˆä¸å¼•ç”¨è”ç³»èµ·æ¥å¼•ç”¨æ›´æ¥è¿‘ä¸constæŒ‡é’ˆï¼Œä¸€æ—¦ä¸æŸä¸ªå˜é‡å…³è”èµ·æ¥ï¼Œå°±ä¸€ç›´æ•ˆå¿ äºå®ƒ ä¾‹å­ int rats;int rodents = rats;int* const pr rats; å®é™…ä¸Šä¸Šé¢ä»£ç æ˜¯ä¸‹é¢çš„ä¼ªè£…ï¼Œå¼•ç”¨rodentsæ‰®æ¼”çš„è§’è‰²å’Œ*prç›¸åŒ","tags":["c++","const","æŒ‡é’ˆ"],"categories":["C++"]},{"title":"C++å‡½æ•°å½¢å‚ä¸ºå¼•ç”¨ç±»å‹æ—¶ï¼Œä¼ å…¥çš„å‚æ•°ç±»å‹ä¸ºä»€ä¹ˆç”¨å¼•ç”¨å¯¹è±¡çš„ç±»å‹å’Œå¼•ç”¨ç±»å‹éƒ½å¯ä»¥ï¼Ÿ","path":"/2023/05/20/C++å‡½æ•°å½¢å‚ä¸ºå¼•ç”¨ç±»å‹æ—¶ï¼Œä¼ å…¥çš„å‚æ•°ç±»å‹ä¸ºä»€ä¹ˆç”¨å¼•ç”¨å¯¹è±¡çš„ç±»å‹å’Œå¼•ç”¨ç±»å‹éƒ½å¯ä»¥ï¼Ÿ/","content":"C++å‡½æ•°å½¢å‚ä¸ºå¼•ç”¨ç±»å‹æ—¶ï¼Œä¼ å…¥çš„å‚æ•°ç±»å‹ä¸ºä»€ä¹ˆç”¨å¼•ç”¨å¯¹è±¡çš„ç±»å‹å’Œå¼•ç”¨ç±»å‹éƒ½å¯ä»¥ï¼Ÿä»£ç å¦‚ä¸‹ï¼š void refer1(int );void refer2(int *);int main()\tint a = 5;\tint b = a;\tint *c = a;\trefer1(a);\trefer1(b);\treturn 0; è¿™é‡Œçš„refer1çš„å½¢å‚æ˜¯ä¸€ä¸ªintç±»å‹çš„å¼•ç”¨ï¼Œä½†æ˜¯æˆ‘ä¼ a(intç±»å‹)è¿›å»å¯ä»¥ï¼Œæˆ‘ä¼ b(intå¼•ç”¨ç±»å‹)è¿›å»ä¹Ÿå¯ä»¥ï¼Œå¯¹æ¯”refer2çš„å½¢å‚ï¼Œè¦æ±‚ä¼ intæŒ‡é’ˆç±»å‹ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ä¼ cè¿›å»ï¼Œå¦‚æœæˆ‘ä¼ a(cæŒ‡å‘çš„ç±»å‹)è¿›å»åˆ™æŠ¥é”™ã€‚ æŒ‰ç…§å¸¸ç†è¯´åº”è¯¥æ˜¯ç±»å‹åŒ¹é…æ‰å¯¹ï¼Œint åŒ¹é…ä¼ è¿›æ¥çš„intï¼Œint *åŒ¹é…ä¼ è¿›æ¥çš„int *,ä¸ºä»€ä¹ˆå½¢å‚æ˜¯å¼•ç”¨int ï¼Œæ—¢å¯ä»¥æ˜¯int åˆå¯ä»¥æ˜¯intå‘¢ï¼Ÿå¦‚æœè¯´å½¢å‚æ˜¯å¼•ç”¨int ï¼Œä¼  int è¿›å»æ˜¯ä¸ºäº†ç»‘å®šåˆ°å®å‚ä¸Šï¼Œé‚£ä¼ ä¸€ä¸ªå·²ç»ç»‘å®šçš„int è¿›å»æ˜¯ç»‘å®šä»€ä¹ˆå‘¢ï¼Ÿ è§£ç­”ï¼šä½¿ç”¨æŒ‡é’ˆæˆ–è€…å¼•ç”¨ä½œä¸ºå½¢å‚æ˜¯ä¸ºäº†è§£å†³æŒ‰å€¼ä¼ é€’å¯èƒ½å¯¼è‡´çš„é—®é¢˜ã€‚ æ‰€ä»¥è¿™é‡Œå†æ¬¡è®²ä¸€ä¸‹ä½¿ç”¨æŒ‡é’ˆï¼Œå¼•ç”¨å’Œå€¼ä½œä¸ºå½¢å‚æ‰€å¯¼è‡´çš„ç»“æœã€‚ C++æ•™ç§‘ä¹¦éƒ½ä¼šç”¨ä¸€ä¸ªäº¤æ¢ä¸¤ä¸ªå˜é‡çš„å€¼çš„å‡½æ•°æ¥ä¸¾ä¾‹ï¼š void swap(int a, int b); //ä½¿ç”¨æŒ‡é’ˆå’Œå¼•ç”¨çš„æƒ…å†µä¸‹å½¢å‚ç±»å‹åˆ†åˆ«ä¸ºint*å’Œint int temp; //ä½¿ç”¨æŒ‡é’ˆä¸ºå½¢å‚çš„æƒ…å†µä¸‹éœ€è¦å°†ä»¥ä¸‹çš„aå’Œbåˆ†åˆ«æ›¿æ¢ä¸º*aå’Œ*b temp = a; a = b; b = temp; ç»“æœæ˜¯æ€ä¹ˆæ ·çš„é¢˜ä¸»åº”è¯¥æ¸…æ¥šï¼šæŒ‰å€¼ä¼ é€’æ— æ³•å®Œæˆè¿™ä¸€è¡Œä¸ºï¼Œè€Œä¼ é€’æŒ‡é’ˆæˆ–è€…å¼•ç”¨æ˜¯å¯è¡Œçš„ã€‚ é‚£ä¹ˆåŸå› æ˜¯ä»€ä¹ˆï¼Ÿ åœ¨æŒ‰å€¼ä¼ é€’çš„æƒ…å†µä¸‹ï¼š int x = 4, y = 5;swap(x, y);//...........................mainå‡½æ•°å…¶å®ƒéƒ¨åˆ†..........................void swap(int a, int b) int temp; temp = a; a = b; b = temp; ç¬¬ä¸€æ­¥ï¼šç¼–è¯‘å™¨ä¼šåœ¨å†…å­˜å¼€è¾Ÿä¸¤ä¸ªèƒ½å­˜æ”¾intå‹å˜é‡çš„åŒºåŸŸï¼ˆå‡è®¾åˆ†åˆ«ä¸º0xAAAAAAAAå’Œ0xBBBBBBBBï¼‰ï¼Œç”¨äºä¿å­˜xå’Œyçš„å€¼ã€‚ç¬¬äºŒæ­¥ï¼šswapå‡½æ•°æ¥æ”¶xå’Œyçš„å€¼ï¼Œç¼–è¯‘å™¨ä¼šå¦å¤–å¼€è¾Ÿä¸¤ä¸ªå­˜æ”¾intå‹å˜é‡çš„åŒºåŸŸï¼ˆå‡è®¾åˆ†åˆ«ä¸º0xCCCCCCCCå’Œ0xDDDDDDDDï¼‰ï¼Œå°†4å’Œ5åˆ†åˆ«èµ‹ç»™å½¢å‚aå’Œbã€‚ç¬¬ä¸‰æ­¥ï¼šswapå‡½æ•°å®Œæˆäº¤æ¢ï¼Œæ­¤æ—¶å½¢å‚a5, b4ï¼Œä½†æ˜¯å®å‚xå’Œyçš„å€¼å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–ã€‚å› ä¸ºswapå‡½æ•°åªäº¤æ¢äº†0xCCCCCCCCå’Œ0xDDDDDDDDä¸¤å—åŒºåŸŸå‚¨å­˜çš„å€¼ï¼Œå¹¶æ²¡æœ‰å½±å“åˆ°0xAAAAAAAAå’Œ0xBBBBBBBBã€‚æ‰€ä»¥xå’Œyæœ¬èº«æ²¡æœ‰å—åˆ°swapå‡½æ•°çš„å½±å“ï¼Œäº¤æ¢å¤±è´¥ã€‚ å½¢å‚ä¸ºæŒ‡é’ˆçš„æƒ…å†µä¸‹ï¼š int x = 4, y = 5;int *px = x, *py = y;swap(px, py);//...........................mainå‡½æ•°å…¶å®ƒéƒ¨åˆ†..........................void swap(int* a, int* b) int temp; temp = *a; *a = *b; *b = temp; ç¬¬ä¸€æ­¥ï¼šç¼–è¯‘å™¨ä¼šåœ¨å†…å­˜å¼€è¾Ÿä¸¤ä¸ªèƒ½å­˜æ”¾intå‹å˜é‡çš„åŒºåŸŸï¼ˆå‡è®¾åˆ†åˆ«ä¸º0xAAAAAAAAå’Œ0xBBBBBBBBï¼‰ï¼Œç”¨äºä¿å­˜xå’Œyçš„å€¼ã€‚ ç¬¬äºŒæ­¥ï¼šç¼–è¯‘å™¨ä¼šåœ¨å†…å­˜å¼€è¾Ÿä¸¤ä¸ªèƒ½å­˜æ”¾intå‹æŒ‡é’ˆçš„åŒºåŸŸï¼ˆå‡è®¾åˆ†åˆ«ä¸º0xCCCCCCCCå’Œ0xDDDDDDDDï¼‰ï¼Œä¸¤å—åŒºåŸŸåˆ†åˆ«å­˜å‚¨xå’Œyçš„åœ°å€ï¼ˆå³0xAAAAAAAAå’Œ0xBBBBBBBBï¼‰ ç¬¬ä¸‰æ­¥ï¼šswapå‡½æ•°æ¥æ”¶pxå’Œpyçš„å€¼ï¼Œç¼–è¯‘å™¨ä¼šå¦å¤–å¼€è¾Ÿä¸¤ä¸ªå­˜æ”¾intå‹æŒ‡é’ˆçš„åŒºåŸŸï¼ˆå‡è®¾åˆ†åˆ«ä¸º0xEEEEEEEEå’Œ0xFFFFFFFFï¼‰ï¼Œå°†0xAAAAAAAAå’Œ0xBBBBBBBBåˆ†åˆ«èµ‹ç»™å½¢å‚aå’Œbã€‚ ç¬¬å››æ­¥ï¼šswapå‡½æ•°åˆ›é€ ä¸€ä¸ªintå‹å˜é‡tempï¼Œå‡è®¾åœ°å€ä¸º0xGGGGGGGGã€‚ -â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ ç¬¬äº”æ­¥ï¼š temp = *a; *açš„å€¼å°±æ˜¯xçš„å€¼ï¼ˆå³4ï¼‰ï¼Œtempè·å¾—4è¿™ä¸ªå€¼ã€‚ -â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ ç¬¬å…­æ­¥ï¼š *a = *b; å½¢å‚açš„å€¼æ˜¯0xAAAAAAAAï¼Œæ‰€ä»¥è¿™ä¸€å¥å°†0xAAAAAAAAè¿™ä¸€å—å†…å­˜æ‰€å­˜å‚¨çš„å€¼ç”±4ä¿®æ”¹ä¸º5ï¼Œè€Œ0xAAAAAAAAæ­£æ˜¯xçš„åœ°å€ã€‚ä¹Ÿå°±æ˜¯è¯´xæœ¬èº«çš„å€¼è¢«æ”¹æˆäº†5ã€‚ -â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ ç¬¬ä¸ƒæ­¥ï¼š *b = temp; åŒç†ï¼Œå½¢å‚bçš„å€¼æ˜¯0xBBBBBBBBï¼Œè¿™ä¸€å¥å°†0xBBBBBBBBè¿™ä¸€å—å†…å­˜æ‰€å­˜å‚¨çš„å€¼ç”±5ä¿®æ”¹ä¸º4ï¼Œè€Œ0xBBBBBBBBæ­£æ˜¯yçš„åœ°å€ã€‚ä¹Ÿå°±æ˜¯è¯´yæœ¬èº«çš„å€¼è¢«æ”¹æˆäº†4ã€‚ swapå‡½æ•°æ‰§è¡Œå®Œæ¯•åxå’Œyçš„å€¼åˆ†åˆ«ä¸º5å’Œ4ï¼Œäº¤æ¢æˆåŠŸã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœä¼ å…¥ä¸¤ä¸ªintå‹å˜é‡è€Œä¸æ˜¯intå‹æŒ‡é’ˆï¼Œåˆ™ç¼–è¯‘ä¸ä¼šé€šè¿‡ã€‚å› ä¸ºintå‹å˜é‡å¹¶ä¸æ˜¯åœ°å€ï¼Œåœ¨aä¸ºintå‹å˜é‡çš„æƒ…å†µä¸‹ï¼Œaå¹¶ä¸æ˜¯ç¬¦å·çš„åˆæ³•ç”¨é€”ã€‚ -â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ å½¢å‚ä¸ºå¼•ç”¨çš„æƒ…å†µä¸‹ï¼š int x = 4, y = 5;swap(x, y);//...........................mainå‡½æ•°å…¶å®ƒéƒ¨åˆ†..........................void swap(int a, int b) int temp; temp = a; a = b; b = temp; ç¬¬ä¸€æ­¥ï¼šç¼–è¯‘å™¨ä¼šåœ¨å†…å­˜å¼€è¾Ÿä¸¤ä¸ªèƒ½å­˜æ”¾intå‹å˜é‡çš„åŒºåŸŸï¼ˆå‡è®¾åˆ†åˆ«ä¸º0xAAAAAAAAå’Œ0xBBBBBBBBï¼‰ï¼Œç”¨äºä¿å­˜xå’Œyçš„å€¼ã€‚ ç¬¬äºŒæ­¥ï¼šä¸¤ä¸ªintå‹å‚æ•°ä¼ å…¥swapå‡½æ•°ï¼Œå‡½æ•°å°†å½¢å‚aå’Œbåˆ†åˆ«å£°æ˜ä¸ºxå’Œyçš„å¼•ç”¨ã€‚æ­¤æ—¶açš„åœ°å€å’Œxä¸€æ ·æ˜¯0xAAAAAAAAï¼Œbçš„åœ°å€å’Œyä¸€æ ·æ˜¯0xBBBBBBBBã€‚ ç¬¬ä¸‰æ­¥ï¼šæ­¤æ—¶swapå‡½æ•°äº¤æ¢aå’Œbçš„å€¼ï¼Œç”±äºaå’Œbçš„åœ°å€åˆ†åˆ«ä¸xå’Œyçš„åœ°å€ç›¸åŒï¼ˆå³0xAAAAAAAAå’Œ0xBBBBBBBBï¼‰ï¼Œè¯¥å‡½æ•°å®Œæˆäº†å¯¹xå’Œyçš„å€¼çš„äº¤æ¢ã€‚äº¤æ¢å0xAAAAAAAAå­˜å‚¨çš„å€¼ä¸º5ï¼Œ0xBBBBBBBBå­˜å‚¨çš„å€¼ä¸º4ã€‚ å½“å½¢å‚ç±»å‹ä¸ºå¼•ç”¨æ—¶ï¼Œå®å‚å’Œå½¢å‚å…±äº«ä¸€ä¸ªåœ°å€ï¼Œå¯¹å½¢å‚çš„ä¿®æ”¹ä¹Ÿå°±æ˜¯å¯¹å®å‚çš„ä¿®æ”¹ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨æŒ‡é’ˆå’Œå¼•ç”¨åˆ†åˆ«å®ç°äº¤æ¢å˜é‡å€¼çš„æœºåˆ¶æ˜¯ä¸åŒçš„ã€‚å°½ç®¡ä¸¤ç§æ–¹æ³•éƒ½ç›´æ¥å¯¹xå’Œyçš„åœ°å€å‚¨å­˜çš„å€¼è¿›è¡Œäº†ä¿®æ”¹ï¼Œä½†æ˜¯å½“å½¢å‚æ˜¯æŒ‡é’ˆæ—¶ï¼Œaå’Œbçš„å€¼å¹¶æœªå‘ç”Ÿå˜åŒ–ï¼ˆä¾ç„¶åˆ†åˆ«æ˜¯xå’Œyçš„åœ°å€ï¼‰ï¼›è€Œå½“å½¢å‚æ˜¯å¼•ç”¨æ—¶ï¼Œaå’Œbçš„å€¼å‘ç”Ÿäº†å˜åŒ–ã€‚ -â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ æœ€åå›åˆ°é—®é¢˜æœ¬èº«ï¼š ä¸ºä»€ä¹ˆå½¢å‚æ˜¯å¼•ç”¨int ï¼Œæ—¢å¯ä»¥æ˜¯int åˆå¯ä»¥æ˜¯intå‘¢ï¼Ÿ ä¸¾ä¸ªä¾‹å­ï¼š #include iostreamusing namespace std;int main() int a = 1, b = 2; //å£°æ˜å¹¶åˆå§‹åŒ–ä¸¤ä¸ªintå‹å˜é‡ int *pa = a, *pb = b; //paå’Œpbåˆ†åˆ«ä¸ºæŒ‡å‘aå’Œbçš„intå‹æŒ‡é’ˆ int ra = a, rb = b; //raå’Œrbåˆ†åˆ«ä¸ºæŒ‡å‘aå’Œbçš„intå‹å¼•ç”¨ cout a*b= a*b endl; //åˆæ³•ï¼Œè¾“å‡ºä¸º2 cout pa*pb= pa*pb endl; //éæ³•ï¼Œç¼–è¯‘æŠ¥é”™ cout ra*rb= ra*rb endl; //åˆæ³•ï¼Œè¾“å‡ºåŒæ ·ä¸º2 return 0; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œrarbçš„ç»“æœå’Œabå®Œå…¨ä¸€è‡´ï¼Œå°½ç®¡raå’Œrbæ˜¯æŒ‡å‘intå‹å˜é‡çš„å¼•ç”¨ï¼Œä½†æ˜¯raå’Œrbåœ¨è¢«å£°æ˜ä¸ºå¼•ç”¨ä»¥åä¹Ÿå¯ä»¥è¢«å½“ä½œintå‹å˜é‡è¿›è¡Œå¤„ç†ã€‚è€Œpaå’Œpbæ˜¯æŒ‡å‘intå‹å˜é‡çš„æŒ‡é’ˆï¼Œå®ƒä»¬å­˜å‚¨çš„æ˜¯aå’Œbçš„åœ°å€è€Œä¸æ˜¯aå’Œbçš„å€¼ï¼Œæ‰€ä»¥å¯¹paå’Œpbè¿›è¡Œintå‹å˜é‡çš„è¿ç®—æ˜¯éæ³•çš„ã€‚ -â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ å¦‚æœè¯´å½¢å‚æ˜¯å¼•ç”¨int ï¼Œä¼ intè¿›å»æ˜¯ä¸ºäº†ç»‘å®šåˆ°å®å‚ä¸Šï¼Œé‚£ä¼ ä¸€ä¸ªå·²ç»ç»‘å®šçš„int è¿›å»æ˜¯ç»‘å®šä»€ä¹ˆå‘¢ï¼Ÿ ä¿®æ”¹ä¸€ä¸‹ä¸Šé¢çš„ä¾‹å­ï¼š #include iostreamusing namespace std;int main() int a = 1, b = 2; //å£°æ˜å¹¶åˆå§‹åŒ–ä¸¤ä¸ªintå‹å˜é‡ int ra = a, rb = b; //raå’Œrbåˆ†åˆ«ä¸ºæŒ‡å‘aå’Œbçš„intå‹å¼•ç”¨ int rra = ra, rrb = rb; //rraå’Œrrbåˆ†åˆ«ä¸ºæŒ‡å‘raå’Œrbçš„intå‹å¼•ç”¨ cout a*b= a*b endl; //åˆæ³•ï¼Œè¾“å‡ºä¸º2 cout ra*rb= ra*rb endl; //åˆæ³•ï¼Œè¾“å‡ºåŒæ ·ä¸º2 cout rra*rrb= rra*rrb endl; //åˆæ³•ï¼Œè¾“å‡ºä¾ç„¶ä¸º2 return 0; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œrraä¸ºæŒ‡å‘ã€æŒ‡å‘intå‹å˜é‡çš„å¼•ç”¨ã€‘çš„å¼•ç”¨ï¼Œå›½å†…çš„C++æ•™ç§‘ä¹¦åœ¨è®²åˆ°å¼•ç”¨ä¹Ÿä¼šæä¸€ä¸‹æŒ‡å‘å¼•ç”¨çš„å¼•ç”¨æ˜¯åˆæ³•çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œraè¢«å¼•ç”¨æ˜¯ä¼šè¢«å½“ä½œæ™®é€šçš„intå‹å˜é‡å¤„ç†ã€‚ å½“ä¸€ä¸ªintå‚æ•°ä¼ å…¥swapå‡½æ•°çš„æ—¶å€™ï¼ŒåŒæ ·åœ°ï¼Œè¯¥intå‚æ•°ä¼šè¢«å½“ä½œä¸€ä¸ªintå‹å˜é‡ï¼Œç„¶åå½¢å‚å°±æ˜¯è¿™ä¸ªå˜é‡çš„å¼•ç”¨ã€‚æ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ä¼ å…¥intæˆ–intçš„è¾“å‡ºéƒ½æ˜¯ä¸€æ ·çš„ã€‚","tags":["c++","å¼•ç”¨"],"categories":["C++ç¬”è®°"]},{"title":"c++primerç¬¬åç« ç»ƒä¹ é¢˜","path":"/2023/05/20/c++primerç¬¬åç« ç»ƒä¹ é¢˜/","content":"ä»€ä¹ˆæ˜¯ç±» ç±»æ˜¯ç”¨æˆ·å®šä¹‰çš„ä¸€æ–°çš„ç§æ•°æ®ç±»å‹ï¼Œå®ƒåŒ…æ‹¬æ•°æ®çš„è¡¨ç¤ºå’Œæ“ä½œæ•°æ®çš„æ–¹æ³•ï¼ˆæ¥å£å‡½æ•°ï¼‰ã€‚ ç±»å¦‚ä½•å®ç°æŠ½è±¡ï¼Œå°è£…å’Œæ•°æ®éšè—ï¼Ÿ æŠ½è±¡ï¼š å°è£…ï¼šåªéœ€è¦çŸ¥é“ç±»é‡Œè¾¹çš„æˆå‘˜å‡½æ•°æ€ä¹ˆç”¨è¡Œäº†ï¼Œå¹¶ä¸éœ€è¦çŸ¥é“å…¶å®ç°çš„ç»†èŠ‚ã€‚ æ•°æ®éšè—ï¼šç±»å®šä¹‰åŒ…æ‹¬ç§æœ‰éƒ¨åˆ†ï¼ˆprivateï¼‰å’Œå…¬å…±éƒ¨åˆ†ï¼ˆpublicï¼‰ã€‚åªèƒ½é€šè¿‡ç±»çš„æˆå‘˜å‡½æ•°æ‰èƒ½è®¿é—®ç±»ä¸­çš„æ•°æ®ï¼Œå«åšæ•°æ®éšè—ã€‚ å¯¹è±¡å’Œç±»ä¹‹é—´çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ ç±»å’Œå¯¹è±¡çš„å…³ç³»å°±å¥½æ¯”äºæ•°æ®ç±»å‹å’Œå˜é‡çš„å…³ç³»ï¼Œæ¯”å¦‚Int iã€‚intç±»æ¯”äºç±»ï¼Œiç±»æ¯”äºå¯¹è±¡ã€‚ ç±»æ˜¯æŠ½è±¡çš„ï¼Œå¯¹è±¡ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯ç±»çš„å®ä¾‹åŒ–ã€‚ é™¤äº†æ˜¯å‡½æ•°ä¹‹å¤–ï¼Œç±»å‡½æ•°æˆå‘˜å’Œç±»æ•°æ®æˆå‘˜ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ æ¯ä¸ªå¯¹è±¡éƒ½æœ‰å±äºè‡ªå·±çš„æ•°æ®æˆå‘˜ï¼Œä½†æ˜¯æ‰€æœ‰çš„å¯¹è±¡å…±äº«ä¸€ç»„æˆå‘˜å‡½æ•°ã€‚æ•°æ®æˆå‘˜ä¸€èˆ¬ç§æœ‰ï¼Œå‡½æ•°æˆå‘˜ä¸€èˆ¬å…±æœ‰ã€‚é€šè¿‡å…±æœ‰çš„æˆå‘˜å‡½æ•°è®¿é—®ç§æœ‰çš„æ•°æ®æˆå‘˜ã€‚ æœªå®Œâ€¦.","tags":["c++"],"categories":["C++ç¬”è®°"]},{"title":"ofstremå’Œistreamçš„åŒºåˆ«","path":"/2023/05/20/ofstremå’Œistreamçš„åŒºåˆ«/","content":"ofstremå’Œistreamçš„åŒºåˆ«ofstremå’Œistreamçš„åŒºåˆ« ofstreamæ–‡ä»¶å†™æ“ä½œï¼Œæ˜¯ä»å†…å­˜åˆ°ç¡¬ç›˜ ios::out å†™æ–‡ä»¶ ifstreamæ–‡ä»¶è¯»æ“ä½œï¼Œæ˜¯ä»ç¡¬ç›˜åˆ°å†…å­˜ ios::in è¯»æ–‡ä»¶ fstreamè¯»å†™æ“ä½œï¼Œå¯¹æ‰“å¼€çš„æ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œ å¦‚æœæƒ³è¦ä»¥è¾“å…¥æ–¹å¼æ‰“å¼€ï¼Œå°±ç”¨Ifstream å¦‚æœæƒ³è¦ä»¥è¾“å‡ºæ–¹å¼æ‰“å¼€ï¼Œå°±ç”¨ofstream å¦‚æœæƒ³ä»¥è¾“å…¥è¾“å‡ºæ–¹å¼æ‰“å¼€ï¼Œå°±ç”¨fstream æ³›å‹ç¼–ç¨‹STLå‡½æ•°æ¨¡æ¿ ç±»æ¨¡æ¿ Forå¾ªç¯å†…éƒ¨å®šä¹‰çš„å˜é‡ï¼Œæ¯æ¬¡å¾ªç¯éƒ½è¢«é‡æ–°å®šä¹‰ å‡½æ•°éœ€è¦ä¼ å…¥çš„å‚æ•°æ˜¯ å¼•ç”¨ ï¼Œè°ƒç”¨å‡½æ•°æ—¶ä¼ å…¥åœ°å€ï¼ˆaï¼‰æˆ–è€…ä¼ å…¥æŒ‡é’ˆå˜é‡éƒ½ä¼šæŠ¥é”™ã€‚åªèƒ½ä¼ å…¥å˜é‡æœ¬èº«çš„åå­— å‡½æ•°éœ€è¦ä¼ å…¥çš„å‚æ•°æ˜¯ æŒ‡é’ˆ ï¼Œè°ƒç”¨å‡½æ•°æ—¶ä¼ å…¥åœ°å€ï¼ˆaï¼‰æˆ–è€…ä¼ å…¥æŒ‡é’ˆå˜é‡éƒ½æ˜¯æ­£ç¡®çš„ã€‚ å½“å½¢å‚ç±»å‹ä¸ºå¼•ç”¨æ—¶ï¼Œå®å‚å’Œå½¢å‚å…±äº«ä¸€ä¸ªåœ°å€ï¼Œå¯¹å½¢å‚çš„ä¿®æ”¹ä¹Ÿå°±æ˜¯å¯¹å®å‚çš„ä¿®æ”¹ã€‚ void test01(int n)\tn = 10;void test02(int *pn)\t*pn = 10;int main()\tint a = 100;\tint b = 1000;\tint* pa = b;\ttest01(a); //test01(pa);//æ— æ³•å°†å‚æ•°ä»int *è½¬æ¢ä¸º int //test01(a);//æ— æ³•å°†å‚æ•°ä»int *è½¬æ¢ä¸º int test02(pa);\ttest02(a);\treturn 0; å½“ä¸€ä¸ªintå‚æ•°ä¼ å…¥swapå‡½æ•°çš„æ—¶å€™ï¼ŒåŒæ ·åœ°ï¼Œè¯¥intå‚æ•°ä¼šè¢«å½“ä½œä¸€ä¸ªintå‹å˜é‡ï¼Œç„¶åå½¢å‚å°±æ˜¯è¿™ä¸ªå˜é‡çš„å¼•ç”¨ã€‚æ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ä¼ å…¥intæˆ–intçš„è¾“å‡ºéƒ½æ˜¯ä¸€æ ·çš„ ä¸è¦å°†å‡½æ•°å®šä¹‰ï¼ˆå†…è”å‡½æ•°é™¤å¤–ï¼‰æˆ–è€…å˜é‡ç”³æ˜æ”¾åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œå¦åˆ™å¤´æ–‡ä»¶åŒ…å«ä¸€ä¸ªå‡½æ•°å®šä¹‰ï¼Œç„¶ååœ¨å…¶ä»–ä¸¤ä¸ªæ–‡ä»¶ä¸­åŒ…å«è¯¥å¤´æ–‡ä»¶ï¼ŒåŒä¸€ä¸ªç¨‹åºä¸­å°†åŒ…å«åŒä¸€ä¸ªå‡½æ•°çš„ä¸¤ä¸ªå®šä¹‰ï¼Œå°†ä¼šå‡ºé”™ã€‚ å°†ç»“æ„æ”¾åœ¨å¤´æ–‡ä»¶ä¸­æ˜¯å¯ä»¥çš„ã€‚å› ä¸ºå®ƒä»¬ä¸åˆ›å»ºçš„å¯¹è±¡ï¼ŒçŸ¥è¯†åœ¨æºä»£ç æ–‡ä»¶ä¸­å£°æ˜ç»“æ„å˜é‡æ—¶ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨å¦‚ä½•åˆ›å»ºè¯¥ç»“æ„å˜é‡ int main()\tint a = 10;//ä½œç”¨åŸŸä¸ºæ•´ä¸ªmain()å‡½æ•° int b = 10;//ä½œç”¨åŸŸä¸ºå†…éƒ¨ cout b endl;//æ­£ç¡® cout a endl;\t//cout b endl;//æœªå®šä¹‰\tint b = 100;//æ­£ç¡®ï¼Œä¸Šä¸€ä¸ªint bçš„ä½œç”¨åŸŸåªåœ¨ä¸Šä¸€ä¸ªä»£ç å—ä¸­ï¼Œå¯ä»¥å†å®šä¹‰ä¸€ä¸ªb\treturn 0;","tags":["c++","stl"],"categories":["C++ç¬”è®°"]},{"title":"å¼•ç”¨","path":"/2023/05/20/å¼•ç”¨/","content":"å¼•ç”¨å‰é¢åŠ ä¸Šconst æ—¶ï¼Œå½“ç±»å‹ä¸åŒ¹é…æ—¶ï¼Œä¼šäº§ç”Ÿä¸´æ—¶å˜é‡const æˆå‘˜å‡½æ•°ï¼šåœ¨å‡½æ•°åè¾¹åŠ ä¸Šconst,è¯´æ˜å‡½æ•°è°ƒç”¨ä¸ä¼šä¿®æ”¹å¯¹è±¡ï¼Œä¸€èˆ¬è¦éµå®ˆè¿™ä¸ªè§„åˆ™ï¼Œå¦å¤–åªæœ‰æˆå‘˜å‡½æ•°æ‰å¯ä»¥ç”¨constï¼Œä¸€èˆ¬çš„å‡½æ•°ä¸å¯ä»¥è¿™æ ·å†™thisæŒ‡é’ˆæ°¸è¿œæŒ‡å‘è°ƒç”¨æˆå‘˜å‡½æ•°çš„å¯¹è±¡ä¸¾ä¾‹ Stock1.top_val(stock2)ï¼Œthis æŒ‡å‘stock1å¯¹è±¡çš„åœ°å€ ç›´æ¥æˆå‘˜è¿ç®—ç¬¦.é—´æ¥æˆå‘˜è¿ç®—ç¬¦-ä½œç”¨åŸŸè§£æè¿ç®—ç¬¦ï¼šï¼šç±»ä½œç”¨åŸŸ class scopeé™å®šå qualified name åœ¨ç±»çš„å£°æ˜ä¸­ ä¸èƒ½ç›´æ¥const int a0;å£°æ˜å¸¸é‡ï¼Œå› ä¸ºä»–ä¸ä¼šåˆ›å»ºè¿™ä¸ªå†…å­˜å¯ä»¥ä½¿ç”¨æšä¸¾æˆ–è€…åŠ ä¸Šstatic é™æ€çš„æˆå‘˜å˜é‡çš„ç‰¹ç‚¹ æ‰€æœ‰å¯¹è±¡å…±äº«åŒä¸€æ•°æ® ç¼–è¯‘é˜¶æ®µå°±åˆ†é…å†…å­˜ ç±»å†…å£°æ˜ ç±»å¤–åˆå§‹åŒ–é™æ€æˆå‘˜å‡½æ•° åªèƒ½è®¿é—®é™æ€æ•°æ® å¤šæ€çš„ä½¿ç”¨æ¡ä»¶çˆ¶ç±»æŒ‡é’ˆæˆ–è€…å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡ä¸€ä¸ªæ¥å£å¤šä¸ªçŠ¶æ€ ä¸€çº§æŒ‡é’ˆå­˜æ”¾æ™®é€šå˜é‡çš„åœ°å€äºŒçº§æŒ‡é’ˆå­˜æ”¾ä¸€çº§æŒ‡é’ˆçš„åœ°å€int main(void){\tint a10;\tint *p\tint **pp\tprintf(â€œ%d,%d,%d â€,p,p,*p);\tprintf(â€œ%d,%d,%d,%dâ€,pp,pp,*pp,**pp);\treturn 0;}","tags":["c++","å¼•ç”¨"],"categories":["C++ç¬”è®°"]},{"title":"myblogtemplate","path":"/2023/01/01/myblogtemplate/","content":"æˆ‘æ˜¯æ‘˜è¦â€¦ xxxé¢˜ç›®ï¼šè§£æ³•-æ€è·¯ï¼š 1. 2. 3. å¤æ‚åº¦ï¼š æ—¶é—´å¤æ‚åº¦ï¼š ç©ºé—´å¤æ‚åº¦ï¼š ä»£ç ï¼š è¯­æ³•å°è®¡ è¯¥é¢˜æ²¡æœ‰è¯­æ³•å°è®¡ *","tags":["c++","xxx"],"categories":["C++åˆ·é¢˜ç¬”è®°"]},{"title":"About Me","path":"/about/index.html","content":"å—¨ï¼Œæˆ‘æ˜¯æ‘¸é±¼å¤§ç‹ ğŸ‘‹â˜• å…³äºæˆ‘ ğŸ”­ æ­£åœ¨ç ”ç©¶ï¼šè¯­è¨€æœåŠ¡ã€åº”æ€¥è¯­è¨€ä½“ç³»ã€RAG æ£€ç´¢å¢å¼ºã€æœºå™¨äººæ§åˆ¶ ğŸŒ± æœ€è¿‘åœ¨å­¦ä¹ ï¼šMoveIt è§„åˆ’ã€ROS é¥æ“ä½œ ğŸ§© å…´è¶£é¢†åŸŸï¼šLINUX é©±åŠ¨å¼€å‘ AI è¯­è¨€æœåŠ¡ æœºå™¨äºº æ•™è‚²ç§‘æŠ€ ğŸ—º æ¢¦æƒ³â‘ ï¼šè‡ªå·±â€œå®ç°â€ä¸€å°è®¡ç®—æœºï¼Œä»é›¶å¼€å§‹å†™ CPUã€æ“ä½œç³»ç»Ÿã€ç¼–è¯‘å™¨â€¦ ğŸ¯ æ¢¦æƒ³â‘¡ï¼šåœ¨æ‘¸é±¼ä¸­æˆä¸ºå…¨æ ˆå­¦è€… ğŸ§  ğŸ¯ æ¢¦æƒ³â‘¢ï¼šèººå¹³â€¦ ğŸ· æˆ‘çš„æ ‡ç­¾ ä»¥ä¸‹æ˜¯æˆ‘åœ¨ä¸åŒå‘ä½çš„æŠ˜è…¾è®°å½• ğŸ‘‡ï¼ˆç‚¹å‡»å³å‰å¾€åˆ†ç±»ï¼‰ ğŸ¤– Linux ğŸŒ é©±åŠ¨å¼€å‘ ğŸ“Š åˆ·é¢˜ç¬”è®° â˜ï¸ æ—…è¡Œæ‚è®° ğŸ’» å‰ç«¯å¼€å‘ ğŸ  æ­å»ºåšå®¢ PSï¼šåšå®¢åŠŸèƒ½è¿˜å¾…å®Œå–„â€¦ ğŸ’¼ å·¥ä½œ å­¦ä¹ ç»å† ğŸ“ USTB (2023.09 â€“ 2026.07) å·¥ä½œå²—ä½ï¼šæ»¥ç«½å……æ•° å·¥ä½œå†…å®¹ï¼šæ‘†çƒ‚ å·¥ä½œæŠ€èƒ½ï¼šCtrl + C â†’ Ctrl + V è”ç³»æˆ‘ GitHubï¼šdkyou é‚®ç®±ï¼šdkyou@163.comæœ‰å¯èƒ½è”ç³»ä¸åˆ°ğŸ˜ Your browser does not support the video tag."}]